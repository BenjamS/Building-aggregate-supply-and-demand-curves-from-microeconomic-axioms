---
title: A theoretical derivation of the agricultural aggregate supply curve and research induced supply curve shift
# author: "Benjamin Schiek"
# date: "`r Sys.Date()`"
abstract: |
  Conventional models of the aggregate supply of agricultural commodities---specifically those used in ex-ante impact assessments of policy and research shocks---do not endogenously model the supply response to technology (or any other exogenous) shocks, but rather 1) assume the farm level supply response as exogenously given based on agronomic information, and then 2) assume, as a matter of fiat, the mechanism by which the farm level response manifests at the aggregate level (whether it is a shift or pivot of the aggregate supply curve, and what the adoption rate will be). Such models also do not account for farm heterogeneity---or, worse still, assume identical marginal farms---and do not account for farm entry/exit. For applications where these things matter, here a tractable aggregate supply model is formally derived from five weak axioms. Unlike the conventional models, the derived form is expressed in parameters that have clear economic meaning. This includes novel parameters such as price volatility and a term representing the mean probability of profit---which in turn endogenously accounts for farm entry/exit---thus broadening the range of policy questions that can be addressed in partial equilibrium analysis. As an illustrative use case, the model is fit to Kenya maize farm data. The fitted aggregate supply and price elasticity of aggregate supply curves agree with empirical estimates. Equations for the _endogenous_ adoption rate, supply response, and producer welfare impact are derived and showcased given a hypothetical exogenous technology shock in the Kenya maize farm population.
  distributional issues endogenous adoption rate
header-includes:
  - \usepackage{geometry}
  - \geometry{top=1in,left=1in,bottom=1in,right=1in}
  - \usepackage{framed}
  - \usepackage{setspace}\doublespacing
  - \usepackage{float}
  - \floatplacement{figure}{H}
  - \usepackage{amsmath}
  - \numberwithin{equation}{section}
output:
  pdf_document:
   fig_caption: true
   number_sections: true
#    latex_engine: xelatex
# mainfont: Times Roman
nocite: |
  @GIEWS14Jun2006
  @USDA28Jun2007
  @GIEWS15Jul2008
  @MoApressRelease2009
  @GIEWS5Aug2010
  @KFSSGJul2011
  @GIEWS16Jul2012
  @cmeData
  @jseData
bibliography: Theory of aggregate supply.bib
csl: american-journal-of-agricultural-economics.csl
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      dev = c("png", "tiff"),
                      dpi = 300)

library(tidyverse)
library(patchwork)
library(scales)
library(lubridate)
library(randomcoloR)
library(modelsummary)
library(flextable)

labelSize <- 2.5
smallLabelSize <- 2
titleSize <- 7
subtitleSize <- 7
legendTextSize <- 6
axisTextSize <- 6
axisTitleSize <- 7
facetTitleSize <- 7

mainFolder <- "D:/OneDrive - CGIAR/Documents 1/CIAT 2/A theory of aggregate supply and demand/"
priceFolder <- "Price data/"

```
   <!-- Allows for analysis of price and technology impacts at specific centiles. -->
  <!--  The results of ex-ante impact assessments often hinge critically upon these two assumptions Strange results cannot then be traced back to    That is to say, there is no actual modeling of economic decision making; rather, the decision making is exogenously introduced. are not explicitly or formally derived from standard microeconomic axioms. Nor does the specification of such models  Such models are then, by construction, theoretically opaque, with unclear mappings between model parameters and relevant empirical phenomena, and no accounting of farm entry/exit in response to price changes. -->
  <!-- [And this, in turn, precludes any possibility of rigorous, endogenous modeling of the supply response to technology (or any other exogenous) shocks. Instead, such models effectively assume the farm level supply response as exogenously given based on agronomic information; and then assume a mechanism by which this translates up to the aggregate level.] -->
<!-- [The two choices presented to us in the literature linear or curved... neither of which...] -->
<!-- unclear mapping between model parameters and relevant empirical phenomena. ...in turn precludes endogenous modeling of decision making... instead exogenously assumed there is no actual modeling of economic behavior or decision making. The economic decision making is assumed. it is questionable, then, in what sense such a model can even be called an economic model. literary statements surmises translated into mathematical symbols not better than the original literary form -->

# Introduction

The conventional linear and constant elasticity of supply (CES) aggregate supply curves commonly used in ex-ante impact assessments of new agricultural technology [@alston1995science; @alston2009economics] are not explicitly derived from microeconomic axioms, but rather specified primarily to facilitate calculations of consumer and producer surplus, with little consideration given to the plausibility of the theoretical underpinnings and empirical implications of this choice of functional form. In particular, it is unclear whether these forms are consistent with standard microeconomic axioms regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves.
<!-- (The model documentation might make passing reference to such axioms; but the models themselves are not formally derived from them.) -->

That is to say, if we consider aggregate supply $Q$ in its most basic definition as the definite integral of farm production function $q^*$ times the production density $\rho(q^*)$ over the domain of profitable production $(\underline{q}^*, \overline{q}^*)$,

\begin{equation}
Q(P) = \int_{\underline{q}^*}^{\overline{q}^*} q^* \rho(q^*) \: dq^*
\label{eq:aggSup0}
\end{equation}

then it is not readily apparent from conventional linear and CES specifications of $Q$ what the function $q^*$ is, nor whether it is consistent with microeconomic theory. Critically, the conventional models also do not explicitly account for heterogeneously endowed farm populations (captured in the farm production density $\rho$)---or, worse still, assume a population of homogeneously endowed identical marginal farms; and they neglect to account for the domain of profitable production $(\underline{q}^*, \overline{q}^*)$, thus precluding any detailed analysis of supply response in terms of yield and entry/exit components.

Because these models are not formally derived from axioms, there is no clear mapping between their parameters and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.), such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters might be affected by the change. This, in turn, precludes any endogenous modeling of economic decision making on the part of farmers in response to technology, or any other exogenous, shocks. Instead, the conventional models introduce farm level economic decision making (i.e., the economically rational supply/expenditure/input mix response to the exogenous shock) as a calibrated assumption based on agronomic data gathered from field trials, literature, and/or consultation with scientists involved in the research under evaluation.

This bears emphasis. The conventional aggregate supply models specifically designed for ex-ante impact assessment of new technology do not in fact model the supply response to new technology, but rather present a mathematical description of a presumed supply response that has been predetermined outside of the model, and then exogenously introduced into it. Model guidelines might offer some words of warning about the difference between economically and agronomically optimal yields/expenditures/input mixes, and about the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation; but very little in the way of actionable advice is actually given. To redress conflicts of interest, e.g., Alston et al. [@alston1995science] prescribe the creation of
<!-- The absurdly high rates of return to agricultural R&D reported in the literature based on such models [@hurley2016] suggests that few practitioners follow this advice in any substantive way. -->

>\singlespacing"an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and...an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact".

\doublespacing

Admirable aspirations, to be sure, but not actionable. If research institute directors are hard pressed to effect such deep cultural changes over the course of a multi-year tenure, how can the lowly economist tasked with the impact assessment---often hired by the scientists as a short term consultant---be expected to do so?

The subsequent step of translating the exogenously introduced farm level response into an aggregate supply response likewise involves no endogenous modeling of economic behavior, but rather exogenous guesswork translated into mathematical symbols. That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate supply response should be represented as a pivot or parallel shift of the curve [@alston1995science; @norton1981evaluating; @voon1991calculation], or some combination thereof, the current default choice of parallel shift in most impact assessments emerges not on any theoretical or empirical basis, but purely as a matter of fiat [@alston2009economics].
<!-- The consensus since the 1990s is that the shock manifests as a parallel shift of the aggregate supply curve [@alston1995science]. But no theoretical or empirical grounds exist for this preference over, say, a supply curve pivot, or a combination of pivot and shift, which would result in a very different calculation of net benefits [@alston1995science; @alston2009economics]. -->

The final step of calculating net benefits in terms of discounted economic surplus, adjusted for probability of success, expected adoption rate, time lags in research and adoption, capital depreciation, and other exogenously collected parameters, bears many of the markings of a rigorous economic assessment. But insofar as the result of this calculation is prefigured by the initial, exogenously determined farm supply/expenditure response to technology change, and to its expression-by-fiat at the aggregate level, it is not so much an impact assessment as it is an impact _assertion_, i.e., an exercise in _petitio principii_.
<!-- To put it more plainly, impact assessments based on conventional supply curves are offer a depiction of what net benefits could look like _if_ the assumed supply and demand curves, type of supply curve shift, and magnitude of the shift are accurate (with no theoretical or empirical basis to suspect that they are). The  -->

Critics have long noted as much, if perhaps in a more understated way. Rose [-@rose1980supply], for example, notes that

>\singlespacing"[T]reatments have been concentrated on increasing the geometric sophistication of explanatory models and even that has been subject to fundamental errors. What is more important is to have an understanding of supply curves and the derivation of cost changes. Geometric manipulations are of little help at that level" [@rose1980supply].

\doublespacing

In other words, policy formation does not require mathematical descriptions of an exogenously assumed supply response to exogenous shocks, but rather endogenous modeling of the supply response to exogenous shocks. For those interested in such modeling, here an aggregate supply curve function is derived from the following five non-controversial economic axioms.

1) Diminishing marginal returns to input use

2) Farms maximize their expected net benefit subject to a budget constraint

3) Farms enter production only if they expect to make non-negative profit

4) Farm yield is lognormally distributed

5) Output price follows a geometric Brownian motion over time

In the course of the derivation, it becomes evident that five other desirable properties immediately follow from axioms 1 and 2 as corollaries, and need not be imposed as additional axioms: 1) The farm yield function is homogeneous (and thus homothetic) and 2) concave in inputs; 3) farm supply curves are upward sloping; 4) input demand curves are downward sloping; and 5) the derived yield function implies agreement with a consensus view of economic rationale driving technology adoption articulated by Lipton [-@lipton2005family].

On the other hand, two somewhat controversial corollaries also follow from this axiomatic approach: strictly decreasing returns to scale and constant marginal cost. The former contradicts the conventional wisdom handed down by Hicks [-@hicks1963theory] and Solow [-@solow1957technical]. The latter is well supported empirically [@lavoie2014post], but is eschewed in textbooks. Regardless of one's view on returns to scale and marginal cost curves, the very fact that it is possible to disagree with specific corollaries, and to trace the disagreement back to specific axioms, underscores a key strength of the derived model: its theoretical transparency. Under the theoretic opacity of the expedient approach, by contrast, it is not even possible to know if one agrees or disagrees with the premises, or whether the premises contradict each other mathematically, since those premises are stated in literary form (if they are stated at all), and the model is not explicitly derived from such premises.

All of the parameters appearing in the derived model have a straightforward interpretation in terms of relevant, measurable, empirical phenomena. This includes, in addition to the usual variables of interest (technology, agroclimatic variables, output price), a term that indirectly accounts for the farm employment rate (i.e. farm entry/exit) in response to price movements, and which is partly a function of farm expenditure population parameters. This facilitates the exploration of a range of distributional policy issues that conventional modeling approaches are admittedly ill suited to address [@norton1992economic]. When axiom 5 comes into play, the distributional term is shown to have a dual expression in stochastic price parameter space as the mean farm's probability of profit. Expression in stochastic price parameter space also introduces an alternative set of parameters (output price trend and volatility parameters, and the length of cropping season) that further extend the range of policy questions that can be addressed within the derived modeling framework.
<!-- effectively accounting for heterogeneous endowments. -->
<!-- Wohlgenant [-@wohlgenant1997nature] suggests the lognormal distribution as a suitable density fn... -->
<!-- the probability that output price will be greater than the mean farm's expected unit cost at harvest---i.e. the mean farm's probability of profit -->

In the Methodology section, immediately below, the model is derived from axioms 1-5. This includes a derivation of equations for assessing the endogenous supply response and producer welfare impact given an exogenous technology shock, together with an endogenous model of the adoption rate. The adoption rate model includes a term accounting for subsidies. The stochasticity of meteorology and output price is introduced at the end of the section. All major differences between the present work and the conventional model stem from this explicit, careful accounting of the endogenous response to exogenous shock, and of the stochastic nature of meteorology and output price.

After the Methodology, the derived model is fit to Kenya maize farm data as an illustrative use case. The fitted maize supply model is vetted against empirical estimates of maize supply at different price points across seven years. The model's estimates of both supply and the price elasticity of supply agree closely with empirical estimates. The model's explicit stochastic accounting of rainfall proves critical to this accuracy. A hypothetical, generic technology shock is then introduced in order to showcase the model's impact assessment capacity. The endogenously modeled aggregate supply response to the shock, and associated producer welfare outcomes, are evaluated at a range of different subsidy levels and assumed price shocks. Results are presented in a heatmap format to facilitate policy discussion and decision making.

Because the conventional linear and CES aggregate supply functions are in such wide use, an in depth literature review is included in the Appendix for those requiring a more detailed engagement with the literature than the cursory treatment above, and to thereby place the motivation for the present work on a more solid footing.

[Because the conventional linear and CES aggregate supply functions are in such wide use, it is first worthwhile to engage with that literature in more detail than is offered in the cursory treatment above, and to thereby place the motivation for the present work on a more solid footing.]

<!-- Changes in agronomic yield and expenditure observed at research stations do not directly translate into changes in economic yield and expenditure likely to occur in real farm populations. This economically obvious, empirically well documented [@herdt1988increasing; @balasubramanian2000yield], fact of life bears mentioning here because confusion about the difference between experimental agronomic and real world economic farm outcomes still pervades the conversation in many areas of agricultural research impact assessment [@sumberg2012mind]. And this is arguably rooted in the lack of practical, formal tools for addressing the matter in the conventional ex-ante impact assessment framework. To be clear, the authors of the conventional framework are cognizant of the matter; but offer little in the way of practical, formal tools for addressing it [@alston1995science]. -->
<!-- [and no transparency for what the assumptions behind the conversion from experimental result to economic yield are! And in practice,... always take the agronomic result as the economic result,[many studies]. also its effectively exogenous] -->
<!-- Information gathered in terms of the change in agronomic yield and/or expenditure must be converted into an estimate for $\partial \ln(g)$. -->

# Literature review

## Is impact assessment insensitive to misspecification of the supply curve?

When pressed on the matter, proponents of the conventional aggregate supply functions make little attempt to defend their specifications on empirical or theoretical grounds. On the contrary, proponents of linear models generally admit that real world commodity supply and demand curves are almost certainly never linear [@brester2023equilibrium]. Proponents of the CES model generally argue that CES models are probably at least slightly more accurate than linear specifications [@voon1991calculation], but likewise offer no formal derivation of their model from theory. Rather, the defense of conventional models centers on the argument that the functional form is irrelevant for purposes of impact assessment.
<!-- On the contrary, everyone involved in this literature acknowledges that the functional forms are specified primarily to facilitate calculations of consumer and producer surplus [@lindner1978supply; @alston1995science; @rose1980supply]. -->

>\singlespacing"The pertinent question is whether the functional form used is an adequate approximation for the purpose. It turns out, empirically, that measures of total research benefits and their distribution between producers and consumers are quite insensitive to choices of functional form. They are much more sensitive to the related but separate choices concerning the nature of the research-induced supply curve shift and elasticities" [@alston1995science].

\doublespacing

Alston et al. [-@alston1995science] cite three peer reviewed articles in support of this claim. One of the cited articles actually runs contrary to the claim, explicitly concluding that impact assessment results are highly sensitive to choices of functional form [@voon1991calculation]---a conclusion subsequently reaffirmed in a comment [@elbasha1997calculation] and reply [@edwards1997calculation]. Another cited article, by Lindner and Jarrett [-@lindner1978supply], concludes that impact assessment results are sensitive to the nature of the supply curve shift (pivot versus parallel shift); but also acknowledges that these shifts are determined by the choice of functional form. In their words,

>\singlespacing"[P]ast studies have made no attempt to justify or explain the particular assumptions made about the type of supply shift. In fact, in some studies the impression is given that the type of supply shift was determined by the specification of the mathematical form of the supply curve, which in turn appears to have been chosen simply for computational convenience" [@lindner1978supply].

\doublespacing

By the transitive property, then, their conclusion regarding impact assessment sensitivity to the type of supply curve shift extends to functional form, again contrary to the claim that functional form is irrelevant. Similarly, the third cited article, by Norton and Davis [-@norton1981evaluating], asserts that functional form is "less important than the type and magnitude of the supply shift". But then, contrary to this assertion, the authors proceed to survey four examples where the mathematical form of the shift is clearly prefigured by that of the supply curve; and explicitly state that differences between the four examples in the assessment of net benefits are due to differences in both type/magnitude of shift and functional form. Alston et al. [-@alston1995science] themselves point out that the practitioner is at liberty to choose between different types of shift only in the case of the linear specification---where the choice is between a pivot and a parallel shift, or some combination thereof. In the case of the CES specification, the practitioner is constricted to assume a pivot (a point later emphasized by Voon and Edwards [-@voon1991calculation]). And elsewhere Alston writes that "the choice [of type of supply shift is] dictated by analytic convenience, given _a prior_ choice of functional form for supply" [@martin1997producer].

A fourth document is also cited [@alston1990measuring], but is not peer reviewed and not, at the time of writing, readily available from the publisher. A subsequent peer reviewed article by Zhao et al. [-@zhao1997functional] cites the unavailable document as an annex to a technical report on R&D in the Australian wool industry. The main text of this report appears to have been published in a peer reviewed journal, but without the annex in question [@scobie1991returns]. In their own analysis, Zhao et al. [-@zhao1997functional] find that assessment of net benefits (economic surplus) is highly sensitive to misspecification of the functional form in the case of the CES specification, again contrary to the claim that impact assessments are insensitive to misspecification of the supply curve.

They also find that impact assessment is insensitive to misspecification error when 1) the linear specification is assumed together with 2) a parallel shift, and assuming 3) the shift is small [@zhao1997functional]. Proponents and critics alike acknowledge that the empirical and theoretical grounds for assumptions 1 and 2 are narrow, at best [@lindner1978supply; @alston2009economics; @voon1991calculation; @rose1980supply]. If the real shift is a pivot or mixture of pivot and shift, then Zhao et al.'s finding of insensitivity does not apply. Moreover, it is questionable whether the parallel supply curve shifts assumed in most economic surplus assessments of returns to agricultural R&D qualify as "small" [@hurley2014re; @alston2000research]. To know for sure, Zhao et al. [-@zhao1997functional] develop a method to calculate the upper bound on misspecification bias; but the present literature review finds no instance where this method has actually been implemented. Finally, Zhao et al. [-@zhao1997functional] acknowledge that their findings regarding linear misspecification are valid only insofar as farm populations consist entirely of identical marginal farms, a condition never actually observed in any real farm population.

In synthesis, then, it is misleading to characterize the cited literature as supportive of Alston et al.'s [-@alston1995science] broad claim that impact assessments are insensitive to misspecification of the functional form of the supply curve. More accurately, the literature supports the much narrower claim that impact assessments are insensitive to misspecification when the linear specification is assumed together with a parallel shift, and when the real shift is also parallel; and when the shift is small, and when the farm population consists of identical marginal farms. Apart from this exceptionally implausible case identified by Zhao et al. [-@zhao1997functional], the literature indicates that impact assessments are highly sensitive to functional form, whether directly, as in the case of the CES function, or by the transitive property, i.e., through a supply curve shift which is mathematically prefigured by the functional form of the supply curve.

## Is it impossible to do any better?

As a final line of defense, proponents of conventional aggregate supply curves argue that there is no alternative to their cavalier approach of arbitrarily assuming a functional form for supply curves and supply curve shifts, however implausible or grossly inaccurate they might be. Alston et al. [-@alston1995science] write:

>\singlespacing"What does economic theory tell us about the nature of ...[research induced aggregate supply curve] shifts? Unfortunately, not very much. To be confident about this aspect of the problem would require either (a) precise econometric evidence or (b) detailed information on the effects on individual agents, details of industry structure including details on exit and entry of firms, and a complete theory of aggregation. This information is not available; assumptions are unavoidable".

\doublespacing

<!-- The aggregate supply model derived in the subsequent sections -->
The present work is effectively one long disagreement with this passage. The sweeping claim that economic theory does not tell us "very much" about the nature of aggregate supply curve shifts is especially perplexing. On the contrary, economic theory provides a set of microeconomic principles whence a firm level yield envelope is derived, whence "effects on individual agents", i.e., farm level response to exogenous shock, can be can modeled. Insofar as the phrase "complete theory of aggregation" refers to the specification of aggregate supply and demand curves, this too can be derived from theory by integrating individual effects over a suitable density function (i.e., Equation \ref{eq:aggSup0}). The firm yield model implies bounds on the domain of optimal output, such that the "exit and entry of firms" is accounted for by integrating over the domain of optimal behavior.
<!-- (Similar bounds can be determined for optimal input use, whence an aggregate demand curve could be derived; but the focus here is limited to aggregate supply.) -->

To be clear, the "precise econometric evidence or...detailed information" that the authors refer to is, indeed, generally not available; but the suggestion that economic theory offers nothing in its stead is mistaken. One of the key purposes of having a theory is to draw inference when detailed information is unavailable or otherwise provides no clear answer to our questions. And, yes, "assumptions are unavoidable"---but in the sense that axioms 1-5 in the Introduction are unavoidable, not in the sense of superimposing an exogenously assumed supply response on top of said axioms. Not economic theory, then, but rather a descriptive mathematical formulation which, by construction, precludes endogenous modeling of the aggregate supply response to exogenous shocks, is what tells us "not very much" about the the aggregate supply response to exogenous shocks.
<!-- The authors themselves may have made little use of theory when they specified their linear aggregate supply and demand curves; but this does not mean that others are prohibited from doing so. -->

## The limited policy relevance of conventional forms

Effective policy formation requires careful assessment not only of the magnitude of net benefits of a given intervention, but also of their distribution across producers and consumers (the "food price dilemma"), and across income levels. Proponents and critics alike acknowledge that conventional functional forms are ill suited to the assessment of such distributional issues [@alston2009economics; @alston1995science; @lindner1978supply; @rose1980supply; @wohlgenant1997nature].

More specifically, impact assessments based on a pivot of the linear or CES supply curve can result in consumer-producer tradeoffs, whereas assessments based on a linear parallel shift of the linear supply curve guarantee increases in both consumer and producer welfare [@alston2009economics]. With no clear theoretical or empirical premise upon which to recommend one set of results over another, little confidence can be attached to any of them. This is remarkable considering that the primary motive for conventional supply curve specifications is to facilitate the assessment of changes in consumer and producer surplus. It is also noteworthy that, of all the possible arbitrary configurations of supply curve and type of shift, most agricultural R&D impact assessments assume the one that, by construction, results in the highest net benefits and avoids any food-price dilemma [@hurley2014re; @alston2000research; @alston2009economics].
<!-- mainly because they are not explicitly derived from a theoretical framework that maps model parameters to specific empirical economic phenomena. -->
<!-- Effective food policy formation requires careful assessment not only of the magnitude of net benefits of a given intervention, but also of resulting consumer-producer tradeoffs (the "food price dilemma"), as well as the distributional effects of the intervention across income levels. In recent decades, rural-urban migration, and hence rural employment (farm entry/exit), is also a major concern []; as well as the overarching issue of smallholder price risk and risk-mitigating mechanisms []. -->
<!-- Due to the fundamental disconnect between theory and functional form outlined above,  Impact assessment results regarding consumer-producer tradeoffs vary considerably with the assumed functional form and type of supply curve shift [@alston2009economic].  -->
<!-- conspicuous -->

As for the assessment of impacts on income inequality, conventional models are ill suited because, as noted earlier, they either do not explicitly account for heterogeneous farm endowments (in the case of the CES curve), or assume a population of identically endowed marginal farms (in the case of the linear specification). In some sectors, one might reasonably justify the assumption of homogeneously endowed firms by invoking competitive long run equilibrium. Such arguments are strained in the primary sector, however, where one typically sees an abundance of heterogeneously endowed, inframarginal farms in operation. By failing to account for such heterogeneity, the conventional models fail to account for farm entry/exit. (See Wohlgenant [-@wohlgenant1997nature] for a deeper treatment of this point.)

Proponents of the conventional approach even go so far as to expressly discourage the assessment of distributional equity vis-a-vis agricultural research, arguing that such issues lie beyond its scope.
<!-- Wohlgenant [-@wohlgenant1997nature] demonstrates that the long run equilibrium supply curve cannot be linear under such circumstances, even if the supply curves of individual farms are all linear. -->

>\singlespacing"For many economists...the only defensible justification for government intervention in agricultural research, and the only legitimate and achievable objective of research, is the pursuit of economic efficiency. This is not to say that other objectives (such as...income distribution and food security) are illegitimate, irrelevant, or unimportant but that there are likely to be alternative, less costly ways to achieve these other objectives than by biasing the agricultural research portfolio away from programs that will maximize total national net income" [@alston1995science].

\doublespacing

An underlying assumption here is that distributional equity and economic growth ("efficiency") are mutually exlusive objectives, such that the one cannot be pursued except at the cost of the other. Norton [-@norton1992economic] makes this explicit by actually drawing an equity-efficiency tradeoff frontier to illustrate the concept. Again citing "many economists", he affirms that "agricultural research is a relatively poor instrument for achieving non-efficiency objectives".

The authors provide no references to indicate who they mean by "many economists"; and it is not readily obvious who they might have in mind. On the contrary, many economists think and/or have demonstrated econometrically that the exact opposite is true: agricultural research generally results in agricultural productivity growth, which goes hand in hand with poverty reduction [@rosegrant2001transforming; @ravallion1996important; @thorbecke1996multiplier; @fan2005rural; @bourguignon1998inequality; @timmer1997well; @gallup1998economic; @ravallion1999gowth; @ravallion2002has; @byerlee2009agriculture; @valdes2010reflections; @kydd2004agricultural; @world2007world; @de2020using; @de2022agriculture; @gollin2021two]. Publicly funded agricultural research since the 1960s has generally endeavored to align with pro-poor growth objectives, with mixed success [@thirtle2003impact; @adato2007agricultural; @hazell2001agricultural; @lipton2005family; @redclift1983production; @feleke2016assessing; @pingali1998impact; @mathur2003agricultural]. Moreover, it is now well documented that a nation's economic growth is generally more robust and sustainable in the measure that it is equitable [@partridge1997inequality; @easterly2007inequality; @berg2012makes; @ostry2015inequality; @berg2017inequality; @berg2018redistribution; @ostry2021growth]. Equity and sustainable growth are not mutually exclusive, but rather "two sides of the same coin" [@berg2017inequality].

Finally, conventional models also introduce awkward artifacts that further undermine their explanatory power. The CES function, by definition, implies that yield and entry/exit responses to price changes always offset each other precisely such that the elasticity of supply is constant. The linear aggregate supply curve implies the possibility of negative supply quantities and/or of farms producing for free. This either requires redefinition of the curve as a piecewise function---which further complicates interpretation in terms of Equation \ref{eq:aggSup0}---or compels us to regard the function as a local approximation to some inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point.
<!-- The lack of any accounting for farm entry/exit  -->
<!-- Effective policy formation also requires careful  rural-urban migration, and hence rural employment (farm entry/exit), is also a major concern [@lall2006rural; @nori2020migration; @crush2013linking].  The conventional approach also takes no account of commodity price risk and risk mitigating mechanisms, which have also received increasing attention in agriculture research and policy discussions [@bellemare2020producer; @byerlee2006managing]. -->
<!-- By neglecting farm heterogeneity, the conventional approach also of course precludes decomposition of supply shifts into yield and entry/exit components. The  -->
<!-- entry/exit and yield components []. -->
<!-- price risk -->

## Real consequences

There is a growing "disconnect" between the actual level of funding for agricultural research and the level of funding that would be justified by impact assessments conducted on the basis of conventional aggregate supply models [@hurley2016returns]. And there is good reason to suspect that this disconnect is due to the implausibly high---and sometimes absurdly high---internal rates of return (IRR) reported in conventional impact assessments of agricultural R&D [@hurley2014re; @alston2001attribution; @hurley2016returns]. The high reported returns are, of course, made more conspicuous by the aforementioned conflict of interest inherent in the expert opinion upon which these studies are typically based. In a meta-analysis of 492 such impact assessments, for example, Hurley et al. [@hurley2016returns] note that the average reported IRR implies that the USDA's 2000 R&D investment of \$4.1 billion should be worth \$56.3 quintillion in 2050, or 2.3 million times projected world GDP at that time.^[The meta-analysis covered a variety of impact assessment methods in addition to expedient specifications of aggregate supply (economic surplus analyses). It is safe to assume that most of these studies were economic surplus analyses.] "[I]t is not difficult to see," the authors conclude, "how policy makers may question the credibility of such evidence" [@hurley2016returns].
<!-- It could merely reflect the low cost of implementing the model, for example, and/or the lack of comparably low cost alternatives.  -->
<!-- [In discussion: The implausibility is made more conspicuous considering that these assessments are typically written by or in close consultation with the scientists whose research is under evaluation, and who thus have a vested interest in its success.] -->

Hurley et al. [@hurley2014re] respond to the incredulity of policy makers by replacing IRR with their "modified" IRR or "MIRR", whereby implausibly high projected returns are deflated to plausible levels. This is a suitable response insofar as the implausibility in question is rooted in the discounting method (although see the debate between Ohemke [-@oehmke2017re] and Hurley et al. [-@hurley2017re]). However, the theoretical opacity, dubious implications, and limited interpretability of these models, outlined above, are good reason to suspect that much of the incredulity is in fact aimed at the impact modeling itself, particularly the modeling of aggregate supply and the supply response to exogenous shocks. Insofar as this is true, MIRR is an insufficient response, and may even exacerbate the problem by masking the real sources of inaccuracy.

# Methodology: Theoretically derived, endogenous modeling of aggregate supply and response to exogenous shock

Below, a deterministic model of aggregate supply and endogenous response to technology (or any other kind of exogenous) shock is derived from axioms 1-5. First, the farm production function is derived from axioms 1 and 2. Then a deterministic aggregate supply function is derived from the farm production function and axioms 3 and 4. (This is deterministic in the sense that it does not take into account the stochasticity of output price and weather.) An alternative deterministic form for aggregate supply is also derived based on the relation between conditional and unconditional means. Practical steps for evaluating curve parameters are briefly enumerated; and the importance of accounting for "stratified TFP"---i.e., variations in total factor productivity across farm populations---is addressed. The farm level endogenous yield and expenditure response to exogenous shock is then formalized---including a formula for calculating the endogenous adoption rate---and aggregated. Finally, stochasticity and axiom 5 are introduced to explicitly account for random fluctuations in weather and output price, resulting in the final functional form for expected aggregate supply.

## Derivation of the farm production function from axioms 1 and 2 \label{sec:axioms1and2}

Throughout much of written history, astute observers have noticed that the usefulness of increments in the quantity of a good is inversely proportional to amount of the input or good or service already acquired [@kauder1953genesis]. In 1738, Daniel Bernoulli put it this way:
<!-- an input (in the case of producer yield functions) or good or service (in the case of consumer utility functions) -->

>\singlespacing "In the absence of the unusual, the utility resulting from any small increase in wealth will be inversely proportionate to the quantity of goods previously possessed" [@bernoulli1954exposition].

\doublespacing
<!-- Today, this is known as the "law of diminishing marginal returns". -->
<!-- \begin{framed} -->
<!--    \textbf{Axiom 1} \\ The law of diminishing marginal returns. -->
<!-- \end{framed} -->
<!-- Formalization of Bernoulli's verbal statement of the law of diminishing marginal returns depends upon how one defines "small increase". If "small increase" means a marginal increase, then Bernoulli's statement can be written down as follows.^[Bernoulli himself could not have had "marginal increase" in mind per se, as calculus had not yet been invented.] -->

Today, this is known as the "law of diminishing marginal returns". Bernoulli's statement is a consumer side formulation of the law. It can also has a producer side formulation: "In the absence of the unusual, the yield increase resulting from any small increase in a given input will be inversely proportionate to the quantity of the input already applied." With the aid of calculus (which was not available to Bernoulli), this may be formalized as follows.

\begin{equation}
\frac{\partial \ln(y)}{\partial x} \sim \frac{1}{x}
\label{eq:dimUtilDefine}
\end{equation}

Where, to be clear, the term $\partial \ln(y) / \partial x$ is the percentage change in yield given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $y(x)$ for the yield of good $x$ can then be obtained by integrating Bernoulli's statement.

\begin{equation}
\begin{split}
\int \frac{\partial \ln(y)}{\partial x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\
\ln(y(x))  &= \alpha \ln(x) + k \\
y(x) &= e^k x^{\alpha}
\end{split}
\label{eq:integrate_lny}
\end{equation}

Where the proportionality constant $\alpha = \partial \ln(y)/ \partial \ln(x)$ is the input elasticity of yield, i.e., the percentage change in yield given a $1$ percent increase in input $x$.

In the multivariate case, an expression $y(\mathbf{x})$ for yield as a function of a vector of $n$ goods $\mathbf{x} = [x_1,x_2,...,x_n]$ can be obtained as follows.

\begin{equation}
\int \nabla_{\mathbf{x}} \ln(y) \cdot d \mathbf{x} = \int D(\boldsymbol{\alpha}) \nabla_{\mathbf{x}} \ln(\mathbf{x}) \cdot d \mathbf{x}
\end{equation}

\begin{equation}
\begin{split}
\ln(y(\mathbf{x})) &= \boldsymbol{\alpha} \cdot \ln(\mathbf{x}) + \alpha_0 \\
y &= e^{\alpha_0} \prod_{i = 1}^{n} x_i^{\alpha_i}
\end{split}
\label{eq:cobbDoug}
\end{equation}

where $\boldsymbol{\alpha}$ is the vector of input elasticities corresponding to each $x_i$, the notation $D(\boldsymbol{\alpha})$ indicates a diagonal matrix with the elements of $\boldsymbol{\alpha}$ along its diagonal, and

\begin{equation}
\nabla_{\mathbf{x}} \ln(y) = \left[ \begin{matrix} \frac{\partial \ln(y)}{\partial x_1} \\
\frac{\partial \ln(y)}{\partial x_2} \\
\vdots \\
\frac{\partial \ln(y)}{\partial x_n}
\end{matrix} \right]
\end{equation}

It is straightforward to see that equation \ref{eq:cobbDoug2} is a homogeneous (and thus also homothetic) function with degree of homogeneity $h$ equal to $\sum_i \alpha_i$. There is no need, then, to impose homogeneity as an additional axiom. It follows from the axiom of diminishing marginal returns.

Empirical analysis involves exogenously given control variables ($k_i$), typically including demographic variables such as age, education, gender, household size, as well as agroclimatic variables such as temperature, rainfall, soil conditions, and so forth. Equation \ref{eq:cobbDoug} is thus henceforth rewritten as follows.
<!-- (Analysis is said to be "ceteris paribus" when these variables are held constant at a particular value across the population.) -->

\begin{equation}
y = g \prod_{i = 1}^{n_k} k_i^{\kappa_i} \prod_{i = 1}^{n_x} x_i^{\alpha_i} \:\:;\:\:\: g = e^{\alpha_0}
\label{eq:cobbDoug2}
\end{equation}

Where the $\kappa_i$ are the control variable elasticities of yield. Because the control variables $k_i$ are non-discretionary, the corresponding elasticities $\kappa_i$ may take positive or negative values. The input elasticities $\alpha_i$, on the other hand, which correspond to discretionary management variables, are generally positive. For purposes of economic analysis, the degree of homogeneity is calculated only over the production elasticities corresponding to management variables ($h = \sum_i \alpha_i$, omitting the $\kappa_i$).
<!-- However, there may arise cases where a variable does not fall neatly into either the management or control category. In the empirical analysis presented farther below, for example, the coefficient on child family labor takes a negative value. Labor is generally considered a discretionary management variable; but family labor, and especially child family labor, might, in some cases, better be considered a control variable, indicative of hard constraints beyond the farmers' discretion. -->
<!-- Axiom 1 gives us the farm yield function as a multivariate power law (see Appendix for details of the derivation.) -->
<!-- Where the $x_i$ are management inputs (fertilizer, etc.), the $k_i$ are control variables (demographic and agroclimatic variables, etc.), and the $\alpha_i$ and $\kappa_i$ are input and control variable elasticities of yield, respectively. The input elasticities of yield are also referred to collectively as the "technology". The product bounds $n_x$ and $n_k$ indicate the number of inputs and control variables, respectively. -->
<!-- The variables $x_i$ and $k_i$ are assumed to be linearly independent and are divided by their population means ($\tilde{x}_i$, $\tilde{k}_i)$, such that $y_0$ may be interpreted as the mean yield.  -->

This is, of course, the Cobb-Douglas form. Outside of Economics, it would simply be referred to as a (multivariate) power law. Such forms are often good models of observed processes across a wide range of research contexts and disciplines. In Economics, the Cobb-Douglas form was widely used from the 1920s to 1950s on the basis of its good empirical fit, but fell into disrepute thereafter for its perceived lack a theoretical basis. Capalbo and Antle [-@capalbo2015agricultural] offer a succinct introduction to this vast discussion. The forgoing derivation of the Cobb-Douglas form from axiom 1 in some measure redresses the lack of a theoretical basis. A full defense against all of the criticisms levied against this form over the past seventy five years is a book-length project that will not be attempted here.
<!-- [Other perceived shortcomings of the form are briefly addressed in the Discussion. if there is enough space!] [Or: In the course of the derivation below, a number of theoretical strengths are brought to light---underrepresented or overlooked by textbook treatments---that cast doubt on the bad reputation as a "restrictive" model] -->

Interpretation of the constant $g$ is as difficult as one wants to make it. It is, of course, usually called the "total factor productivity" (TFP), and understood to represent the yield per unit "all inputs"---although a more accurate description would be yield per unit "all input and control variables, raised to various powers". The TFP constant $g$ may in fact be a sum of binary endowments $b_i \beta_i$ that augment the base constant $\beta_0$ on farms where the endowment is present (where $b_i = 1$). That is to say, 

\begin{equation}
\ln(g) = \alpha_0 = \beta_0 + \sum_{i = 1}^{n_b} b_i \beta_i
\label{eq:g0Sum}
\end{equation}

In the Kenya maize farm exercise farther below, for example, there are four ($n_b = 4$) binary endowment variables $b_i$ (which take a value of $1$ if the endowment is present and $0$ otherwise): use of oxen in land preparation, use of tractor in land preparation, use of hybrid maize seed, and land tenure. This means that $g$ can vary across the population. In the Kenya maize exercise, there are 12 unique values of $g$ in the population, corresponding to 12 unique combinations of the four binary endowments plus the base endowment constant $\beta_0$.

The parameter $g$ may also be arbitrarily defined in terms of a new parameter ($u$) combined with judiciously chosen reference terms such that the new parameter has a meaningful interpretation and/or results in a more useful expression for yield. For present purposes, $g$ is defined as follows
<!-- For those not yet comfortable working in units of, say, -->
<!-- $$ -->
<!-- \text{kg.} \times \: \text{acres}^{-1} \times \: \text{liters}^{-\alpha_{pest}} \times \: \text{kg.}^{-\alpha_{fert}} \times \: \text{manhours}^{-\alpha_{labor}} \times\: \\ \text{mm.}^{-\alpha_{rain}} \times\: \text{num. persons}^{-\alpha_{HHsize}} -->
<!-- $$ -->
 <!-- \:;\:\: \alpha_{(var)} \in \mathbb{R} -->
<!-- \: \text{years}^{-\alpha_{age}} \times\: -->
<!-- in terms of another constant $u$, the means $E[x_i]$, and the mean of    fixed reference values $\tilde{k}_i$, $\tilde{x}_i$ that have the same units as the corresponding management and control variables $x_i$ and $k_i$. -->
<!-- Because the ratios in parentheses are dimensionless, $y_0$ must have the same units as $y$; and $y_0$ may be interpreted as the value of $y$ when all management and control variables equal their reference values. In the empirical study included here, for example, the reference values are set equal to the sample means, such that $y_0$ is the value of $y$ evaluated at the sample means of the input and control variables. -->

\begin{equation}
g = \frac{u}{E[\prod_{i = 1}^{n_k} k_i^{\kappa_i}] \prod_{i = 1}^{n_x} E[x_i]^{\alpha_i}}
\label{eq:u0_for_g0}
\end{equation}

Where $u$ is a constant, such that $y$ may be rewritten

\begin{equation}
y = u \frac{k}{E[k]} \prod_{i = 1}^{n_x} \left( \frac{x_i}{E[x_i]} \right)^{\alpha_i} \:\:;\:\:\: k = \prod_{i = 1}^{n_k} k_i^{\kappa_i}
\label{eq:cobbDoug3}
\end{equation}

This substitution will soon be seen to facilitate interpretation and manipulation of the optimal yield function. But first the optimal yield function must be derived from axiom 2 (profit maximization). Defining farm net benefit or profit ($\mathcal{L}$) as

\begin{equation}
\mathcal{L} = Py - \lambda (C - B)
\label{eq:lagrangian}
\end{equation}

Where $P$ is the output price, $C$ is expenditure ($C = \mathbf{w}'\mathbf{x}$), $B$ is the farm budget and $\lambda$ is the farm budget shadow price---that is, the marginal benefit to the farm of a marginal increase in budget ($\partial \mathcal{L} / \partial B = \lambda$)---then the first order conditions for a maximum,

\begin{equation}
\begin{split}
\nabla_{\mathbf{x}} \mathcal{L} &= P \nabla_{\mathbf{x}} y - \lambda \mathbf{w} = \mathbf{0} \\
&= Py D(\mathbf{x})^{-1} \boldsymbol{\alpha} - \lambda \mathbf{w} = \mathbf{0} \\
& \text{(Where}\: \mathbf{0} \: \text{is a vector of zeroes equal to the length of}\: \mathbf{x} \text{.)}
\end{split}
\label{eq:eqFOC}
\end{equation}
<!-- (see Appendix A1 for details). SOC -->

can be rearranged into an expression for the $i^{th}$ input demand.

\begin{equation}
x^*_i = \frac{y^* P \alpha_i}{\lambda w_i}
\label{eq:inputDem1}
\end{equation}

Where $w_i \in\mathbf{w}$ is the $i^{th}$ input price, $\lambda$ is the farm budget shadow price, and $y*$ is the optimal yield, i.e., the yield function in Equation \ref{eq:cobbDoug2} evaluated at the optimal inputs $x^*_i$. Multiplying this expression for $x^*_i$ by $w_i$ and summing both sides over $i$ then gives an expression for optimal expenditure ($C^*$).

\begin{equation}
C^* = R^* \frac{h}{\lambda} \:;\:\:\: R^* = y^* P
\label{eq:cStar}
\end{equation}

Such that the input demand may be rewritten

\begin{equation}
x^*_i = \frac{C^* \alpha_i}{h w_i}
\label{eq:inputDem2}
\end{equation}

Taking the expectation and rearranging,

\begin{equation}
\frac{E[x^*_i]}{E[C^*]} = \frac{\alpha_i}{h w_i}
\end{equation}

Combining this with the previous equation gives

\begin{equation}
\frac{x^*_i}{E[x^*_i]} = \frac{C^*}{E[C^*]}
\end{equation}

Such that the optimal farm yield $y^*$ (Equation \ref{eq:cobbDoug3} evaluated at $x^*_i$) may be expressed

\begin{equation}
y^* = u \frac{k}{E[k]} \left( \frac{C^*}{E[C^*]} \right)^h
\label{eq:YdEnvNeat0}
\end{equation}

The expression can be simplified still further by taking the expectation and solving for $u$.

\begin{equation}
u = E[y^*] \frac{E[C^*]^h}{E[C^{*h}]}
\label{eq:muYstarU0}
\end{equation}

And then substituting this for $u$ in the yield expression.

\begin{equation}
y^* = E[y^*] \frac{k}{E[k]} \frac{C^{*h}}{E[C^{*h}]}
\label{eq:YdEnvNeat}
\end{equation}

This expression for optimal farm yield---henceforth referred to simply as the farm yield---is particularly useful as an econometric yield model, as it only requires information on the control variables $k_i$ and total cost $C^*$, and no information on individual input quantities, as would be required when estimating Equations \ref{eq:cobbDoug2} or \ref{eq:cobbDoug3}. Given farm data, one specifies the model

\begin{equation}
y^* = v k C^{*h}e^{\epsilon} \:\:;\:\:\: v = \frac{E[y^*]}{E[k] E[C^{*h}]}
\label{eq:YdEnvReg1}
\end{equation}

(Where $\epsilon$ is the error term.) Such that the estimated coefficient on logged farm cost may be directly interpreted as the degree of homogeneity for the population. When estimating the model in Equations \ref{eq:cobbDoug2} or \ref{eq:cobbDoug3}, by contrast, $h$ must be tallied by summing the estimated coefficients $\alpha_i$, and will likely vary across the population since not all farms necessarily apply all the inputs specified in the model. The new term $v$, moreover, retains meaning as a measure of TFP---and arguably a more instructive one since all inputs are expressed in identical units of cost. It is henceforth referred to as the "expenditure TFP", and is related to conventional TFP as follows.

\begin{equation}
\begin{split}
v &= \frac{u}{E[k] E[C^*]^h} \\
&= g \frac{\prod_i^{n_x}E[x_i]^{\alpha_i}}{E[C^*]^h} \\
&= g \frac{1}{h}\prod_i^{n_x} \left( \frac{\alpha_i}{w_i} \right)^{\alpha_i}
\end{split}
\label{eq:v0forms}
\end{equation}

Where the last line follows from the input demand expression in Equation \ref{eq:inputDem2}.

### Returns to scale, cancavity, price elasticities of farm supply and input demand

The second order condition for maximum profit is

\begin{equation}
\begin{split}
\mathbf{x} ' \nabla_{\mathbf{x}}^2 \mathcal{L} \mathbf{x} &= P \mathbf{x} ' \nabla_{\mathbf{x}}^2 y \mathbf{x} ' < 0 \\
&= P h (h - 1) < 0
\end{split}
\label{eq:eqSOC}
\end{equation}

Where Euler's Theorem has been invoked in the second line of the condition. Axioms 1 and 2 thus require that yield exhibit decreasing returns to scale ($0 < h < 1$), whereby it also follows that yield is globally concave in inputs. (Increasing returns to scale would imply minimum profit and convexity in inputs, while constant returns would imply the break even point and linearity in inputs.)

The price elasticity of farm supply resolves as follows.

\begin{equation}
\frac{\partial \ln(y^*)}{\partial P} = h \frac{\partial \ln(C^*)}{\partial P}
\end{equation}

Recalling that $C^* = R^* h / \lambda$ (Equation \ref{eq:cStar}), the output price elasticity of farm supply resolves as follows.

\begin{equation}
\begin{split}
\frac{\partial \ln(y^*)}{\partial P} &= h \frac{\partial \ln(C^*)}{\partial P} \\
&= h \left( \frac{\partial \ln(y^*)}{\partial P} + \frac{1}{P} \right) \\
\frac{\partial \ln(y^*)}{\partial P} &= \frac{h}{1 - h} \frac{1}{P} \\
\frac{\partial \ln(y^*)}{\partial \ln(P)} &= \frac{h}{1 - h} \\
& \equiv \eta
\end{split}
\label{eq:PelastYstar}
\end{equation}

(Where Equation \ref{eq:cStar} is invoked in the second line.) Because returns to scale are strictly decreasing, it follows that farm supply is positively sloped. Moreover, farm supply is elastic for $h \in (1 / 2 , 1)$, inelastic for $h \in (0, 1 / 2)$, and linear when $h = 1 / 2$. Note that increasing returns to scale would imply negatively sloped supply curves. In Appendix A.1, the input own and cross price elasticities of demand are likewise derived and shown to be strictly negative only when returns to scale are decreasing.
<!-- Then $y^*$ can also be written -->
<!-- \begin{equation} -->
<!-- y^* = \left( g \prod_{i = 1}^{n_x} \left( \frac{\alpha_i}{w_i} \right)^{\alpha_i} \right) \left( \frac{P}{\lambda} \right) -->
<!-- \end{equation} -->
<!-- Whereby the price elasticity of farm yield follows as -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(P)} = \frac{h}{1 - h} -->
<!-- \end{equation} -->
<!-- In Appendices A.2 and A.3 it is shown that the second order conditions for maximum profit imply the degree of homogeneity $h$ must exhibit strictly decreasing returns to scale ($0 < h < 1$), whereby it also follows that farm , and that the farm supply curve is positively sloped. -->

## Aggregation of farm level supply based on axioms 3 and 4

The derivation of a compact, instructive expression for $y^*$ (Equation \ref{eq:YdEnvReg1}) brings us a step closer to parsing the aggregate supply function defined in Equation \ref{eq:aggSup0}. Denoting area $k_a$ such that $q^* = k_a y^*$,
<!-- Substituting Equation \ref{eq:qStar} for $q^*$ in Equation \ref{eq:aggSup0} gives -->

\begin{equation}
\begin{split}
Q &= N \int_{\underline{q}^*}^{\bar{q}^*} \rho(q^*) dq^* \\
&= N \int_{0}^{\infty} k_a \int_{0}^{\bar{y}^*} \rho(y^*) dy^* \rho(k_a) dk_a \\
&= N E[k_a] v \int_{0}^{\infty} k \int_{0}^{\bar{C}^*} C^{* h} \rho(C^*)  d C^* \rho(k) dk \\
&= N E[k_a] v  E[k] \int_{0}^{\bar{C}^*} C^{* h} \rho(C^*) d C^* \\
&= N E[k_a] \frac{E[y^*]}{E[C^{*h}]} \int_{0}^{\bar{C}^*} C^{* h} \rho(C^*) d C^*
\end{split}
\end{equation}

The integral is now over the domain of expenditure $C^* \in (0, \bar{C}^*)$ instead of the domain of production. Moreover, letting $C^{\#}$ denote optimal unit expenditure (also commonly referred to as the "average cost", $C^{\#} = C^* / y^*$), note that $C^*$ and $y^*$ can be rewritten in terms of $C^{\#}$ as follows.

\begin{equation}
\begin{split}
C^* = C^{\#} y^* &= C^{\#} v k C^{* h} \\
&rightarrow C^* = (v k C^{\#})^{\eta / h} \:\:;\:\:\: \eta = \frac{h}{1 - h} \\
&rightarrow y^* = (v k)^{\eta / h} C^{\# \eta}
\end{split}
\label{eq:fnCsharp}
\end{equation}

And note that taking the expected value of the last line and rearranging gives

\begin{equation}
v^{\eta / h} = \frac{E[y^*]}{E[k^{\eta / h}] E[C^{\# \eta}]}
\end{equation}

Such that aggregate supply can also be written in terms of an integral over $C^{\#} \in (0, \bar{C}^{\#})$,

\begin{equation}
\begin{split}
Q &= N E[k_a] v^{\eta / h} E[k^{\eta / h}] \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#}) d C^{\#} \\
&= N E[k_a] \frac{E[y^*]}{E[C^{\# \eta}]} \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#}) d C^{\#}
\end{split}
\label{eq:aggSupStep1}
\end{equation}

To parse further, the upper bound on unit expenditure $\bar{C}^{\#}$ and density function $\rho(C^{\#})$ are resolved from axioms 3 and 4 below. The farm employment rate is also resolved as a by product.

### Upper bound on expenditure, farm employment rate, deterministic aggregate supply \label{sec:addSupDet}
<!-- \label{sec:aggSup1} -->

Given the introduction of $C^{\#}$, note that Equation \ref{eq:cStar} simplifies to

\begin{equation}
C^{\#} = \frac{P}{\lambda} h
\label{eq:cSharp}
\end{equation}

Axiom 3 states that farms enter production only if they expect to make non-negative profit, i.e. if $C^* \leq R^*$, which simplifies to $C^{\#} \leq P$. (It follows from Equation \ref{eq:cStar} or \ref{eq:cStar} that another way of expressing axiom 3 is $\lambda \geq h$.) Note, in passing, that the farm employment rate $\mathcal{E}$ may thus be expressed as follows.

\begin{equation}
\mathcal{E} = \int_0^{P} \rho(C^{\#}) dC^{\#}
\end{equation}

Assuming yield is lognormally distributed (axiom 4), then so must be $C^*$ and $C^{\#}$; and this expression reduces to

\begin{equation}
\begin{split}
\mathcal{E} &= \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right) \\
& m_{\#} = E[\ln(C^{\#})] \:\:\:\: s^2_{\#} = Var[\ln(C^{\#})]
\end{split}
\end{equation}

Where $\Phi()$ is the standard normal cumulative distribution function.

Now, to resolve the integral in the expression for aggregate supply (Equation \ref{eq:aggSupStep1}), note that, for any lognormally distributed variable $\chi$ and upper bound $\xi$,

\begin{equation}
\begin{split}
\int_{0}^{\xi} \chi \rho(\chi) d\chi &= E[\chi] \Phi\left( \frac{\ln(\xi) - m_{\chi}}{s_{\chi}} - s_{\chi} \right) \:\:; \\ 
&m_{\chi} = E[\ln(\chi)] \:\:\: s^2_{\chi} = Var[\ln(\chi)]
\end{split}
\label{eq:keyResult}
\end{equation}

(See Appendix A.4 for a proof.)

Substituting $\chi = C^{\# \eta}$ and $\xi = P$,

\begin{equation}
\int_{0}^{P} C^{\# \eta} \rho(C^{\#}) d C^{\#} = E[C^{\# \eta}] \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)
<!-- \label{eq:integralStep2} -->
\end{equation}

Substituting the right hand side of this expression for the integral in Equation \ref{eq:aggSupStep2}, the expression for aggregate supply simplifies as follows.

\begin{equation}
Q = N E[k_a] E[y^*] \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)
\end{equation}

To reduce notational clutter, the shorthand $\mathcal{P}$ is henceforth introduced,

\begin{equation}
\mathcal{P}(\xi; m_{\chi}, s_{\chi}) = \Phi \left( \frac{\ln(\xi) - m_{\chi}}{s_{\chi}} - s_{\chi} \right)
\end{equation}

Such that aggregate supply can be written more compactly as follows.

\begin{equation}
Q = N E[k_a] E[y^*] \mathcal{P}(P^{\eta}; m_{\#}, s_{\#})
\label{eq:aggSup1}
\end{equation}

Axioms 1-4 thus give us a provisional tractable expression for aggregate supply in terms of interpretable parameters. The derived form is provisional because it is a deterministic expression that does not capture the stochastic nature of meteorology and price movements affecting agricultural output. The stochastic dimension of aggregate supply is introduced along with axiom 5 farther below.

### Conditional vs. unconditional means, an alternative form for aggregate supply \label{sec:condMean}

It is important to keep in mind that $E[C^*]$, $E[y^*]$ are _unconditional_ means. Because axiom 3 truncates the upper tail of the distribution of $C^{\#}$ at $P$, then sample parameters calculated from observed data must be interpreted as _conditional_. That is to say, the sample means of expenditure and yield do not represent $E[C^*]$ and $E[y^*]$, but rather the conditional means $E[C^* | C^{\#} \leq P]$ and $E[y^* | C^{\#} \leq P]$. The conditional and unconditional means of any lognormally distributed variable $\chi$ with upper bound $\xi$ are related as follows.

\begin{equation}
E[\chi | \chi \leq \xi] \Phi \left( \frac{\ln(\xi) - m_{\chi}}{s_{\chi}} \right) = E[\chi] \Phi \left(\frac{\ln(\xi) - m_{\chi}}{s_{\chi}} - s_{\chi}\right)
\label{eq:keyResult2}
\end{equation}
<!-- Evaluating this relation at $\chi = C^{\# \eta}$ and $\xi = P$ gives -->

Whereby it follows that

\begin{equation}
E[C^{\# \eta}] \mathcal{P}(P, m_{\#}, s_{\#}) = E[C^{\# \eta} | C^{\#} \leq P] \mathcal{E}
\label{eq:condMeanCshrp}
\end{equation}

And

\begin{equation}
E[y^*] \mathcal{P}(P^{\eta}, m_{\#}, s_{\#}) = E[y^* | C^{\#} \leq P] \mathcal{E}
\label{eq:condMeanYd1}
\end{equation}

Such that aggregate supply may also be written

\begin{equation}
Q = N E[k_a] E[y^*|C^{\#} \leq P] \mathcal{E}
\end{equation}

Which may be useful for point estimates of aggregate supply along the curve since $E[y^*|C^{\#} \leq P]$ can be estimated from the observed yield distribution. This form is also instructive because $\mathcal{E}$ has a straightforward interpretation as the farm employment rate. However, it is inconvenient for purposes of drawing the entire aggregate supply curve, as the observed $E[y^*|C^{\#} \leq P]$ is valid only for the $P$ at which it is measured. The unconditional mean yield $E[y^*]$, on the other hand, is constant for all $P$. For this reason, Equation \ref{eq:aggSup1} is preferred for supply curve assessment. Moreover, the term $\mathcal{P}(P; m_{\#}, s_{\#})$ turns out to have a meaningful economic interpretation that will become clear when the stochastic character of price is taken into account farther below.

### Evaluating supply curve parameters in practice \label{sec:evalInPract}

Tractable expressions for mean expenditure and yield follow from Equations \ref{eq:fnCsharp} and from the lognormality of $y^*$ and $C^*$ (axiom 4).

\begin{equation}
E[C^*] = e^{m_c + frac{s^2_c}{2}}
\end{equation}

Where

\begin{equation}
\begin{split}
m_c &= \frac{1}{1 - h}(\ln(v) + m_k + m_{\#}) \:\:;\:\:\: m_k = E[\ln(k)] \\
s_c^2 &= \frac{1}{(1 - h)^2} (s_k^2 + s_{\#}^2) \:\:;\:\:\: s_k^2 = Var[\ln(k)]
\end{split}
\label{eq:mCsC}
\end{equation}

And

\begin{equation}
\begin{split}
E[y^*] &= v E[k] E[C^{* h}] \\
&= v E[k] e^{h m_c + h^2 \frac{s_c^2}{2}}
\end{split}
\end{equation}

The conditional means can be expressed by replacing $m_c$, $s_c$, $m_{\#}$, and $s_{\#}$ with the sample parameters $\bar{m}_c$, $\bar{s}_c$, $\bar{m}_{\#}$, and $\bar{s}_{\#}$, defined

\begin{equation}
\begin{split}
\bar{m}_c &= E[\ln(C^*) | C^{\#} \leq P] \\
\bar{s}^2_c &= Var[\ln(C^*) | C^{\#} \leq P] \\
\bar{m}_{\#} &= E[\ln(C^{\#}) | C^{\#} \leq P] \\
\bar{s}^2_{\#} &= Var[\ln(C^{\#}) | C^{\#} \leq P]
\end{split}
\end{equation}

In practice, the sample parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ can be calculated from the sample parameters $\bar{m}_c$ and $\bar{s}_c$ by rearranging Equations \ref{eq:mCsC} into expressions for $\bar{m}_{\#}$ and $\bar{s}_{\#}$.

\begin{equation}
\begin{split}
\bar{m}_{\#} &= (1 - h) \bar{m}_c - \ln(v) - m_k \\
\bar{s}_{\#}^2 &= (1 - h)^2 \bar{s}_c^2 - s_k^2
\end{split}
\label{eq:mCshrpsCshrp}
\end{equation}

This is preferred to calculating the mean and standard deviation directly from observed $y^*/C^*$ because observed yield is harvest yield, whereas the $y^*$ appearing in all of the equations above refers not to harvest yield but to expected harvest yield at planting time. This becomes clear when stochasticity is taken into account.

Because $C^{\#}$ is lognormally distributed, the unconditional parameters $m_{\#}$ and $s_{\#}$ can then be deduced from the conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ by solving the following system of equations.

\begin{equation}
\begin{split}
\bar{m}_{\#} &= m_{\#} - s_{\#} \frac{\phi(z)}{\Phi(z)} \\
\bar{s}_{\#}^2 &= s_{\#}^2 \left( 1 - z \frac{\phi(z)}{\Phi(z)} - \left( \frac{\phi(z)}{\Phi(z)} \right)^2   \right) \:\:;\:\:\: z = \frac{\ln(P) - m_{\#}}{s_{\#}}
\end{split}
\label{eq:cSharpUncondParams}
\end{equation}

Whence it is then possible to evaluate the unconditional parameters $m_c$, $s_c$, $E[C^*]$, and $E[y^*]$.

### TFP strata \label{sec:TFPstrata}

As noted earlier (Equation \ref{eq:g0Sum}), binary endowments $\beta_i b_i$, and hence TFP, vary across the population. In the Kenya maize farm example explored farther below, there are 12 distinct values of expenditure TFP, corresponding to 12 distinct combinations of the binary endowments, henceforth referred to as "TFP strata". Wherever $g$ or $v$ appears above, then, what is really meant is $g_{\ell}$ and $v_{\ell}$, where $\ell$ indexes the values of TFP corresponding to each stratum ($\ell \in (1,12)$ in this case). It follows that any parameters that are a function of $v_{\ell}$ likewise correspond to the $\ell^{th}$ stratum. In other words, $E[C^*]$ and $E[y^*]$ can be disaggregated by stratum as follows.

\begin{equation}
\begin{split}
E[C^*]_{\ell} &= e^{m_{c \ell} + frac{s^2_c}{2}} \\
\text{Where} &\:\:\: m_{c \ell} = \frac{1}{1 - h}(\ln(v_{\ell}) + m_k + m_{\#})
\end{split}
\end{equation}

And

\begin{equation}
\begin{split}
E[y^*]_{\ell} &= v_{\ell} E[k] E[C^{* h}]_{\ell} \\
&= v_{\ell} E[k] e^{h m_{c \ell} + h^2 \frac{s_c^2}{2}}
\end{split}
\end{equation}

To evaluate the stratified conditional (observed) means, replace $m_{c \ell}$, $s_c$ in these expressions with $\bar{m}_{c \ell}$, $\bar{s}_c$.

Parameters unindexed by $\ell$ refer to their average across all strata. For example, $E[y^*]$ refers to the unconditional mean yield evaluated at $v$, the average expenditure across all strata.

\begin{equation}
v = \sum_{\ell} \frac{N_\ell}{N} v_{\ell}
\end{equation}

Where $N_{\ell} / N$ is the fraction of farms in the $\ell^{th}$ TFP stratum.

## An endogenous model of supply response to and welfare impact of exogenous shock

Agronomic yield and expenditure response to exogenous stimulus at an experimental station does not translate into the economic yield and expenditure response likely to occur in real farm populations. This economically obvious fact of life [@herdt1988increasing; @balasubramanian2000yield] bears reiteration because confusion on this matter unfortunately still pervades the conversation in key areas of agricultural research impact assessment [@sumberg2012mind].

As noted in the Introduction, the authors of the conventional modeling framework are cognizant of the difference between economic yields and agronomic yields; and offer some words of warning on the matter [@alston1995science]. But they provide no practical, formal method to distinguish between the two or to explicitly relate the former to the latter, such that their model effectively blurs the technology shock and supply response together as a single, nebulous exogenous shock.

In this subsection, equations for the evaluation of the farm level endogenous supply and expenditure response to exogenous shock are derived and aggregated based on the model derived from axioms 1-4 in the subsections above. This includes endogenous assessment of the adoption rate. As mentioned earlier, all of the salient differences between the theoretical framework proposed here and the conventional approach stem from these two steps.

More specifically, whereas the conventional approach assumes the farm level expenditure and/or yield response to exogenous shock based on agronomic data and expert opinion, the approach explained below endogenously models the farm level response to the shock based on the theoretical model derived from axioms 1-4 above. The farm level response model explicitly accounts not only for the shock itself, but also for any anticipated changes in input and output price, and for any subsidies included in the technology package.

And whereas the conventional approach exogenously assumes the adoption rate, again typically based on the opinion of experts closely involved in the technology under evaluation, here the adoption rate follows endogenously from the theoretical derivation, based on whether or not adoption increases farm net benefit ($\mathcal{L}^*$).

### The endogenous farm yield and expenditure response to exgenous shock \label{sec:farmResp}

The impact of yield scaling technologies and/or management practices on farm supply and expenditure can be represented through perturbations of the TFP parameter ($g_{\ell}$). This is tantamount to adding a binary endowment variable to the TFP sum in Equation \ref{eq:g0Sum}. The four binary endowments included in the Kenya maize model example may be considered yield scaling interventions that increase the value of $g_{\ell}$ on farms where the endowment is present. The percentage increase in TFP given the introduction of a new intervention $\beta_5 b_5$ on adopting farms (farms where $b_5 = 1$) may be calculated as

\begin{equation}
\begin{split}
\partial \ln(g_{\ell}) &\approx \frac{g_{\ell}' - g_{\ell}}{g_{\ell}} \:\:; \:\:\: g_{\ell}' = g_{\ell} e^{\beta_5 b_5} \\
&\approx e^{\beta_5} - 1
\end{split}
\end{equation}

Note that the percentage increase is the same across all adopting farms regardless of the starting value $g_{\ell}$.

Ideally, the value of $\beta_5$ should be estimated directly from field trials. If this is not possible, then the estimate can be made on the basis of agronomic crop modeling and expert opinion. Regardless of the path taken in this exercise, it is critically important to keep in mind that the objective is to estimate the change in TFP ($\beta_5$ or $\partial \ln(g)$), not the change in economic yield itself ($\partial \ln(y^*)$). If information is gathered in terms of the change in agronomic yield and/or expenditure, then it must be converted into an estimate for $\partial \ln(g)$. The percentage changes in economic yield, expenditure, and expenditure TFP ($v$) then follow from Equations \ref{eq:fnCsharp} as a function of the change in TFP as well as any change in output and input prices.
<!-- The percentage changes in expenditure TFP ($v$), farm expenditure, and yield given a 1% change in $g$ follow from Equations \ref{eq:cStar} and \ref{eq:YdEnvReg1}. -->

\begin{equation}
\begin{split}
\frac{\partial \ln(y^*)}{\partial \ln(g)} &= \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right) \\
\frac{\partial \ln(C^*)}{\partial \ln(g)} &= \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right) \\
\frac{\partial \ln(v)}{\partial \ln(g)} &= 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)}
\end{split}
\label{eq:dldlg0}
\end{equation}

(See Appendix A.2 for details.)

The direction of the expected change in prices depends upon the type of research product. Most agricultural research currently falls into one of two broad paradigms: "sustainable agricultural intensification" (SAI) or "agroecological intensification" (AEI) [@mockshell2018beyond]. Widespread adoption of a new SAI technology typically results in increased output supply and input demand, and hence a lower output price and higher input prices. Widespread adoption of an AEI technology, on the other hand, typically results in lower input demand and emphasizes yield stability over quantity, hence lowering input prices and having little or uncertain impact on output price. For illustrative purposes, in this article the new technology is assumed to be an SAI research product, such that $\partial \ln(\mathbf{w}) / \partial \ln(g) > 0$ and $\partial \ln(P) / \partial \ln(g) < 0$).
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(g)} &= \frac{\partial \ln(v)}{\partial \ln(g)} + h \frac{\partial \ln(C^*)}{\partial \ln(g)} \\ -->
<!-- &= \frac{\partial \ln(v)}{\partial \ln(g)} + h \left( \frac{\partial \ln(y^*)}{\partial \ln(g)} + \frac{\partial \ln(C^{\#})}{\partial \ln(g)} \right) \\ -->
<!-- &\rightarrow \frac{\partial \ln(y^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( \frac{\partial \ln(v)}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \frac{\partial \ln(v)}{\partial \ln(g)} + h \frac{\partial \ln(C^*)}{\partial \ln(g)} -->

<!-- &= \left( g \prod_{i = 1}^{n_x} \left( \frac{\alpha_i}{w_i} \right)^{\alpha_i} \right) \left( \frac{C^{\#}}{h} \right)^{\frac{h}{1 - h}} -->

<!-- [[In appendix: -->
<!-- The percentage changes in expenditure per acre and yield given a 1 percentage change in TFP then follow from Equations \ref{eq:cStar} and \ref{eq:YdEnvReg1}. -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(C^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \label{eq:dlCstardlg0} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \label{eq:dlyStardlg0} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- C^{\#} = \frac{P}{\lambda} h -->
<!-- \label{eq:cSharp} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(C^{\#})}{\partial \ln(g)} = \frac{\partial \ln(P)}{\partial \ln(g)} -->
<!-- \label{eq:cSharp} -->
<!-- \end{equation} -->
<!-- ]] -->
<!-- The change in yield is positive only if $\partial \ln(g) > \boldsymbol{\alpha} ' \partial \ln(\mathbf{w}) + h \partial \ln(P)$. -->
<!-- Change in expenditure is positive if $\partial \ln(g) > (1 - h) (\boldsymbol{\alpha} ' \partial \ln(\mathbf{w}) + \partial \ln(P))$. -->

### The endogenous adoption rate \label{sec:adopt}
<!-- Aggregate outcomes of an exogenous intervention depend critically on the adoption rate. This, in turn depends upon the profitability of adoption at the farm level. -->
<!-- Given the forgoing, the objective function evaluated at optimal yield ... -->
<!-- From the objective function -->

The farm net benefit function in Equation \ref{eq:lagrangian} evaluated at $y^*$ gives the farm net benefit envelope.

\begin{equation}
\begin{split}
\mathcal{L}^* &= \mathcal{L}|_{y = y^*} = R^* + \lambda (B - C^*) \\
&= \frac{\lambda}{h} ((1 - h) C^* + h B)
\end{split}
\end{equation}
<!-- By Equation \ref{eq:cStar}, this reduces to -->
<!-- \begin{equation} -->
<!-- \mathcal{L}^* = R^* (1 - h) + \lambda B -->
<!-- \end{equation} -->

The welfare effect on a given farm of adopting the new technology can be examined by differentiating $\mathcal{L}^*$ with respect to the change in TFP.

\begin{equation}
\begin{split}
\frac{\partial \mathcal{L}^*}{\partial \ln(g)} &= \frac{\lambda}{h} \left((1 - h) \frac{\partial C^*}{\partial \ln(g)} + h \frac{\partial B}{\partial \ln(g)} \right) \\
&= \frac{\lambda}{h} \left( C^* \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right) + h \frac{\partial B}{\partial \ln(g)} \right)
\end{split}
\label{eq:dLdlng}
\end{equation}

Assuming farmers adopt only if $\partial \mathcal{L}^*/\partial \ln(g) \geq 0$ (this is implicit in axiom 2), then the adoption condition is

\begin{equation}
\begin{split}
\partial \ln(P) - \boldsymbol{\alpha} {'} \partial \ln(\mathbf{w}) + \partial \ln(g) + \frac{h}{C^*} \partial B &> 0 \\
\partial \ln(\nu) + \partial \ln(g) + \frac{h}{C^*} \partial B &> 0 \:\:;\:\:\: \partial \ln(\nu) = \partial \ln(P) - \boldsymbol{\alpha} {'} \partial \ln(\mathbf{w})
\end{split}
\label{eq:adoptCond}
\end{equation}

Where the term $\partial B$ represents the subsidies, costs, or any other exogenous mitigating circumstances, per unit area, entailed in the adoption of the technology package. In the absence of such mitigating circumstances, the condition simplifies to

\begin{equation}
\partial \ln(g) > -\partial \ln(\nu)
\label{eq:adoptCondSimp}
\end{equation}

As mentioned above, for SAI technologies the expectation is that $\partial \ln(P) < 0$, $\partial \ln(\mathbf{w}) > 0$, and thus $\partial \nu < 0$. In words, then, the adoption condition says that a farm stands to increase its net benefit through adoption of yield scaling technology only if the resulting percentage increase in TFP ($g$) is greater than the corresponding percentage decrease in output price minus the corresponding percentage increase in input prices scaled by their respective input elasticities ($\alpha_i$). Note the resemblance between this and the "price/productivity tightrope" condition formulated by Lipton [-@lipton2005family].

>\singlespacing "New [SAI] science usually raises farm supply of outputs and demand for inputs. That makes outputs cheaper and inputs more expensive; hence the ratio of farm output prices to input prices falls. Do small and poor farmers gain? If, and only if, this science-induced fall in their relative farm prices is slower than the science-induced rise in their conversion ratio of physical inputs into physical outputs (that is, TFP)."

\doublespacing

The only substantive difference between Lipton's condition and the condition in Inequality \ref{eq:adoptCondSimp} is that the percentage increases in input prices in the latter are scaled by their respective efficiency parameters. And of course the more complete version of the adoption condition in Inequality \ref{eq:adoptCond} differs from Lipton by also including the exogenous net subsidy term.

If the efficiency adjusted output-input price ratio decrease is greater than the increase in TFP ($g$), then the margin by which it is greater is the net subsidy term $h / C^* \partial B$ required to make adoption profitable. Note that the required net subsidy $\partial B$ will vary across farms based on $C^*$. The factor $h / C^*$, which may also be written $\lambda / R^*$, represents each farm's marginal valuation of the subsidy; and implies that the subsidy is relatively more valuable to farms with relatively lower expenditure. Solving Inequality \ref{eq:adoptCond} for $C^*$ gives the maximum expenditure level for which adoption is profitable if the (absolute value of the) efficiency adjusted output-input price ratio decrease is greater than the increase in TFP ($|\partial \ln(\nu)| > \partial \ln(g)$).

\begin{equation}
C^* \leq \frac{-h \partial B}{\partial \ln(\nu) + \partial \ln(g)}
\label{eq:cStarAdopt}
\end{equation}

If $\partial B=0$, then Inequality \ref{eq:adoptCond} implies that adoption will be either $0\%$ or $100\%$. Empirically, this is almost never observed. Adoption rates tend to fall somewhere between $0\%$ and $100\%$. The increased input demand associated with new technology adoption implies in and of itself that, without subsidies, $\partial B < 0$. And, of course, every major green revolution success story has involved subsidies of one kind or another to offset the required increase in input expenditure, and then some [@patel2013long; @pingali2012green]. (In his Nobel lecture, Norman Borlaug said that "equally as important as" the research product itself was the "sound governmental economic policy which would assure the farmer a fair price for his grain, the availability of the necessary inputs...and the credit with which to buy them" [-@Borlaug1970].) Within the theoretical framework developed here, this means that the net subsidy $\partial B$ is generally positive.
<!-- Equally as important as the transfer of the new seed and new technology from Mexico to India and Pakistan was the introduction from Mexico of a crop-production campaign strategy. This strategy harnessed the high grain-yield potential of the new seed and new technology to sound governmental economic policy which would assure the farmer a fair price for his grain, the availability of the necessary inputs  seed, fertilizers, insecticides, weed killers, and machinery  and the credit with which to buy them. Collectively these inputs and strategy became the base from which the green revolution evolved. -->
<!-- Assuming farms spend their whole farm budget ($B = C^*$), then the subsidy term simplifies to $h \partial \ln(C^*)$ and the adoption condition can be rewritten -->

Denoting the upper adoption bound on $C^*$ (Equation \ref{eq:cStarAdopt}) as $\bar{\bar{C^*}}$, the adoption rate $\mathcal{A}$ when $\partial \ln(g) < -\partial \ln(\nu)$ can be expressed as the integral of the density $\rho(C^*)$ over the domain $(0, \bar{\bar{C^*}})$.

\begin{equation}
\mathcal{A} = \int_0^{\bar{\bar{C^*}}} \rho(C^*) d C^*
\end{equation}

Because $C^*$ is lognormally distributed, the expression resolves as follows.

\begin{equation}
\begin{split}
\mathcal{A} &= \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_c}{s_c} \right) \\
&= \Phi\left( \frac{\frac{-h \partial B}{\partial \ln(\nu) + \partial \ln(g)} - m_c}{s_c}
\end{split}
\label{eq:AdoptRate}
\end{equation}

The aggregate net subsidy required to reach this adoption rate can then be computed as the subsidy per unit area times the total farm area times the adoption rate.

\begin{equation}
\text{Aggregate net subsidy} = \partial B N E[k_a] \mathcal{A}
\label{eq:aggSubsidy}
\end{equation}

The adoption rate within single a binary endowment stratum can be calculated by evaluating this expression at the $v_{\ell}$ of interest.
<!-- aggSubsidy <- dB * Nf * muArea * adoptRateTotal * 10^-9 # Total subsidies in billions -->

<!-- \begin{equation} -->
<!-- A = \sum_{\ell} \frac{N_{\ell}}{N} A_{\ell} -->
<!-- \end{equation} -->
<!-- [[ -->
<!-- The observed (conditional) mean cost and yield disaggregated by endowment stratum ($E[C^*| \theta]_i$, $E[y^*(T)| \theta]_i$), can be evaluated as follows. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[C^*| \theta]_i &= e^{\bar{m}_{ci} + \frac{\bar{s}^2_c}{2}} \\ -->
<!-- &= v_i^{\frac{1}{1 - h}} e^{\frac{1}{1 - h}(m_k + \bar{m}_{\#}) + \frac{1}{(1 - h)^2} \frac{s^2_k + \bar{s}_{\#}^2}{2}} -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- <!-- \:\:;\:\:\: \bar{m}_{ci} = \frac{1}{1 - h}(\ln(v) + m_k + \bar{m}_{\#})  \\ -->

<!-- Where the parameters $\bar{m}_{ci}$ and $\bar{s}_c$ are calculated from Equations \ref{eq:mCsC}. -->

<!-- And -->

<!-- \begin{equation} -->
<!-- E[\hat{y}^*(T, k_m(T))]|_{t = 0} = v E[k] E[C^{*h}| \theta] -->
<!-- \end{equation} -->
<!-- <!-- E[e^{\epsilon}]_i --> 
<!-- <!-- Where $E[e^{\epsilon}]_i$ is the mean of the exponential function of the regression error of farms in the $i^{th}$ stratum. -->

<!-- The stratified ex-ante expected mean yield $E[\tilde{y}^*(T)]|_{t = 0}^i$ can also be deduced as  -->

<!-- <!-- in Equation \ref{eq:EyStarT0fromYhat}. -->
<!-- <!-- , since it is calculated based on the fitted value of $v_{0i}$ -->

<!-- \begin{equation} -->
<!-- E[\tilde{y}^*(T)]|_{t = 0}^i = \left( \frac{E[k_r(T)]|_{t = 0}}{E[k_r]_i} \right)^{\kappa_r} E[y_i^*(T) E[e^{-\epsilon}]_i -->
<!-- \end{equation} -->

<!-- ]] -->
<!-- (Note that the adoption rate will be higher in strata with lower starting $v_{0i}$, _ceteris paribus_.) -->

## Aggregation of the endogenous farm supply response and change in welfare due to technology shocks \label{sec:aggImpact}
...second main contributution...
The total increase in aggregate supply due to a technology shock can be evaluated by integrating the change in farm production $\partial y^*$ over the density of adopting farms $(0, \bar{\bar{y^*}})$ where $\bar{\bar{y^*}} = y^*(\bar{\bar{C^*}})$.

$\overset{\triangle}{y}$

\begin{equation}
\begin{split}
\Delta Q &= N \int_0^{\bar{\bar{y^*}}} k_a \partial \y^* \rho(y^*) dy^* \\
&= N E[k_a] \int_0^{\bar{\bar{y^*}}} y^* \partial \ln(y^*) \rho(y^*) dy^*
\end{split}
\end{equation}

From the expression for research induced yield change in Equations \ref{eq:dldlg0} it follows that

\begin{equation}
\partial \ln(y^*) = \frac{\ell}{1 - h} \:\:;\:\:\: \ell = \partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w}) + h \partial \ln(P)
\end{equation}

Such that the integral reduces to

\begin{equation}
\begin{split}
\Delta Q &= N E[k_a] \frac{\ell}{1 - h} \int_0^{\bar{\bar{y^*}}} y^* \rho(y^*) dy^* \\
&= N E[k_a] \frac{\ell}{1 - h} v E[k] \int_0^{\bar{\bar{C^*}}} C^{*h} \rho(C^*) dC^* \\
&= N E[k_a] v E[k] E[C^{*h}] \frac{\ell}{1 - h} \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_c}{s_c} - h s_c  \right) \\
&= N E[k_a] v E[k] E[C^{*h}] \frac{\ell}{1 - h} \mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c)
\end{split}
\end{equation}
<!-- $$ -->
<!-- \Delta Q = N E[k_a] \frac{\ell}{1 - h} \int_0^{\bar{\bar{y^*}}} y^* \rho(y^*) dy^* \\ -->
<!-- = N E[k_a] \frac{\ell}{1 - h} v E[k] \int_0^{\bar{\bar{C^*}}} C^{*h} \rho(C^*) dC^* \\ -->
<!-- = N E[k_a] v E[k] E[C^{*h}] \frac{\ell}{1 - h} \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_c}{s_c} - h s_c  \right) \\ -->
<!-- = N E[k_a] v E[k] E[C^{*h}] \frac{\ell}{1 - h} \mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c) -->
<!-- $$ -->
<!-- \Delta Q = N E[k_a] \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) \int_0^{\bar{\bar{y^*}}} y^* \rho(y^*) dy^* \\ -->
<!-- = N E[k_a] \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) v E[k] \int_0^{\bar{\bar{C^*}}} C^{*h} \rho(C^*) dC^* \\ -->
<!-- = N E[k_a] v E[k] E[C^{*h}] \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_c}{s_c} - h s_c  \right) \\ -->
<!-- = N E[k_a] v E[k] E[C^{*h}] \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) \mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c) -->
<!-- $$ -->

Where the penultimate line follows from Equation \ref{eq:keyResult}. Recalling that $v = E[y^*] / (E[k] E[C^{*h}])$ (Equation \ref{eq:v0forms}), this further reduces to

\begin{equation}
\Delta Q = N E[k_a] E[y^*] \frac{\ell}{1 - h} \mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c)
\label{eq:deltQ}
\end{equation}
<!-- $$ -->
<!-- \Delta Q = N E[k_a] E[y^*] \frac{\ell}{1 - h}\mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c) -->
<!-- $$ -->

The new aggregate supply curve ($Q'$) can then be evaluated as

\begin{equation}
Q' = Q + \Delta Q
\end{equation}

To assess the aggregate change in net benefit, note from Equation \ref{eq:dLdlng} that the farm level change in net benefit per unit area $\partial \mathcal{L}^*$ may be expressed

\begin{equation}
\begin{split}
\partial \mathcal{L}^* &= \frac{\lambda}{h} ( C^* (\partial g - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w}) + \partial \ln(P)) + h \partial B) \\
&= r (C^* \gamma + h \partial B) \:\:;\:\:\: \gamma = \partial g - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w}) + \partial \ln(P) \:\:\: r = \frac{\lambda}{h} = \fraC{P}{C^{\#}}
\end{split}
\end{equation}

But recall from Equation \ref{eq:cStarAdopt} that $h \partial B = - \gamma \bar{\bar{C}^*}$, such that the expression reduces to

\begin{equation}
\partial \mathcal{L}^*(r, C^*) = r \gamma (C^* - \bar{\bar{C}^*})
\label{eq:dLstar}
\end{equation}

The aggregate change in net benefit ($\Delta \psi$) can be evaluated by integrating $\partial \mathcal{L}^*(C^*, r)$ over the farm expenditure ($C^* \in (0, \bar{\bar{C^{*h}}})$), revenue to expenditure ratio ($r \in (1, \infty)$) and area ($k_a$) densities. The domain of $r$ follows from axiom 3.

\begin{equation}
\begin{split}
\Delta \psi &= N \int_0^{\infty} \int_1^{\infty} \int_0^{\bar{\bar{C^*}}} \partial \mathcal{L}^*(C^*, r) \rho(C^*) dC^* \rho(r) dr \rho(k_a) d k_a \\
&= N E[k_a] \int_1^{\infty} r \rho(r) dr  \int_0^{\bar{\bar{C^*}}} \gamma (C^* - \bar{\bar{C}^*})  \rho(C^*) dC^* \\
&= N E[k_a] E[r] \gamma \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} + s_{\#} \right) \left( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c) - \bar{\bar{C}^*} \mathcal{A} \right)
\end{split}
\end{equation}

But note that, by the symmetry of the normal cumulative distribution function,

\begin{equation}
\begin{split}
\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} + s_{\#} \right) &= 2 \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}}\right) - \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - s_{\#} \right)\\
&= 2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})
\end{split}
\end{equation}

Such that the previous equation reduces as follows.

\begin{equation}
\Delta \psi = N E[k_a] E[r] \gamma (2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})) ( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c)  - \bar{\bar{C}^*} \mathcal{A} )
\label{eq:dPsi}
\end{equation}
<!-- $$ -->
<!-- \Delta \psi = N \int_0^{\infty} \int_1^{\infty} \int_0^{\bar{\bar{C^*}}} \partial \mathcal{L}^*(C^*, r) \rho(C^*) dC^* \rho(r) dr \rho(k_a) d k_a \\ -->
<!-- = N E[k_a] \int_1^{\infty} r \rho(r) dr \int_0^{\bar{\bar{C^*}}} \gamma (C^* - \bar{\bar{C}^*})  \rho(C^*) dC^* \\ -->
<!-- = N E[k_a] E[r] \gamma \Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} + s_{\#} \right) \left( E[C^*] \Phi \left( \frac{\ln(\bar{\bar{C}^*}) - m_c}{s_c} - s_c \right) - \bar{\bar{C}^*} \mathcal{A} \right) \\ -->
<!-- = N E[k_a] E[r] \gamma (2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})) ( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c)  - \bar{\bar{C}^*} \mathcal{A}) -->
<!-- $$ -->

By Equation \ref{eq:keyResult2}, this can also be written

\begin{equation}
\Delta \psi = N E[k_a] \gamma E[r | r \geq 1] \mathcal{A} \mathcal{E} (E[C^* | C^* \leq \bar{\bar{C}^*}] - \bar{\bar{C}^*})
\end{equation}

To calculate the change in aggregate supply and welfare for each stratum ($\Delta Q_{\ell}$ and $\Delta \psi_{\ell}$), in the equations above simply replace $v$, $N$, with $v_{\ell}$, $N_{\ell}$.

## Accounting for stochasticity, derivation of the expected aggregate supply curve based on axiom 5 \label{sec:acct4Stoch}

The deterministic aggregate supply function derived in section \ref{sec:addSupDet} is a suitable aggregate supply function in sectors characterized by deterministic production processes, negligible delays between input decisions and output, and negligible output price volatility. However, it is not suited to the primary sector, where production is partly deterministic but also partly a function of stochastic meteorological variables; where there is a significant delay between input decisions and output (i.e., the cropping season); and where output price volatility looms large in any management decision. In order to accommodate these hallmarks of agricultural supply, it is necessary to be more explicit in the treatment of yield and output price as stochastic variables.
<!-- Equation \ref{eq:aggSup1} -->

To begin with, yield is partly a function of stochastic meteorological variables unknown at planting time. Wherever $y^*$ appears in the equations above, what is really meant is $E[y^*(T)]|_{t = 0}$---that is to say, the farm's expectation of what yield will be at harvest time ($t = T$) as evaluated at planting time ($t = 0$). To arrive at an expression for $E[y^*(T)]|_{t = 0}$, consider observed yield at harvest.

\begin{equation}
\begin{split}
y^*(T; k_m(T)) &= y^*(T) = E[y^*(T; k_m(T))] \frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} \:\:;\:\:\: k' = k_m(T)^{-\kappa_m} k \\
&= v \frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} k' C^{*h} \:\:;\:\:\: v = \frac{E[y^*(T)]}{E[k'] E[C^{*h}]}
\end{split}
\label{eq:yStarT}
\end{equation}

Where the stochastic meteorological component $k_m(T)^{\kappa_m}$ has been factored out of $k$. The component $k_m(T)$ may be a single stochastic meteorological component such as total rainfall by harvest time, or it may represent a product of cumulative meteorological variables raised to their respective elasticities. For example, if the key meteorological variables are rainfall and solar radiation, then $k_m(T)^{\kappa_m} = k_r(T)^{\kappa_r} k_s(T)^{\kappa_s}$, where $k_r(T)$ and $k_s(T)$ are cumulative rainfall and solar radiation at harvest.

Taking the stochastic expectation of Equation \ref{eq:yStarT} then gives an expression for expected yield $E[y^*(T)]|_{t = 0}$.

\begin{equation}
E[y^*(T; k_m)]|_{t = 0} = E[\tilde{y}^*(T; k_m)]|_{t = 0} \left[\frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} \right]\Big|_{t = 0} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} \:\:;\:\:\: \tilde{y}^*(T; k_m) = E[y^*(T; k_m)]
\label{eq:EyStarT0}
\end{equation}

Note that taking the population mean of both sides of this equation results in a useful expression.

\begin{equation}
E[E[y^*(T; k_m)]|_{t = 0}] = E[\tilde{y}^*(T; k_m)]|_{t = 0}
\end{equation}

This result, which can also be reached by invoking Fubini's theorem, maps the mean expected yield to the expected yield on the mean farm---i.e., the farm where $k = E[k]$ and $C^{*h} = E[C^{*h}]$.

Farm data reports harvest yield $y^*(T)$, but expected yield at planting time ($E[y^*(T; k_m)]|_{t = 0}$) is generally not observable. Nonetheless, the implicit observed mean expected yield can be calculated from fitted $v$ and observed $E[k']$ and $E[C^{*h}|\theta]$, for a given mean expected meteorological condition. To see this, note that, by Fubini's theorem, the mean expected meteorological condition may be expressed

\begin{equation}
E[E[k_m(T)^{\kappa_m}]|_{t = 0}] = E[\tilde{k_m}(T)^{\kappa_m}]|_{t = 0} \:\:;\:\:\: \tilde{k_m}(T)^{\kappa_m} = E[k_m(T)^{\kappa_m}]
\end{equation}

Such that the implicit observed mean expected yield can be written

\begin{equation}
E[\tilde{y}^*(T; k_m)|\theta]|_{t = 0} = v E[\tilde{k}_m(T)^{\kappa_m}]|_{t = 0} E[k'] E[C^{*h}|\theta]
\label{eq:impMuEyStarT0cond}
\end{equation}
<!-- ...in section \ref{sec:condMean}, tractable expression for mean yield, stochastic version -->
<!-- ... -->
<!-- The relation between conditional and unconditional mean yield (Equation \ref{eq:condMeanYd1}) can thus be rewritten as follows. -->
<!-- \begin{equation} -->
<!-- E[y^*] = E[y^*|C^{\#} \leq P] \frac{\mathcal{E}}{\mathcal{P}} -->
<!-- \label{eq:condMeanYd2} -->
<!-- \end{equation} -->
<!-- ... -->
<!-- In practice, $E[y^*(T; k_m(T))]|_{t = 0}$ is generally not observable. Given farm data on which to fit the model in Equation \ref{eq:yStarT}, one may reasonably parse expected yield based on observed yield $y^*(T; k_r(T))$, observed meteorology $k_m(T)$, and on the expected meteorology $E[k_m(T)]|_{t = 0}$, as follows. -->
<!-- \begin{equation} -->
<!-- E[y^*(T; k_m(T))]|_{t = 0} = \frac{E[k_m(T)^{\kappa_m}]|_{t = 0}}{k_r(T)^{\kappa_m}} y^*(T; k_r(T)) -->
<!-- \end{equation} -->
<!-- Combining the previous two equations gives a formula for calculating expected yield at a specific expected meteorological condiion $E[k_m(T)^{\kappa_m}]|_{t = 0}$ based on observed yield $y^*(T)$ and meteorology $k_m(T)^{\kappa_m}$. -->
<!-- \begin{equation} -->
<!-- E[y^*(T)]|_{t = 0} = \frac{E[k_m(T)^{\kappa_m}]|_{t = 0}}{k_m(T)^{\kappa_m}} y^*(T) -->
<!-- \label{eq:stochYd1} -->
<!-- \end{equation} -->
<!-- E[y^*(T)]|_{t = 0} = \frac{E[\tilde{y}^*(T)]|_{t = 0}}{\tilde{y}^*(T)} y^*(T) \frac{E[k_m(T)^{\kappa_m}]|_{t = 0}}{k_m(T)^{\kappa_m}} -->
<!-- Because the unconditional mean yield does not change $\tilde{y}^*(T) = E[\tilde{y}^*(T)]|_{t = 0}$, [changes in weather affect both identically] -->
<!-- The term $E[E[y^*(T)]|_{t = 0}]$ is the population mean of the expectation of the stochastic process $y^*(t)$.  This can be rewritten in more expedient notation by evaluating the population mean of both sides,  -->
<!-- By Fubini's theorem ... -->
<!-- \begin{equation} -->
<!-- E[E[y^*(T)]|_{t = 0}] = E[E[y^*(T)]]|_{t = 0} -->
<!-- \label{eq:EyStarFubiniThm} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- y^*(T) = E[y^*(T)] \frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} -->
<!-- \end{equation} -->
<!-- And then taking the stochastic expectation -->
<!-- \begin{equation} -->
<!-- E[y^*(T)]|_{t = 0} = E[E[y^*(T)]]|_{t = 0} \frac{E[k_m(T)^{\kappa_m}]|_{t = 0}}{E[k_m(T)^{\kappa_m}]} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} -->
<!-- \end{equation} -->
<!-- By which it follows from this and Equation \ref{eq:stochYd1} that  -->
<!-- \begin{equation} -->
<!-- E[E[y^*(T)]|_{t = 0}] = E[E[y^*(T)]]|_{t = 0} -->
<!-- \label{eq:EyStarFubiniThm} -->
<!-- \end{equation} -->
<!-- Which is a result that can also be reached by invoking Fubini's theorem. The result states that the population mean of the expectation of $y^*(T)$ is equal to the expectation of $y^*(T)$ on the mean farm---i.e., the farm where $k' = E[k']$ and $C^{*h} = E[C^{*h}]$. The stochastic formulation of farm yield may thus be more clearly written -->
<!-- <!-- Given a suitable stochastic model for $k_m(t)$ such that $E[k_m(T)]|_{t = 0}$ can be parsed, this means that the population mean can be evaluated based on stochastic weather parameters when farm data is not available.Equation \ref{eq:EyStarFubiniThm}  -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[y^*(T)]|_{t = 0} &= E[\tilde{y}^*(T)]|_{t = 0} \frac{E[k_m(T)]|_{t = 0}}{E[\tilde{k}_m(T)]|_{t = 0}} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} \:\:;\:\:\: \tilde{y}^*(T) = y^*(T)\bigr|_{k'} = E[k'], \:\:\: C^{*h} = E[C^{*h}]} \\ -->
<!-- &= v k' \frac{E[k_m(T)]|_{t = 0}}{E[\tilde{k}_m(T)]|_{t = 0}} C^{*h} \:\:;\:\:\: v = \frac{E[\tilde{y}^*(T)]|_{t = 0}}{E[k'] E[C^{*h}]} -->
<!-- \end{split} -->
<!-- \label{eq:stochYd2} -->
<!-- \end{equation} -->

The optimal farm expenditure per acre $C^*$ remains a deterministic variable because it refers primarily to land preparation, seed, fertilizer and chemical pest control. Some formulations of farm cost might also include some harvest post harvest labor costs (e.g., shelling, stooking, transport), but the main cost components are typically known (executed or committed) at planting time.
<!-- For purposes of parameter estimation, expected yield is generally not observable. However, noting that -->
<!-- \begin{equation} -->
<!-- E[y^*(T)]|_{t = 0} = \frac{E[\tilde{y}^*(T)]|_{t = 0}}{\tilde{y}^*(T)} \left( \frac{E[k_m(T)]|_{t = 0}}{k_m(T)} \right)^{\kappa_m} y^*(T) -->
<!-- \label{eq:EyStarFromYT} -->
<!-- \end{equation} -->
<!-- Expected yield can be deduced from observed yield $y^*(T)$ by estimating Equation \ref{eq:stochYd2} at $t = T$ (in logs), -->
<!-- \ref{eq:YdEnvReg1} becomes -->
<!-- \begin{equation} -->
<!-- \ln(y^*(T)) = \ln(v) + \kappa_m \ln(k_m(T)) + \sum_{i \neq m}^{n_{k'}} \kappa_i \ln(k_i) + h \ln(C^*) + \epsilon -->
<!-- \label{eq:lYdEnvReg2} -->
<!-- \end{equation} -->
<!-- And then evaluating Equation \ref{eq:EyStarFromYT} at the fitted values of $y^*(T)$, and at the expected meteorological conditions of interest. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \ln(E[y^*(T)]|_{t = 0}) &= \widehat{\ln(y^*(T))} - \kappa_m \ln(k_m(T)) + \kappa_m \ln(E[k_m(T)]|_{t = 0}) \\ -->
<!-- &= \ln(y^*(T)) - \kappa_m \ln(k_m(T)) + \kappa_m \ln(E[k_m(T)]|_{t = 0}) - \epsilon \\ -->
<!-- &\rightarrow E[y^*(T)]|_{t = 0} = \left( \frac{E[k_m(T)]|_{t = 0}}{k_m(T)} \right)^{\kappa_m} y^*(T) e^{-\epsilon} -->
<!-- \end{split} -->
<!-- \label{eq:EyStarT0fromYhat} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- E[y^*(T)]|_{t = 0} = v E[k_m(T)]|_{t = 0} \hat{k} C^{*h} \:\:;\:\:\: v = \frac{E[\tilde{y}^*(T)]|_{t = 0}}{E[k] E[C^{*h}]} -->
<!-- \label{eq:YdEnvReg2} -->
<!-- \end{equation} -->
<!-- \:\:;\:\:\: v = \frac{E[y^*]}{E[k] E[C^{*h}]}  -->
<!-- # ```{r Fig2, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:gBmWeather}(Left) Daily average weather variable time series covering the 2018 maize long rains growing season in Eldoret, Kenya (NREL 2023). (Right) The corresponding daily log changes exhibit the normal distribution typical of geometric Brownian motion.", echo = FALSE} -->
<!-- #Weather data from National Solar Radiation Database -->
<!-- #https://nsrdb.nrel.gov/data-viewer -->
<!-- mainFolder <- "D:/OneDrive - CGIAR/Documents 1/CIAT 2/A theory of aggregate supply and demand/Eldoret weather data/" -->
<!-- thisFile <- "NSRDB weather data Eldoret 2018 maize season.csv" -->
<!-- thisFilePath <- paste0(mainFolder, thisFile) -->
<!-- df <- read.csv(thisFilePath, stringsAsFactors = F) -->
<!-- colnames(df)[ncol(df)] <- "Log change" -->
<!-- df$Date <- as.Date(df$Date) -->
<!-- gg <- ggplot(df, aes(x = Date, y = val)) -->
<!-- gg <- gg + geom_line() -->
<!-- gg <- gg + scale_x_date(breaks = scales::breaks_pretty(n = 8)) -->
<!-- gg <- gg + facet_wrap(~var, ncol = 1, scales = "free_y", strip.position = "left") -->
<!-- gg <- gg + labs(title = "Daily averages of key weather variables influencing crop yields\nEldoret, Kenya, 2018 maize growing season") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title.x = element_text(size = axisTitleSize), -->
<!--                  axis.title.y = element_blank(), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  strip.background = element_rect(fill = "white"), -->
<!--                  strip.text = element_text(size = facetTitleSize), -->
<!--                  plot.title = element_text(size = titleSize)) -->
<!-- gg_line <- gg -->
<!-- gg <- ggplot(df, aes(x = `Log change`)) -->
<!-- gg <- gg + geom_histogram(color = 4, fill = "white", bins = 20) -->
<!-- gg <- gg + facet_wrap(~var, ncol = 1, scales = "free") -->
<!-- gg <- gg + labs(title = "Daily log change") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title = element_blank(), -->
<!--                  #axis.title.y = element_blank(), -->
<!--                  #axis.title.x = element_text(size = axisTitleSize), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  strip.background = element_rect(fill = "white"), -->
<!--                  strip.text = element_blank(), -->
<!--                  plot.title = element_text(size = titleSize)) -->
<!-- gg_hist <- gg -->
<!-- gg_line + gg_hist + plot_layout(ncol = 2, widths = c(1, 1/3)) -->
<!-- ``` -->
<!-- [@jseData; @fpmaData; @cmeData; @nsrdbData] -->
<!-- ---especially temperature, solar radiation, and humidity--- -->

Absent a forward contract, the output sale price $P$ is a stochastic variable unknown to the farmer at the time of planting. Wherever $P$ appears in the equations above, then, what is really meant is $E[P(T)]|_{t = 0}$---the value that the farmer expects $P$ to take at harvest/sale, as evaluated at planting time. To parse $E[P(T)]|_{t = 0}$, a suitable stochastic model must be assumed for $P(t)$. Within a given season, prices often follow a geometric Brownian motion (gBm). That is to say, changes in $P$ over a small time interval $\Delta t$ ($\Delta P = P(t + \Delta t) - P(t)$) are often accurately modeled by

\begin{equation}
\Delta P = P(t) m_p \Delta t - P(t) s_p \varepsilon \sqrt{\Delta t}
\end{equation}

Where $\varepsilon$ is a normally distributed random variable with mean $0$ and variance $1$, such that the arithmetic change $\Delta P / P$ is normally distributed with mean and variance

\begin{equation}
\begin{split}
E \left[\frac{\Delta P(T)}{P(T)} \right] &= m_{p} \Delta t  \\
Var \left[\frac{\Delta P(T)}{P(T)} \right] &= s_{p}^2 \Delta t
\end{split}
\end{equation}

Such that the expected value of $P(T)$ resolves as

\begin{equation}
E[P(T)]\bigr|_{t = 0} = P(0) e^{m_p T}
\label{eq:EPT0}
\end{equation}

(For details, see Hull [-@hull9thEdition].)

The choice of gBm as the stochastic model for $P(t)$ is axiom 5. For what follows, it is important to note that the log change of the gBm $\ln(P(T) / P(\hat{t}))$ is defined over any finite time interval for some starting time $\hat{t}<T$, and is also normally distributed, with mean and variance

\begin{equation}
\begin{split}
E \left[\ln \left( \frac{P(T)}{P(\hat{t})} \right) \right] &= \left(m_{p} - \frac{s_p^2}{2} \right) T \\
Var \left[\ln \left( \frac{P(T)}{P(\hat{t})} \right) \right] &= Var \left[\ln (P(T)) \right] = s_{p}^2 T
\label{eq:lnChngP}
\end{split}
\end{equation}

For those unfamiliar with stochastic modeling but familiar with statistics, the choice of stochastic model may be roughly thought of as the choice of size distribution of changes in $P(t)$ per small time increment $\Delta t$. Selecting gBm as the stochastic model of $P(t)$ is tantamount to assuming that such changes are lognormally distributed. Some examples of maize prices following a gBm are given in Figure \ref{fig:gBmPrice}, accompanied by histograms of their log changes per time step. The histograms offer visual confirmation that price changes per time step are convergent to a lognormal distribution, and that gBm is therefore a reasonable assumption.

It is important to keep in mind that the price trajectory considered here is over a cropping season---from planting to harvest. When considered over multiple cropping seasons, prices typically exhibit cyclic or mean reverting behavior, which requires a more sophisticated stochastic model.
<!-- Finally, note that $\Delta t$ is technically an instantaneous time interval, such that $m_p$ is the expected instantaneous growth rate. In practice, it is often acceptable to treat $\Delta t$ as a finitely small, but judicious, time step. As a rule of thumb, $\Delta t$ should be as small as the resolution of the data will allow, while also ensuring a finite sample path with no jumps. -->

\singlespacing
```{r Fig1, fig.show = "hold", fig.width = 5, fig.height=4, fig.align="center", fig.cap="\\label{fig:gBmPrice}(Left) Maize price series from (top to bottom) Chicago, USA (CME, 2025), Johannesburg, RSA (JSE, 2025), and Eldoret market, Kenya (WFP, 2025). (Right) The corresponding daily (monthly, in the case of Kenya) log changes exhibit the normal distribution typical of geometric Brownian motion.", echo = FALSE}

thisFile <- "South Africa corn future price.csv"
thisFilePath <- paste0(mainFolder, priceFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c("DATE", "WHITE")
df_raw <- df_raw[, keepCols]
colnames(df_raw) <- c("Date", "Price")
df_raw$Date <- as.Date(df_raw$Date, "%m/%d/%Y")
df <- subset(df_raw, Date > "2017-11-01" &
               Date < "2018-04-15") %>%
  complete(Date = seq.Date(from = min(Date),
                           to = max(Date), by = "day"))  %>%
  filter(!(weekdays(Date) %in% c('Saturday','Sunday')))


df$`Log change` <- c(NA, diff(log(df$Price)))
#shapiro.test(df$`Log change`)
df_sa <- df
df_sa$Place <- "South Africa"
#-----------------------------------------------------------------
thisFile <- "US corn future price.csv"
thisFilePath <- paste0(mainFolder, priceFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c("date", "adjusted")
df_raw <- df_raw[, keepCols]
colnames(df_raw) <- c("Date", "Price")
df_raw$Date <- as.Date(df_raw$Date, "%Y-%m-%d")
df <- subset(df_raw, Date > "2018-03-31" &
               Date < "2018-12-01") %>%
  complete(Date = seq.Date(from = min(Date),
                           to = max(Date), by = "day")) %>%
  filter(!(weekdays(Date) %in% c('Saturday','Sunday')))
df$Price <- df$Price / 100
df$`Log change` <- c(NA, diff(log(df$Price)))
#shapiro.test(df$`Log change`)
df_us <- df
df_us$Place <- "USA"
#---------------------------------------------------------------
# https://data.humdata.org/organization/wfp?vocab_Topics=prices
thisFile <- "Maize price Eldoret WFP.csv"
thisFilePath <- paste0(mainFolder, priceFolder, thisFile)
dfRaw <- read.csv(thisFilePath, stringsAsFactors = F)
dfRaw$Date <- row.names(dfRaw); dfRaw <- dfRaw[-1, ]; colnames(dfRaw)[1] <- "Price"
dfRaw$Price <- round(as.numeric(dfRaw$Price), 2)
dfRaw$Date <- my(dfRaw$Date)
df <- dfRaw %>%
  complete(Date = seq.Date(from = min(Date),
                           to = max(Date), by = "month"))
df$`Log change` <- c(NA, diff(log(df$Price)))
#shapiro.test(df$`Log change`)
df_ky <- df
df_ky$Place <- "Kenya"
#----------------------------------------------------------------------------------------
# Put it all together for graphic
df_ts <- as.data.frame(do.call(rbind, list(df_us, df_sa, df_ky)))
df_ts$Place <- gsub("Kenya", "Eldoret, Kenya\n2006-2022 (monthly)\nKES / kg.", df_ts$Place)
df_ts$Place <- gsub("USA", "Chicago, USA\n2018 (daily)\nUSD / bushel", df_ts$Place)
df_ts$Place <- gsub("South Africa", "Johannesburg, RSA\n2018 (daily)\nZAR / kg.", df_ts$Place)
gg <- ggplot(df_ts, aes(x = Date, y = Price))
gg <- gg + geom_line()
gg <- gg + scale_x_date(breaks = scales::breaks_pretty(n = 8), labels = date_format("%b\n%Y"))
# gg <- gg + scale_x_date(breaks = "4 months", labels = date_format("%m-%Y"))
#gg <- gg + scale_x_date(date_breaks = "4 month", date_labels =  "%b %Y")
gg <- gg + facet_wrap(~factor(Place,
                              levels = c("Chicago, USA\n2018 (daily)\nUSD / bushel",
                                         "Johannesburg, RSA\n2018 (daily)\nZAR / kg.",
                                         "Eldoret, Kenya\n2006-2022 (monthly)\nKES / kg.")),
                      ncol = 1, scales = "free", strip.position = "left")
gg <- gg + labs(title = "Maize price series exhibiting geometric Brownian motion")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 axis.text = element_text(size = axisTextSize),
                 strip.background = element_rect(fill = "white"),
                 strip.text = element_text(size = 5), #facetTitleSize
                 plot.title = element_text(size = titleSize))
gg_ts <- gg
#---------------------------------------------------------------
# Histograms of log changes
# df_hist <- as.data.frame(do.call(rbind, list(df_sa, df_us, df_ky)))
df_hist <- df_ts
gg <- ggplot(df_hist, aes(x = `Log change`))
gg <- gg + geom_histogram(color = 4, fill = "white", bins = 15)
gg <- gg + facet_wrap(~factor(Place,
                              levels = c("Chicago, USA\n2018 (daily)\nUSD / bushel",
                                         "Johannesburg, RSA\n2018 (daily)\nZAR / kg.",
                                         "Eldoret, Kenya\n2006-2022 (monthly)\nKES / kg.")), ncol = 1, scales = "free")
gg <- gg + labs(title = "Log change")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text = element_text(size = axisTextSize),
                 strip.background = element_rect(fill = "white"),
                 strip.text = element_blank(),
                 plot.title = element_text(size = titleSize))
gg_hist <- gg
#---------------------------------------------------------------
# library(patchwork)

gg_ts + gg_hist + plot_layout(ncol = 2, widths = c(1, 1/3))

# design <- c("AAD
#             BBD
#             CCD")
# wrap_plots(A = gg_ky, B = gg_sa, C = gg_us, D = gg_hist, design = design)

```
\doublespacing

Farm cost per acre is deterministic, but optimal unit expenditure $C^{\#}$ is proportional to price, and must therefore also be stochastic. Rewriting Equation \ref{eq:cSharp} in stochastically explicit terms,

\begin{equation}
\begin{split}
E[C^{\#}(T)]\bigr|_{t = 0} &= \frac{E[P(T)]\bigr|_{t = 0}}{\lambda} h \\
&= \frac{P(0) e^{m_p T}}{\lambda} h
\end{split}
\label{eq:useful2}
\end{equation}

Substituting the stochastic terms developed above for $y^*$, $P$, and $C^{\#}$ in the deterministic aggregate supply curve (Equation \ref{eq:aggSup1}), gives the _expected_ aggregate supply curve.

\begin{equation}
\begin{split}
E[Q(T)]|_{t = 0} = N E[k_a] E[\tilde{y}^*(T; k_m(T))]|_{t = 0} \Phi \left( \frac{\ln(E[P(T)]|_{t = 0}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) \\
m_{\#} = E[\ln(E[C^{\#}(T)]|_{t = 0})] \:\:\:\: s^2_{\#} = Var\ln(E[C^{\#}(T)]|_{t = 0})
\end{split}
\label{eq:aggSup2}
\end{equation}

Equation \ref{eq:condMeanYd1}, relating the observed (conditional) mean and unconditional mean expected yield, must also be rewritten more carefully as follows.

\begin{equation}
\begin{split}
E[\tilde{y}^*(T; k_m(T))]|_{t = 0} &= E[\tilde{y}^*(T; k_m(T)) | \theta]|_{t = 0} \frac{\Phi\left( \frac{\ln(E[P(T)]|_{t = 0}) - m_{\#}}{s_{\#}} \right)}{\Phi \left( \frac{\ln(E[P(T)]|_{t = 0}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)} \\
& \theta = E[C^{\#}(T)]|_{t = 0} \leq E[P(T)]|_{t = 0} \\
& \tilde{y}^*(T; k_r(T))|\{\theta\} = E[y^*(T; k_r(T)) | \theta]
\end{split}
\label{eq:condMeanYd2}
\end{equation}

In practice, the expected conditional mean yield ($E[\tilde{y}^*(T; k_m(T)) | \theta]|_{t = 0}$) is generally not observable. However, it can be estimated from the observed (conditional) mean harvest yield ($E[y^*(T; k_m(T))|\theta]$) as follows.

\begin{equation}
E[\tilde{y}^*(T; k_m(T)) | \theta]|_{t = 0} = \frac{E[E[k_m(T)^{\kappa_m}]]|_{t = 0}}{E[k_m(T)^{\kappa_m}]} E[y^*(T; k_m(T))|\theta]
\label{eq:EmuYstarCondEst}
\end{equation}
<!-- \begin{split} -->
<!-- E[E[y^*(T)]|_{t = 0}] &= E[E[y^*(T)]|_{t = 0} | \theta] -->
<!-- \frac{\Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)} \\ -->

It was noted earlier that the $\Phi()$ term in the numerator on the righthand side of Equation \ref{eq:condMeanYd2} may be interpreted as the farm employment rate. In the remainder of this section, it is shown that the $\Phi()$ term appearing in the denominator, and in the expected aggregate supply function, also has a meaningful economic interpretation. Specifically,

\begin{equation}
\Phi \left( \frac{\ln(E[P(T)]|_{t = 0}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) = \text{Prob}(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0} \leq P(T)^{\eta}) \:\:;\:\:\: \tilde{C}^{\#}(T) = E[C^{\#}(T)]
\label{eq:probProfitResult}
\end{equation}

In words, the $\Phi()$ term on the lefthand side equals the probability that the harvest output price (raised to $\eta$) will be greater than the mean farm's expected unit cost (raised to $\eta$). The term may thus be considered a rough reflection (up to the adjustment $\eta$) of the mean probability of profit. To see this, start with the expectation of Equation \ref{eq:useful2}, giving the population mean of $E[C^{\#}(T)]\bigr|_{t = 0}$.

\begin{equation}
E[E[C^{\#}(T)]\bigr|_{t = 0}] = E[P(T)]\bigr|_{t = 0} h E[\lambda^{-1}]
\end{equation}

But note also that

\begin{equation}
E[C^{\#}(T)] = P(T) h E[\lambda^{-1}]
\end{equation}

Such that

\begin{equation}
E[E[C^{\#}(T)]]\bigr|_{t = 0} = E[P(T)]\bigr|_{t = 0} h E[\lambda^{-1}]
\end{equation}

Then it follows that

\begin{equation}
E[E[C^{\#}(T)]\bigr|_{t = 0}] = E[E[C^{\#}(T)]]\bigr|_{t = 0}
\label{eq:fubThm}
\end{equation}

Which is a result that can again also be reached by invoking Fubini's theorem. To be clear, the result states that the population mean of the optimal expected unit cost ($E[C^{\#}(T)]\bigr|_{t = 0}$) is equal to the optimal expected unit cost on the mean farm, i.e. the farm with $\lambda^{-1} = E[\lambda^{-1}]$. It therefore maps the mean of all $C^{\#}(t)$ trajectories in the farm population to the mean of possible random trajectories on a single farm (the farm where $\lambda^{-1} = E[\lambda^{-1}]$). Letting $\tilde{C}^{\#}(T)$ denote the unit cost on the mean farm (i.e. $\tilde{C}^{\#}(T) = C^{\#}(T)|_{\lambda^{-1} = E[\lambda^{-1}]}$), an equivalent, perhaps clearer, way of writing the result is
<!-- reference justifying application of Fubini's thm here: -->
<!-- https://stats.stackexchange.com/questions/412936/when-can-integration-and-expectation-be-exchanged -->
<!-- [GRAPHIC showing equality of pop mean of expected future cSharp to expected cSharp on the mean farm (?)] -->

\begin{equation}
E[E[C^{\#}(T)]\bigr|_{t = 0}] = E[\tilde{C}^{\#}(T)]\bigr|_{t = 0}
\label{eq:fubThm2}
\end{equation}

Where the righthand side has been rewritten to more clearly indicate future expectation on the single farm where $\lambda^{-1} = E[\lambda^{-1}]$.

Switching from population parameter space to stochastic price parameter space also requires that the variance likewise switches from a population variance to a stochastic variance. This means replacing $Var[\ln(E[C^{\#}(T)]|_{t = 0})]$ (i.e. $s^2_{\#}$) with $Var[\ln(\tilde{C}^{\#}(T))]|_{t = 0}$. 

To parse $Var[\ln(\tilde{C}^{\#}(T))]|_{t = 0}$, note first that the optimal expected unit cost $E[C^{\#}(T)]\bigr|_{t = 0}$ is an abstract optimal target that farmers aim for, but that evolves before and after the actual farm expenditure that is "locked in" at planting based on the price information $P(0)$ available at that time. As an abstract target, then, optimal unit cost may be expressed

\begin{equation}
C^{\#}(t) = P(t) \frac{h}{\lambda}
\label{eq:useful3}
\end{equation}

Because its evolution is proportional to output price, then, by Ito's Lemma, $C^{\#}(t)$ must also be a gBm with the same drift and volatility parameters as $P(t)$. (A proof of this is given in Appendix B.) Therefore,

\begin{equation}
Var[\ln(C^{\#}(T))]\bigr|_{t = 0} = s^2_p T
\label{eq:sPTresult}
\end{equation}

This is true for any value of $\lambda^{-1}$, including $\lambda^{-1} = E[\lambda^{-1}]$. Thus, when moving from farm population space to stochastic price space, $s^2_{\#}$ becomes $s^2_p T$.

As for $m_{\#}$, recall that the $m_{\#}$ in the $\Phi()$ term in Equation \ref{eq:aggSup2} comes from the definition $E[C^{\# \eta}] = e^{\eta m_{\#} + \eta^2 s^2_{\#} / 2}$ such that $m_{\#} = \ln(E[C^{\# \eta}]) - \eta s^2_{\#} / 2$. The results in Equations \ref{eq:fubThm2} and \ref{eq:sPTresult} mean that $m_{\#}$ also has the following dual expression in stochastic price space.

\begin{equation}
m_{\#} = \ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}) - \eta \frac{s^2_p}{2} T
\end{equation}

Substituting the dual expressions for $m_{\#}$ and $s^2_{\#}$ in the $\Phi()$ term of Equation \ref{eq:probProfitResult}, and substituting $P(0)e^{m_p T}$ for $E[P(T)]|_{t = 0}$ (via Equation \ref{eq:EPT0}), resolves the $\Phi()$ term as follows.

\begin{equation}
\begin{split}
\Phi \left( \frac{\ln(E[P(T)]|_{t = 0}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) &= \Phi \left( \frac{\ln(P(0)) + m_p T - \ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}) + \eta \frac{s^2_p}{2} T}{s_p \sqrt{T}} - \eta s_p \sqrt{T} \right) \\
&= \Phi \left( -\frac{\ln \left(\frac{E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}}{P(0)} \right) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}} \right) \\
&= 1 - \Phi(z) \:\:;\:\:\: z = \frac{\ln \left(\frac{E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}}{P(0)} \right) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}}
\end{split}
\label{eq:PhiMap}
\end{equation}

But note that $z$ is just the standard score of logged output price evaluated at $\ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0})$. (Recall Equations \ref{eq:lnChngP}.)

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- z &= \frac{\ln \left(\frac{E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}}{P(0)} \right) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}} \\ -->
<!-- &= \frac{\ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}) - \ln(P(0)) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}} -->
<!-- \end{split} -->
<!-- \end{equation} -->
\begin{equation}
\begin{split}
z &= \frac{\ln \left(\frac{E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}}{P(0)} \right) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}} \\
&= \frac{\ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}) - \ln(P(0)) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}}  \\
&= \frac{\ln(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}) - E[\ln(P(T))]|_{t = 0}}{s_p \sqrt{T}}
\end{split}
\end{equation}

Therefore

\begin{equation}
\begin{split}
1 - \Phi(z) &= \text{Prob}(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0} \leq P(T)^{\eta}) \\
& \equiv \mathcal{P}
\end{split}
\end{equation}

Which proves Equation \ref{eq:probProfitResult}. Recalling from section \ref{sec:axioms1and2} that the adjustment $\eta$ is the output price elasticity of farm supply (PEFS), the probability $\mathcal{P}$ is henceforth referred to as the "PEFS-adjusted mean probability of profit". Equation \ref{eq:PhiMap} maps the PEFS-adjusted mean probability of profit from farm population parameter space to stochastic price parameter space. The most appropriate parameter space to work in is that for which the higher resolution data is available. When farm data is available, evaluation in farm population parameter space is the best approach. In the absence of farm data, evaluation in stochastic price parameter space is appropriate if high resolution price series data is available.

Expected aggregate supply in stochastic price parameter space follows from Equations \ref{eq:aggSup2} and \ref{eq:PhiMap}.

\begin{equation}
E[Q(T)]|_{t = 0} = N E[k_a] E[\tilde{y}^*(T; k_m(T))]|_{t = 0} (1 - \Phi(z)) \:\:;\:\:\: z = \frac{\ln \left( \frac{E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0}}{P(0)} \right) - \left( m_p - \eta \frac{s^2_p}{2} \right) T}{s_p \sqrt{T}}
\label{eq:aggSup3}
\end{equation}

Where the expected unconditional mean yield in stochastic price parameter space is

\begin{equation}
E[\tilde{y}^*(T)]|_{t = 0} = E[\tilde{y}^*(T) | \theta]|_{t = 0} \frac{1 - \Phi(z - \eta s_p \sqrt{T})}{1 - \Phi(z)}
\label{eq:condMeanYd3}
\end{equation}

And, regardless of the parameter space in which calculations are made,

\begin{equation}
\begin{split}
E[Q(T)]|_{t = 0} &= N E[k_a] E[\tilde{y}^*(T; k_m(T))]|_{t = 0} \text{Prob}(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0} \leq P(T)^{\eta}) \\
&= N E[k_a] E[\tilde{y}^*(T)]|_{t = 0} \times \text{PEFS-adj. mean probability of profit}
\end{split}
\label{eq:aggSup4}
\end{equation}

And

\begin{equation}
\begin{split}
E[\tilde{y}^*(T)]|_{t = 0} &= E[\tilde{y}^*(T) | \theta]|_{t = 0} \frac{\text{Prob}(E[C^{\#}(T)]|_{t = 0} \leq P(T))}{\text{Prob}(E[\tilde{C}^{\#}(T)^{\eta}]|_{t = 0} \leq P(T)^{\eta})} \\
\text{Expected undonditional mean yield} &= \text{Expected conditional mean yield} \times \frac{\text{Farm employment rate}}{\text{PEFS-adj. mean probability of profit}}
\end{split}
\label{eq:muEyStarT0frommuEyStarT0trunc}
\end{equation}
<!-- \text{Mean expected undonditional yield} &= \text{Mean expected conditional yield} -->

In the absence of both farm and price data, then, back of the envelope calculations can be made based on expert consensus regarding mean observed (conditional) yield, the farm employment rate, and the PEFS adjusted mean probability of profit.

Note that the price elasticity of expected aggregate supply follows as

\begin{equation}
\begin{split}
\frac{\partial \ln(E[Q(T)]|_{t = 0})}{\partial \ln(P(0))} &= \frac{d \ln (\Phi(-z))}{d (-z)} \frac{\partial (-z)}{\partial \ln(P(0))} \\
&= \frac{\phi(-z)}{\Phi(-z)} \frac{1}{s_p \sqrt{T}}
\end{split}
\label{eq:pElasQagg}
\end{equation}

Whereby it is clear that, under axioms 1-5, price elasticity of expected aggregate supply changes with price, contrary to the assumption in many economic surplus analyses. It follows, moreover, that aggregate supply is elastic/inelastic if

\begin{equation}
s_p \sqrt{T} </> \frac{\phi(-z)}{\Phi(-z)}
\end{equation}

Finally, the stochastically explicit formulations for the research induced change in aggregate supply and welfare derived in section \ref{sec:aggImpact} follow from the exposition above as

\begin{equation}
\begin{split}
\Delta E[Q(T; k_m(T))]|_{t = 0} &= N E[k_a] E[\tilde{y}^*(T, k_m(T))]|_{t = 0} \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) \mathcal{P} \\
&= N \mathcal{A} E[k_a] E[\tilde{y}^*(T, k_m(T))| C^* \leq \bar{\bar{C^*}}]|_{t = 0} \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w}))
\end{split}
\label{eq:dEQT0}
\end{equation}
<!-- \Delta Q = N E[k_a] E[y^*] \frac{\ell}{1 - h}\mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c) -->

And

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \Delta \psi &= N E[k_a] E[k] v P \gamma (E[C^{*h}] \mathcal{P}() - \bar{\bar{C^{*h}}} \mathcal{A}) \\ -->
<!-- &= N E[k_a] P \gamma \left( E[y^*] \mathcal{P} - E[\overline{\overline{E[y(T)^*]|_{t = 0}}}] \mathcal{A} \right) -->
<!-- \end{split} -->
<!-- \label{eq:dEPsi} -->
<!-- \end{equation} -->

\begin{equation}
\Delta \psi = N E[k_a] E[\tilde{r}(T)]|_{t = 0} \gamma (2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})) ( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c)  - \bar{\bar{C}^*} \mathcal{A} ) \:\:;\:\:\: \tilde{r}(T) = E[r(T)] = \frac{E[P(T)]}{E[C^{\#}(T)]}
\label{eq:dEPsi}
\end{equation}
<!-- \Delta \psi = N E[k_a] E[r] \gamma (2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})) ( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c)  - \bar{\bar{C}^*} \mathcal{A} ) -->


<!-- \Delta E[Q(T; k_m(T))]|_{t = 0} &= N E[k_a] E[\tilde{y}^*(T, k_m(T))]|_{t = 0} \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) (1 - \Phi ( \v )) \\ -->
<!-- &= N \mathcal{A} E[k_a] E[\tilde{y}^*(T, k_m(T))| C^* \leq \bar{\bar{C^*}}]|_{t = 0} \frac{1}{1 - h}(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \ln(\mathbf{w})) -->
<!-- \begin{equation} -->
<!-- \frac{\ln(\bar{\bar{C^*}}) - m_{c}}{s_c} - h s_c = \frac{\ln(\bar{\bar{C^{\#}}}) - m_{\#}}{s_{\#}} - \eta s_{\#} -->
<!-- \end{equation} -->

# An illustrative use case: Kenya's maize aggregate supply curve

## Expected aggregate supply model parameter estimation and comparison to empirical estimates

As an illustrative example, the expected aggregate supply curve derived above from axioms 1-5 is fit to 2007 Kenyan maize farm data and compared against empirical estimates of expected aggregate supply for the years 2006-2012. The farm data used in this pedagogical exercise come from a panel covering the main and short rains seasons for multiple crops across Kenya for the years 1997, 2000, 2004, 2007, and 2010, originally gathered by the Egerton University Tegemeo Institute of Agricultural Policy and Development in partnership with Michigan State University, under the auspices of a USAID project [@maizeData]. For the present exercise, only the 2007 main rains season maize farm data is used. The main season in Kenya generally runs from March to August or September. Farms not reporting maize as their main crop or reporting zero maize production cost are excluded, as well as five farms reporting extremely high unit cost, resulting in a sample size of 937 maize farms across 20 districts (nowadays referred to as "counties"). The sample represents all major maize growing regions in the country. Full details regarding the data and its processing for the present exercise, including summary statistics, are provided in Appendix B.

The empirical estimates of aggregate supply for the years 2006-2012 are taken from commodity intelligence reports published in mid to late season---prior to harvest but after planted area and main season rainfall are known. These estimates, summarized in Table 1, cover some of Kenya's worst drought years in living memory.

\singlespacing
```{r, echo = FALSE}
#out.width='\\textwidth',
# Ministry of Ag midseason expected main season maize harvest, million MT
# Or USDA FAS GAIN report or Commodity Intelligence report
# Long rains production accounts for 80% of national output (USDA FAS GAINS 2007)
# Does long rains harvesting extend into September?
# Note that these estimates are made after rainfall is known, hence should be close to the high
# or low rainfall as appropriate
EQsT2006Jun14giews<- 2.7 #GIEWS
#EQsT2007May15MoA <- 1.04 * 2.7 # GIEWS 3 total (short and main), up 4% from prev yr
EQsT2007Jun28usda <- 2.6 # USDA FAS
EQsT2008Jul15giews <- 2.16 # MoA forecast (GIEWS 2008 report), also reported in USDA FAS Commod Intel Report - 100,000 ha not planted due to post election violence, west received normal rainfall but rest of main maize growing area received 20-80% of normal. https://ipad.fas.usda.gov/highlights/2008/09/kenya/
#EQsT2008sep17usda <- 2.55 # USDA FAS Commod Intel Report https://ipad.fas.usda.gov/highlights/2008/09/kenya/
EQsT2009Aug11MoA <- 1.84 # Minister of Ag press release, Severe drought, crop failure 1.9# USAID 29 Sept 2009
EQsT2010Aug5giews <- 2.6 # GIEWS Good rain, started 2 weeks early
EQsT2011Nov3kfssg <- 2.34 # KFSSG Dismal rainfall outside of western Kenya
EQsT2012Jul16giews <- 2.4 # MLND outbreak, late start to rains
#EQsT2013Jul16MoA <- 1.62 # GoK KFSSG Poorly distributed low rainfall, early cessation
EQsTvec <- c(EQsT2006Jun14giews, EQsT2007Jun28usda, EQsT2008Jul15giews,
             EQsT2009Aug11MoA, EQsT2010Aug5giews, EQsT2011Nov3kfssg, EQsT2012Jul16giews)
reportDate <- c("12 Jun 2006",
                "28 Jun 2007",
                "15 Jul 2008",
                "11 Aug 2009",
                "5 Aug 2010",
                "July 2011",
                "16 Jul 2012")
citeVec <- c("FAO Global Information and Early Warning System 2006",
             "USDA Foreign Agricultural Service 2007",
             "FAO Global Information and Early Warning System 2008",
             "Minister of Agriculture 2009",
             "FAO Global Information and Early Warning System 2010",
             "Kenya Food Security Steering Group 2011",
             "FAO Global Information and Early Warning System 2012")
commentVec <- c("Normal rainfall",
                "Normal rainfall",
                "Post-election violence, drought",
                "Severe drought, crop failure",
                "Good rains that came early, but some crop loss due to flooding",
                "Dismal rainfall except in west Kenya",
                "Rains started late, maize lethal necrosis outbreak")
dfPoints <- data.frame(`Estimate date` = reportDate,
                       `Estimate (million MT)` = EQsTvec,
                       Reference = citeVec,
                       Comments = commentVec)
colnames(dfPoints) <- c("Estimate date", "Estimate (million MT)", "Reference", "Comments")

set_flextable_defaults(
  font.size = 10#, #theme_fun = theme_vanilla,
  #padding = 6
  )
  #background.color = "#EFEFEF")
dfPoints_ft <- dfPoints
dfPoints_ft$`Estimate (million MT)` <- as.character(dfPoints_ft$`Estimate (million MT)`)
ft <- flextable(dfPoints_ft) %>% 
  set_caption("Empirical midseason forecasts of Kenya main season maize harvest 2006-2012", align_with_table = F) %>% autofit() %>% fit_to_width(7)
  # add_header_row(values = "",
  # colwidths = c(4)) 
ft

```
\doublespacing

To estimate the parameters of expected aggregate supply curve, Equation \ref{eq:yStarT} (in logs) is fit to the farm data by OLS regression.

\begin{equation}
\ln(y^*(T)) &= \ln(v) + \sum_i^{n_k} \kappa_i \ln(k_i) + h \ln(C^*) + \epsilon
\label{eq:lYstarT}
\end{equation}
<!-- $$ -->
<!-- y^*(T; k_m(T)) = y^*(T) = E[y^*(T; k_m(T))] \frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} \frac{k'}{E[k']} \frac{C^{*h}}{E[C^{*h}]} \:\:;\:\:\: k' = k_m(T)^{-\kappa_m} k \\ -->
<!-- = v \frac{k_m(T)^{\kappa_m}}{E[k_m(T)^{\kappa_m}]} k' C^{*h} \:\:;\:\:\: v = \frac{E[y^*(T)]}{E[k'] E[C^{*h}]} -->
<!-- $$ -->

Where $\epsilon$ is the regression residual. Recall from the exposition in section \ref{sec:axioms1and2} that the regression constant $\ln(v)$ captures the (logged) expenditure TFP, and is related to the (logged) TFP $\ln(g)$ as follows.

\begin{equation}
\ln(v) = \ln(a) + \ln(g) \:\:;\:\:\: \ln(a) &= \sum_i^{n_x} \ln \left( \frac{\alpha_i}{w_i} \right)^{\alpha_i} - \ln(h)
\end{equation}

Where TFP may include binary endowment variables that augment the constant on farms where the endowment is present (Equation \ref{eq:g0Sum}, replicated here for convenience).

$$
\ln(g) = \beta_0 + \sum_{i = 1}^{n_b} \beta_i b_i \:\:;\:\:\: n_b = 4
$$
<!-- \begin{equation} -->
<!-- \ln(g) = \alpha_0 = \beta_0 + \sum_{i = 1}^{n_b} b_i \beta_i -->
<!-- \label{eq:g0Sum} -->
<!-- \end{equation} -->

As mentioned in section \ref{sec:axioms1and2}, in this exercise there are four binary endowment variables $b_i$ (which take a value of $1$ if the endowment is present and $0$ otherwise) are: use of oxen in land preparation, use of tractor in land preparation, use of hybrid seed, and land tenure. There are 12 unique combinations of these four endowments in the data. The control variables ($k_i$) are planting density (seed kg/acre), adult equivalent household size, farm size, and rainfall. The rainfall variable is 2007 main season rainfall divided by an historical benchmark, and so can be interpreted as the rainfall anomaly or departure from the historical benchmark. The farm expenditure $C^*$ includes the cost of synthetic fertilizer, land preparation, pest and disease control chemicals, and seed. The OLS regression results are presented in Table 2.

\pagebreak

\singlespacing
```{r, echo = FALSE}

thisFile <- "df_mod2007.csv"
thisFilepath <- paste0(mainFolder, thisFile)
df_mod <- read.csv(thisFilepath, stringsAsFactors = F)
colnames(df_mod) <- df_mod[nrow(df_mod), ]
df_mod <- df_mod[-nrow(df_mod), ]
df_mod[, -1] <- as.data.frame(apply(df_mod[, -1], 2, as.numeric))
colnames(df_mod)[which(colnames(df_mod) == "Cstar")] <- "Cost/acre (KES/acre)"
df_mod <- df_mod %>% rename(`Child family labor, planting (person-hrs/acre)` = `planting fam lab child (pers-hrs/acre)`,
                            `Maize (KES/kg)` = P,
                            `DAP fert (kg/acre)` = `dap (kg/acre)`,
                            `DAP fert (KES/kg)` = `dap (KES/kg)`,
                            `DAP fert (KES/acre)` = `dap (KES/acre)`,
                            `Adult equivalent household size` = aehh07,
                            `Farm size (acres)` = acres)
colnames(df_mod) <- str_replace(colnames(df_mod), "^\\w{1}", toupper)
colnames(df_mod) <- gsub("\\(KES/kg\\)", "price (KES/kg)", colnames(df_mod))
#=======================================================================
input_vars <- c(#"Total fam lab child (pers-hrs/acre)",
  #"Total fam lab (pers-hrs/acre)",
  #"Total fam lab adult (pers-hrs/acre)",
  #"Total wage labor (pers-hrs/acre)",
  #"1st weeding fam lab child (pers-hrs/acre)",
  #"2nd weeding fam lab fem (pers-hrs/acre)",
  #"2nd weeding fam lab adult (pers-hrs/acre)",
  #"1st weeding fam lab fem (pers-hrs/acre)",
  #"1st weeding fam lab adult (pers-hrs/acre)",
  #"1st weeding fam lab male (pers-hrs/acre)", *
  #"1st weeding wage labor (pers-hrs/acre)",
  #"2nd weeding wage labor (pers-hrs/acre)",
  # "1st ploughing fam lab child (pers-hrs/acre)",
  #"1st ploughing fam lab adult (pers-hrs/acre)",
  # "1st ploughing fam lab fem (pers-hrs/acre)",
  #"1st ploughing fam lab male (pers-hrs/acre)",
  #"1st ploughing wage labor (pers-hrs/acre)",
  #"shelling fam lab adult (pers-hrs/acre)",
  #"shelling fam lab fem (pers-hrs/acre)",
  #"shelling fam lab male (pers-hrs/acre)",
  #"shelling fam lab child (pers-hrs/acre)",
  # "shelling wage labor (pers-hrs/acre)",
  #"harvesting fam lab male (pers-hrs/acre)", #**
  #"harvesting fam lab adult (pers-hrs/acre)", *
  #"harvesting fam lab fem (pers-hrs/acre)",
  #"harvesting fam lab child (pers-hrs/acre)",
  #"harvesting wage labor (pers-hrs/acre)",
  #  "planting fam lab adult (pers-hrs/acre)",
  # "planting fam lab fem (pers-hrs/acre)",
  #"planting fam lab male (pers-hrs/acre)",
  "Child family labor, planting (person-hrs/acre)",
  #"planting wage labor (pers-hrs/acre)",
  #"Total synth. fert. (kg/acre)",
  "Seed (kg/acre)",
  "Total CAN fert (kg/acre)",      
  "Total NPK fert (kg/acre)",  
  "Total UREA fert (kg/acre)",
  "DAP fert (kg/acre)",
  #"UREA (46:0:0) (kg/acre)",
  #"CAN (26:0:0) (kg/acre)",
  # "NPK (23:23:23) (kg/acre)",
  # "NPK (23:23:0) (kg/acre)",
  #"NPK (17:17:0) (kg/acre)",
  #"manure (kg/acre)",
  #"compost (kg/acre)",
  #"mavuno-basal (kg/acre)",
  #"foliar feed (kg/acre)",
  # "Fungicide qty (kg/acre)",
  # "Herbicide qty (kg/acre)",
  # "Insecticide qty (kg/acre)",
  # "Pesticide qty (kg/acre)"
  "Total P&D chem (kg/acre)"
)
demog_vars <- c(#"age",
  "Adult equivalent household size"#,
  #"hhsize07"
  # "km to organic fert mkt",
  #"km to synth fert mkt",
  #"km to pest/plague chem mkt"
)
clim_vars <- c("Rain anomaly"#,
               #"qwetpre",
               #"main07",
               # "qwetxt",
               # "qwetit"
)
bin_vars <- c("Adopter", #"gend",
              #"irrigated",
              # "tenure: govt/communal/cooperative",
              # "tenure: owned by parent/relative", 
              "Tenure: owned with title deed",
              # "tenure: owned without title deed",
              # "tenure: rented",
              # "landprep: manual",
              # "landprep: none",
              "Landprep: oxen",
              "Landprep: tractor")
#-----------------------------------------------------------------------
costVars <- c("Cost/acre (KES/acre)", #"seed (KES/acre)",
              "DAP fert (KES/acre)",
              #"UREA (46:0:0) (KES/acre)",
              "Total CAN fert (KES/acre)",
              #"CAN (26:0:0) (KES/acre)",
              "Total NPK fert (KES/acre)",
              #"NPK (23:23:23) (KES/acre)",
              #"NPK (23:23:0) (KES/acre)",
              "Total UREA fert (KES/acre)",
              #"manure (KES/acre)",
              "Total P&D chem (KES/acre)"
)
priceVars <- gsub("\\(KES/acre\\)", "price (KES/kg)", costVars[-1])
#priceVars <- c(priceVars, "harvesting (KES/hour)")
priceVars <- priceVars[-which(priceVars == "Total UREA fert price (KES/kg)")]
#-----------------------------------------------------------------------
# # Remove farms not using any inputs (as these farms then have h=0)
# indh0 <- which(rowSums(df_mod[, setdiff(input_vars, c("planting fam lab child (pers-hrs/acre)", "seed (kg/acre)"))]) == 0)
# #length(indh0)
# df_mod <- df_mod[-indh0, ]
#-----------------------------------------------------------------------
mod1Vars <- c("Dist", "Yield (kg/acre)", "Farm size (acres)",
              input_vars, bin_vars, demog_vars, clim_vars,
              costVars, priceVars, "Maize price (KES/kg)")
df_mod1 <- df_mod[, mod1Vars]
not_these <- which(colnames(df_mod1) %in% c("Dist", costVars, priceVars, "Maize price (KES/kg)"))
# df_mod1 <- df_mod1 %>% rename(`Adult equivalent household size` = aehh07,
#                               `DAP (kg/acre)` = `dap (kg/acre)`)
mod1 <- lm(`Yield (kg/acre)`~., df_mod1[, -not_these])
#summ(mod1)
#summary(mod1)
#sum(mod1$residuals^2)
#plot(mod1$fitted.values, mod1$residuals)
#car::vif(mod1)
#View(df_mod1[which(mod1$residuals < -2), ])
library(jtools)
#summ(mod1)
coefsNeg <- mod1$coefficients[which(mod1$coefficients < 0)]
coefsNegNames <- gsub("`", "", names(coefsNeg))
inputsNegCoef <- coefsNegNames[which(coefsNegNames %in% input_vars)]
inputsPosCoef <- setdiff(input_vars, inputsNegCoef)
#-----------------------------------------------------------------------
mod2Vars <- c("Dist", "Yield (kg/acre)", "Cost/acre (KES/acre)", "Farm size (acres)", "Seed (kg/acre)", inputsNegCoef, bin_vars, demog_vars, clim_vars, priceVars)
df_mod2 <- df_mod[, c(mod2Vars, "Maize price (KES/kg)")]
#-----------------------------------------------------------------------
# Get cStar and area before transforming
cStar <- exp(df_mod2$`Cost/acre (KES/acre)`)
muCstarSamp <- mean(cStar)
lAcres <- df_mod2$`Farm size (acres)`
mArea <- mean(lAcres)
sArea <- sd(lAcres)
muArea <- exp(mArea + sArea^2 / 2)
#---------------------------------------------------------------------
theseCols <- c("Cost/acre (KES/acre)", "Farm size (acres)", "Seed (kg/acre)", demog_vars)
thisFun <- function(x){out <- x - log(mean(exp(x))); return(out)}
df_mod2[, theseCols] <- as.data.frame(apply(df_mod2[, theseCols], 2, thisFun))
df_mod2[, priceVars] <- log(df_mod2[, priceVars])
for(i in 1:length(priceVars)){
  u <- df_mod2[, priceVars[i]]
  df_mod2[which(is.infinite(u)), priceVars[i]] <- 0
  if(length(which(is.na(u)) > 0)){
      df_mod2[which(is.na(u)), priceVars[i]] <- 0
  }
}
not_these <- which(colnames(df_mod2) %in% c("Maize price (KES/kg)", "Dist", costVars[-1]))
# naFn <- function(x){return(sum(is.na(x)))}
# NaNfn <- function(x){return(sum(is.nan(x)))}
# nNA <- apply(df_mod2, 2, naFn)
# nNaN <- apply(df_mod2, 2, NaNfn)
mod2 <- lm(`Yield (kg/acre)`~., df_mod2[, -not_these])
#summ(mod2)
#summary(mod2)
# sum(mod2$residuals^2)
# plot(mod2$fitted.values, mod2$residuals)
#car::vif(mod2)
# View(df_mod2[which(mod2$residuals < -1.5), ])
# indOutlier <- which(mod2$residuals < -2)
# df_mod2[indOutlier, c("Dist", "Yield (kg/acre)", "Farm size (acres)")]
# df_mod2 <- df_mod2[-indOutlier, ]
#---------------------------------------------------------------------
# mod 3
mod3Vars <- setdiff(mod2Vars, c(priceVars, "Child family labor, planting (person-hrs/acre)"))
dfMod3 <- df_mod[, mod3Vars]
colnames(dfMod3) <- gsub("Adopter", "Hybrid seed", colnames(dfMod3))
colnames(dfMod3) <- gsub("Seed \\(kg/acre\\)", "Planting density (kg seed/acre)", colnames(dfMod3))
indDum <- which(colnames(dfMod3) %in% c("Tenure: owned with title deed", "Landprep: tractor", "Landprep: oxen", "Hybrid seed"))
notThese <- c(1, indDum)
colnames(dfMod3)[-notThese] <- paste0("ln[", colnames(dfMod3)[-notThese], "]")
colnames(dfMod3) <- gsub(":", " -", colnames(dfMod3))
coefOrder <- c(colnames(dfMod3)[-c(2, notThese)], colnames(dfMod3)[notThese[-1]])
# Drop cost outliers
#hist((dfMod3$`ln[Cost/acre (KES/acre)]`), 20)
indHiCost <- which(exp(df_mod$`Cost/acre (KES/acre)`) > 40000)
indOxTractr <- which((dfMod3$`Landprep - oxen` + dfMod3$`Landprep - tractor`) == 2)
indRm <- unique(c(indHiCost, indOxTractr))
dfMod3 <- dfMod3[-indRm, ]
mod3 <- lm(`ln[Yield (kg/acre)]` ~., dfMod3[, -1])
#summ(mod3)
#car::vif(mod3)

# summary(mod3) %>% xtable() %>%
# kable()

#coefOrder <- gsub("`", "", unique(c(varsOve1a, varsOve1b, varsOve2a, varsOve2b, varsOve3)))
ft <- modelsummary(mod3, output = "flextable", statistic = "{std.error} ({p.value})",
             estimate = "{estimate}{stars}",
             gof_map = c("nobs", "r.squared", "adj.r.squared"),
             coef_map = coefOrder)
#output = "markdown"
#output = "kableExtra"
#ouput="flextable"
ft %>% autofit() %>% set_caption("2007 Kenya farm yield regression results") %>%
  fontsize(size = 9) %>% delete_part(part = "header") %>%
  add_header_row(values = "Dependent variable: ln[yield (kg/acre)]",
  colwidths = c(2))

h <- mod3$coefficients[2]; eta <- h / (1 - h)
hReport <- round(h, 2)
etaReport <- round(eta, 2)

rm(df_mod1, df_mod2, df_hist, df_ky, df_raw, df_sa, df_ts, df_us, dfRaw)
rm(mod1, mod2, listDf)

```
\doublespacing

The fitted coefficient on logged cost per acre is statistically significant and indicates that the population yield degree of homogeneity is $h =$ `r hReport`, by which it follows immediately that the price elasticity of farm supply is $\eta = h / (1 - h) =$ `r etaReport`. The coefficients on the other regressors are also statistically significant and take values and signs that agree with intuition. Note that the coefficient on the farm size regressor is negative, affirming the inverse relation between farm size and yield found in numerous other studies [@muyanga2019revisiting; @larson2014should; @wassie2019revisiting; @gautam2019too; @kimhi2006plot].

The fitted binary endowment coefficients ($\beta_i$) indicate that hybrid maize seed is the most significant contributor to TFP, followed by land prep method and tenure. Interestingly, oxen contributes slightly more than tractor. Based on these values, the expenditure TFPs are calculated for each of the 12 binary endowment strata ($v_{\ell}$), as well as the average across all strata ($v$). The implicit mean expected yield ($E[\tilde{y}^*(T;k_r) | \theta] |_{t = 0}$) is then calculated by Equation \ref{eq:impMuEyStarT0cond}, for $\tilde{k}_r^{\kappa_r} = 1$ (indicating rainfall expectation in line with the historical benchmark). These stratified and whole sample parameters are reported along with the mean observed cost per unit area and harvest yield in Table 2.

comment on higher yield of tractor but higher efficiency of oxen
harvest was higher than expected, implicit expected yield based on kr=1 when in fact kr > 1 (graphic)-- expected less got more hence harvest yield higher than implicit expected yield at $\tilde{k}_r^{\kappa_r}=1$.

```{r Fig3, fig.show = "hold", fig.width = 6, fig.height=3, fig.align="center", fig.cap="\\label{fig:v0strata}(Left) The expenditure TFP, conditional (observed) mean cost/area, harvest yield, and implicit expected yield for each of the 12 different combinations of binary endowments present in the Kenya farm data. The implicit expected yield assumes rainfall equal to the historical benchmark. (Right) their respective prevalance in the population.", echo = FALSE}
#=============================================================================
# Define constant in terms of convenient known reference value y0, in this case sample mean yield.
# Sample mean yield varies with binary controls. Here is the mean with just the base constant
# (i.e. all binaries = 0)
coefVec <- mod3$coefficients; coefNames <- gsub("`", "", names(coefVec))
#-----------------------------------------------------------------------------
# Get muK
# HAVE TO FACTOR OUT KRAIN BECAUSE IT IS AN EX POST VARIABLE!!!!
# IMPORTANT TO NOTE IN TEXT THAT EXOG CONTROL VARS ARE FROM POV OF PLANTING TIME
# --> A crude way of calculating expected yield is by evaluating ex-post yield
# at kRain = 1, i.e. expecting rainfall to follow past pattern.
kappaRn <- coefVec[which(coefNames == "ln[Rain anomaly]")]
kRn <- exp(dfMod3$`ln[Rain anomaly]`)
# EyStarT0 <- exp(dfMod3$`Yield (kg/acre)`) * kRn^(-kappaRn)
EyStarT0trunc <- exp(mod3$fitted.values) * kRn^(-kappaRn)
notThese <- c("Dist", "ln[Yield (kg/acre)]", "ln[Cost/acre (KES/acre)]", bin_vars, "ln[Rain anomaly]") 
lnMod3Vars <- coefOrder
kPrimeVars <- setdiff(lnMod3Vars, notThese)
#kVars <- kVars[-grep("Tenure|Landprep", kVars)]
kappaPrimeVec <- coefVec[which(coefNames %in% kPrimeVars)]
matKprime <- dfMod3[, kPrimeVars] %>% as.matrix()
kPrimeLook <- matKprime %*% rep(1, ncol(matKprime))
lkPrimeVec <- matKprime %*% kappaPrimeVec
mKprimeVec <- matKprime %*% diag(kappaPrimeVec) %>% colMeans()
sKprimeVec <- matKprime %*% diag(kappaPrimeVec) %>% apply(2, sd)
mKprime <- sum(mKprimeVec)
sKprime <- sqrt(sum(sKprimeVec^2))
muKprime <- exp(mKprime + sKprime^2 / 2)
#-----------------------------------------------------------------------------
beta0plusAlphaWhterm <- coefVec[1]
v0base <- exp(beta0plusAlphaWhterm)
#y0base <- v0base * muThetaKnh * muEcSharpT0n
#muEcStarT0hBase <- muEyStarT0 / (muThetaK * v0base)
#---
# Now calculate mean yield for all binary combinations
# Adjust for exogenous endowments/constraints
bin_vars <- gsub(":", " -", bin_vars)
bin_vars <- gsub("Adopter", "Hybrid seed", bin_vars)
kappaBins <- coefVec[which(coefNames %in% bin_vars)]
names(kappaBins) <- gsub("`", "", names(kappaBins))
dfBins <- dfMod3[, bin_vars]
beta0adj <- beta0plusAlphaWhterm + as.matrix(dfBins) %*% kappaBins
vStrat <- exp(beta0adj)
nStrat <- unique(vStrat) %>% length()
dfx <- dfBins
dfx$vStrat <- c(vStrat)
dfx$lcStar <- dfMod3$`ln[Cost/acre (KES/acre)]`
dfx$ydHarv <- exp(dfMod3$`ln[Yield (kg/acre)]`)
dfx$kPrime <- exp(lkPrimeVec)
#--------------------------------------------------------------------------
# Create label vec for each of the 12 endowment combos
dfBins$`Hybrid seed` <- ifelse(dfBins$`Hybrid seed` == 1, "Hybrid", "0")
dfBins$`Tenure - owned with title deed` <- ifelse(dfBins$`Tenure - owned with title deed` == 1, "Tenure", "0")
dfBins$`Landprep - oxen` <- ifelse(dfBins$`Landprep - oxen` == 1, "Oxen", "0")
dfBins$`Landprep - tractor` <- ifelse(dfBins$`Landprep - tractor` == 1, "Tractor", "0")
endowVec <- apply(dfBins, 1, paste, collapse = " + ")
endowVec <- gsub("0 \\+|\\+ 0", "", endowVec)
endowVec <- gsub("   0", "Base", endowVec)
endowVec[which(endowVec != "Base")] <- paste("Base +", endowVec[which(endowVec != "Base")])
endowVec <- gsub("  ", " ", endowVec)
endowVec <- trimws(endowVec)
endowVec <- gsub("  ", " ", endowVec)
#unique(endowVec)
#--------------------------------------------------------------------------
dfx$Type <- endowVec
dfStrat <- dfx %>% group_by(Type) %>% summarise(Type = unique(Type),
                                                vStrat = unique(vStrat),
                                                mCstar = mean(lcStar),
                                                 sCstar = sd(lcStar),
                                                 muYdHarv = mean(ydHarv),
                                                 muKprimeStrat = mean(kPrime)) %>%
  mutate(muCstarTruncStrat = exp(mCstar + sCstar^2 / 2)) %>%
  mutate(muCstarHtruncStrat = exp(h * mCstar + h^2 * sCstar^2 / 2)) %>%
  mutate(muEyStarT0truncStrat = vStrat * muKprime * muCstarHtruncStrat) %>%
  mutate(mEcSharpT0truncStrat = (1 - h) * mCstar - mKprime - log(vStrat),
         sEcSharpT0truncStrat = sqrt((1 - h)^2 * sCstar^2 - sKprime^2)) %>%
  mutate(muEcSharpT0truncStrat = exp(mEcSharpT0truncStrat + sEcSharpT0truncStrat^2 / 2)) %>%
  arrange(vStrat) %>% relocate(Type) %>%
  mutate(stratID = as.character(1:nStrat))
dfAll <- dfx %>% summarise(v = mean(vStrat),
                              mCstar = mean(lcStar),
                              sCstar = sd(lcStar),
                              muYdHarv = mean(ydHarv),
                              muKprime = mean(kPrime)) %>%
  mutate(muCstarTrunc = exp(mCstar + sCstar^2 / 2),
         muCstarHtrunc = exp(h * mCstar + h^2 * sCstar^2 / 2)) %>%
  mutate(muEyStarT0trunc = mean(vStrat) * muKprime * muCstarHtrunc) %>%
  mutate(mEcSharpT0trunc = (1 - h) * mCstar - mKprime - log(v),
         sEcSharpT0trunc = sqrt((1 - h)^2 * sCstar^2 - sKprime^2)) %>%
  mutate(muEcSharpT0trunc = exp(mEcSharpT0 + sEcSharpT0^2 / 2)) %>%
  mutate(stratID = "All",
         Type = "Sample") %>% relocate(Type)
# REMEMBER: kRain removed from muK (equivalent to setting kRain = 1), so muEyStarT0truncStrat
# is the conditional mean expected yield assuming rain will be in line with historical
# benchmark
dfStratTab <- dfStrat %>% select(Type, vStrat, muCstarTruncStrat,
                                 muEcSharpT0truncStrat, muYdHarv, muEyStarT0truncStrat)
tabHeaders <- c("Expenditure\nTFP",
                "Mean observed\nexpenditure/area\n(KES/acre)",
                "Mean implicit\nexpected unit\nexpend. (KES/kg)",
                "Mean observed\nharvest yield\n(kg/acre)",
                "Mean implicit\nexpected yield\n(kg/acre)")
colnames(dfStratTab)[-1] <- tabHeaders
dfAllTab <- dfAll %>% select(Type, v, muCstarTrunc, muEcSharpT0trunc,
                             muYdHarv, muEyStarT0trunc)
colnames(dfAllTab)[-1] <- tabHeaders
#==========================================================================
# Graphic of prevalence of each endowment combo and its value
cellText_size <- 2.5
dfStratPct <- data.frame(Type = endowVec, vStrat = round(vStrat, 1)) %>%
  mutate(xx = 1) %>% group_by(Type) %>%
  summarise(`Number of farms` = sum(xx, na.rm = T), vStrat = unique(vStrat)) %>%
  as.data.frame() %>%
  mutate(`Pct of farms in sample` = `Number of farms` / sum(`Number of farms`) * 100) %>%
  arrange(vStrat) %>% mutate(Type = factor(Type, Type))
stratFrac <- dfStratPct$`Pct of farms in sample` / 100
#muVcheck <- sum(dfStratPct$vStrat * stratFrac) - mean(vStrat)
#-----------------------------------------------------------------------------
# popRow <- data.frame(Type = "Population mean", `Number of Farms` = length(v0),
#                      v0 = round(muV0, 1), NA)
# colnames(popRow) <- colnames(dfStrat)
#dfStrat <- dfStrat %>% rbind(popRow)
#dfStrat <- dfStrat %>% mutate(Type = factor(Type, Type))
#-----------------------------------------------------------------------------
typeVec <- dfStratTab$Type
dfTab <- dfStratTab %>% gather_("var", "val", tabHeaders) %>% mutate(val = round(val, 1))
gg <- ggplot(dfTab, aes(x = var, y = Type, fill = val, label = val))
gg <- gg + scale_y_discrete(limits = typeVec)
gg <- gg + geom_tile(alpha = 0)
gg <- gg + scale_x_discrete(limits = tabHeaders, position = "top")
# scale_x_discrete(labels = c("A", "B", bquote("TFP " ~ v[0]), "D"))
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text.x = element_text(size = axisTextSize),
                 axis.ticks.x = element_blank(),
                 axis.text.y = element_text(size = axisTextSize),
                 panel.grid = element_blank(),
                 plot.title = element_text(size = axisTitleSize, hjust = 0.5),
                 legend.position = "none")
gg <- gg + geom_text(size = cellText_size)
ggEndow1 <- gg
#---
gg <- ggplot(dfStratPct, aes(x = `Pct of farms in sample`, y = Type))
#gg <- gg + scale_y_discrete(limits = typeVec)
gg <- gg + geom_col()
gg <- gg + labs(title = "Pct of farms in sample")
gg <- gg + scale_x_continuous(position = "top")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 #axis.title.x = element_text(size = axisTitleSize),
                 axis.text.y = element_blank(),
                 axis.text.x = element_text(size = axisTextSize),
                 #panel.grid = element_blank(),
                 plot.title = element_text(size = axisTextSize, hjust = 0.5))
ggEndow2 <- gg
#ggEndow1 + ggEndow2

#colnames(dfPlot1)
# dfPopRow <- data.frame(Type = "Population mean",
#                        var = c("TFP (v0)", "Mean cost/area\n(KES/acre)",
#                                "Mean yield\n(kg/acre)"),
#                        val = c(round(muV0, 1), round(muCstar, 1), round(muYstarT, 1)))
dfAllTab <- dfAllTab %>% gather_("var", "val", tabHeaders) %>% mutate(val = round(val, 1))
gg <- ggplot(dfAllTab, aes(x = var, y = Type, fill = val, label = val))
#gg <- gg + scale_y_discrete(limits = typeVec)
gg <- gg + geom_tile(alpha = 0)
#gg <- gg + labs(title = expression(v[0]))
gg <- gg + scale_x_discrete(limits = tabHeaders)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text.x = element_blank(),
                 axis.ticks.x = element_blank(),
                 axis.text.y = element_text(size = axisTextSize),
                 panel.grid = element_blank(),
                 plot.title = element_text(size = axisTitleSize, hjust = 0.5),
                 legend.position = "none")
gg <- gg + geom_text(size = cellText_size)
ggEndowPop <- gg

dfBlank <- data.frame(Type = NA,
                       var = c(NA, NA, NA),
                       val = c(NA, NA, NA))
gg <- ggplot(dfBlank, aes(x = var, y = Type, fill = val, label = val))
gg <- gg + geom_tile(alpha = 0)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text = element_blank(),
                 axis.ticks = element_blank(),
                 panel.grid = element_blank(),
                 panel.border = element_blank(),
                 legend.position = "none")
ggBlank <- gg


((ggEndow1 / ggEndowPop + plot_layout(heights = c(1, 1 / 12))) | (ggEndow2 / ggBlank + plot_layout(heights = c(1, 1 / 12)))) + plot_layout(widths = c(1, 1 / 4))


```

To evaluate the expected unconditional mean yield term ($E[\tilde{y}^*(T)]|_{t = 0}$) and parameters $m_{\#}$, $s_{\#}$ appearing in the expected aggregate supply expression (Equation \ref{eq:aggSup2}), first the conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ are calculated from the fitted values $v$ and $h$, and the sample parameters $\bar{m}_c$, $\bar{s}_c$, $m_k$, and $s_k$, as explained in section \ref{sec:evalInPract}. The expected price at planting time ($E[P(T)]|_{t = 0}$) for the year of the data is also required.
<!-- by Equation \ref{eq:mCshrpsCshrp} -->
<!-- as explained in \ref{sec:farmResp} -->
<!-- as explained in \ref{sec:adopt} -->

The Kenya farm data includes the harvest output price as observed at harvest $P(T)$, but not $E[P(T)]|_{t = 0}$. Recall from Equation \ref{eq:EPT0} that calculation of $E[P(T)]|_{t = 0}$ requires the maize price at planting $P(0)$, the drift parameter $m_p$, and the time from planting to harvest $T$. In the present exercise, this information is taken from the World Food Program main season monthly price series plotted in Figure \ref{fig:mzP} [@WFPpriceData]. Given the monthly time step of the data, the time horizon from planting in March to the August-September harvest is $T = 6$. The price at planting $P(0)$ is averaged over the main maize markets. The drift parameter $m_p$ is then calculated as the mean log change from one month to another in all markets. Missing values are omitted from these calculations.

When calculating $m_p$, it is important to take note of price dynamics peculiar to the market in question. In Kenya, the short rains maize crop is harvested about a month before the main season crop is planted. If the short rains harvest is good, then the maize price tends to remain flat during the main season or decrease a little. If the short rains harvest is poor, then the price tends to trend upwards during the main season and to be a little more volatile. This is reflected in Figure \ref{fig:mzP}, where the price series in 2008, 2009, 2011, and 2012 are upward trending. It is known that the main season followed a poor short rains harvest in these years. In the other years, the price series are flat because the short rains harvest was normal. To accommodate this dichotomy, $m_P$ is calculated separately for bad short rain years and good short rain years. For years beginning with a bad short rains harvest, the expected price is calculated using the "bad short rains" $m_p$, while expected price in years beginning with a good short rains harvest is calculated using the "good short rains" $m_p$.
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[E[C^{\#}(T)]|_{t = 0}| \theta] &= E \left[ \frac{C^*}{E[y^*(T; k_m(T))]|_{t = 0}}  \right] \\ -->
<!-- &= \fracE[C^*] -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- E[\tilde{y}^*(T)|{\theta}]|_{t = 0} -->
<!-- As explained in \ref{sec:aggSupDeterm}, axiom 3 truncates the observed distribution of optimal expected unit cost at the expected output price. The conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ are calculated from this observed, truncated distribution; and then  -->
<!-- When taking account of stochasticity, the unconditional mean $E[y^*]$ in the deterministic aggregate supply expression (Equation \ref{eq:aggSup1}) is replaced with the stochastic expectation of the unconditional mean yield $E[\tilde{y}^*(T)]|_{t = 0}$. For purposes of parameterization, this can be calculated from the known value $E[k_m(T)^{\kappa_m}]$, the expectation $E[\widetilde{k_r(T)^{\kappa_r}}]|_{t = 0}$, and the unconditional mean at harvest. -->
<!-- Where the unconditional mean yield $E[y^*(T)]$ is calculated from the conditional mean as explained in the previous section. -->
<!-- Farmers base expectations of harvest price on most recent price movement, adaptive expectation [@onono2013response].  -->
<!-- GoK KFSSG 2011 long rains assessment - 85% of the national output is main season -->
<!-- Nf: GoK KFSSG 2011 long rains assessment notes that 1.8 million hectares (4.45 million acres) are put to maize. Then have to consider harvested area will be less than planted area. mean farm size of about 2 acres -> Nf = 2 million -->
<!-- 2006 12 Jun - Good rain [GIEWS]. -->
<!-- 2007 15 May assessment - long rains were delayed and short rains harvest delayed due to unseasonal extension of short rains into February. This initially led to reduced main season planting, but then good rains came and planting increased. [GIEWS/MoA 2007]. -->
<!-- 2008 15 July assessment - after a poor mar-may main rains season and post election violence the Ministry of Agriculture estimated that the main season harvest would be 2.16 million MT (GIEWS/MoA 2008 brief). also input prices were higher. -->
<!-- 100,000 ha not planted due to post election violence, west received normal rainfall but rest of main maize growing area received 20-80% of normal. (USDA FAS Commod Intel Report https://ipad.fas.usda.gov/highlights/2008/09/kenya/) -->
<!-- 2009 Aug - Severe drought and crop failure [MoA assessment cited in USDA FAS Commodity Intelligence Kenya maize Report, 1 Dec 2009 -->
<!-- https://ipad.fas.usda.gov/highlights/2009/12/kenya/#:~:text=In%20August%202009%2C%20Kenya's%20MoA,reduced%20crop%20prospects%20in%20October.] -->
<!-- 2010 5 Aug - Good rain, started 2 weeks early. 2.6. Farmers planted more due to the attractive prices seen in 2009. About 200,000 small farmers received seeds and fertilizer through the National Accelerated Agricultural Input Access Program. Some crop loss due to flooding. -->
<!-- 2011 3 Nov GIEWS - 2.25 less rain -->
<!-- 2011 GoK KFSSG 2.34 dismal rains -->
<!-- 2012 16 Jul - rains 2-4 weeks late, erratic, crop failure in some parts. About 1.4% of planted area was affected by lethal maize necrosis -->
<!-- Price controls came into play during the 2009-2012 crisis -->
<!-- Gov gave fert to some farmers -->

\singlespacing
```{r Fig2, fig.show = "hold", fig.width = 5, fig.height=3, fig.align="center", fig.cap="\\label{fig:mzP}Maize monthly price series during main season (March-August) at primary markets in Kenya. Price data are from the World Food Program (WFP 2025).", echo = FALSE}
#======================================================================
# Get mean price jump from county level monthly price data
# (downloaded from WFP https://data.humdata.org/organization/wfp?vocab_Topics=prices)
mktVec <- c("Eldoret", "Nakuru", "Nairobi", "Mombassa", "Nyanza")
fileVec <- paste("Maize price", mktVec, "WFP.csv")
listDf <- list()
for(i in 1:length(fileVec)){
  thisFile <- fileVec[i]
  thisFilePath <- paste0(mainFolder, priceFolder, thisFile)
  dfRaw <- read.csv(thisFilePath, stringsAsFactors = F)
  dfRaw$Date <- row.names(dfRaw); dfRaw <- dfRaw[-1, ]; colnames(dfRaw)[1] <- "Price"
  dfRaw$Price <- round(as.numeric(dfRaw$Price), 2)
  dfRaw$Mkt <- mktVec[i]
  dfRaw$Date <- my(dfRaw$Date)
  dfRaw$`Log change` <- c(NA, diff(log(dfRaw$Price)))
  listDf[[i]] <- dfRaw
}
df <- do.call(rbind, listDf) %>% as.data.frame() %>% group_by(Mkt) %>%
  complete(Date = seq.Date(from = min(Date),
                           to = max(Date), by = "month")) %>%
  mutate(year = year(Date), month = month(Date))
dfPlot <- df %>% subset(year <= 2012 & month %in% c(2:9))
#-------------------------------------------------------------------------------------
# Define function to accommodate legend in price series plot
shift_legend2 <- function(p) {
  # ...
  # to grob
  gp <- ggplotGrob(p)
  facet.panels <- grep("^panel", gp[["layout"]][["name"]])
  empty.facet.panels <- sapply(facet.panels, function(i) "zeroGrob" %in% class(gp[["grobs"]][[i]]))
  empty.facet.panels <- facet.panels[empty.facet.panels]
  
  # establish name of empty panels
  empty.facet.panels <- gp[["layout"]][empty.facet.panels, ]
  names <- empty.facet.panels$name
  # example of names:
  #[1] "panel-3-2" "panel-3-3"
  
  # now we just need a simple call to reposition the legend
  #lemon::reposition_legend(p, 'center', panel=names)
  p_out <- lemon::reposition_legend(p, 'center', panel=names)
  #class(lemon::reposition_legend(p, 'center', panel=names))
  return(p_out)
}
#------------------------------------------------------------------------------------
# Plot the price series
theseColors <- distinctColorPalette(length(mktVec))
gg <- ggplot(dfPlot, aes(x = factor(month.abb[month], levels = month.abb), y = Price, group = Mkt, color = Mkt))
gg <- gg + geom_line(lwd = 0.75)
gg <- gg + facet_wrap(~year, nrow = 2)
gg <- gg + labs(x = "Maize price (KES / kg.)", color = "Market")
gg <- gg + scale_color_manual(values = theseColors)
gg <- gg + theme_bw()
#gg <- gg + guides(color = guide_legend(byrow = TRUE))
gg <- gg + theme(axis.title = element_blank(),
                 axis.text = element_text(size = axisTextSize),
                 strip.background = element_rect(fill = "white"),
                 strip.text = element_text(size = facetTitleSize),
                 plot.title = element_text(size = titleSize),
#                 legend.spacing.y = unit(0.5, 'cm'),
                 legend.title = element_text(size = legendTextSize),
                 legend.text = element_text(size = legendTextSize))
#gg <- gg + guides(colour = guide_legend(title.position = "left"))
gg <- shift_legend2(gg)
gg <- ggplotify::as.ggplot(gg)
#---------------------------------------------------------------------------------
upYrs <- c(2008, 2009, 2011, 2012)
dfHistUp <- dfPlot %>% subset(year %in% upYrs)
# gg <- ggplot(dfHistUp, aes(x = `Log change`))
# gg <- gg + geom_histogram(color = 4, fill = "white", bins = 10)
# #gg <- gg + facet_wrap(~Mkt, scales = "free")
# gg <- gg + labs(title = "Log change")
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank(),
#                  axis.text = element_text(size = axisTextSize),
#                  #strip.background = element_rect(fill = "white"),
#                  strip.text = element_blank(),
#                  plot.title = element_text(size = titleSize))
dfHistDown <- dfPlot %>% subset(!(year %in% upYrs))
# gg <- ggplot(dfHistDown, aes(x = `Log change`))
# gg <- gg + geom_histogram(color = 4, fill = "white", bins = 10)
# #gg <- gg + facet_wrap(~Mkt, scales = "free")
# gg <- gg + labs(title = "Log change")
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank(),
#                  axis.text = element_text(size = axisTextSize),
#                  #strip.background = element_rect(fill = "white"),
#                  strip.text = element_blank(),
#                  plot.title = element_text(size = titleSize))
#-------------------------------------------------------------------------------------
#shapiro.test(df$`Log change`)
timeHoriz <- 6 #cropping season length in months (planting to harvest: March-August; planning to sale (?): February to September)
# sum(is.na(dfHistUp$`Log change`) == F) #sample size for up years
# sum(is.na(dfHistDown$`Log change`) == F) #sample size for down years
mPup <- mean(dfHistUp$`Log change`, na.rm = T)
sPup <- sd(dfHistUp$`Log change`, na.rm = T)
# mPup * timeHoriz
# sPup * sqrt(timeHoriz)
mPDown <- mean(dfHistDown$`Log change`, na.rm = T)
sPDown <- sd(dfHistDown$`Log change`, na.rm = T)
# mPDown * timeHoriz
# sPDown * sqrt(timeHoriz)
#upYrs <- c(upYrs, 2019)
#df <- df %>% subset(year <= 2019)
df <- dfPlot
df$yrType <- "down"; df$yrType[which(df$year %in% upYrs)] <- "up"
dfP0 <- df %>% subset(month %in% c("2", "3", "4")) %>%
  select(Mkt, Price, Date, month, yrType, year) %>%
  rename(monthT0 = month, dateT0 = Date, P0 = Price) %>%
  mutate(mktYr = paste(Mkt, year))
dfP0March <- dfP0 %>% subset(monthT0 == 3 & !is.na(P0)) %>%
  mutate(monthT0 = "March") %>% select(-dateT0)

indNoMarch <- which(!(dfP0$mktYr %in% dfP0March$mktYr))
dfP0notMarch <- dfP0[indNoMarch, ] %>% subset(!is.na(P0)) %>%
  group_by(Mkt, year, yrType) %>% summarise(P0 = mean(P0)) %>% mutate(monthT0 = "near March")
indUp <- which(dfP0notMarch$yrType == "up"); indDown <- which(dfP0notMarch$yrType == "down")
dfP0notMarch$EPT0 <- NA
dfP0notMarch$EPT0[indUp] <- dfP0notMarch$P0[indUp] * exp(mPup * timeHoriz)

indUp <- which(dfP0March$yrType == "up"); indDown <- which(dfP0March$yrType == "down")
dfP0March$EPT0[indUp] <- dfP0March$P0[indUp] * exp(mPup * timeHoriz)
dfP0March$EPT0[indDown] <- dfP0March$P0[indDown] * exp(mPDown * timeHoriz)
dfPT <- df %>% subset(month %in% c("8", "9", "10")) %>% select(Mkt, year, Price, month) %>%
  rename(monthtT = month, PT = Price)
dfPTaug <- dfPT
dfAnomP0March <- merge(dfP0March, dfPT)
dfAnomP0notMarch <- merge(dfP0notMarch, dfPT)
dfAnomP0March$Anom <- (dfAnomP0March$EPT0 - dfAnomP0March$PT) / dfAnomP0March$PT * 100
dfAnomP0notMarch$Anom <- (dfAnomP0notMarch$EPT0 - dfAnomP0notMarch$PT) / dfAnomP0notMarch$PT * 100
# hist(dfAnomP0March$Anom)
# hist(dfAnomP0notMarch$Anom)
EPT02006 <- mean(dfP0March$EPT0[which(dfP0March$year == 2006)])
EPT02007 <- mean(dfP0March$EPT0[which(dfP0March$year == 2007)])
EPT02008 <- mean(dfP0March$EPT0[which(dfP0March$year == 2008)])
EPT02009 <- mean(dfP0March$EPT0[which(dfP0March$year == 2009)])
EPT02010 <- mean(dfP0March$EPT0[which(dfP0March$year == 2010)])
EPT02011 <- mean(dfP0March$EPT0[which(dfP0March$year == 2011)])
EPT02012 <- mean(dfP0March$EPT0[which(dfP0March$year == 2012)])
# EPT02013 <- mean(dfP0March$EPT0[which(dfP0March$year == 2013)])
# EPT02014 <- mean(dfP0March$EPT0[which(dfP0March$year == 2014)])
# EPT02015 <- mean(dfP0March$EPT0[which(dfP0March$year == 2015)])
P02007 <- mean(dfP0March$P0[which(dfP0March$year == 2007)])
#=============================================================================
#=============================================================================
#=============================================================================
# Define root function to solve for population EcSharpT0
rootFnUp <- function(xIn, xUp, sXtrunc, mXtrunc){
  sX <- xIn[1]
  mX <- xIn[2]
  zUp <- (log(xUp) - mX) / sX
  invMillsRatio <- dnorm(zUp) / pnorm(zUp)
  slack_s <- sXtrunc^2 - sX^2 * (1 - zUp * invMillsRatio - invMillsRatio^2)
  slack_m <- mXtrunc - mX + sX * invMillsRatio
  outVec <- c(slack_s, slack_m)
  return(outVec)
}
#=============================================================================
# Unconditional params
#=============================================================================
# mCstarTrunc <- mean(dfMod3$`ln[Cost/acre (KES/acre)]`)
# sCstarTrunc <- sd(dfMod3$`ln[Cost/acre (KES/acre)]`)
# muCstarTrunc <- exp(mCstarTrunc + sCstarTrunc^2 / 2)
# mCstarTruncStrat <- mean(dfMod3$`ln[Cost/acre (KES/acre)]`)
# sCstarTrunc <- sd(dfMod3$`ln[Cost/acre (KES/acre)]`)
#--------------------------------------------------------------------------
# mEcSharpT0trunc <- (1 - h) * mCstarTrunc - mK - mean(beta0adj)
# sEcSharpT0trunc <- sqrt((1 - h)^2 * sCstarTrunc^2 - sK^2)
# muEcSharpT0Trunc <- exp(mEcSharpT0trunc + sEcSharpT0trunc^2 / 2)
# EyStarT0trunc <- kRn^-kappaRn * exp(mod3$fitted.values)
# cStarTrunc <- exp(dfMod3$`ln[Cost/acre (KES/acre)]`)
#xIn <- c(sEcSharpT0trunc, mEcSharpT0trunc)
xIn <- c(dfAll$sEcSharpT0, dfAll$mEcSharpT0)
sol <- nleqslv::nleqslv(xIn, rootFnUp, jac = NULL,
                        xUp = EPT02007,
                        sXtrunc = dfAll$sEcSharpT0,
                        mXtrunc = dfAll$mEcSharpT0)
#sol
sEcSharpT0 <- sol$x[1]
mEcSharpT0 <- sol$x[2]
muEcSharpT0 <- exp(mEcSharpT0 + sEcSharpT0^2 / 2)
muEcSharpT0n <- exp(eta * mEcSharpT0 + eta^2 * sEcSharpT0^2 / 2)
# Now can calculate unconditional cStar, muEyStarT0 parameters
# Keep in mind 
mCstar <- 1 / (1 - h) * (mean(beta0adj) + mKprime + mEcSharpT0)
sCstar <- 1 / (1 - h) * sqrt(sKprime^2 + sEcSharpT0^2)
muCstar <- exp(mCstar + sCstar^2 / 2)
muCstarh <- exp(h * mCstar + h^2 * sCstar^2 / 2)
muEyStarT0 <- mean(vStrat) * muKprime * muCstarh
# Stratified unconditional params
mCstarStrat <- 1 / (1 - h) * (log(dfStrat$vStrat) + mKprime + mEcSharpT0)
muCstarStrat <- exp(mCstarStrat + sCstar^2 / 2)
muCstarhStrat <- exp(h * mCstarStrat + h^2 * sCstar^2 / 2)
muEyStarT0strat <- dfStrat$vStrat * muKprime * muCstarhStrat
# mLamba <- log(P02007) + (mPDown - sPDown^2 / 2) * timeHoriz + log(h) - mEcSharpT0
# mean(log(lamTrunc))
# log(P02007) + (mPDown - sPDown^2 / 2) * timeHoriz + log(h) #mEcSharpT0
ProbProfit <- pnorm((log(EPT02007) - mEcSharpT0) / (sEcSharpT0) - eta * sEcSharpT0)
EmploymentRate <- pnorm((log(EPT02007) - mEcSharpT0) / sEcSharpT0)
muEyStarT0check <- dfAll$muEyStarT0trunc * EmploymentRate / ProbProfit
#muEyStarT0check - muEyStarT0
#=============================================================================
#=============================================================================
#=============================================================================
# Mean farm size
muArea <- mean(exp(dfMod3$`ln[Farm size (acres)]`))
muAreaReport <- round(muArea, 2)
# Number of farms
NfReport <- 2
Nf <- NfReport * 10^6

```
\doublespacing

<!-- Calculation of $m_{\#}$ and $s_{\#}$ requires the expected price at planting for 2007, the same year as the farm data used to estimate $\bar{m}_{\#}$ and $\bar{s}_{\#}$. -->
The short rains harvest in 2007 was normal and so the "good short rains" estimate of $m_p$, and March 2007 price is used to compute $E[P(T)]|_{t = 0} = P(0) e^{m_p T}$ (where $P(0)$ is the price at planting in March), which then feeds into the calculation of the unconditional parameters $m_{\#}$ and $s_{\#}$ by simultaneous Equations \ref{eq:cSharpUncondParams}.

Once $m_{\#}$ and $s_{\#}$ are calculated, the expected unconditional mean yield term ($E[\tilde{y}^*(T; k_r(T))]|_{t = 0}$) required to evaluate aggregate supply is calculated by Equation \ref{eq:impMuEyStarT0uncond} at four different expected rainfall levels: $E[E[k_r(T)^{\kappa_r}]]|_{t = 0} = 1.5^{\kappa_r}, \: 1^{\kappa_r}, \: 0.5^{\kappa_r}, \: 0.1^{\kappa_r}$. These values correspond to expected rainfall that is 150% of the historical benchmark ("high"), in line with the historical benchmark ("normal"), 50% of the historical benchmark ("low"), and 10% of the historical benchmark ("dismal"), respectively.
<!-- follows from Equation \ref{eq:condMeanYd2}. In the process, the farm employment rate is calculated as $\mathcal{E}=$ `r round(EmploymentRate, 2)` and the PEFS adjusted mean probability of profit is calculated as `r round(ProbProfit, 2)`. -->

The two remaining parameters required to evaluate expected aggregate supply in Equation \ref{eq:aggSup2} are number of farms $N$ and mean farm size $k_a$. For mean farm size, the Kenya farm sample mean is used, giving $k_a =$ `r muAreaReport` acres. The number of maize farms is more difficult to assess. One sometimes sees the figure $3$ million mentioned [e.g. @njeru2022maize], but this appears to be unsupported by any hard evidence. Here, a rough estimate is deduced by dividing planted area by mean farm size. The midseason reports examined for this exercise suggest that planted main season maize area during the period in question ranges between 3 and 4.5 million acres [@KFSSGJul2011]. Divided by $k_a$, this gives a range between $1.56$ and $2.34$ million farms. The figure $N =$ `r NfReport` million is used as a rough estimate.

With all the necessary parameters estimated, the theoretical expected aggregate supply curve developed in the sections above is plotted at the four expected rainfall levels, with empirical aggregate supply estimates overlaid, in the top panel of Figure \ref{fig:EaggQs}. The empirical estimates for the major drought years agree closely with the theoretical expected supply curve evaluated at the "dismal" rainfall level, while the estimates in normal or good rainfall years generally agree with the theoretical curve evaluated at the "normal" and "high" rainfall levels. The curve overshoots the 2010 estimate somewhat, possibly due to crop loss from flooding that year [@GIEWS5Aug2010]. The one major empirical divergence from the theoretical curve is 2009, an historic drought year [@MoApressRelease2009].

The price elasticity of expected aggregate supply curve is presented in the bottom panel of Figure \ref{fig:EaggQs}. Empirical estimates of the maize price elasticity of supply in Kenya generally range from $0.1$ to $0.365$ [@abodi2021supply; @onono2013response; @olwande2009supply], which is roughly the range of elasticities indicated by the theoretical curve for the years examined here.
<!-- In one study, Onono et al.'s estimate of price elasticity of supply: 0.365 [@onono2013response] -->

A key message emerging from these results is that aggregate supply varies widely with meteorological conditions. Individual supply curves represent specific scenarios within a broad range of such scenarios. It may thus more instructive to speak of a supply range or "ribbon", bounded by supply curves on top and bottom representing best and worst case meteorological scenarios.

Finally, it is important to keep in mind that the expected aggregate supply and price elasticity curves parameterized in this exercise are "short run" curves in the sense that they are valid only insofar as the values of their fitted parameters---$h$, $N$, $k_a$, $k$, $m_{\#}$, $s_{\#}$, $m_p$---are accurate. Empirical estimates for years well before or well after the year of the data used to estimate the parameters can be expected to diverge from the curve.

\singlespacing
```{r Fig4, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:EaggQs}(Top) The theoretical expected aggregate maize supply curve fitted to 2007 Kenya long rains maize season data, plotted against empirical estimates of expected aggregate supply for the years 2006-2012. (Bottom) The corresponding theoretical price elasticity of expected aggregate supply curve.", echo = FALSE}
#----------------------------------------------------------------------------------------
# Define expected agg supply function
EQsFun <- function(EPT0, muEyStarT0, mEcSharpT0, sEcSharpT0, h, muArea, Nf, kappaRn){
  z <- (log(EPT0) - mEcSharpT0) / sEcSharpT0 - eta * sEcSharpT0
  ProbProfitMeanFarm <- pnorm(z)
  #Expected agg supply in kg
  EQsT0 <- muArea * Nf * muEyStarT0 * ProbProfitMeanFarm #assuming rainfall equals historical benchmark
  EQsT0HiRn <- muArea * Nf * 1.5^kappaRn * muEyStarT0 * ProbProfitMeanFarm #assuming rainfall 50% higher than benchmark
  EQsT0LoRn1 <- muArea * Nf * 0.5^kappaRn * muEyStarT0 * ProbProfitMeanFarm #Expected rainfall 50% lower than benchmark
  EQsT0LoRn2 <- muArea * Nf * 0.1^kappaRn * muEyStarT0 * ProbProfitMeanFarm #Expected rainfall 90% lower than benchmark
  #------------Expected agg supply in million MT
  EQsT0 <- EQsT0 * 10^-9
  EQsT0HiRn <- EQsT0HiRn * 10^-9
  EQsT0LoRn1 <- EQsT0LoRn1 * 10^-9
  EQsT0LoRn2 <- EQsT0LoRn2 * 10^-9
  #------------Spot price elasticity of expected agg supply
  etaP0EQsT0 <- dnorm(z) / pnorm(z) * 1 / sEcSharpT0
  #etaP0EQsT0 <- dnorm(z) / pnorm(z) * 1 / (sP * sqrt(timeHoriz))
  #------------
  EmploymentRate <- pnorm((log(EPT0) - mEcSharpT0) / sEcSharpT0)
  #------------
  dfOut <- data.frame(EPT0, EQsT0, EQsT0HiRn, EQsT0LoRn1, EQsT0LoRn2, etaP0EQsT0,
                      ProbProfitMeanFarm, EmploymentRate)# etaP0EQsT0, etaSpEQsT0)
  colnames(dfOut) <- c("Expected price (KES/kg)", "Expected supply\n(million MT)",
                       "Expected supply, high rainfall (150%)\n(million MT)",
                       "Expected supply, low rainfall (50%)\n(million MT)",
                       "Expected supply, dismal rainfall (10%)\n(million MT)",
                       "Price elasticity\nof supply",
                       "PEFS-adj. mean probability\nof profit", "Employment rate")
  return(dfOut)
}
#-------------------------------------------------------------------------------------
EPT0vec <- seq(0.1, 60, length.out = 50)
dfOut <- EQsFun(EPT0vec, muEyStarT0, mEcSharpT0, sEcSharpT0, h, muArea, Nf, kappaRn)
EPT0EmpirVec = c(EPT02006, EPT02007, EPT02008, EPT02009, EPT02010, EPT02011, EPT02012)
dfPoints$EPT0 <- EPT0EmpirVec
#-------------------------------------------------------------------------------------
# Expected aggregate supply curve
#gg <- ggplot(dfEQsT0, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million MT)`))
gg <- ggplot(dfOut)
gg <- gg + geom_ribbon(aes(x = `Expected price (KES/kg)`,
                           ymin = `Expected supply, dismal rainfall (10%)\n(million MT)`,
                           ymax = `Expected supply, high rainfall (150%)\n(million MT)`),
                       fill = 'blue', alpha = 0.2)
dfLine <- dfOut[, 1:5]; colnames(dfLine)[-1] <- c("Normal rainfall", "High rainfall (150%)", "Low rainfall (50%)", "Dismal rainfall (10%)")
dfLine <- dfLine %>% gather(rainLev, `Expected supply\n(million metric tons)`, `Normal rainfall`:`Dismal rainfall (10%)`)
gg <- gg + geom_line(data = dfLine, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million metric tons)`, group = rainLev, color = rainLev))
gg <- gg + scale_color_manual(breaks = c("Normal rainfall", "High rainfall (150%)", "Low rainfall (50%)", "Dismal rainfall (10%)"), values = c("black", "green", "orange", "red"))
#gg <- gg + geom_vline(xintercept = EPT02007)
gg <- gg + geom_point(data = dfPoints, aes(x = EPT0, y = `Estimate (million MT)`)) + ggrepel::geom_text_repel(data = dfPoints, aes(x = EPT0, y = `Estimate (million MT)`, label = `Estimate date`), size = 2, lineheight = 0.75)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_text(size = axisTitleSize),
                 axis.text = element_text(size = axisTextSize),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendTextSize),
                 legend.position = "top")
ggEQsT0 <- gg
#-------------------------------------------------------------------------------------
# Price elasticity of expected aggregate supply
gg <- ggplot(dfOut, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
gg <- gg + geom_line() + coord_cartesian(ylim = c(0, 1))
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_text(size = axisTitleSize),
                 axis.text = element_text(size = axisTextSize))
ggEtaEPT0EQsT0a <- gg
# gg <- ggplot(dfOut, aes(x = `Expected price (KES/kg)`, y = `PEFS-adj. mean probability\nof profit`))
# ggProbProfit <- gg + geom_line() + theme_bw()
# gg <- ggplot(dfOut, aes(x = `Expected price (KES/kg)`, y = `Employment rate`))
# ggEmployment <- gg + geom_line() + theme_bw()
# df_inset <- subset(dfOut, `Expected price (KES/kg)` > (EPT02007 - 3) & `Expected price (KES/kg)` < EPT02007 + 3)
# gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
# gg <- gg + geom_line()
# #gg <- gg + geom_hline(yintercept = 1, linetype = "dashed", color = "red")
# gg <- gg + geom_vline(xintercept = EPT02007)
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank())
# ggEtaEPT0EQsT0b <- gg
# ggEtaEPT0EQsT0 <- ggEtaEPT0EQsT0a + annotation_custom(ggplotGrob(ggEtaEPT0EQsT0b),
#                                           xmin = 6, xmax = 20, 
#                                           ymin = 5, ymax = 11)
#-------------------------------------------------------------------------------------------
ggEQsT0 / ggEtaEPT0EQsT0a
#-------------------------------------------------------------------------------------------
# gg <- ggplot(dfQs)
# gg <- gg + geom_ribbon(aes(x = `Expected price (KES/kg)`,
#                            ymin = `Expected supply, low rainfall\n(million metric tons)`,
#                            ymax = `Expected supply, high rainfall\n(million metric tons)`),
#                        fill='blue',alpha=0.2)
# df_line <- dfQs[, c("Expected price (KES/kg)", "Expected supply, low rainfall\n(million metric tons)", "Expected supply, high rainfall\n(million metric tons)",
#                     "Expected supply, normal rainfall\n(million metric tons)")]
# colnames(df_line)[2:4] <- c("Low rainfall", "High rainfall", "Normal rainfall")
# df_line <- df_line %>% gather(var, `Expected supply\n(million metric tons)`, `Low rainfall`:`Normal rainfall`)
# gg <- gg + geom_line(data = df_line, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million metric tons)`, group = var, color = var))
# gg <- gg + scale_color_manual(values = c("green", "red", "black"))
# gg <- gg + geom_vline(xintercept = EPT02007)
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title.x = element_text(size = axisTextSize),
#                  legend.title = element_blank(),
#                  legend.text = element_text(size = legendTextSize),
#                  legend.position = "top")
# ggQs <- gg
#---
# gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
# gg <- gg + geom_line()
# gg <- gg + theme_bw()
# ggElast <- gg
# df_inset <- subset(dfQs, `Expected price (KES/kg)` > 7 & `Expected price (KES/kg)` < 11)
# gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
# gg <- gg + geom_line()
# gg <- gg + geom_hline(yintercept = 1, linetype = "dashed", color = "red")
# gg <- gg + geom_vline(xintercept = EPT02007)
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank())
# ggElastInset <- gg
# ggPelastQs <- ggElast + annotation_custom(ggplotGrob(ggElastInset),
#                                           xmin = 6, xmax = 20, 
#                                           ymin = 20, ymax = 70)
# #----------
# gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Participation (%)`))
# gg <- gg + geom_line()
# # gg <- gg + labs(y = expression(paste("Prob(", P(T)^eta, "> E[", C^[0](T), "]", ")")))
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title.x = element_blank())
# ggProb <- gg
# #----------
# ggQs + ggProb + ggPelastQs + plot_layout(ncol = 1, heights = c(1, 1/4, 1))
#----------------------------------------------------------------------
# Expected aggregate supply maps
# fracVec <- seq(0.75, 1.2, length.out = 50)
# n <- length(fracVec)
# kRnVec <- seq(1 / 5, 3, length.out = n)
# list_df <- list()
# for(i in 1:n){
#   thisKrn <- kRnVec[i]
#   dfQs <- QsFun(muEyStarT0, EPT0ref = EPT02007,
#                 fracVec, h = hCoef, kappaRn, muArea,
#                 muEcSharpT0, mP = mP2006, sP = sP2006,
#                 th, Nf, kRn = thisKrn)
#   dfQs$`Rainfall anomaly` <- thisKrn
#   list_df[[i]] <- dfQs
# }
# 
# dfMap <- as.data.frame(do.call(rbind, list_df))
# colnames(dfMap)[3] <- "Expected supply\n(million metric tons)"
# gg <- ggplot(dfMap, aes(x = `Expected price (KES/kg)`,
#                         y = `Rainfall anomaly`, fill = `Participation (%)`))
# gg <- gg + geom_tile()
# gg

#======================================================================
# # Graph truncated yield, unit cost distributions
# # shapiro.test(lEcSharpT0trunc)
# # car::qqPlot(lEcSharpT0trunc)
# xVec <- seq(0.001, 40, length.out = length(EcSharpT0trunc))
# #fVec <- dlnorm(xVec, mEcSharpT0, sEcSharpT0)
# fVec <- dnorm(log(xVec), mEcSharpT0, sEcSharpT0)
# dfPlot <- data.frame(xVec, fVec)
# # EPT0min <-min(df_mod$`Maize price (KES/kg)`) 
# # EPT0max <-max(df_mod$`Maize price (KES/kg)`)
# gg <- ggplot() + geom_histogram(data = data.frame(lEcSharpT0trunc), aes(x = lEcSharpT0trunc, y = after_stat(count / sum(count))), bins = 35, color = "black", fill = "white") + scale_y_continuous(labels = scales::percent)
# gg <- gg + geom_line(data = dfPlot, aes(x = xVec, y = fVec))
# gg <- gg + scale_x_continuous(limits = c(0, 40))
# gg <- gg + geom_vline(xintercept = log(EPT0), color = "red", linetype = "dashed")
# gg <- gg + annotate("rect", fill = "red", alpha = 0.25, 
#         xmin = EPT02007min, xmax = EPT02007max,
#         ymin = -Inf, ymax = Inf)
# gg <- gg + theme_bw()
# # Now EyStarT0
# xVec <- seq(0.001, 2500, length.out = length(EyStarT0trunc))
# fVec <- dlnorm(xVec, mEyStarT0, sEyStarT0)
# dfPlot <- data.frame(xVec, fVec)
# EyStarT0maxUp <- muEyStarT0 * max(exp(thetaKvec))^(eta / h) / muThetaKnh * EPT02007max^eta / muEcSharpT0n
# EyStarT0maxLo <- muEyStarT0 * min(exp(thetaKvec))^(eta / h) / muThetaKnh * EPT02007min^eta / muEcSharpT0n
# gg <- ggplot() + geom_histogram(data = data.frame(EyStarT0trunc), aes(x = EyStarT0trunc, y = after_stat(count / sum(count))), bins = 15, color = "black", fill = "white") #+ scale_y_continuous(labels = scales::percent)
# gg <- gg + geom_line(data = dfPlot, aes(x = xVec, y = fVec))
# gg <- gg + geom_vline(xintercept = EyStarT0max, color = "red", linetype = "dashed")
# gg <- gg + annotate("rect", fill = "red", alpha = 0.25, 
#         xmin = EyStarT0maxLo, xmax = EyStarT0maxUp,
#         ymin = -Inf, ymax = Inf)
# gg <- gg + theme_bw()

# # ggplot() + geom_line(data = dfPlot, aes(x = lEcSharpVec, y = f)) + geom_vline(xintercept = log(EPT02007), color = "red", lwd = 1) + theme_bw()
# xVec <- seq(0.0001, 40, length.out = length(EcSharp))
# f <- dlnorm(xVec, mEcSharp, sEcSharp)
# dfPlot <- data.frame(xVec, f)
# gg <- ggplot() + geom_histogram(data = data.frame(EcSharpT0), aes(x = EcSharp, y = 0.7*after_stat(count / sum(count))), bins = 45, color = "black", fill = "white") #+ scale_y_continuous(labels = scales::percent)
# gg <- gg + geom_line(data = dfPlot, aes(x = EcSharpVec, y = f)) + geom_vline(xintercept = EPT02007, color = "red", lwd = 1) + theme_bw()
# 
# annotate("rect", fill = "red", alpha = 0.5,
#         xmin = 1924, xmax = 1928 + 11/12,
#         ymin = -Inf, ymax = Inf)
#----------------------------------------------------------------------------------------
#======================================================================
# rootFnLo <- function(xIn, xLo, sXtrunc, mXtrunc){
#   sX <- xIn[1]
#   mX <- xIn[2]
#   zLo <- (log(xLo) - mX) / sX
#   probTerm <- dnorm(zLo) / pnorm(-zLo)
#   slack_s <- sXtrunc^2 - sX^2 * (1 + zLo * probTerm - probTerm^2)
#   slack_m <- mXtrunc - mX - sX * probTerm
#   outVec <- c(slack_s, slack_m)
#   return(outVec)
# }
```
\doublespacing

## The research induced supply ribbon shift
```{r, echo=FALSE}

# sEcSharpT0stratVec <- c(); mEcSharpT0stratVec <- c()
# for(i in 1:nrow(dfStrat)){
#   xIn <- c(dfStrat$sEcSharpT0[i], dfStrat$mEcSharpT0[i])
# sol <- nleqslv::nleqslv(xIn, rootFnUp, jac = NULL,
#                         xUp = EPT02007,
#                         sXtrunc = dfStrat$sEcSharpT0[i],
#                         mXtrunc = dfStrat$mEcSharpT0[i])
# #sol
# sEcSharpT0stratVec[i] <- sol$x[1]
# mEcSharpT0stratVec[i] <- sol$x[2]
# }
# muEcSharpT0 <- exp(mEcSharpT0 + sEcSharpT0^2 / 2)
# muEcSharpT0n <- exp(eta * mEcSharpT0 + eta^2 * sEcSharpT0^2 / 2)
# Now can calculate unconditional cStar parameters
# muCstar <- exp(mCstar + sCstar^2 / 2)
# muCstarh <- exp(h * mCstar + h^2 * sCstar^2 / 2)
# muEyStarT0 <- mean(vStrat) * muK * muCstarh
# mLamba <- log(P02007) + (mPDown - sPDown^2 / 2) * timeHoriz + log(h) - mEcSharpT0
# mean(log(lamTrunc))
# log(P02007) + (mPDown - sPDown^2 / 2) * timeHoriz + log(h) #mEcSharpT0
# ProbProfitStrat <- pnorm((log(EPT02007) - mEcSharpT0stratVec) / (sEcSharpT0stratVec) - eta * sEcSharpT0stratVec)
# EmploymentRateStrat <- pnorm((log(EPT02007) - mEcSharpT0stratVec) / sEcSharpT0stratVec)
# muEyStarT0check <- dfAll$muEyStarT0truncStrat * EmploymentRate / ProbProfit
#-------------------------------------------------------------------------
# Exogenous tech, price, and subsidy shock params
# betaNew <- 0.2
# dlng0 <- exp(betaNew) - 1
dlng0 <- 0.3
betaNew <- log(dlng0 + 1)
nuRatio <- 0.75
aDotdlw <- 0.2; dlP <- -aDotdlw * nuRatio
dB <- 1000
dlnNu <- dlP - aDotdlw
dlnNuh <- h * dlP - aDotdlw
# Save intervention coordinates to mark on heat maps farther below
dlNuPoint <- dlnNu
dBPoint <- dB
#-------------------------------------------------------------------------
# Endogenous farm expenditure TFP, mean cost, and mean expected yield response
dlv0dlg0 <- dlng0 - aDotdlw
dlMuCstar <- 1 / (1 - h) * (dlnNu + dlng0)
dlMuEyStarT0 <- 1 / (1 - h) * (dlnNuh + dlng0)
#---
cStarMaxAdopt <- -h * dB / (dlnNu + dlng0)
lcStarMaxAdopt <- log(cStarMaxAdopt)
zStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar
adoptRateStrat <- pnorm(zStrat)
zTot <- (lcStarMaxAdopt - mCstar) / sCstar
adoptRateTotal <- pnorm(zTot)
adoptRateTotalCheck <- sum(adoptRateStrat * stratFrac)
#adoptRateTotal - adoptRateTotalCheck
# A = \Phi\left( \frac{\frac{-h (1 - h) \partial B}{\partial \ln(\nu) + \partial \ln(g)} - (\ln(v) + m_k + m_{\#})}{\sqrt{s_k^2 + s_{\#}^2}} \right)
#--------------------------------------------------------------------------
# Total subsidies in millions
aggSubsidyTot <- dB * Nf * muArea * adoptRateTotal * 10^-6
aggSubsidyStrat <- stratFrac * dB * Nf * muArea * adoptRateStrat * 10^-6
#sum(aggSubsidyStrat) - aggSubsidy # Check if zero
#--------------------------------------------------------------------------
# Welfare assessment
phiArgStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar - sCstar
probProfAdoptStrat <- pnorm(phiArgStrat)
phiArgTot <- (lcStarMaxAdopt - mCstar) / sCstar - sCstar
probProfAdoptTot <- pnorm(phiArgTot)
#mR <- log(EPT02007) - mEcSharpT0; sR <- sEcSharpT0
# muRcondStrat <- EPT02007 * exp(-dfStrat$mEcSharpT0truncStrat + dfStrat$sEcSharpT0truncStrat^2 / 2)
#muRcondTot <- EPT02007 * exp(-dfAll$mEcSharpT0trunc + dfAll$sEcSharpT0trunc^2 / 2)
muRcond <- EPT02007 * exp(-dfAll$mEcSharpT0trunc + dfAll$sEcSharpT0trunc^2 / 2)
dPsiStrat <- stratFrac * Nf * muArea * (dlnNu + dlng0) * muRcond * EmploymentRate * (muCstar * probProfAdoptStrat - cStarMaxAdopt * adoptRateStrat) * 10^-6 # In million KES
#\Delta \psi = N E[k_a] E[r] \gamma (2 \mathcal{E} - \mathcal{P}(P; m_{\#}, s_{\#})) ( E[C^*] \mathcal{P}(\bar{\bar{C}^*}; m_c, s_c)  - \bar{\bar{C}^*} \mathcal{A} )
# dPsiStrat <- stratFrac * Nf * muArea * muEyStarT0strat * EPT02007 * (dlnNu + dlng0) * (probProfAdoptStrat - cStarMaxAdopt / muCstarhStrat * adoptRateStrat)
dPsiTot <- sum(dPsiStrat)
#dPsiTot / 67.32 # 2007 USD exchange rate
dPsiTotCheck <- Nf * muArea * (dlnNu + dlng0) * muRcond * EmploymentRate * (muCstar * probProfAdoptTot - cStarMaxAdopt * adoptRateTotal) * 10^-6 # In million KES
#dPsiTot - dPsiTotCheck
#dPsiTot - aggSubsidyTot
#--------------------------------------------------------------------------
# Change in aggregate supply
phiArgStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar - h * sCstar
probProfAdoptStrat <- pnorm(phiArgStrat)
phiArgTot <- (lcStarMaxAdopt - mCstar) / sCstar - h * sCstar
probProfAdoptTot <- pnorm(phiArgTot)
dQStrat <- stratFrac * Nf * muArea * muEyStarT0strat * (dlnNuh + dlng0) / (1 - h) * probProfAdoptStrat
dQStrat <- 10^-3 * dQStrat # in MT
dQStrat <- 10^-3 * dQStrat # in 1000 MT
dQtot <- sum(dQStrat)
dQtotCheck <- Nf * muArea * muEyStarT0 * (dlnNuh + dlng0) / (1 - h) * probProfAdoptTot * 10^-6
#dQtot - dQtotCheck
#\Delta Q = N E[k_a] E[y^*] \frac{\ell}{1 - h}\mathcal{P}(\bar{\bar{C^{*h}}}; m_c, s_c)
```

Say a new technology package is released in Kenya that results in a `r 100 * dlng0`% increase in TFP on adopting farms. As explained in section \ref{sec:farmResp}, this is tantamount to adding another binary endowment $b_5\beta_5 =$ `r round(betaNew, 2)` to the yield model. Say that the expected $\boldsymbol{\alpha}$-adjusted percentage increase in input prices ($\boldsymbol{\alpha} '\partial \ln(\mathbf{w})$) is `r aDotdlw`, and the expected percentage decrease in output price ($\partial \ln(P)$) is `r dlP`, such that $\partial \ln(\nu) =$ `r dlnNu`, which is greater than the percentage increase in TFP. Adoption would thus result in a `r 100 * dlv0dlg0`% increase in expenditure TFP ($v$), a `r -round(100 * dlMuCstar)`% reduction in expenditure, and a `r round(100 * dlMuEyStarT0)`% increase in yield on adopting farms (recall Equations \ref{eq:dlv0dlg0}, \ref{eq:dlyStardlg0}, and \ref{eq:dlCstardlg0}). However, by the criterion in Inequality \ref{eq:adoptCondSimp}, adoption makes economic sense for the farmer only if a net subsidy is included in the technology package (i.e., only if $\partial B > 0$).

Say that the Ministry of Agriculture offers a net subsidy of $\partial B = $ `r dB` KES/acre to adopting farms, perhaps in the form of free seed and fertilizer. As explained in section \ref{sec:adopt}, this then implies the adoption expenditure per acre ceiling of $\bar{\bar{C}^*} =$ `r round(cStarMaxAdopt)` KES (Equation \ref{eq:cStarAdopt}), and the corresponding adoption rate of $\mathcal{A} =$ `r round(100 * adoptRateTotal, 1)`% (Equation \ref{eq:AdoptRate}). The aggregate net subsidy required from the Ministry of Agriculture to achieve this rate follows from Equation \ref{eq:aggSubsidy} as `r round(aggSubsidy, 2)` billion KES. The corresponding increase in expected aggregate supply and producer welfare follow from Equations \ref{eq:dEQT0} and \ref{eq:dEPsi} as `r round(dQ, 2)` 1000 MT and `r round(dPsi, 2)` billion KES, respectively (assuming normal rainfall $\tilde{k}_r^{\kappa_r} = 1$). The breakdown by stratum is given in the left panel of Figure \ref{fig:intervention}, accompanied by a graphic of the corresponding supply ribbon shift in the right panel.
<!-- By the criterion in Inequality \ref{eq:adoptCondSimp}, adoption in the absence of exogenous subsidies/costs will increase farm net benefit only if the the percentage increase in TFP $\partial \ln(g) =$ `r 100 * dlng0`% is greater than the absolute value of the percentage decrease in output price plus the $\alpha_i$-scaled increase in input prices (i.e. only if $\partial \ln(g) > |\partial \ln(\nu)|$).  -->

\singlespacing

```{r Fig5, fig.show = "hold", fig.width = 7, fig.height=3, fig.align="center", fig.cap="\\label{fig:intervention}(Left) The adoption rate, change in welfare, and change in supply for each of the 12 binary endowment strata, for the technological intervention described in the text. (Right) The corresponding expected aggregate supply ribbon shift, where the dotted lines represent the new normal and dismal rainfall bounds of the aggregate supply ribbon.", echo = FALSE}

# dfStrat$`Adoption\nrate\n(%)` <- 100 * round(adoptRateStrat, 3)
# dfStrat$`Change in aggregate\nproducer welfare\n(billion KES)` <- round(dPsiStrat, 2)
# dfStrat$`Change in\nsupply\n(1000 MT)` <- round(dQStrat, 2)
# dfTab <- dfStrat %>% rename(`TFP (v0)` = v0) %>%
#   select(`Type`, `Adoption\nrate\n(%)`, `Change in aggregate\nproducer welfare\n(billion KES)`, `Change in\nsupply\n(1000 MT)`) %>%
#   relocate(`Type`, `Adoption\nrate\n(%)`, `Change in aggregate\nproducer welfare\n(billion KES)`, `Change in\nsupply\n(1000 MT)`) %>% gather(var, val, `Adoption\nrate\n(%)`:`Change in\nsupply\n(1000 MT)`)

#dfPlot$Type <- factor(dfPlot$Type, levels = dfPlot$`TFP (v0)`[order(dfPlot$`TFP (v0)`)], ordered = T)
#gg <- ggplot(dfPlot, aes(x = Element, y = Type, fill = y0, label = y0))


dfTab <- data.frame(Type = dfStrat$Type,
                    round(100 * adoptRateStrat, 1),
                    round(dQStrat, 1),
                    round(dPsiStrat, 1))
varCols <- c("Adoption\nrate (%)", "Change in\nsupply\n(1000 MT)",
             "Change in aggregate\nproducer welfare\n(million KES)")
colnames(dfTab)[-1] <- varCols
dfTab <- dfTab %>% gather_("var", "val", varCols)
gg <- ggplot(dfTab, aes(x = var, y = Type, fill = val, label = val))
gg <- gg + scale_y_discrete(limits = typeVec)
gg <- gg + geom_tile(alpha = 0)
#gg <- gg + labs(title = expression(v[0]))
gg <- gg + scale_x_discrete(limits = varCols, position = "top")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text.x = element_text(size = axisTextSize),
                 axis.ticks.x = element_blank(),
                 axis.text.y = element_text(size = axisTextSize),
                 panel.grid = element_blank(),
                 plot.title = element_text(size = axisTitleSize, hjust = 0.5),
                 legend.position = "none")
gg <- gg + geom_text(size = cellText_size)
ggShift <- gg
#---
dfPopRow <- data.frame(Type = "Population",
                       var = unique(dfTab$var),
                       val = c(round(100 * adoptRateTotal, 1),
                               round(dQtot, 1), 
                               round(dPsiTot, 1)))
gg <- ggplot(dfPopRow, aes(x = var, y = Type, fill = val, label = val))
gg <- gg + geom_tile(alpha = 0)
gg <- gg + scale_x_discrete(limits = varCols)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text.x = element_blank(),
                 axis.ticks.x = element_blank(),
                 axis.text.y = element_text(size = axisTextSize),
                 panel.grid = element_blank(),
                 plot.title = element_text(size = axisTitleSize, hjust = 0.5),
                 legend.position = "none")
gg <- gg + geom_text(size = cellText_size)
ggShiftPop <- gg
#===========================================================================
# Supply curve shift

# gg <- ggplot(dfOut)
# gg <- gg + geom_ribbon(aes(x = `Expected price (KES/kg)`,
#                            ymin = `Expected supply, dismal rainfall (10%)\n(million MT)`,
#                            ymax = `Expected supply, high rainfall (150%)\n(million MT)`),
#                        fill = 'blue', alpha = 0.2)
dfLine <- dfOut[, 1:5]; colnames(dfLine)[-1] <- c("Normal rainfall", "High rainfall (150%)", "Low rainfall (50%)", "Dismal rainfall (10%)")
dfLine <- dfLine %>% gather(rainLev, `Expected supply\n(million metric tons)`, `Normal rainfall`:`Dismal rainfall (10%)`) %>%
  subset(rainLev %in% c("Normal rainfall", "Dismal rainfall (10%)"))
gg <- ggplot(dfLine)
gg <- gg + geom_line(aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million metric tons)`, group = rainLev, color = rainLev))
gg <- gg + scale_color_manual(breaks = c("Normal rainfall", "Dismal rainfall (10%)"), values = c("black", "red"))

dfShift <- dfLine %>% mutate(`Expected supply\n(million metric tons)` = `Expected supply\n(million metric tons)` + dQtot * 10^-3) %>% mutate(x = "The research induced\nsupply ribbon shift")
gg <- gg + geom_line(data = dfShift, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million metric tons)`, group = rainLev, color = rainLev), linetype = "dashed")
gg <- gg + facet_wrap(~x, strip.position = "right")
gg <- gg + scale_color_manual(breaks = c("Normal rainfall", "Dismal rainfall (10%)"), values = c("black", "red"))
#gg <- gg + labs(title = "The research induced supply ribbon shift")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_text(size = axisTitleSize),
                 axis.text = element_text(size = axisTextSize),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendTextSize),
                 legend.position = "top",
                 strip.text = element_text(size = axisTitleSize),
                 strip.background = element_blank())
ggEQsT0Shift <- gg



(ggShift / ggShiftPop + plot_layout(heights = c(1, 1 / 12))) | (ggEQsT0Shift)


# gg <- ggplot(dfPlot, aes(x = `Pct of farms in sample`, y = Type))
# #gg <- gg + scale_y_discrete(limits = typeVec)
# gg <- gg + geom_col()
# gg <- gg + labs(title = "Pct of farms in sample")
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank(),
#                  #axis.title.x = element_text(size = axisTitleSize),
#                  axis.text.y = element_blank(),
#                  axis.text.x = element_text(size = axisTextSize),
#                  #panel.grid = element_blank(),
#                  plot.title = element_text(size = axisTitleSize, hjust = 0.5))
# ggEndow2 <- gg
# ggEndow1 + ggEndow2
# # dfPlot %>% group_by(var) %>% summarise(val = mean(val))
# # muEyStarT0
# # dfCheck <- data.frame(Type = endowVec, v0 = round(v0, 1),
# #                       yd = exp(dfMod3$`ln[Yield (kg/acre)]` - mod3$residuals - kRn
# #                                dfMod3$`ln[Rain anomaly]`),
# #                       cost = exp(dfMod3$`ln[Cost/acre (KES/acre)]`)) %>%
# #   group_by(Type) %>% summarise(muYd = mean(yd),
# #                                muCost = mean(cost),
# #                                v0 = mean(v0)) %>%
# #   arrange(v0)


```
\doublespacing

For policy formation, it is helpful to consider interventions in a sensitivity heatmap format whereby multiple farm subsidy and price change scenarios can be examined at a single glance (Figure \ref{fig:decisionMaps}). By illustrating the impact of changes in subsidy and assumed price shifts in a readily digestible manner, these maps build intuition about the effectiveness of changes in subsidy policy and the implications of price changes associated with the intervention.
<!-- [address the alpha in aDotW] -->
<!-- [Also can do "pro-poor" measures of change in aggregate (supply and?) producer welfare. Integrate dlnL instead of dL.] -->

```{r Fig6, fig.show = "hold", fig.width = 7, fig.height=3, fig.align="center", fig.cap="\\label{fig:decisionMaps}Kenya maize farm subsidy policy heat maps of the (left to right) adoption rate, change in aggregate supply, and aggregate producer welfare given release of the technology package described in the text. Each 'coordinate' on the map represents an assumed percentage decrease in the $\\alpha$ adjusted output-input price ratio and a net subsidy per acre. The scenario presented in the previous figure above is marked with a black dot. In these maps, the ratio of change in input price to change in output price is fixed at 0.75.", echo = FALSE}

# rm(dfPlot, dfPlot1)
# gc()
# Adoption rate map
muRcond <- EPT02007 * exp(-dfAll$mEcSharpT0trunc + dfAll$sEcSharpT0trunc^2 / 2)
nRes <- 20
aDotdlwVec <- seq(0.19, 0.22, length.out = nRes)
dlP <- -nuRatio * aDotdlwVec
dlNuVec <- rev(-aDotdlwVec + dlP)
dlNuhVec <- rev(-aDotdlwVec + h * dlP)
#dBvec <- seq(400, 1100, length.out = nRes)
dBvec <- seq(500, 1500, length.out = nRes)
matAdopt <- matrix(NA, nRes, nRes)
matDq <- matrix(NA, nRes, nRes)
matDpsi <- matrix(NA, nRes, nRes)
matSub <-  matrix(NA, nRes, nRes)
matProfitAdopt <- matrix(NA, nRes, nRes)
adoptCheckVec <- c()
dPsiCheckVec <- c()
dQCheckVec <- c()
t <- 0
for(j in 1:nRes){
    dB <- dBvec[j]
    #dB <- dBvec[indY]
for(i in 1:nRes){
    dlNu <- dlNuVec[i]
    #dlNu <- dlNuVec[indX]
    dlNuh <- dlNuhVec[i]
  #---
  cStarMaxAdopt <- -h * dB / (dlng0 + dlNu)
  lcStarMaxAdopt <- log(cStarMaxAdopt)
  #---
  # Stratified adopt rate
  zStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar
  adoptRateStrat <- pnorm(zStrat)
  adoptRateTotalCheck <- sum(adoptRateStrat * stratFrac)
  # Total adopt rate
  zTot <- (lcStarMaxAdopt - mCstar) / sCstar
  adoptRateTotal <- pnorm(zTot)
  # Check mean stratified adopt rate equals total
  t <- t + 1
  adoptCheckVec[t] <- adoptRateTotal - adoptRateTotalCheck
 # print(paste("Check adoptRate", round(adoptRateTotal - adoptRateTotalCheck, 3)))
#---
# Stratified welfare change
phiArgStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar - sCstar
probProfAdoptStrat <- pnorm(phiArgStrat)
phiArgTot <- (lcStarMaxAdopt - mCstar) / sCstar - sCstar
probProfAdoptTot <- pnorm(phiArgTot)
matProfitAdopt[i, j] <- probProfAdoptTot
dPsiStrat <- stratFrac * Nf * muArea * (dlnNu + dlng0) * muRcond * EmploymentRate * (muCstar * probProfAdoptStrat - cStarMaxAdopt * adoptRateStrat) * 10^-6 # In million KES
dPsiTot <- sum(dPsiStrat)
#dPsiTot / 67.32 # 2007 USD exchange rate
dPsiTotCheck <- Nf * muArea * (dlnNu + dlng0) * muRcond * EmploymentRate * (muCstar * probProfAdoptTot - cStarMaxAdopt * adoptRateTotal) * 10^-6 # In million KES
# Check that the sum of stratified welfare changes matches the total
dPsiCheckVec[t] <- dPsiTot - dPsiTotCheck
#dPsiTot - dPsiTotCheck
#--------------------------------------------------------------------------
# Change in aggregate supply
phiArgStrat <- (lcStarMaxAdopt - mCstarStrat) / sCstar - h * sCstar
probProfAdoptStrat <- pnorm(phiArgStrat)
phiArgTot <- (lcStarMaxAdopt - mCstar) / sCstar - h * sCstar
probProfAdoptTot <- pnorm(phiArgTot)
dQStrat <- stratFrac * Nf * muArea * muEyStarT0strat * (dlnNuh + dlng0) / (1 - h) * probProfAdoptStrat
dQStrat <- 10^-3 * dQStrat # in MT
dQStrat <- 10^-3 * dQStrat # in 1000 MT
dQtot <- sum(dQStrat)
dQtotCheck <- Nf * muArea * muEyStarT0 * (dlnNuh + dlng0) / (1 - h) * probProfAdoptTot * 10^-6 # In 1000 MT
dQCheckVec[t] <- dQtot - dQtotCheck
#---
# Total subsidies in millions
aggSubsidy <- dB * Nf * muArea * adoptRateTotal * 10^-6
#aggSubsidyStrat <- stratFrac * dB * Nf * muArea * adoptRateStrat * 10^-9
#sum(aggSubsidyStrat) - aggSubsidy # Check if zero
#aggSubsidyMillnUSD <- aggSubsidy / 67 #in million USD
#---
matDq[i, j] <- round(dQtot, 3)
matDpsi[i, j] <- round(dPsiTot, 3)
matAdopt[i, j] <- round(adoptRateTotal, 3) * 100
matSub[i, j] <- dPsiTot - aggSubsidy
}
}
# hist(adoptCheckVec)
# hist(dPsiCheckVec)
# hist(dQCheckVec)

indX <- which(abs(dlNuPoint - dlNuVec) == min(abs(dlNuPoint - dlNuVec)))
indY <- which(abs(dBPoint - dBvec) == min(abs(dBPoint - dBvec)))
dfMat <- as.data.frame(matAdopt)
dfMat[indX, indY] <- NA
colnames(dfMat) <- round(dBvec, 2) # paste("dB =", round(dBvec, 2))
gatherCols <- colnames(dfMat)
dfMat$dlNu <- round(dlNuVec, 2) #paste("dlnNu =", round(dlnNuVec, 2))
dfPlot <- dfMat %>% gather_("dB", "var", gatherCols)
dfPlot$dB <- as.numeric(dfPlot$dB)
gg <- ggplot(dfPlot, aes(x = dlNu, y = dB, z = var, fill = var, group = 1))
gg <- gg + geom_tile(alpha = 0.8) + geom_contour()
gg <- gg + metR::geom_text_contour(aes(z = var), stroke = 0.15)
gg <- gg + scale_fill_gradient(low = "coral", high = "cyan", na.value = "black")
#gg <- gg + geom_text(aes(label = adoptRate), size = labelSize)
# gg <- gg + annotate("rect", 
#            xmin = dlNuPoint - 0.01, xmax = dlNuPoint + 0.01,
#            ymin = dBPoint - 0.5, ymax = dBPoint + 0.5,
#            fill = "blue", alpha = 0.8)
gg <- gg + labs(fill = "Adoption rate (%)", x = "Decrease in output input price ratio (%)",
                y = "Net subsidy (KES/acre)")
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_text(size = axisTextSize),
                 axis.title = element_text(size = axisTitleSize),
                 legend.title = element_text(size = axisTitleSize),
                 legend.text = element_text(size = axisTextSize),
                 legend.position = "top",
                 legend.title.position = "top")
ggAdopt <- gg


dfMat <- as.data.frame(matDpsi)
dfMat[indX, indY] <- NA
colnames(dfMat) <- round(dBvec, 2) # paste("dB =", round(dBvec, 2))
gatherCols <- colnames(dfMat)
dfMat$dlNu <- round(dlNuVec, 2) #paste("dlnNu =", round(dlnNuVec, 2))
dfPlot <- dfMat %>% gather_("dB", "var", gatherCols)
dfPlot$dB <- as.numeric(dfPlot$dB)
gg <- ggplot(dfPlot, aes(x = dlNu, y = dB, z = var, fill = var, group = 1))
gg <- gg + geom_tile(alpha = 1) + geom_contour()
gg <- gg + metR::geom_text_contour(aes(z = var),
                                   #breaks = seq(100, 3000, length.out = 6),
                                   stroke = 0.15)
gg <- gg + scale_fill_gradient(low = "coral", high = "cyan", na.value = "black")
#gg <- gg + geom_text(aes(label = var), size = labelSize)
gg <- gg + labs(fill = "Change in aggregate\nproducer welfare (million KES)", 
                x = "Decrease in output input price ratio (%)",
                y = "Net subsidy (KES/acre)")
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_text(size = axisTextSize),
                 axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 legend.title = element_text(size = axisTitleSize),
                 legend.text = element_text(size = axisTextSize),
                 legend.position = "top",
                 legend.title.position = "top")
ggDpsi <- gg

dfMat <- as.data.frame(matDq)
dfMat[indX, indY] <- NA
colnames(dfMat) <- round(dBvec, 2) # paste("dB =", round(dBvec, 2))
gatherCols <- colnames(dfMat)
dfMat$dlNu <- round(dlNuVec, 2) #paste("dlnNu =", round(dlnNuVec, 2))
dfPlot <- dfMat %>% gather_("dB", "var", gatherCols)
dfPlot$dB <- as.numeric(dfPlot$dB)
gg <- ggplot(dfPlot, aes(x = dlNu, y = dB, z = var, fill = var, group = 1))
gg <- gg + geom_tile(alpha = 1) + geom_contour()
gg <- gg + metR::geom_text_contour(aes(z = var),
                                   #breaks = seq(100, 3000, length.out = 6),
                                   stroke = 0.15)
gg <- gg + scale_fill_gradient(low = "coral", high = "cyan", na.value = "black")
#gg <- gg + geom_text(aes(label = var), size = labelSize)
gg <- gg + labs(fill = "Change in aggregate supply (1000 MT)", x = "Decrease in output input price ratio (%)",
                y = "Net subsidy (KES/acre)")
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_text(size = axisTextSize),
                 axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 legend.title = element_text(size = axisTitleSize),
                 legend.text = element_text(size = axisTextSize),
                 legend.position = "top",
                 legend.title.position = "top")
ggDq <- gg


dfMat <- as.data.frame(matSub)
dfMat[indX, indY] <- NA
colnames(dfMat) <- round(dBvec, 2) # paste("dB =", round(dBvec, 2))
gatherCols <- colnames(dfMat)
dfMat$dlNu <- round(dlNuVec, 2) #paste("dlnNu =", round(dlnNuVec, 2))
dfPlot <- dfMat %>% gather_("dB", "var", gatherCols)
dfPlot$dB <- as.numeric(dfPlot$dB)
gg <- ggplot(dfPlot, aes(x = dlNu, y = dB, z = var, fill = var, group = 1))
gg <- gg + geom_tile(alpha = 1) + geom_contour()
gg <- gg + metR::geom_text_contour(aes(z = var),
                                   #breaks = seq(100, 3000, length.out = 6),
                                   stroke = 0.15)
gg <- gg + scale_fill_gradient(low = "coral", high = "cyan", na.value = "black")
#gg <- gg + geom_text(aes(label = var), size = labelSize)
gg <- gg + labs(fill = "Welfare-tot net subsidy (billion KES)", x = "Decrease in output input price ratio (%)",
                y = "Net subsidy (KES/acre)")
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_text(size = axisTextSize),
                 axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 legend.title = element_text(size = axisTitleSize),
                 legend.text = element_text(size = axisTextSize),
                 legend.position = "top",
                 legend.title.position = "top")
ggSub <- gg

dfMat <- as.data.frame(matProfitAdopt)
dfMat[indX, indY] <- NA
colnames(dfMat) <- round(dBvec, 2) # paste("dB =", round(dBvec, 2))
gatherCols <- colnames(dfMat)
dfMat$dlNu <- round(dlNuVec, 2) #paste("dlnNu =", round(dlnNuVec, 2))
dfPlot <- dfMat %>% gather_("dB", "var", gatherCols)
dfPlot$dB <- as.numeric(dfPlot$dB)
gg <- ggplot(dfPlot, aes(x = dlNu, y = dB, z = var, fill = var, group = 1))
gg <- gg + geom_tile(alpha = 1) + geom_contour()
gg <- gg + metR::geom_text_contour(aes(z = var),
                                   #breaks = seq(100, 3000, length.out = 6),
                                   stroke = 0.15)
gg <- gg + scale_fill_gradient(low = "coral", high = "cyan", na.value = "black")
#gg <- gg + geom_text(aes(label = var), size = labelSize)
gg <- gg + labs(fill = "ProbProfitAdopt", x = "Decrease in output input price ratio (%)",
                y = "Net subsidy (KES/acre)")
gg <- gg + theme_bw()
gg <- gg + theme(axis.text = element_text(size = axisTextSize),
                 axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 legend.title = element_text(size = axisTitleSize),
                 legend.text = element_text(size = axisTextSize),
                 legend.position = "top",
                 legend.title.position = "top")
ggProbProfitAdopt <- gg


ggAdopt | ggDq | ggDpsi




```
The illustrative example presented above is an exercise in comparative statics. That is to say, it is a comparison of the "before new tech" (or status quo) and "after new tech" situations, without accounting for the time it takes for release and adoption to occur. In a standard impact assessment, the static analysis would be converted into a temporally explicit assessment by introducing a sigmoidal adoption rate curve over time, as explained in Alston et al. [] and elsewhere. The welfare impact would be then be calculated as the sum of discounted yearly net impacts out to a relevant cutoff year determined by the policy question.

# Discussion and conclusion

A model of agricultural supply and of the production side impact of new technology (or any exogenous shock) is useful to agricultural policy makers insofar as it can map out the plausible outcome space for the relevant range of price assumptions and policy lever settings (subsidies) underpinning the policy discussion; and insofar as this mapping is transparently rooted in an empirically vetted, sensible theoretical foundation.

More specifically, this means that a useful model of aggregate supply must explicitly account for 1) the shape of the yield distribution, and hence also provide an endogenous accounting of farm entry and exit in response to price changes; 2) the endogenous farm level supply response to new technology (or any exogenous shock) and to any associated exogenous changes in input/output prices and subsidies; and 3) the aggregation of farm level response and welfare impacts up to the population level---i.e. the supply curve shift---in a theoretically sensible and transparent way, including endogenous modeling of the adoption rate.

As mentioned in the Introduction, the conventional approach to modeling aggregate agricultural supply and technology shocks provides no such explicit, theoretically grounded, endogenous accounting. Instead, the shape of the distribution is unceremoniously ignored (or identically endowed marginal firms are assumed), the supply response and adoption rate are assumed as exogenous inputs into the model, essentially synonymous with the technology shock itself; and the aggregation of farm level impacts up to the population level is neither empirically nor theoretically grounded, but rather introduced as a matter of fiat. As a result, the model is ill suited to answer such basic policy questions such as:

*By how much will the adoption rate/producer welfare/aggregate supply change if the change in TFP turns out to be $10$% higher or lower than expected?

*By how much will the adoption rate/producer welfare/aggregate supply change if subsidies are increased/lowered?

*By how much will the adoption rate/producer welfare/aggregate supply change if the change in input prices is $10$%?

*Given a certain change in TFP and input/output prices, what subsidy level is required to push adoption over $50$%?

To more squarely meet the needs of agricultural policy makers, here an alternative modeling framework is theoretically derived from 5 non-controversial axioms, and empirically vetted against Kenya farm data. The proposed model can answer the ussual policy questions such as those just enumerated, as well as many others not often considered part of the purview of such models. In particular, the model explicitly controls for meteorological conditions and price volatility, and disaggregates results by binary endowment stratum. The model can thus be used to examine highly nuanced scenarios regarding technology packages tailored to specific farming systems under different weather and price volatility settings.

For example, on untenured farms, the technology package could be bundled with legal services to formalize a title deed, such that TFP on such farms is augmented not just by the new techology coefficient ($\beta_{new}$), but also by the tenure coefficient $\beta_{new} + \beta_{tenure}$. (In such a scenario, the cost of the legal services would be included in the $\partial B$ term.) If the technology shock is a new seed variety, then the impact on farms growing hybrid maize will be considerably less than on non-hybrid farms, as TFP is augmented not by $\beta_{new}$ but by $\beta_{new} - \beta_{hybrid}$.

The proposed model is highly adaptive to the data that is available. The Kenya example explored above represents an ideal case where good farm survey data is available. Under less auspicious circumstances, model parameters can still be estimated up to a respectable degree of precision because the model is expressed in terms of economic indicators and population parameters (the farm employment rate, PEFS-adjusted probability of profit, observed mean and standard deviation of yield and expenditure) that in many cases is published or readily deductible from available information. As explained in section \ref{sec:acct4Stoch}, model parameters can also be estimated based on price information.
<!-- The conventional approach, by contrast, makes no use of farm survey data even when it is available. Rather, the model parameters are mostly elicited from "experts"---i.e., scientists directly involved in the research who have a vested interest in the impact assessment---makes very little use of farm survey data even when it is available. -->
<!-- \ref{sec:aggSup1} -->
<!-- compare numbers of parameters? -->
<!-- \ref{sec:aggImpact} -->

The model developed here is limited to the evaluation of aggregate supply and production side impacts. The model can be expanded to include aggregate demand and consumer side impacts (i.e. a full fledged partial equilibrium model) by pairing the derivation above with a theoretical derivation of the demand curve from the same set of axioms. While this lies outside the scope of the present effort, one may reasonably anticipate that this will involve reinterpretation of the input demand curve derived in section \ref{sec:axioms1and2} as a processing plant (e.g. miller, starch factory) feedstock demand curve; and the aggregation of this curve over the processor plant population density. In the Kenya maize example above (and many other such applied cases), the number of processors is small relative to the number of producers, such that the resulting aggregate demand curve would likely represent a monopsony or cartel demand curve, especially at subnational scales of analysis.

By explicitly including aggregate demand in the modeling, the equilibrium output price becomes endogenous to the model, and consumer welfare can be evaluated. (Although it should be kept in mind that "consumer welfare" in such instances is, more accurately, processing plant welfare; and thus does not necessarily reflect the welfare that ultimately passes through to the end consumer.) In the Kenya maize example above, producer welfare alone is not enough to offset the total subsidy paid out by the government to encourage adoption. Adding in consumer welfare would likely result in a net positive return on the government's investment.

In future work, it will be interesting to use this model to examine the role of price volatility and price support (forward contracts, price floors) on technology adoption and impact under different meteorological scenarios.  and to test the limits of the model in minimum data contexts.

It may also be interesting to model technology shocks as a perturbation of the degree of homogeneity ($h$). Preliminary exploration of the matter suggests that the supply response to and welfare outcomes of changes in homogeneity are considerably more complex and ambiguous than they are in the case of changes to TFP.

future work: consumer side impact, price guarantees, forward contracts, can also look at shocks to continuous endowments k; map between employment rate and PEFS adj mean prob of profit
another way is to shock h, much more ambiguous results.
the role of price volatility


<!-- The model may likewise be linked to upstream market models such that input prices also become endogenous. That is to say, the proposed model is modular, and may be inserted into broader multimarket equilibrium frameworks. -->
<!-- The framework derived here is the minimum -->
<!-- The broader the scope of equilibrium, the more data is required. -->



opens up a novel set of policy questions and nuance -- not just tech but also contractual arrangements, intermediaries, value chain, agroclimatic advisory services, cooperative social mechanisms, risk pooling,...enabling environment... and all at once--combined approaches ...much higher fidelity representation of the reality and the reality of interventions.

, rainfall etc., many of these simultaneously...
distributional questions


[[Some may consider the welfare calculation "unconventional" ... this a direct measure of welfare. I challenge them to explain in what sense "producer surplus" is a measure of tangible, realized or realizable welfare, or even just to explain what producer surplus represents in any meaningful economic sense.]]
caveats: t=0 and T may differ across the population, prices differ across the population... the bigger the geographical scope, the more the difference. At subnational scales the differences will be small. I.e. the more homogeneous the agroclimatic environment and market, the smaller the difference.

# References {-}

<div id="refs"></div>

\pagebreak

# Appendix A

A.1

## Price and cross price elsaticities of input demand

Decreasing returns to scale imply strictly downward sloping input demand curves. To see this, consider the derivative of input demand (Equation \ref{eq:inputDem1}) with respect to input own price.

\begin{equation}
\frac{\partial \ln(x^*_i)}{\partial \ln(w_i)} = \frac{\partial \ln(y^*)}{\partial \ln(w_i)} - 1 \end{equation}

To resolve the yield derivative, note that a more conventional textbook form of $y^*$ can be written by combining Equations \ref{eq:cobbDoug2} and \ref{eq:inputDem1}.

\begin{equation}
\begin{split}
y^* &= y|_{x_i = x^*_i} = g \prod_{i = 1}^{n_k} k_i^{\kappa_i} \prod_{i = 1}^{n_x} x^*_i^{\alpha_i} \\
&= g \prod_{i = 1}^{n_k} k_i^{\kappa_i} \prod_{i = 1}^{n_x} \left( \frac{y^* P \alpha_i}{\lambda w_i} \right)^{\alpha_i}
&\rightarrow y^* = \left( g \prod_{i = 1}^{n_k} k_i^{\kappa_i} \prod_{i = 1}^{n_x} \frac{\alpha_i}{w_i} \right)^{1 / (1 - h)} \left( \frac{P}{\lambda} \right)^{h / (1 - h)}
\end{split}
\label{eq:yStarAlt}
\end{equation}

Hence the yield derivative with respect to input price works out to

\begin{equation}
\begin{split}
\frac{\partial \ln(y^*)}{\partial \ln(w_i)} &= -\frac{\alpha_i}{1 - h}
\end{split}
\end{equation}

And so the input own and cross price elasticity resolve, respectively,

\begin{equation}
\frac{\partial \ln(x^*_i)}{\partial \ln(w_i)} = -\frac{\alpha_i}{1 - h} - 1 < 0
\end{equation}

And

\begin{equation}
\frac{\partial \ln(x_i^*)}{\partial \ln(w_{j \neq i})} = -\frac{\alpha_j}{1 - h} < 0
\label{eq:CrossPriceElas}
\end{equation}

whereby it is clear that the domain of $h$ implies negatively sloped own and cross price demand curves. It follows, moreover, that input own price elasticity of demand is strictly less than or equal to unity. Input cross price elasticity of demand is elastic if $h \in (1 - \alpha_j, 1)$, inelastic if $h \in (0, 1 - \alpha_j)$, and linear if $h = 1 - \alpha_j$. Note that increasing returns to scale would imply strictly upward sloping cross price demand curves, and the possibility of upward sloping own price demand curves.

A.2

## Differentiation of expenditure TFP, yield, and expenditure with respect to TFP

The derivative of expenditure TFP ($v$) with respect to TFP ($g$) follows from Equations \ref{eq:v0forms}.

\begin{equation}
\frac{\partial \ln(v)}{\partial \ln(g)} = 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)}
\end{equation}

And the derivatives $\partial \ln (C^*) / \partial \ln(g)$ and $\partial \ln(y^*) / \partial \ln(g)$ then follow from the expressions in Equation \ref{eq:fnCsharp}.

\begin{equation}
\begin{split}
\frac{\partial \ln(C^*)}{\partial \ln(g)} &= \frac{1}{1 - h} \left( \frac{\partial \ln(v)}{\partial \ln(g)} + \frac{\partial \ln(C^*)}{\partial \ln(g)} \right)  \\
&\rightarrow \frac{\partial \ln(C^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right)
\end{split}
\end{equation}

And

\begin{equation}
\begin{split}
\frac{\partial \ln(y^*)}{\partial \ln(g)} &= \frac{\partial \ln(v)}{\partial \ln(g)} - h \frac{\partial \ln(C^*)}{\partial \ln(g)} \\
&= \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right)
\end{split}
\end{equation}

<!-- ## Derivation of input demand from axiom 2 \label{sec:A1} -->
<!-- Standard textbook treatments of the first and second order conditions for Cobb-Douglas profit maximization [e.g. @heathfield1987introduction] are typically limited to the two input case (capital and labor) for the purpose of isoquant analysis, and omit the budget constraint. It is therefore necessary to take a moment to examine these conditions for the more general case, and specific aims, at hand. -->
<!-- ; and because the widespread insistence on constant or increasing returns to scale together with profit maximization, upward sloping firm supply curves, and other commonly desired production function properties, without acknowledging the mathematical contradiction between the latter and the former, suggests a lack of familiarity with the mathematical implications of these axioms beyond a literary form, such that a review is relevant to the aims of this article. -->
<!-- \begin{framed} -->
<!--    \textbf{Axiom 2} \\ Farms apply inputs so as to maximize their net benefit subject to a budget constraint. -->
<!-- \end{framed} -->

<!-- Formally, axiom 2 may be written -->

<!-- \begin{equation} -->
<!-- y^* = y(\mathbf{x}^*; y_0, \tilde{\mathbf{x}}, \mathbf{k}, \tilde{\mathbf{k}}, \boldsymbol{\alpha}, \boldsymbol{\kappa}) \:;\:\: x^* = \text{argmax}_{\mathbf{x}}(P y - \lambda(C - B)) -->
<!-- \end{equation} -->

<!-- Where $P$ is the output price, $B$ is the farm budget, $C$ is the cost function, defined -->

<!-- \begin{equation} -->
<!-- C = \mathbf{w} ' \mathbf{x} -->
<!-- \end{equation} -->

<!-- and $\mathbf{w}$ is the vector of input prices corresponding to each element in the input vector $\mathbf{x}$. -->

<!-- **-- -->
<!-- The Lagrangian is then -->

<!-- \begin{equation} -->
<!-- \mathcal{L} = Py - \lambda (C - B) -->
<!-- \label{eq:lagrangian} -->
<!-- \end{equation} -->

<!-- Where $\lambda$ is the farm budget shadow price, that is, the marginal benefit to the farm of a marginal increase in budget. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \mathcal{L}}{\partial B} = \lambda -->
<!-- \end{equation} -->
<!-- <!-- The budget shadow price is an implicit measure of how each farm values cash for expenditures on farm inputs, and plays a central role in the aggregation step farther below. -->

<!-- The first order conditions for a maximum of $\mathcal{L}$ are -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \nabla_{\mathbf{x}} \mathcal{L} &= P \nabla_{\mathbf{x}} y - \lambda \mathbf{w} = \mathbf{0} \\ -->
<!-- &= Py D(\mathbf{x})^{-1} \boldsymbol{\alpha} - \lambda \mathbf{w} = \mathbf{0} -->
<!-- \end{split} -->
<!-- \label{eq:eqFOC} -->
<!-- \end{equation} -->

<!-- Where the $\mathbf{0}$ indicates a vector of zeroes equal to the length of $\mathbf{x}$. -->

<!-- And the second order condition for a maximum is -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \mathbf{x} ' \nabla_{\mathbf{x}}^2 \mathcal{L} \mathbf{x} &= P \mathbf{x} ' \nabla_{\mathbf{x}}^2 y \mathbf{x} ' < 0 \\ -->
<!-- &= P h (h - 1) < 0 -->
<!-- \end{split} -->
<!-- \label{eq:eqSOC} -->
<!-- \end{equation} -->

<!-- Where Euler's Theorem has been invoked in the second line of the condition. The first order conditions may be solved for input demand $x_j^*$ as follows. -->

<!-- \begin{equation} -->
<!-- x_j^* = \frac{P y^* \alpha_j}{\lambda w_j} -->
<!-- \label{eq:inputDem1} -->
<!-- \end{equation} -->

<!-- A.2 -->
<!-- ## Returns to scale and price elasticity of the farm yield envelope \label{sec:A2} -->

<!-- The second order conditions examined above (Equation \ref{eq:eqSOC}) imply that constant returns to scale ($h = 1$) occur at the breakeven point of zero net benefit; and that increasing returns to scale ($h > 1$) minimize net benefit. The only values of $h$ over which the second order condition for maximum net benefit are met are $0 < h < 1$. Therefore, axioms 1 and 2 lead to the corollary that optimal farm yield exhibits strictly decreasing returns to scale. Note that it also follows that the farm yield function is globally concave in inputs only for decreasing returns to scale. Constant and increasing returns, on the other hand, would imply global linearity and convexity, respectively. -->

<!-- Turning to output supply and input demand curves, note that the derivative of logged optimal yield (Equation \ref{eq:YdEnvNeat}) with respect to output price is -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial P} = h \frac{\partial \ln(C^*)}{\partial P} -->
<!-- \end{equation} -->

<!-- Recalling that $C^* = R^* h / \lambda$ (Equation \ref{eq:cStar}), the output price elasticity of farm supply resolves as follows. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial \ln(y^*)}{\partial P} &= h \left( \frac{\partial \ln(y^*)}{\partial P} + \frac{1}{P} \right) \\ -->
<!-- \frac{\partial \ln(y^*)}{\partial P} &= \frac{h}{1 - h} \frac{1}{P} \\ -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(P)} &= \frac{h}{1 - h} -->
<!-- \end{split} -->
<!-- \label{eq:PelastYstar} -->
<!-- \end{equation} -->

<!-- Because returns to scale are strictly decreasing, it follows that farm supply is positively sloped. Moreover, farm supply is elastic for $h \in (1 / 2 , 1)$, inelastic for $h \in (0, 1 / 2)$, and linear when $h = 1 / 2$. Note that increasing returns to scale would imply negatively sloped supply curves. -->
<!-- <!-- first note that the optimal yield function in Equation \ref{eq:YdEnvNeat} can be rewritten in terms of output price $P$ by invoking Equation \ref{eq:cStar} to substitute $R^* h / \lambda$ for $C^*$. --> 
<!-- **-- -->
<!-- A.3 -->
<!-- ## Marginal cost -->
<!-- <!-- ### Marginal cost and unit cost -->
<!-- <!-- Some important/underrepresented corollaries -->
<!-- <!-- Because the C-D fn has fallen into such disrepute, it is worthwhile to take a moment to highlight some attractive corollaries that are underrepresented in the textbook treatments. [and one new one -lipton] -->

<!-- From Equation \ref{eq:YdEnvNeat}, it follows that -->

<!-- \begin{equation} -->
<!-- \frac{d \ln(y^*)}{d \ln(C^*)} = h -->
<!-- \end{equation} -->
<!-- In words, the degree of homogeneity $h$ may also be interpreted as the "scale elasticity of yield"---the fraction by which yield increases given a unit increase in expenditure. (This is a standard result for the Cobb-Douglas form, usually noted in the textbooks [@heathfield1987introduction]). -->
<!-- The farm marginal cost follows from this as -->
<!-- \begin{equation} -->
<!-- \frac{dC^*}{dy^*} = \frac{C^*}{y^* h} -->
<!-- \end{equation} -->

<!-- Which, considering Equation \ref{eq:cStar}, may also be written -->

<!-- \begin{equation} -->
<!-- \frac{dC^*}{dy^*} = \frac{P}{\lambda} -->
<!-- \label{eq:margCost} -->
<!-- \end{equation} -->

<!-- Axioms 1 and 2 thus imply that marginal cost is proportionate, but not equal, to output price. If they were equal, then this would constitute theoretical grounds upon which to presume that every farm has the same marginal cost. And then from there it would be a short jump to presume, as is often done, that a given exogenous shock affects every farm's marginal cost identically. But no, marginal cost varies with $\lambda$. In highly developed economic sectors, it may be that $\lambda$ is effectively determined by the lending rate, and is thus homogeneous across firms; but this is generally not true in the primary sector. In the primary sector, heterogeneous endowments result in heterogeneous valuation of marginal increments in production expenditure (i.e. $\lambda$). -->
<!-- <!-- This may be considered one of the hallmarks of the primary sector setting it apart from other sectors. -->

<!-- The relation between marginal cost and "average cost" (i.e. optimal unit cost) readily follows from Equation \ref{eq:margCost}. -->

<!-- \begin{equation} -->
<!-- \frac{dC^*}{dy^*} = \frac{C^{\#}}{h} \:\:; \:\:\: C^{\#} = C^*/y^* -->
<!-- \end{equation} -->

<!-- The standard assertion that profit-maximizing farms produce such that marginal cost equals average cost thus implies constant returns to scale ($h = 1$), which in turn implies a marginal farm producing for zero profit with a perfectly inelastic farm supply curve that is globally linear in inputs. -->
<!-- Since $P = d R^* / d y^*$, this can be rearranged into another instructive expression for $\lambda$. -->
<!-- constant marginal cost. (As mentioned in the introduction, this is well supported empirically [].) -->
<!-- \begin{equation} -->
<!-- \lambda = \frac{dR^* / dy^*}{dC^* / dy^*} = \frac{dR^*}{dC^*} -->
<!-- \label{eq:lambda2} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial \ln(x^*_i)}{\partial w_i} &= \frac{\partial \ln(C^*)}{\partial w_i} - \frac{1}{w_i} \\ -->
<!-- &= \frac{1}{C^*} \left(x^*_i + \frac{\partial x_i^*}{\partial w_i} w_i \right) - \frac{1}{w_i} \\ -->
<!-- &= \frac{x^*_i}{C^*} \left(1 + \frac{\partial \ln(x_i^*)}{\partial \ln(w_i)} \right) - \frac{1}{w_i} -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Multiplying through by $w_i$, -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x^*_i)}{\partial \ln(w_i)} = \frac{C^*_i}{C^*} \left(1 + \frac{\partial \ln(x_i^*)}{\partial \ln(w_i)} \right) - 1 -->
<!-- \end{equation} -->
<!-- Where $C^*_i$ is the expenditure on input $i$. But note from Equation \ref{eq:inputDem2} that -->
<!-- \begin{equation} -->
<!-- \frac{C^*_i}{C^*} = \frac{\alpha_i}{h} -->
<!-- \end{equation} -->
<!-- This instructive corollary of axioms 1 and 2 says that optimal expenditure shares are equal to their respective technology shares. Substituting the technology share $\alpha_i / h$ for $C^*_i / C^*$ in the previous equation and isolating $\partial \ln(x^*_i) / \partial \ln(w_i)$ gives the expression for input own price elasticity of input demand. -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x^*_i)}{\partial \ln(w_i)} = \alpha_i + \frac{\partial \ln(x_i^*)}{\partial \ln(w_i)} \right) - 1 -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- y^* &= y|_{x_i = x^*_i} = u \frac{k}{E[k]} \prod_{i = 1}^{n_x} \left( \frac{x^*_i}{E[x_i]} \right)^{\alpha_i} \:\:;\:\:\: k = \prod_{i = 1}^{n_k} k_i^{\kappa_i} \\ -->
<!-- &= u \frac{k}{E[k]} \prod_{i = 1}^{n_x} \left( \frac{x^*_i}{E[x_i]} \right)^{\alpha_i} -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- y = u \frac{k}{E[k]} \prod_{i = 1}^{n_x} \left( \frac{x_i}{E[x_i]} \right)^{\alpha_i} \:\:;\:\:\: k = \prod_{i = 1}^{n_k} k_i^{\kappa_i} -->
<!-- \label{eq:cobbDoug3} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- x^*_i = \frac{y^* P \alpha_i}{\lambda w_i} -->
<!-- \label{eq:inputDem1} -->
<!-- \end{equation} -->
<!-- [[By axioms 1 and 2, then we get corrollaries: upward sloping farm supply, downward sloping input demand, concavity in inputs, marginal cost equals P/lambda, MC and Avg cost]] -->
<!-- [[Cost *increases* with tech (h)]] -->
<!-- [[pause and review MC = h/lambda AC basis of the conventional concept and insistence on marginal firms]] -->

<!-- Finally, note also the similarity between Equations \ref{eq:yStarC} and \ref{eq:integrate_lny}. And note that -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial C^*} \sim \frac{1}{C^*} -->
<!-- \end{equation} -->
<!-- Which is congruent to axiom 1. The question arises, then, whether axiom 2 requires axiom status, or whether it is implied by axiom 1. But this is a question for logicians. Pending clarification, it remains an axiom for now. -->
<!-- In the case of cross price demand curves, this implies that all inputs are complements, not substitutes. -->
<!-- \begin{equation} -->
<!-- \theta_x = \prod_i {\alpha_i}^{\alpha_i} \:\:\: \theta_w = \prod_i{w_i}^{\alpha_i} \:\:\:  \theta_k = \prod_i \left( \frac{k_i}{\tilde{k}_i} \right)^{\kappa_i} -->
<!-- \end{equation} -->

A.3
## Proof of Equation \ref{eq:keyResult}

For any lognormally distributed $\chi$, the probability density function $\rho(\chi)$ is defined

\begin{equation}
\rho(\chi) = \frac{1}{\sqrt{2\pi} s_{\chi}} e^{-\frac{(\ln(\chi) - m_{\chi})^2}{2 s^2_{\chi}}} \:\:;\:\:\: m_{\chi} = E[\ln(\chi)] \:\:\: s^2_{\chi} = Var[\ln(\chi)]
\end{equation}

So for a given constant upper bound $\chi \leq \xi$,

\begin{equation}
\int_{0}^{\xi} \chi \rho(\chi) \: d\chi = \frac{1}{\sqrt{2\pi} s_{\chi}} \int_{0}^{P} \chi e^{-\frac{(\ln(\chi) - m_{\chi})^2}{2 s^2_{\chi}}} d \ln(\chi)
\label{eq:proofStep1}
\end{equation}

Introducing a change of variables,

\begin{equation}
\gamma = \frac{\ln(\chi) - m_{\chi}}{s_{\chi}} \: \rightarrow \: d \ln(\chi) = s_{\chi} d \gamma
\end{equation}

Equation \ref{eq:proofStep1} resolves as follows.

\begin{equation}
\begin{split}
\int_{0}^{\xi} \chi \rho(\chi) \: d\chi &= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(\xi) - m_{\chi}}{s_{\chi}}} e^{(\gamma s_{\chi} + m_{\chi}) } e^{-\frac{\gamma^2}{2}} d \gamma \\
&= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(\xi) - m_{\chi}}{s_{\chi}}} e^{-1/2[\gamma^2 - 2 \gamma s_{\chi}  - 2 m_{\chi} ]} d \gamma
\end{split}
\end{equation}

Where the argument of the exponential function resolves as follows,

\begin{equation}
\begin{split}
-1/2[\gamma^2 - 2 m_{\chi}  - 2 \gamma s_{\chi} ]\end{split} \\
&= -1/2 [(\gamma - s_{\chi} )^2 - 2 m_{\chi}  - s^2_{\chi} ^2 ] \\
&= -\frac{(\gamma - s_{\chi} )^2}{2} + m_{\chi}  + \frac{s^2_{\chi}}{2} ^2
\end{split}
\end{equation}

So the integral can be rewritten

\begin{equation}
\begin{split}
\frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(\xi) - m_{\chi}}{s_{\chi}}} e^{-\frac{(\gamma - s_{\chi} )^2}{2} + m_{\chi}  + \frac{s^2_{\chi}}{2} ^2} d \gamma \\
&= \frac{1}{\sqrt{2\pi}} e^{m_{\chi}  + \frac{s^2_{\chi}}{2} ^2} \int_{0}^{\frac{\ln(\xi) - m_{\chi}}{s_{\chi}}} e^{-\frac{(\gamma - s_{\chi} )^2}{2}} d \gamma \\
&= \frac{E[\chi]}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(\xi) - m_{\chi}}{s_{\chi}}} e^{-\frac{(\gamma - s_{\chi} )^2}{2}} d \gamma \\
&= E[\chi] \Phi \left(\frac{\ln(\xi) - m_{\chi}}{s_{\chi}} - s_{\chi}  \right)
\end{split}
\end{equation}

Where $\Phi()$ is the standard normal cumulative distribtion function.

\begin{equation}
\Phi(\ell) = \frac{1}{\sqrt{2\pi}} \int_{0}^{\ell} e^{-\frac{\psi^2}{2}} d \psi
\end{equation}

$\blacksquare$

<!-- (The proof below closely follows that of Hull in the appendix to chapter 13 of his book [-@hull9thEdition].) -->
<!-- For lognormally distributed $C^{\#}$, the probability density function $\rho(C^{\#})$ is defined -->
<!-- \begin{equation} -->
<!-- \rho(C^{\#}) = \frac{1}{\sqrt{2\pi} s_{\#}} e^{-\frac{(\ln(C^{\#}) - m_{\#})^2}{2 s^2_{\#}}} \:\:;\:\:\: m_{\#} = E[\ln(C^{\#})] \:\:\: s^2_{\#} = Var[\ln(C^{\#})] -->
<!-- \end{equation} -->
<!-- So -->
<!-- \begin{equation} -->
<!-- \int_{0}^{P} C^{\# \eta} \rho(C^{\#}) \: dC^{\#} = \frac{1}{\sqrt{2\pi} s_{\#}} \int_{0}^{P} C^{\# \eta} e^{-\frac{(\ln(C^{\#}) - m_{\#})^2}{2 s^2_{\#}}} d \ln(C^{\#}) -->
<!-- \label{eq:integral1} -->
<!-- \end{equation} -->
<!-- Introducing a change of variables, -->
<!-- \begin{equation} -->
<!-- \gamma = \frac{\ln(C^{\#}) - m_{\#}}{s_{\#}} \: \rightarrow \: d \ln(C^{\#}) = s_{\#} d \gamma -->
<!-- \end{equation} -->
<!-- Equation \ref{eq:integral1} resolves as follows. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_{0}^{P} C^{\# \eta} \rho(C^{\#}) \: dC^{\#} &= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{(\gamma s_{\#} + m_{\#})\eta } e^{-\frac{\gamma^2}{2}} d \gamma \\ -->
<!-- &= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-1/2[\gamma^2 - 2 \gamma s_{\#} \eta - 2 m_{\#} \eta]} d \gamma -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Where the argument of the exponential function resolves as follows, -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- -1/2[\gamma^2 - 2 m_{\#} \eta - 2 \gamma s_{\#} \eta]\end{split} \\ -->
<!-- &= -1/2 [(\gamma - s_{\#} \eta)^2 - 2 m_{\#} \eta - s^2_{\#} \eta^2 ] \\ -->
<!-- &= -\frac{(\gamma - s_{\#} \eta)^2}{2} + m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2 -->
<!-- \end{equation} -->
<!-- So the integral can be rewritten -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2} + m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2} d \gamma \\ -->
<!-- &= \frac{1}{\sqrt{2\pi}} e^{m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2}} d \gamma \\ -->
<!-- &= \frac{E[C^{\# \eta}]}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2}} d \gamma \\ -->
<!-- &= \frac{E[C^{\# \eta}]}{\sqrt{2\pi}} \Phi \left(\frac{\ln(P) - m_{\#}}{s_{\#}} - s_{\#} \eta \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Where $\Phi()$ is the standard normal cumulative distribtion function. -->
<!-- \begin{equation} -->
<!-- \Phi(\ell) = \frac{1}{\sqrt{2\pi}} \int_{0}^{\ell} e^{-\frac{\xi^2}{2}} d \xi -->
<!-- \end{equation} -->
<!-- $\blacksquare$ -->

A.5
# Proof that optimal unit cost is a geometric brownian motion with the same parameters as price

If $P(t)$ is a gBm with drift and volatility parameters $m_p$ and $s_p$, and given the relation (Equation \ref{eq:useful3}),

$$
C^{\#}(t) = P(t) \frac{h}{\lambda}
$$

Then Ito's Lemma states

\begin{equation}
\Delta C^{\#} = \left(\frac{\partial C^{\#}}{\partial t} + m_p P(t) \frac{\partial C^{\#}}{\partial P} +  \frac{1}{2} s_p^2 P(t)^2 \frac{\partial^2 C^{\#}}{\partial P^2}  \right) \Delta t + s_p P(t) \partial C^{\#}}{\partial P} \epsilon \sqrt{\Delta t}
\label{eq:itoLem}
\end{equation}

Where $\epsilon$ is a normally distributed random variable with mean $0$ and standard deviation $1$. (For a reference see Hull [-@hull9thEdition].)

By Equation \ref{eq:useful3},

\begin{equation}
\frac{\partial C^{\#}}{\partial t} = 0 \:\:\:\: \frac{\partial C^{\#}}{\partial P} = \frac{C^{\#}}{P} \:\:\:\: \frac{\partial^2 C^{\#}}{\partial P^2} = 0
\end{equation}

Such that Equation \ref{eq:itoLem} resolves to

\begin{equation}
\Delta C^{\#} = m_p C^{\#} \Delta t + s_p C^{\#} \epsilon \sqrt{\Delta t}
\end{equation}

By which it follows that $C^{\#}$ has the same drift and volatility parameters as $P(t)$.

\begin{equation}
\begin{split}
E[C^{\#} / C^{\#}] &= m_p \Delta t \\
Var[C^{\#}(T)] &= s^2_p \Delta t
\end{split}
\end{equation}

And thus

\begin{equation}
\begin{split}
E[\ln(C^{\#}(T))]\bigr|_{t = 0} &= \ln(C^{\#}(0)) + \left(m_p - \frac{s^2_p}{2} \right) T \\
Var[\ln(C^{\#}(T))]\bigr|_{t = 0} &= s^2_p T
\end{split}
\end{equation}

$\blacksquare$

# Appendix B: Data details and preparation

The raw Kenya farm data files used in this article are open access and available from Tegemeo Institute upon request. The files detail short and long rains maize production (and that of any other crops grown), farm size, input (seed, synthetic and organic fertilizer, chemical pest control) use and cost, land tenure type, and land preparation type and cost, for the years 1997, 2000, 2004, 2007, and 2010. For the present article, only the 2007 long rains (i.e. main season) data is used. Data on production, area, seed, fertilizer, land preparation, and tenure are provided at field level. Fields where maize is not grown or is not the main crop are dropped. Green and dry maize production are reported separately. Green maize production is converted to dry maize equivalent by subtracting 15% of the production weight. The field level input and production files are then merged and aggregated up to farm level. Farm yield is then calculated as maize production (kg.) divided by maize area (acres). Chemical input use and cost are reported at farm level, indicating the main crop on the farm to which the input is applied. Chemical pest controls are counted as costs only if applied primarily to maize. Synthetic fertilizer consists of calcium ammonium nitrate (CAN), nitrogen phosphorus potassium (NPK), Urea, and diammonium phosphate (DAP). Different mixtures under these headings (e.g. NPK 22:11:11, NPK 18:12:12, NPK 17:17:0, etc.) are aggregated. Farm level cost is then calculated as the sum of seed, fertilizer, chemical pest control, and land preparation costs in Kenyan Shillings per acre (KES/acre).
<!-- This is then merged with the main farm level file.  -->

Land preparation type (manual, oxen, tractor, or none) and land tenure type (owned by parent/relative, owned with title deed, owned without title deed, rented) are reported at field level. Dummy variables are created for land preparation types "oxen" and "tractor", and for the land tenure type "owned with title deed". When aggregating to farm level, the land preparation dummies are preserved if present on any field.

The field level data files also include details on seed type and method of acquisition. For this article, farms are considered adopters of hybrid maize seed if they use either purchased hybrid seed or a mixture of retained and purchased hybrid maize seed on any of their fields.

Main season rainfall is reported in millimeters at district level. (Prior to the 2010 constitution, counties were referred to as "districts".) The "rain anomaly" variable appearing in the regression is calculated as 2007 main season rainfall divided by 1997 main season rainfall. Rain anomaly values greater or less than $1$ thus indicate departures north or south of the 1997 benchmark.
<!--main07 This file, originally generated by Tavneet Suri, contains 2007 and historic average main season rainfall reported by the FEWS National Weather Service Climate Prediction Center, georeferenced to the 2007 TAMPA/TAPRA survey. -->

```{r Fig7, fig.show = "hold", fig.width = 4, fig.height=4, fig.align="left", fig.cap="\\label{fig:sumStats}Summary statistics for the 2007 Kenya long rains farm level maize data.", echo = FALSE}
# dfLook <- dfMod3 %>% select(`Landprep: oxen`, `Landprep: tractor`) %>%
#   summarise_all(list(mean = "mean", sd = "sd"))
gatherCols <- colnames(dfMod3)[-1]
dfPlot <- dfMod3[, -1] %>% gather_("var", "val", gatherCols)
dumVars <- c("Tenure: owned with title deed", "Landprep: oxen", "Landprep: tractor", "Adopter")
ind <- which(!(dfPlot$var %in% dumVars))
dfPlot$val[ind] <- exp(dfPlot$val[ind])
dfPlot$var[-ind] <- paste(dfPlot$var[-ind], "(dummy)")
dfPlot <- dfPlot %>% group_by(var) %>%
  summarize_all(list(N = "length",
                     Mean = "mean",
                     `Stand. dev.` = "sd",
                     Max = "max",
                     Min = "min")) %>%
  mutate(across(!var, round, 3))
dfPlot <- dfPlot %>% gather(stat, val, N:Min)
gg <- ggplot(dfPlot, aes(x = stat, y = var))
gg <- gg + geom_tile(alpha = 0)
gg <- gg + geom_text(aes(label = val), size = labelSize) +
  scale_x_discrete(limits = c("N", "Mean", "Stand. dev.", "Max", "Min"), position = "top") +
  theme_classic() +
  theme(axis.title = element_blank(),
        axis.text = element_text(size = axisTextSize))#,
        #plot.title = element_text(size = plotTitleSize),
        #strip.text = element_text(size = facetTitleSize))

# thisFile <- "Kenya 2007 maize summary statistics.png"
# thisFilepath <- paste0(outFolder, thisFile)
# ggsave(thisFilepath, height = 2, width = 7)


```

# Appendix C: Derivation of the technology adoption condition in Equation \ref{eq:adoptCond}

The farm profit lagrangian in Equation \ref{eq:lagrangian} evaluated at $y^*$ gives the farm profit envelope.

\begin{equation}
\mathcal{L}^* = R^* + \lambda (B - C^*)
\end{equation}

By Equation \ref{eq:cStar}, this reduces to

\begin{equation}
\mathcal{L}^* = R^* (1 - h) + \lambda B
\end{equation}

Assuming that farms will adopt a new yield scaling technology only if they expect it to increase their net benefit, the adoption condition is $\partial \mathcal{L}^*/\partial \ln(g) > 0$. That is,

\begin{equation}
\frac{\partial \mathcal{L}}{\partial \ln(g)} = E[R^*(T)]|_{t = 0} (1 - h) \left( \frac{\partial \ln(P)}{\partial u} + \frac{\partial \ln(y^*)}{\partial u} \right) + \lambda \frac{\partial B}{\partial u} > 0
\end{equation}

The yield derivative resolves by substituting $P y^* h/\lambda$ for $C^*$ in Equation \ref{eq:YdEnvNeat0} and differentiating with repect to $\ln(g)$.

\begin{equation}
\begin{split}
\frac{\partial \ln(y^*)}{\partial \ln(g)} &= 1 - \mathbf{\alpha} {'} \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} + h \frac{\partial \ln(y^*)}{\partial \ln(g)} \\
&\rightarrow \frac{\partial \ln(y^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \mathbf{\alpha} {'} \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right)
\end{split}
\end{equation}

Substituting this into the adoption condition and simplifying,

\begin{equation}
\frac{\partial \mathcal{L}}{\partial \ln(g)} = \frac{1 - \mathbf{\alpha} {'} \frac{\partial \ln(\mathbf{w})}{\partial u}} + \partial \ln(P)}{\partial \ln(g)} \right) + \frac{\lambda}{R^*} \frac{\partial B}{\partial u} > 0
\end{equation}

Which further reduces to

\begin{equation}
\partial \ln(P) - \mathbf{\alpha} {'} \partial \ln(\mathbf{w}) + \partial \ln(g)  + \frac{\lambda}{R^*} \partial B > 0
\end{equation}

Or, substituting $h / C^*$ for $\lambda / R^*$,

\begin{equation}
\partial \ln(P) - \mathbf{\alpha} {'} \partial \ln(\mathbf{w}) + \partial \ln(g)  + \frac{h}{C^*} \partial B > 0
\end{equation}

And, in stochastic terms,

\begin{equation}
\partial \ln(E[P(T)]|_{t = 0}) - \mathbf{\alpha} {'} \partial \ln(\mathbf{w}) + \partial \ln(g)  + \frac{h}{C^*} \partial B > 0
\end{equation}

\blacksquare

<!-- #==================================================================================== -->
<!-- #==================================================================================== -->
<!-- #==================================================================================== -->
<!-- #==================================================================================== -->
<!-- # Scraps -->
<!-- #==================================================================================== -->
<!-- #==================================================================================== -->
<!-- qwetpre is a climate model projection of rainfall during the rainiest three consecutive months of the year, i.e., the main rains season. It provides a benchmark based on which to measure how far actual rainfall diverges from expectation. -->
<!-- The files also include a wealth of other information not made use of in this article (tribal affiliation, ). -->
<!-- DAP (NPK, CAN, UREA?) application in line with recommended level of 50kg/acre -->
<!-- farm size refers to maize fields only, excludes fields that are fallow or where other crops are grown -->
<!-- 121 crops grown in the survey area, by far maize and beans, often intercropped together. Only farms reporting maize as their main crop are included for the present exercise. Only farms yd > 1kg/acre and cost > 0. [inappendix: yield from croplev07.dta, field07.dta, fert07.dta, labour07.dta, input07.dta (P&D control inputs) files, tampa_rain_96_07.dta (main07), climate.dta (qwetpre), main season only,  Adopter if purchased or retained hybrid maize seed.] -->
<!-- The survey reports 28 different types of organic and synthetic fertilizer types in use, only a small subset of which is applied in significant quantities: CAN, NPK, DAP, UREA, and manure. For the present exercise, different mixture ratios within any one of these main fertilizer categories (e.g., NPK (23:23:0) and NPK (18:12:12)) are aggregated. Pest and disease control chemical use (pesticide, insecticide, herbicide, fungicide) is similarly aggregated up to a single "P&D control chemical" variable. Reported in different units, harmonized to kg. Input prices are then calculated as the aggregate cost divided by the aggregate quantities. Rain anomaly is actual rainfall divided by the qwetpre -->
<!-- , must be used in accordance with the provisions of the Tegemeo data policy. -->
<!-- adult equivalent household size  -->
<!-- tribal affiliation, gender of head of household, cell phone use, distance to market or nearest road, etc., but  -->
<!-- Graphics: -->
<!-- main ferttypes used, fert kg/acre in line with recommendations, urea, manure -->
<!-- likewise pesticide/herbicide/fungicide -->
<!-- Farm size -->
<!-- Input and output prices vary considerably across districts. -->
<!-- Wage differs considerably by activity and district -->
<!-- Labor type breakdown who labors where -->
<!-- binary endowment barchart -->
<!-- Characterization of the data -- predominant ferttypes, price variation across districts, binary endowments -->
<!-- Descriptive graphics [yield/qty histogram, dist level chem input prices and wage, family labor, rain anomaly, cost per acre] are presented in figure .... More detailed summary statistics breakdown in appendix. -->
<!-- seed kg/acre not an input but a control variable representing planting density, which is a management decision/constraint -->
<!-- field level aggregated up to farm level -->
<!-- after estimation -- lambda rational farms -->
<!-- constant $\tilde{y}$ is not the same for all farms, but varies depending upon how many binary endowments the farm has -->
<!-- alternative model estimation included in appendix + some validation exercises -- tech share = cost share, implicit family wage -->
<!-- Maize growing farms in 20 sub-counties (known as "districts" at the time of the survey) covering the main agricultural zones. [hired labor wage is given in KES/day, this is converted to a nominal hourly wage by dividing by 8.] -->
<!-- Covers 18 labor activities, 16 excluding security and irrigation. wage varies considerably by activity and district. Main activities are 1st weeding, harvesting, planting, 1st ploughing, 2nd weeding, shelling, stooking -->

<!-- # ```{r} -->
<!-- # Descriptive graphics -->
<!-- dfLook <- dfMod3 -->
<!-- gatherCols <- colnames(dfLook)[-1] -->
<!-- dfLook <- dfLook %>% gather_("var", "val", gatherCols) -->
<!-- # Control vars -->
<!-- controlVarsVec <- c("Seed (kg/acre)", "Adult equivalent household size", "Rain anomaly", "Cost/acre", "Farm size (acres)") #"Child family labor, planting (person-hrs/acre)" -->
<!-- dfPlot <- dfLook %>% subset(var == "Yield (kg/acre)") -->
<!-- dfPlot$val <- exp(dfPlot$val) -->
<!-- ggYd <- ggplot(dfPlot, aes(x = val)) + -->
<!--   geom_histogram(color = "black", fill = "white", bins = 25) + -->
<!--   facet_wrap(~var, scales = "free") + theme_bw() + -->
<!--   theme(axis.title = element_blank(), -->
<!--         #axis.title.y = element_text(size = axisTitleSize), -->
<!--         axis.text = element_text(size = axisTextSize), -->
<!--         strip.background = element_blank(), -->
<!--         strip.text = element_text(size = facetTitleSize)) -->
<!-- dfPlot <- dfLook %>% subset(var %in% controlVarsVec & val > 0) -->
<!-- dfPlot$val <- exp(dfPlot$val) -->
<!-- u <- dfPlot$var; dfPlot$var[grep("Adult equivalent", u)] <- "Adult equivalent\nhousehold size" -->
<!-- #u <- dfPlot$var; dfPlot$var[grep("Child family", u)] <- "Child fam lab, planting\n (pers-hrs/acre)" -->
<!-- ggIndepVars <- ggplot(dfPlot, aes(x = val)) + -->
<!--   geom_histogram(color = "black", fill = "white", bins = 26) + -->
<!--   facet_wrap(~var, scales = "free") + theme_bw() + -->
<!--   theme(axis.title.x = element_blank(), -->
<!--         #axis.title.y = element_text(size = axisTitleSize), -->
<!--         axis.text = element_text(size = axisTextSize), -->
<!--         strip.background = element_blank(), -->
<!--         strip.text = element_text(size = facetTitleSize - 1)) -->
<!-- ggIndepVars + ggYd + plot_layout(widths = c(2, 2)) -->
<!-- # # Input/output prices -->
<!-- # dfPlot <- dfLook %>% subset(var %in% priceVars & val > 0) %>% rename(`KES/kg` = val) -->
<!-- # dfPlot$var <- gsub(" \\(KES/kg\\)", "", dfPlot$var) -->
<!-- # ggInputPrices <- ggplot(dfPlot, aes(y = `KES/kg`)) + -->
<!-- #   geom_histogram(color = "black", fill = "white") + -->
<!-- #   facet_wrap(~var, scales = "free_y") + theme_bw() + -->
<!-- #   theme(axis.text = element_text(size = axisTextSize), -->
<!-- #         strip.background = element_blank(), -->
<!-- #         strip.text = element_text(size = facetTitleSize)) -->
<!-- # dfPlot <- dfLook %>% subset(var == "Maize price (KES/kg)") %>% -->
<!-- #   group_by(Dist) %>% summarise(val = mean(val)) %>% -->
<!-- #   rename(`KES/kg` = val) %>% mutate(var = "Maize price") -->
<!-- # dfPlot$var <- gsub(" \\(KES/kg\\)", "", dfPlot$var) -->
<!-- ggMaizePrice <- ggplot(dfPlot, aes(x = `KES/kg`, y = Dist)) + -->
<!--   geom_bar(stat = "identity", color = "black", fill = "white") + -->
<!--     facet_wrap(~var, scales = "free_y") + theme_bw() + -->
<!--   theme(axis.title.y = element_blank(), -->
<!--         axis.text = element_text(size = axisTextSize), -->
<!--         strip.background = element_blank(), -->
<!--         strip.text = element_text(size = facetTitleSize)) -->
<!-- #ggInputPrices + ggMaizePrice + plot_layout(widths = c(2, 1)) -->
<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- ``` -->
<!-- <!-- this can be rewritten -->
<!-- <!-- \begin{equation} -->
<!-- <!-- \int_0^{h^{-\theta}} \lambda^{-\theta} f(\lambda^{-\theta}) \: d \lambda^{-\theta} = h^{-\theta} E[E[b(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln \left(\frac{1}{E[E[b(T)]\bigr|_{t = 0}^{-\theta}]} \right) - \theta^2 \frac{\omega^2}{2}}{\theta \omega} \right) -->
<!-- <!-- \label{eq:refEq} -->
<!-- <!-- \end{equation} -->
<!-- <!-- Where $\omega^2 = Var[\ln(E[b(T)]\bigr|_{t = 0})]$. -->
<!--  Equation \ref{eq:refEq} may now be rewritten -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{h^{-\theta}} \lambda^{-\theta} f(\lambda^{-\theta}) \: d \lambda^{-\theta} &= h^{-\theta} E[\mu_b(T)^{-\theta}]\bigr|_{t = 0} \Phi \left(\frac{\ln \left(\frac{1}{E[\mu_b(T)]\bigr|_{t = 0}^{-\theta}} \right) - \theta^2 \frac{s_{\mu}^2}{2} T}{\theta s_{\mu} T} \right) \\ -->
<!-- &= h^{-\theta} \mu_b(0)^{-\theta} e^{-\theta m_{\mu} T} \Phi \left(\frac{\ln \left(\frac{1}{\mu_b(0)^{-\theta}} \right) - \theta m_{\mu}T - \theta^2 \frac{s_{\mu}^2}{2} T}{\theta s_{\mu} T} \right) \\ -->
<!-- &= h^{-\theta} \mu_b(0)^{-\theta} e^{-\theta m_{\mu} T} \Phi \left( -\frac{\ln \left(\frac{1}{\mu_b(0)^{-\theta}} \right) - \left(\theta m_{\mu} - \theta^2 \frac{s_{\mu}^2}{2}\right) T}{\theta s_{\mu} T} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- The mean and variance of the log fractional change (or "return") of $\mu_b(t)$ over period $T$, meanwhile, are -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E \left[ \ln \left( \frac{\mu_b(T)}{\mu_b(0)} \right) \right] &= \left(m_{\mu} - \frac{s_{Eb}^2}{2} \right) T \\ -->
<!-- Var \left[ \ln \left( \frac{\mu_b(T)}{\mu_b(0)} \right) \right] &= Var[\ln(\mu_b(T))]\bigr|_{t = 0} = s_{\mu}^2 T -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- By which it follows that the -->
<!-- Taking logs and factoring out $\ln (P y^*/\lambda)$, -->
<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + \ln \left(\frac{P y^*}{\lambda} \right) \sum_i \alpha_i + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i) -->
<!-- \end{equation} -->

<!-- But note that, by Euler's homogenous function theorem, -->

<!-- \begin{equation} -->
<!-- \sum_i \alpha_i = h -->
<!-- \end{equation} -->

<!-- where $h$ is the degree of homogeneity of $y$. -->

<!-- \begin{equation} -->
<!-- y^* =  \left(y_0 \left(\frac{P}{\lambda}\right)^h \prod_i \left(\frac{\alpha_i}{w_i}\right)^{\alpha_i} \prod_i k_i^{\kappa_i} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:YdEnv1} -->
<!-- \end{equation} -->





<!-- The Lagrangian is then -->

<!-- \begin{equation} -->
<!-- \mathcal{L} = Py - \lambda (C - B) -->
<!-- \end{equation} -->

<!-- Where $\lambda$ is the farm budget shadow price, that is, the marginal benefit to the farm of a marginal increase in budget. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \mathcal{L}}{\partial B} = \lambda -->
<!-- \end{equation} -->

<!-- The first order conditions for a maximum work out to: -->

<!-- \begin{equation} -->
<!-- \nabla_{\mathbf{x}} \mathcal{L} = Py D(\mathbf{x})^{-1} \boldsymbol{\alpha} - \lambda \mathbf{x} = \mathbf{0} -->
<!-- \label{eq:eqFOC} -->
<!-- \end{equation} -->

<!-- Where the $\mathbf{0}$ indicates a vector of zeroes equal to the length of $\mathbf{x}$. This is then solved for the optimal input levels $\mathbf{x}^*$. -->

<!-- \begin{equation} -->
<!-- \mathbf{x}^* = P y^* / \lambda D(\mathbf{w})^{-1} \boldsymbol{\alpha} -->
<!-- \end{equation} -->

<!-- Or, alternatively, -->

<!-- \begin{equation} -->
<!-- x_v^* = \frac{P y^* \alpha_v}{\lambda w_v} -->
<!-- \label{eq:inputDem1} -->
<!-- \end{equation} -->

<!-- The optimal yield, or yield envelope, or economic yield, $y^*$ is then found by evaluating $y$ at $\mathbf{x}^*$. -->

<!-- \begin{equation} -->
<!-- y^* = y(\mathbf{x}^*; y_0, \boldsymbol{\alpha}, \mathbf{k}, \boldsymbol{\kappa}) = y_0 \prod_i \left(\frac{P y^* \alpha_i}{\lambda w_i} \right)^{\alpha_i} \prod_i k_i^{\kappa_i} -->
<!-- \end{equation} -->

<!-- Taking logs and factoring out $\ln (P y^*/\lambda)$, -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + \ln \left(\frac{P y^*}{\lambda} \right) \sum_i \alpha_i + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i)  -->
<!-- \end{equation} -->

<!-- But note that, by Euler's homogenous function theorem, -->

<!-- \begin{equation} -->
<!-- \sum_i \alpha_i = h -->
<!-- \end{equation} -->

<!-- where $h$ is the degree of homogeneity of $y$. Hence the previous equation can be rewritten -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + h \ln \left(\frac{P y^*}{\lambda} \right) + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i)  -->
<!-- \label{eq:eulerInvokd} -->
<!-- \end{equation} -->

<!-- Solving for $\ln(y^*)$, -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \frac{1}{1 - h} \left(\alpha_0 + h \ln \left(\frac{P}{\lambda} \right) + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i) \right) -->
<!-- \end{equation} -->

<!-- And taking the exponential function of this then gives the yield envelope. -->

<!-- \begin{equation} -->
<!-- y^* =  \left(y_0 \left(\frac{P}{\lambda}\right)^h \prod_i \left(\frac{\alpha_i}{w_i}\right)^{\alpha_i} \prod_i k_i^{\kappa_i} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:YdEnv1} -->
<!-- \end{equation} -->

<!-- Economic yield is thus a function of: -->

<!-- 1) Input prices $\mathbf{w}$ -->

<!-- 2) The output price $P$ -->

<!-- 3) The input elasticities of yield $\boldsymbol{\alpha}$ (i.e. the technology) -->

<!-- 4) The control variables $\mathbf{k}$ -->

<!-- 5) Their control variable elasticities of yield $\boldsymbol{\kappa}$ -->

<!-- 6) The farm budget shadow price $\lambda$ -->
<!-- The steps followed above more or less align with the standard derivation of the Cobb-Douglas yield envelope found in textbooks , with the important exception of the invocation of Euler's homogeneous function theorem in equation \ref{eq:eulerInvokd}. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(w_i)} = \frac{-\alpha_v}{1 - h} -->
<!-- \end{equation} -->

<!-- With domain -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(w_v)} \in (-\infty, -\alpha_v) -->
<!-- \end{equation} -->

<!-- The yield envelope derived in equation \ref{eq:YdEnvCompact} implies that the farm supply curve^["Farm supply curve" is used as a shorthand for the "yield envelope as a function of price $P$, with all other variables held constant".] is a power law---or, in economics jargon, a constant elasticity of supply curve. This becomes more evident if the yield envelope is rewritten in the following compact form. -->

<!-- \begin{equation} -->
<!-- y^* = t_S P^{\eta(P, y^*)} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- t_S = \left(y_0 \frac{\theta_x \theta_k}{\lambda^h \theta_w} \right)^{\frac{1}{1 - h}} -->
<!-- \end{equation} -->

<!-- And $\eta(P, y^*)$ is the price elasticity of yield defined in equation \ref{eq:PelastYstar}. -->

<!-- <!-- Both the scale parameter $t$ and exponent $\eta(P, y^*)$ depend critically upon the degree of homogeneity. -->
<!-- The output price elasticity of yield implies that the farm supply curve is elastic for $h \in (1 / 2 , 1)$, and inelastic for $h \in (0, 1 / 2)$, and linear with slope $t_S \bigr|_{h = 1 / 2}$ when $h = 1 / 2$. -->

<!-- This is important information. This means that (insofar as Axioms 1-3 are true) for a given increase in output price, the supply response in a population of farms with inefficient input elasticities (such that $h < 1 / 2$) will be less than proportionate to the increase in price. In a population of relatively input-efficient farms (such that $h > 1 / 2$), on the other hand, the supply response will be more than proportionate to the increase in price. -->

<!-- The farm supply curve approaches perfect inelasticity as $h$ approaches $0$, and approaches (but never reaches) perfect elasticity as $h$ approaches $1$. The scale factor $t_S$ approaches $0$ as $h$ approaches $0$, and tends toward infinity as $h$ approaches $1$. -->

<!-- ## The degree of homogeneity and output price elasticity of yield \label{sec:degHomog} -->

<!-- [The costStar^h  formulation of yield envelope] -->

<!-- [Put "certain useful elasticities/expressions" here maybe] -->

<!-- By invoking Euler's theorem in the derivation of the yield envelope above, the yield degree of homogeneity $h$ is made explicit in the yield envelope; and this lays bare some interesting critical properties. Note, first of all, that the yield envelope is undefined at $h = 1$. The theory constructed so far from Axioms 1 and 2 thus contradicts the deeply entrenched surmise among economists, going back at least to Hicks [-@hicks1963theory], and later cemented into place by Solow [-@solow1957technical], that yield functions are homogeneous of degree 1. -->

<!-- In section \ref{sec:PDfunP}, circumstances are explored under which increasing returns to scale are possible. However, these circumstances generally apply to firms---mills and factories, for example---and not to farms. -->

<!-- The domain of $h$ derived above in turn implies the following bounds on the price elasticity of yield. -->
<!-- <!-- Note, in passing, that the input price elasticity of yield likewise bears the expected sign only under decreasing returns to scale. -->

<!-- ## Input demand \label{sec:inDem} -->

<!-- Using equation \ref{eq:YdEnvCompact} to substitute for $y^*$ in input demand (equation \ref{eq:inputDem1}) gives the following expression for input demand as a function of basal yield, prices, input elasticities, the budget shadow price, and control variables together with their respective elasticities. -->

<!-- \begin{equation} -->
<!-- x_v^* = \frac{\alpha_v}{w_v} \left( y_0 \frac{P \theta_x \theta_k}{\lambda \theta_w} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:inputDem2} -->
<!-- \end{equation} -->

<!-- Note that input demand, like optimal yield, is undefined at $h = 1$. The own price elasticity of input demand is -->


<!-- Here another Axiom comes into play. -->

<!-- \begin{framed} -->
<!--    \textbf{Axiom 4} \\ Demand curves are negatively sloped. $\left( \frac{\partial \ln(x_v^*)}{\partial \ln(w_v)} < 0 \:\: \forall v \right)$ -->
<!-- \end{framed} -->

<!-- From equation \ref{eq:ownPriceElas}, it is clear that Axiom 4 imposes the following domain on $h$. -->

<!-- \begin{equation} -->
<!-- h \in (-\infty, 1 + \underline{\alpha}) \:\:; \:\:\: \underline{\alpha} = \min(\boldsymbol{\alpha}) -->
<!-- \end{equation} -->

<!-- Considering that $\underline{\alpha} > 0$, the effective domain of $h$ satisfying both Axioms 3 and 4 (upward sloping supply curves and downward sloping demand curves) is -->

<!-- \begin{equation} -->
<!-- h \in (0, 1) -->
<!-- \end{equation} -->

<!-- The effective domain of $h$ in turn implies the following bounds on the own price elasticity of input demand. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x_v^*)}{\partial \ln(w_v)} \in (\infty, -1) -->
<!-- \end{equation} -->

<!-- The input demand curve is thus always elastic, such that the increase in farm level demand resulting from a decrease in the input price is always more than proportionate to the fall in price. -->

<!-- Note that the cross price elasticity of input demand also bears the expected sign under the effective domain of $h$, -->


<!-- As does the output price elasticity of input demand, -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x_v^*)}{\partial \ln(P)} = \frac{1}{1 - h} -->
<!-- \end{equation} -->

<!-- Equation \ref{eq:inputDem2} implies that the input demand curve^["Input demand curve" is used as a shorthand for the "optimal input level as a function of its price, with all other variables held constant".] is a power law. This is more evident when expressed in the following compact form. -->

<!-- \begin{equation} -->
<!-- x_v^* = z w_v^{\eta(w_v, x_v^*)} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- z = \left(y_0 \frac{\theta_x \theta_k}{\lambda^h \tilde{\theta}_w} \right)^{\frac{1}{1 - h}} \:\:;\:\:\: \tilde{\theta}_w = w_v^{-\alpha_v}\theta_w -->
<!-- \end{equation} -->

<!-- And $\eta(w_v, x_v^*)$ is the own price elasticity of input demand, derived in equation \ref{eq:ownPriceElas}. -->

<!-- In equation \ref{eq:cobbDoug2}, the shorthand $y_0 = e^{\alpha_0}$ has also been introduced. The scale factor $y_0$ is the yield when inputs $\mathbf{x}$ are set to 1 and the control variables $\mathbf{k}$ are also set to 1. It may thus be interpreted as the "unit input yield" or "unit input ceteris paribus yield", to be more precise. "Basal yield" is henceforth used as a shorthand. -->
<!-- Many economists prefer to call $y_0$ the "total factor productivity" (TFP). This is because $y_0$ equals, in some sense, the "yield per unit all inputs" when it is isolated on one side of the equation. However, the presence of control variables complicates this interpretation. Moreover, TFP implies bizarre and rather useless units of measurement. For example, if the inputs $x_i$ are labor and pesticide, while the control variables $k_i$ are rainfall, temperature, and farmer age, then the TFP $y_0$ has units of kg hectare$^{-1}$ manhour$^{-1}$ liter$^{-1}$ millimeter$^{-1}$ degree Celsius$^{-1}$ years$^{-1}$, each of which is raised to various exponents (the respective elasticities $\alpha_i$ and $\kappa_i$). Because of the exponents, a more accurate name for TFP would be the "technology adjusted total factor productivity". -->
<!-- Nonetheless, a very mature literature has developed around TFP, and the reader is encouraged to continue thinking of $y_0$ in terms of TFP if that is what they are most comfortable with. The "basal yield" interpretation is merely provided here as an alternative for those of us who wrestle with the idea of TFP or are not yet familiar with it. -->
<!-- exogenously given control variables like age, soil quality, or climate variables. -->
<!-- TFP vis--vis dimensional analysis -->
<!-- The (in)famous residual -->
<!-- The rate of growth of total factor productivity is defined as the difference between the rate of growth of real product and the rate of growth of real factor input (Jorgenson & Griliches, 1967). This definition violates dimensional analysis. -->
<!-- Given a yield function -->
<!-- y=Kx_1^(_1 ) x_2^(_2 )x_n^(_n )	(1) -->
<!-- "TFP"=K=y/(x_1^(_1 ) x_2^(_2 )x_n^(_n ) )	(2) -->
<!-- There are two problems with this expression from the point of view of dimensional analysis. First of all, the units in which TFP is expressed are impossible to make sense of. Say n=4, with x_1 standing for labor, x_2 for machinery, x_3 for fertilizer, and x_4 for pesticide. Then TFP has units of production per unit -->
<!-- area (man hour)^(_1 ) (machine hour)^(_2 )  (weight)^(_3 )  (volume)^(_4 )	(3) -->
<!-- The second, more serious, problem is that these units will always vary from one data set to another. Even if the variables x_1,x_2,,x_n are the same across studies, and are expressed in the same units, the units in which the residual K is expressed will nonetheless vary because the estimated parameters _i vary. It is therefore impossible to make meaningful comparisons of K across data sets. -->
<!-- On the other hand, it is possible to make meaningful comparisons of the residual in another sense. Define the parameter K as follows: -->
<!-- K=k/(x _1^(_1 ) x _2^(_2 )x _n^(_n ) )	(3) -->
<!-- Where the x _i are arbitrarily chosen reference values. Then the yield equation becomes: -->
<!-- y=ku_1^(_1 ) u_2^(_2 ) u_n^(_n )  ;  u_i=x_i/x _i 	(3) -->
<!-- It now becomes clear what the units of k are. Each x _i has the same units as its respective x_i. This means that all of the u_i^(_i ) terms on the right hand side of the equation are dimensionless. Therefore, the units of k must agree with the units of whatever is on the left hand side, which happens to be yield.  -->
<!-- k=y/(u_1^(_1 ) u_2^(_2 ) u_n^(_n ) )	(5) -->
<!-- When interpreted in this way, it is now possible to make meaningful comparisons of the residual across data sets (if the reference values x _i are harmonized across the data sets). However, the residual now has units of productivity with respect to land only, and not with respect to any other factor, much less the total factor. -->
<!-- Conclusion -->
<!-- Above I have shown that TFP (equation 2) is measured in units which 1) are virtually impossible to make sense of, and 2) cannot be compared across data sets. I have shown that it is possible to express the residual in straightforward units that are comparable across data sets, but that these are units of land productivity only. The residual may be interpreted as TFP only at the cost of nonsensical units and cross-study incompatibility. A residual with sensible units and comparability, on the other hand, comes at the cost of expressibility only in units of a single factors productivityland in the case of farms, widget factories in the case of firms. -->
<!-- As mentioned above, this result depends on a definition of small increase as a marginal increase. Other forms result from other definitions of small increase. If small increase is defined as a percentage increase, for example, a functional form involving Lambert's W function results (left as an exercise for the reader). The Cobb-Douglas function is selected from among these two choices on empirical grounds. (The Cobb-Douglas function is famous for how well it fits economic data across many contexts and scales.) -->
<!-- [# Derivation of the yield envelope from Axiom 2 (net benefit maximization)] -->



<!-- ## The farm net benefit envelope -->

<!-- The optimized objective function or "net benefit envelope" $\mathcal{L}^*$ is just the objective function $\mathcal{L}$ evaluated at the optimal yield $y^*$. -->

<!-- \begin{equation} -->
<!-- \mathcal{L}^* = \mathcal{L} \bigr|_{y = y^*} = P y^* - \lambda (C^* - B) -->
<!-- \end{equation} -->

<!-- Note that, applying the handy relation in equation \ref{eq:lambdaHandy}, the net benefit envelope can be rewritten without the optimal expenditure term $C^*$. -->

<!-- \begin{equation} -->
<!-- \mathcal{L}^* = (1 - h) P y^* + \lambda B -->
<!-- \label{eq:NBenv} -->
<!-- \end{equation} -->

<!-- Farm production $q^*$ is, of course, just farm yield envelope times farm area. Often, area is one of the control variables in $\theta_k$. In this case, $q^*$ is given by adding $1$ to the fitted exponent (call this $\kappa_a$) on area. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- q^* &= A y^* \\ -->
<!-- &= y_0 \hat{\theta}^{\eta(D)} \left(\frac{E[P(T)]\bigr|_{t = 0}}{\lambda}\right)^{\eta(E[P(T)]\bigr|_{t = 0})} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \hat{\theta} &= \frac{\theta_x \hat{\theta_k}}{\theta_w} \\ -->
<!-- \hat{\theta_k} &= A \theta_k = A^{\kappa_a + 1} \prod_{i \neq a}^{n_k} k_i^{\kappa_i} -->
<!-- \end{split} -->
<!-- \end{equation} -->


<!-- \begin{equation} -->
<!-- \int_{0}^{h^{-\eta(P)}} \lambda^{-\eta(P)} f(\lambda^{-\eta(P)}) \: d \lambda^{-\eta(P)} = E[\lambda^{-\eta(P)}] (1 - \Phi(z)) -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- z = \frac{\ln\left( \left( \frac{\mu_{C^{\#}}(0)}{P(0)} \right)^{\eta(D)} \right) - \left(\eta(D) m_{\lambda} - \eta(D)^2 \frac{s_{\lambda}^2}{2} \right)T}{s_{\lambda} \sqrt{T}} -->
<!-- \end{equation} -->

<!-- The term $1 - \Phi(z)$ may thus be interpreted as the probability, at planting time, that the elasticity adjusted output price at time of harvest and sale $P(T)^{\eta(P)}$ will be greater than the corresponding elasticity adjusted mean marginal cost of production $\mu_{C^{\#}}(T)^{\eta(D)}$. -->

<!-- \begin{equation} -->
<!-- 1 - \Phi(z) = \text{Prob}(P(T)^{\eta(D)} > \mu_{C^{\#}}(T)^{\eta(D)}) -->
<!-- \end{equation} -->

<!-- The effect of $\eta(D)$ in this equation is to regulate the rate at which the condition $P(T)^{\eta(D)} > \mu_{C^{\#}}(T)^{\eta(D)}$ is met (or fails) with changes in either $P(T)$ or $\mu_{C^{\#}}(T)$. To see this, it may be helpful to rewrite the condition in terms of a "marginal benefit-cost" ratio $r$. -->
<!-- \begin{equation} -->
<!-- 1 - \Phi(z) = \text{Prob}(r^{\eta(D)} > 1) \:\:;\:\:\: r = P(T) / \mu_{C^{\#}}(T) -->
<!-- \end{equation} -->
<!-- As $\eta(D)$ is lower, $r^{\eta(D)}$ changes less when $r$ changes. As $\eta(D)$ is higher, movements of $r^{\eta(D)}$ become more pronounced in response to changes in $r$. -->
<!-- ----------------------------------- -->
<!-- ...expedient forms are considered unavoidable because...characterize the alternative, a theoretical derivation, as an impossible task [a fool's errand?]... -->
<!--  In the name of expedience, then, many methodological headaches are accumulated. At some point the headaches outweigh the expedience   Difficult to defend and impossible to account for farm entry and exit. disentangle impact from model artifact...difficult to tell whether the result is due to exogenous shock, or to artifacts of the model  ... -->

<!-- The expression for aggregate supply in Equation \ref{eq:aggSup0} can now be written more explicitly as follows. -->
<!-- \begin{equation} -->
<!-- E[Q(T)]\bigr|_{t = 0} = N \int_0^{\bar{q}^*(T)} E[q^*(T)]|_{t = 0} f(q^*(T))  \: d q^*(T) -->
<!-- \label{eq:aggSup02} -->
<!-- \end{equation} -->
<!-- Where the farm production density $\rho(q^*)$ has been expressed in terms of a probability density $N f(q^*)$, where $N$ is the number of farms in the population. -->
<!-- Substituting Equation \ref{eq:yStarC0b} for $q^*$, the aggregate supply curve becomes -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[Q(T)]\bigr|_{t = 0} &= N \int_0^{E[P(T)]\bigr|_{t = 0}} \left(\frac{\theta_x}{\theta_w} \theta_k \right)^{\eta + 1} h^{-\eta} E[C^{\#}(T)]|_{t = 0} f(C^{\#}(T)) \: d C^{\#}(T) \\ -->
<!-- &= N \left(\frac{\theta_x}{\theta_w} \right)^{\eta + 1} \hat{\theta}_k h^{-\eta} \int_0^{E[P(T)]\bigr|_{t = 0}} E[C^{\#}(T)]|_{t = 0} f(C^{\#}(T))  \: d C^{\#}(T) -->
<!-- \end{split} -->
<!-- \label{eq:aggSup03} -->
<!-- \end{equation} -->
<!-- Assuming production is lognormally distributed (axiom 5), this expression further resolves as follows. -->
<!-- \begin{equation} -->
<!-- E[Q(T)]\bigr|_{t = 0} = N E[E[q^*(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln\left(\frac{E[\bar{q}^*(T)]|_{t = 0}}{E[E[q^*(T)]|_{t = 0}]}\right) - \frac{\nu^2}{2}}{\nu} \right) \:\:;\:\:\: \nu^2 = Var[\ln(E[q^*(T)]\bigr|_{t = 0})] -->
<!-- \label{eq:aggSup03} -->
<!-- \end{equation} -->
<!-- (See Appendix for details.) -->


<!-- Science under scarcity p360: -->
<!-- "(after allowing for the optimization of the input mix when switching from existing technology to new technology and allowing for differences between changes in commercial yields and changes in experimental yields)" -->

<!-- The exogenous shock is introduced as a change in farm yield and cost elicited from experimental trial results and from scientists with a clear conflict of interest. These results must then be adjusted to reflect economic yield as opposed to experimental yield, but no clear method of adjustment is available because, in the name of expedience, the aggregate curve is not built up from the farm level curve, and so no farm level yield function is ever specified in the process. The change in yield in cost must be calculated from the economic yield and cost envelopes evaluated at the new technology, not the other way around. The impact asessor must elicit the change in technical efficiency resulting from the new technology and then calculate the change in yield and cost by evaluating the optimized yield and cost functions at the    The change in technology      The mechanism by which  ...also the price elasticity of aggregate supply is assumed to be independent of changes in technology... The impact assessment thus effectively an impact assertion. _petitio principii_ ... a great many methodological headaches are quickly accumulated in the name of expedience, which ultimately defeat the purpose/invalidate the model/etc. -->
<!-- ...They also introduce exogenous shocks in terms of a cost reduction---typically based on results gathered at experimental stations under biophysically optimal management conditions---whereas the cost reduction must be modeled as an endogenous economic reaction to a change in technological parameters....Cost, more properly optimal expenditure, is an economic variable, a function of technology and prices. Since the 1950s it has been observed that "yields are very different when the goal is changed to maximizing profit" [Pingali etc.]... By assuming a cost reduction, the modeler effectively engages in petitio principii---i.e. assumes what must be proven.... below we show that the cost/supply response to changes in tech is far more complex than the conventional treatment would suggest.  -->


<!-- The authors warn against this conflict of interest, and provide a few recommendations for managing this bias, none of which are ever followed in practice.... the result is a sort of positive impact assessment mill -->
<!-- Science under scarcity p349: -->
<!-- >When information for calculating Ks for prospective research is elicited from scientists, it is necessary to guard against unrealistic responses that would invalidate the analysis and the use of the results for evaluating research or setting priorities. A particular risk of bias  -->
<!-- arises because scientists know the purpose of the analysis and often have (or perceive) a vested interest in a high measured rate of return to research. Three ways of dealing with this potential bias are (a) using objective data on past experimental results, historical yield trends, and perhaps, total factor productivity growth rates to calibrate the elicitations, (b) creating an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and (c) creating an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact (e.g., by comparing actual achievements within programs over time against scientists' forecasts of what would be achieved). -->

<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- # # Model validation tests -->
<!-- # #---------------------------------------------------------------------- -->
<!-- # coefsNames <- gsub("`", "", names(mod1$coefficients)) -->
<!-- # aVec <- mod1$coefficients[which(coefsNames %in% inputsPosCoef)] -->
<!-- # # If seed coef removed, calculation of h based on model 1 input coefs -->
<!-- # # matches estimation of h in model 2  -->
<!-- # rmThese <- which(names(aVec) == "`seed (kg/acre)`")#%in% c("`seed (kg/acre)`", "`harvesting fam lab male (pers-hrs/acre)`")) -->
<!-- # aVec <- aVec[-rmThese] -->
<!-- # hFull <- sum(aVec) -->
<!-- # #aVec / h -->
<!-- # inputMat <- as.matrix(df_mod1[, inputsPosCoef[-c(1)]]) # (if removing seed coef) -->
<!-- # #inputMat <- as.matrix(df_mod1[, inputsPosCoef]) -->
<!-- # inputMat[inputMat != 0] <- 1 -->
<!-- # h <-  inputMat %*% aVec -->
<!-- # eta <- h / (1 - h) -->
<!-- # hist(h, breaks = 10) -->
<!-- # #ind_h0 <- which(h == 0) -->
<!-- # #hist(df_mod1$`yield (kg/acre)`[ind_h0]) -->
<!-- # #unique(df_mod1$dist[ind_h0]) -->
<!-- # #hist(df_mod1$`seed (kg/acre)`[ind_h0]) -->
<!-- # #hist(df_mod1$aehh07[ind_h0]) -->
<!-- # #plot(mod1$fitted.values[ind_h0], mod1$residuals[ind_h0]) -->
<!-- # #View(df_mod1[ind_h0, ]) -->
<!-- # #h[ind_h0] <- 0.02 -->
<!-- # #--- -->
<!-- # # Validation test 1 using cost shares vs. tech shares -->
<!-- # # (Theory predicts that input cost_i / total input cost = alpha_i / h) -->
<!-- # # (So the following ratios should = 1, or log(ratio) = 0) -->
<!-- # # Encouraging results, make sure `cost/acre` only includes inputs used in model, -->
<!-- # # and that seed might better not be considered an input -->
<!-- # #--- -->
<!-- # `cost/acre` <- exp(df_mod1$`cost/acre`) -->
<!-- # yStar <- exp(df_mod1$`yield (kg/acre)`) -->
<!-- # # `cost/acre`, yStar, and CtildeStar are lognormally distributed -->
<!-- # cSharpEff <- `cost/acre` / yStar -->
<!-- # # # hist(log(CtildeStarEff), breaks = 25) -->
<!-- # # # hist(log(`cost/acre`), breaks = 25) -->
<!-- # # # hist(log(yStar), breaks = 25) -->
<!-- # # # #`cost/acre`[which(`cost/acre` == 1)] <- 0 -->
<!-- # # # hist(log(`cost/acre` / yStar)) -->
<!-- # # #ratio <- aVec[which(names(aVec) == "`seed (kg/acre)`")] / h * `cost/acre` / df_mod1$`seed (KES/acre)` -->
<!-- # # #ratio <- aVec[which(names(aVec) == "`manure (kg/acre)`")] / h * `cost/acre` / df_mod1$`manure (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total NPK fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total CAN fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total UREA fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`dap (kg/acre)`")] / h * `cost/acre` / df_mod1$`dap (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total P&D chem (KES/acre)` -->
<!-- # # #hist(log(ratio)) -->
<!-- # # #--- -->
<!-- # # # Validation test 2 based only on input costs and tech coeffs -->
<!-- # # # (Theory says input cost_i / alpha_i = input cost_j / alpha_j) -->
<!-- # # # (So the following ratios should = 1, or log(ratio) = 0) -->
<!-- # # # More encouraging results! -->
<!-- # # # Ratios involving seed continue to diverge from theory, -->
<!-- # # # maybe b/c the seed cost is incomplete, -->
<!-- # # # maybe farmers have ways of getting it for free -->
<!-- # # # maybe b/c seed cost is not really a management variable -->
<!-- # # # Note this way of validating opens the door to deducing family labor wage -->
<!-- # # #--- -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` *  -->
<!-- # #   aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")] / (df_mod1$`Total NPK fert (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")] / (df_mod1$`Total UREA fert (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total UREA fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")]) -->
<!-- # # #ratio <- df_mod1$`seed (KES/acre)` * aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`seed (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")] / (df_mod1$`Total CAN fert (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / (df_mod1$`Total P&D chem (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / (df_mod1$`Total P&D chem (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total P&D chem (kg/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (kg/acre)` * aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")]) -->
<!-- # # # # Fam labor is in qty terms, not cost terms, but exhibits stable ratio values -->
<!-- # # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`Total UREA fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`dap (kg/acre)`")]) -->
<!-- # # #hist(log(ratio)) -->


<!-- Given a lognormally distributed random variable $u$, such that $\ln(u)$ is normally distributed with mean $m_u$ and variance $s_u^2$, then the expected value of $u$ is -->
<!-- <!-- Where $p(q)$ is the probability density function of the random variable $q$. If $\ln(q)$ is normally distributed with mean $m_u$ and variance $s_u^2$, then --> -->

<!-- \begin{equation} -->
<!-- E[u] = e^{m_u + \frac{s_u^2}{2}} -->
<!-- \label{eq:muU} -->
<!-- \end{equation} -->

<!-- And the probability density function of $u$ is -->

<!-- \begin{equation} -->
<!-- f(u) = \frac{1}{u s_u} \phi \left(\frac{\ln(u) - m_u}{s_u} \right) -->
<!-- \end{equation} -->

<!-- Where $\phi()$ is the standard normal probability density function. -->

<!-- Now, introducing a change of variables, -->

<!-- \begin{equation} -->
<!-- p = \frac{\ln(u) - m_u}{s_u} -->
<!-- \label{eq:subThis1} -->
<!-- \end{equation} -->

<!-- Such that -->

<!-- \begin{equation} -->
<!-- \frac{dp}{du} = \frac{1}{u s_u}\: \rightarrow \: d u = u s_u dp -->
<!-- \label{eq:subThis2} -->
<!-- \end{equation} -->

<!-- Then -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{\bar{u}} u f(u) \: du &= \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{s_u p + m_u} \phi(p) \: dp  \\ -->
<!-- &= \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{s_u p + m_u} \frac{1}{\sqrt{2 \pi}} e^{\frac{p^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{p s_u + m_u -\frac{p^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-1 / 2 (p^2 - 2 p s_u - 2 m_u)} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2} + m_u + \frac{s_u^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} e^{m_u + \frac{s_u^2}{2}} \: dp \\ -->
<!-- &= e^{m_u + \frac{s_u^2}{2}} \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} \: dp \\ -->
<!-- &= \frac{E[u]}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} \: dp \\ -->
<!-- &= E[u] \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} \phi(p - s_u) \: dp \\ -->
<!-- &= E[u] \Phi \left(\frac{\ln(\bar{u}) - m_u}{s_u} - s_u \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Finally, rearranging equation \ref{eq:muU} into an expression for $m_u$ -->

<!-- \begin{equation} -->
<!-- m_u = \ln(E[u]) - \frac{s_u^2}{2} -->
<!-- \end{equation} -->

<!-- And substituting this in for $m_u$ in the previous expression gives -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{\bar{u}} u f(u) \: du &= E[u] \Phi \left(\frac{\ln(\bar{u}) - \ln(E[u]) + \frac{s_u^2}{2} }{s_u} - s_u \right) \\ -->
<!-- &= \frac{E[u]} \Phi \left(\frac{\ln \left(\frac{\bar{u}}{E[u]} \right) - \frac{s_u^2}{2} }{s_u} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- In Equation \ref{eq:aggSup03}, $u = E[q^*(T)]\bigr|_{t = 0}$, giving -->

<!-- $$ -->
<!-- E[Q(T)]\bigr|_{t = 0} = N_f E[E[q^*(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln\left(\frac{E[\bar{q}^*(T)]|_{t = 0}}{E[E[q^*(T)]|_{t = 0}]}\right) - \frac{s_{EqT0}^2}{2}}{s_{EqT0}} \right) \:\:;\:\:\: s_{EqT0}^2 = Var[E[q^*(T)]\bigr|_{t = 0}] -->
<!-- $$ -->

<!-- $\blacksquare$ -->

<!-- ## Derivation of a provisional aggregate supply function from the forgoing + axioms 3 and 4 -->

<!-- The contours of an aggregate supply function begin to emerge into view when one considers what might happen if one of the farm production expressions above is substituted for $q^*$ in Equation \ref{eq:aggSup0}. In particular, it becomes clear that: -->

<!-- 1) Insofar as prices are constant across the population, and insofar as $y_0$ and the technology $\alpha_i$ are estimated on farm survey data (and are thus constant across the farm population), then $y_0$, $P$, $h$, $\theta_x$, and $\theta_w$ are constants that factor out of the integral. -->

<!-- 2) Control variables, and thus $\hat{\theta}_k$, inevitably vary across the population. But if production is lognormally distributed (axiom 3), then it follows that $\hat{\theta}_k$ is independent of either $\lambda$ or $C^{\#}$, such that the population mean of $\hat{\theta}_k$ factors out of the integral. -->

<!-- 3) It follows from (1) and (2), and from the law of the unconscious statistician, that the integral with respect to $q^*$ reduces to an integral with respect to $\lambda$, $C^{\#}$, or $C^*$, depending upon which of the expressions for farm production is used. In the case of Equation \ref{eq:prodFn2}, e.g., Equation \ref{eq:aggSup0} can now be rewritten as follows. -->

<!-- \begin{equation} -->
<!-- Q = N \left(y_0 \frac{\theta_x}{\theta_w} \right)^{\eta + 1} E \left[\theta_k^{\eta + 1} \right] h^{-\eta} \int_{\underline{C}^{\#}}^{\overline{C}^{\#}} C^{\# \eta} f \left(C^{\#} \right) \: dC^{\#} -->
<!-- \end{equation} -->

<!-- Where the farm density $\rho()$ that appears in Equation \ref{eq:aggSup0} has been rewritten in terms of the probability density $f()$ and the number of farms in the population $N$ (i.e., $\rho(C^{\#}) = N f(C^{\#})$). -->

<!-- 4) Assuming that farms enter production only if they expect to make a profit (axiom 4), then unit cost cannot exceed output price, thus resolving the upper bound of this integral. Since cost cannot be negative, the lower bound is $0$. The domain of integration must then be $0 < C^{\#} < P$. -->

<!-- \begin{equation} -->
<!-- Q &= N E[k_a] E[y^*] \frac{1}{E[C^{\# \eta}]} \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} -->
<!-- \end{equation} -->
<!-- <!-- &= N E[k_a] E[y^*] \frac{E[C^{\# \eta} | C^{\#} \leq P]}{E[C^{\# \eta}]} -->

<!-- Because $y^*$ is lognormally distributed, then $C^{\# \eta}$ must also be lognormally distribtued, such that the integral in this expression resolves as follows (proof given in Appendix A2). -->
<!-- <!--and $k$ and $C^{\# \eta}$ are independent, then $k$ and [$k$ and $C^{\# \eta}$ are independent by equation useful (i.e. b/c Csharp is not a function of k)] k is formerly theta_k --> 

<!-- \begin{equation} -->
<!-- \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} = E[C^{\# \eta}] \Phi \left(\frac{\ln \left( \frac{E[C^{\# \eta}]}{P} \right) + \frac{s_{\#}^2}{2}}{s_{\#}} \right) -->
<!-- \end{equation} -->

<!-- Such that the aggregate supply equation reduces to -->

<!-- \begin{equation} -->
<!-- Q &= N E[k_a] E[y^*] \Phi \left(\frac{\ln \left( \frac{E[C^{\# \eta}]}{P} \right) + \frac{s_{\#}^2}{2}}{\eta s_{\#}} \right) \:;\:\:\: s_{\#}^2 = Var[\ln(C^{\#})] -->
<!-- \end{equation} -->

<!-- This might be a suitable aggregate supply function in sectors characterized by highly deterministic production processes, negligible delays between input decisions and output, and negligible output price volatility. However, it is not suited to the primary sector, where production is partly deterministic, partly a function of stochastic meteorological variables; where there is a significant delay between input decisions and output (i.e., the cropping season); and where output price volatility looms large in any management decision. In order to accommodate these features, a suitable assumption regarding the stochastic character of output price (axiom 5) is introduced in the next section; and the aggregate supply model derived above is modified accordingly. In addition to accommodating the stochastic character of farm production, the modified model resolves the term $\Phi(\gamma)$ into a surprisingly instructive and intuitive form. -->

<!-- Where $\omega^2 = Var[\ln(v)]$ and $\Phi()$ is the standard cumulative normal distribution function. (See Appendix A2 for proof.) -->

<!-- Because production is assumed to be lognormally distributed, $C^{\#}$ (and $\lambda$) must also be lognormally distributed. Substituting $v = C^{\# \eta}$ and $M = P^{\eta}$, into \ref{eq:keyResult} then, -->

<!-- \begin{equation} -->
<!-- E[C^{\# \eta} | C^{\# \eta} < P^{\eta}] = E[C^{\# \eta}] \Phi \left(\frac{\ln P - m_{\#}}{s_{\#} - \eta s_{\#}} \right) -->

<!-- \right) + \frac{s_{\#}^2}{2}}{s_{\#}} \right) -->

<!-- \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} = E \left[C^{\# \eta} \right] \Phi \left(\frac{\ln\left(\frac{P}{E \left[C^{\#} \right]} \right)^{\eta} - \frac{\eta^2}{2} Var \left[\ln \left(C^{\#} \right) \right]}{\eta \sqrt{Var \left[ \ln \left(C^{\#} \right) \right]}} \right) -->
<!-- \end{equation} -->

<!-- Where $\Phi()$ is the standard normal cumulative distribution function. (See Appendix A.2 for details.) The aggregate supply function thus reduces to the following tractable form. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- Q &= N \left(y_0 \frac{\theta_x}{\theta_w} \right)^{\eta + 1} E \left[\hat{\theta}_k^{\eta + 1} \right] \frac{E \left[C^{\# \eta}\right]}{h^{\eta}} \Phi(\gamma) \:\:; \\ -->
<!-- \gamma &= \frac{\ln\left(\frac{P}{E \left[C^{\#} \right]} \right)^{\eta} - \frac{\eta^2}{2} Var \left[\ln \left(C^{\#} \right) \right]}{\eta \sqrt{Var \left[\ln \left( C^{\#} \right) \right]}} -->
<!-- \end{split} -->
<!-- \label{eq:aggSup02a} -->
<!-- \end{equation} -->
<!-- <!-- This is an aggregate supply curve that explicitly accounts for input prices, farm size, technology, and control variables ($\hat{\theta}$), as well as for output price and farm entry/exit in response to changes in output price. Farm entry/exit is captured by the term $\Phi(\gamma)$. The supply response to changes in technology is thus endogenously modeled. --> 

<!--  it is useful to express $y^*$ in terms of optimal cost per unit output or "average cost", henceforth referred to as the optimal unit cost or unit expenditure. Denoting this $C^{\#}$, then by definition, -->

<!-- \begin{equation} -->
<!-- C^{\#} = \frac{C^*}{y^*} -->
<!-- \end{equation} -->

<!-- Substituting $C^{\#} y^*$ for $C^*$ in Equation \ref{eq:YdEnvNeat} and solving for $y^*$ gives -->

<!-- \begin{equation} -->
<!-- y^* = E[y^*] \left( \frac{k}{E[k]} \right)^{\eta + 1} \frac{C^{\# \eta}}{E[C^{\# h}]^{\eta + 1}} \:\:\:;\:\:\:\: \eta = \frac{h}{1 - h} -->
<!-- \end{equation} -->

<!-- Taking the expectation and rearranging gives  -->

<!-- \begin{equation} -->
<!-- E[k]^{\eta + 1} E[C^{\# h}]^{\eta + 1} = E[k^{\eta + 1}] E[C^{\# \eta}] -->
<!-- \end{equation} -->

<!-- Such that the previous expression simplifies to -->

<!-- \begin{equation} -->
<!-- y^* = E[y^*] \frac{k^{\eta + 1}}{E[k^{\eta + 1}]} \frac{C^{\# \eta}}{E[C^{\# \eta}]} -->
<!-- \label{eq:YdEnvNeatSharp} -->
<!-- \end{equation} -->

<!-- While this is a poor choice of econometric yield model (because unit cost is calculated as a function of yield, and would thus introduce an endogeneity problem if used in an OLS regression), it facilitates the derivation of the aggregate supply function because $C^{\#}$ has a clear upper bound of integration stipulated by axiom 3. Recall that axiom 3 states that farms enter production only if they expect to make non-negative profit. Mathematically, this means $C^* \leq R^*$---an inequality that is ill suited to definite integration since $R^*$ varies across the population. But the inequality simplifies to $C^{\#} \leq P$, which is useful for definite integration since the upper bound $P$ is constant across the population.  -->

<!-- Returning to the main task at hand, farm production $q^*$ is defined as $y^*$ times area $k_a$. -->

<!-- \begin{equation} -->
<!-- q^* = k_a y^* -->
<!-- \end{equation} -->

<!-- Substituting this into Equation \ref{eq:aggSup0} gives -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- Q = N \int_{\underline{q}^*}^{\bar{q}^*} \rho(q^*) dq^* \\ -->
<!-- &= N \int_{0}^{\infty} k_a \int_{0}^{\bar{y}^*} \rho(y^*) dy^* \rho(k_a) dk_a \\ -->
<!-- &= N E[k_a] \frac{E[y^*]}{E[k^{\eta + 1}] E[C^{\# \eta}]} \int_{0}^{\infty} k^{\eta + 1} \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#}) dC^{\#} \rho(k) dk \\ -->
<!-- &= N E[k_a] \frac{E[y^*]}{E[C^{\# \eta}]} \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#}) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Axiom 3 states that farms enter production only if they expect to make non-negative profit. This condition may be formalized $R^* > C^*$, which in turn implies $P > C^{\#}$. By axiom 3, then, the upper bound of integration $\bar{C}^{\#}$ must be $P$. -->

<!-- \begin{equation} -->
<!-- Q = N E[k_a] \frac{E[y^*]}{E[C^{\# \eta}]} \int_{0}^{P} C^{\# \eta} \rho(C^{\#}) dC^{\#} -->
<!-- \end{equation} -->

<!-- If $y^*$ is lognormally distributed (axiom 4), then $C^{\#}$ is also lognormally distributed, and the integral in this expression resolves to -->

<!-- \begin{equation} -->
<!-- \int_{0}^{P} C^{\# \eta} \rho(C^{\#}) dC^{\#} = E[C^{\#}] \Phi\left( \frac{\ln(C^{\#}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) -->
<!-- \end{equation} -->

<!-- Where $\Phi()$ is the standard normal cumulative distribution function, $m_{\#} = E[\ln(C^{\#})]$, and $s^2_{\#} = Var[\ln(C^{\#})]$. (See Appendix A2 for a proof of this step.) -->

<!-- Substituing the right hand side of this equation for the integral in the previous equation results in the following expression for aggregate supply. -->

<!-- \begin{equation} -->
<!-- Q = N E[k_a] E[y^*] \Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) -->
<!-- \label{eq:aggSupply1} -->
<!-- \end{equation} -->

<!-- Assuming that output price follows a gBm (axiom 5), the stochastic model for $C^{\#}(t)$ follows directly from the gBm model for $P(t)$. That is to say, since ${C}^{\#}(t)$ and $P(t)$ are related by Equation \ref{eq:useful}, then, by Ito's lemma, $C^{\#}(t)$ must also follow a gBm with trend and volatility parameters ($m_c$, $s_c$) equal to those of the output price ($m_p$, $s_p$). (See Appendix for details.) It then follows trivially that the mean and variance of the log change $\ln(C^{\#}(T)/C^{\#}(\hat{t}))$ are equal to those of the log change in output price displayed in Equations \ref{eq:lnChngP}. This means that -->
<!-- \begin{equation} -->
<!-- Var \left[\ln \left( \tilde{C}^{\#}(T) \right) \right] = s_p^2 T  -->
<!-- \label{eq:lnChngC} -->
<!-- \end{equation} -->
<!-- unit cost is likewise partly dependent upon possible unforeseen adversity after planting (e.g., pests & disease), and then it too must be considered a stochastic variable whose value is not known at the time of planting. -->
<!-- , yield $y^*$, and unit cost $C^{\#}$ -->
<!-- and unit cost are -->
<!-- , and $C^{\#}$ -->
<!-- , and $E[C^{\#}(T)]\bigr|_{t = 0}$ -->
<!-- and $C^{\#}$ -->
<!-- Those familiar with financial analysis will notice a similarity between the PEFS-adjusted mean probability of profit and the first $\Phi()$ term in the Black-Scholes equation, which indicates the probability that a stock price will finish at or above the strike price at maturity---in other words, that a European call option will finish "in the money" [@hull9thEdition]. Farm planting and expenditure decisions are thus mathematically analogous to investment banking decisions. In particular, the farm expected unit expenditure decision is analogous to selecting a strike price, while planting with harvest date $T$ is analogous to buying a derivative on the crop output price at that strike with maturity date $T$. The only major differences between farming and investment banking then seem to be that farmers generally have a much better track record, do much more work, are paid much less, and receive no government bailout in bad years. -->
<!-- Here it is tempting to introduce a sixth axiom saying that farmers will only pursue a risky bet if the probability of profit is greater than that of a coin toss (i.e., greater than $50\%$), and to thereby limit the domain of $z$ to $(-\infty, 0)$. But this is left to the discretion of the practitioner. [There are cases when rational economic agents pursue "out of the money" bets.] -->
<!-- The main purpose of developing the stochastic price parameter formulation of aggregate supply above is to demonstrate that the $\Phi()$ term in aggregate supply has a meaningful economic interpretation as the PEFS-adjusted mean probability of profit. -->
<!-- either the the farm population parameter formulation (Equation \ref{eq:aggSup2}) or the stochastic price parameter formulation (Equation \ref{eq:aggSup3}) can be used. -->
<!-- , taking care to estimate the unconditional population parameters $m_{\#}$ and $s_{\#}$ based on the observed conditional parameters as explained in section \ref{sec:aggSupDeterm}, -->

<!-- Parameterization of the expected aggregate supply curve requires knowledge of the expected harvest price at time of planting $E[P(T)]|_{t = 0}$, which can be calculated via Equation ... based on the price at planting $P(0)$ and length of cropping season $T$ if price series data is available by which to estimate $m_p$ and $s_p$. It also requires the number of farms in the population $N$, mean farm size $k_a$, the degree of homogeneity $h$. If calculating the PEFS-adj. mean probability of profit in the  in the farm population   the mean farm's expected unit cost as evaluated at planting time $E[\tilde{C}^{\#}(T)]|_{t = 0}$, and the expected mean harvested output as evaluated at planting time $E[\tilde{q}^*(T)]\bigr|_{t = 0}$.  -->
<!-- <!-- As discussed in section ... Equation \ref{eq:cobbDoug4} has the advantage of requiring 
<!-- \begin{equation} -->
<!-- E[y^*(T)]\bigr|_{t = 0} \approx \hat{y}^*|_{\mathbf{k}_{post} = \mathbf{\tilde{k}}_{post}}) -->
<!-- \end{equation} -->

<!-- Now, as discussed in the previous section, the population mean of $E[y^*(T)]\bigr|_{t = 0}$ may be considered equal to the expected value at planting time of the population mean harvested yield $\tilde{y}^*(T)$ (recall Equation \ref{eq:rubThm}). However, because of axiom 3, the sample mean of $E[y^*(T)]\bigr|_{t = 0}$ does not represent the population mean, but rather the mean over a truncated population, i.e. $E[\tilde{y}^*(T) | C^# < E[P(T)]\bigr|_{t = 0}]\bigr|_{t = 0}$. -->

<!-- In order to arrive at the population mean and redress count 2, the sample mean of $C^{\#}$ is first calculated as follows. -->

<!-- \begin{equation} -->
<!-- E[C^{\#}(T) | E[C^{\#}(T)]\bigr|_{t = 0} < E[P(T)]\bigr|_{t = 0}]\bigr|_{t = T} = E\left[ frac{C^*}{y^*(T)} \right] -->
<!-- \end{equation} -->

<!-- Given the assumption of lognormally distributed yield (axiom ...), then, by linear independence of the OLS regressors, $C^{\#}(T)$ is also lognormally distributed, such that the unobserved mean and variance of the untruncated distribution of $\ln(C^{\#}(T))$ ($m_c$, $s_c^2$) can be implicitly calculated from the observed (i.e. sample) mean and variance ($\overline{m}_c$, $\overline{s}_c^2$) by the following standard formulae. -->

<!-- Because the model is estimated in logs, the coefficients on the continuous variables may be interpreted as the control variable elasticities ($\kappa_i$). Note that the coefficient on acres is negative, affirming the inverse relation between farm size and yield found in numerous other studies [@muyanga2019revisiting; @larson2014should; @wassie2019revisiting; @gautam2019too; @kimhi2006plot]. The coefficient on child family labor during planting is also negative, confirming that this variable is better thought of as a hard constraint rather than a discretionary management variable. -->

<!-- This is where we talk about the continuous and binary variables used in the model and how other specifications are certainly feasible... lots of management variables available, but not required because of Equation \ref{eq:yStarC}. Models including farmer age, education, gender, maximum and minimum temperature, other types of family labor, and distance to market variables were also explored. But the coefficients on these variables were either statistically insignificant or introduced multicollinearity and/or missing data issues. A model based on Equation \ref{eq:cobbDoug3} was also estimated (provided in the Appendix) to compare h via mod2 against h as sum of estimated output elasticities of inputs. As discussed in sec..., the mod1 h varies across farms...the mod 2 h is very close to the mean h of mod1. -->

<!-- As discussed in section \ref{sec:ax12}, the independent continuous variables $k_i$ and $C^*$ are divided by their respective sample means $\tilde{k}_i$ and $\tilde{C}^*$ in order to facilitate interpretation of the constant $\tilde{y}$. (In the case of rainfall, $\tilde{k}_i$ is the historical average, not the sample average). The constant $\tilde{y}$ may then be interpreted as the farm yield evaluated at the sample mean of the continuous independent variables (at the historical mean in the case of rainfall). Insofar as the continuous independent variables are uncorrelated, moreover, then $E[\hat{y}^*] = \tilde{y} e^{s_{\epsilon}^2 / 2}$, where $s_{\epsilon}^2$ is the variance of the error $\epsilon$. -->
<!-- But $E[\hat{y}^*]$ is the sample mean.  -->
<!-- Figure \ref{fig:ySampAvg} -->

<!-- ## Results -->

<!-- ...have to get the population mean/sd from the truncated mean/sd... -->

<!-- Assuming that the fitted coefficients do not vary much within a few years of when they are estimated... -->

<!-- Expected yield is actual yield divided by the rainfall anomaly...[assume farms expect rainfall consistent with the historical trend. The same would go for other weather variables like temperature and solar radiation, if they were included in the model and were statistically significant.] AND using EXPECTED PRICE at planting time, not the post harvest sale price. -->

<!-- ...mP and sP -- time period over which it is taken. -->


<!-- This is an ex-ante curve in the sense that each point on the curve is an ex-ante projection based on the expected price information available at or before planting time. -->

<!-- The projection overestimates the eventual  is far off because of the 2008-2009 drought. -->

<!-- <!-- https://www.fao.org/giews/reports/sub-saharan-africa-cereal-report/en/ -->

<!-- ```{r Fig5, fig.show = "hold", fig.width = 5, fig.height=3, fig.align="center", fig.cap="\\label{fig:Qs2009}The ex-ante Kenya 2009 aggregate maize supply curve, parameterized based on the 2007 Kenya farm data. The shaded area around the curve...", echo = FALSE} -->
<!-- thetaK <-  -->
<!-- EyStar0UpBnd <- e -->
<!-- kNames <- c("Farm size (acres)", "seed (kg/acre)", -->
<!--             "Adult equivalent household size", "Rain anomaly") -->
<!-- kVec <- mod3Coefs[which(coefsNames %in% kNames)] -->
<!-- lkMat <- as.matrix(df_mod2[, kNames]) -->
<!-- betaK <- exp(lkMat %*% kVec) -->
<!-- kappaRn <- mod2Coefs[which(coefsNames == "Rain anomaly")] -->
<!-- lkRn <- as.matrix(df_mod2[, "Rain anomaly"]) -->
<!-- betaRn <- exp(lkRn * kappaRn) -->

<!-- #--- -->
<!-- kNames <- c("acres", "seed (kg/acre)", -->
<!--             "planting fam lab child (pers-hrs/acre)", -->
<!--             demog_vars) -->
<!-- kVec <- mod2Coefs[which(coefsNames %in% kNames)] -->
<!-- lkMat <- as.matrix(df_mod2[, kNames]) -->
<!-- betaK <- exp(lkMat %*% kVec) -->
<!-- kappaRn <- mod2Coefs[which(coefsNames == "Rain anomaly")] -->
<!-- lkRn <- as.matrix(df_mod2[, "Rain anomaly"]) -->
<!-- betaRn <- exp(lkRn * kappaRn) -->
<!-- kRn <- exp(lkRn) -->
<!-- eps <- mod2$residuals -->
<!-- sErr <- sd(eps) -->
<!-- #---------------------------------------------------------------------- -->
<!-- const <- y0 * betaK / muCstarSamp^hCoef * hCoef^hCoef * exp(sErr^2 / 2) -->
<!-- #---------------------------------------------------------------------- -->
<!-- EyStar1 <- const * kRn^kappaRn * (cStar / hCoef)^hCoef -->
<!-- EyStar0 <- exp(mod2$fitted.values - kappaRn * lkRn + sErr^2 / 2) -->
<!-- #EyStar1 - EyStar0 -->
<!-- EcSharp <- cStar / EyStar0 -->
<!-- #--- -->
<!-- lam <- EPT02007 / EcSharp * hCoef -->
<!-- #lam <- exp(-mP2006) * df_mod2$P / EcSharp * hCoef -->
<!-- # EyStarUp2 <- y0 * betaKnormdAdj * kRn^kappaRn * ERstar^hCoef * exp(sErr^2 / 2) -->
<!-- # EyStarUp - EyStarUp2 -->
<!-- #---------------------------------------------------------------------- -->
<!-- # How many rational farms? -->
<!-- nRational <- sum(lam > hCoef) / length(lam) -->
<!-- # sum(EcSharp < df_mod2$P) / length(EcSharp) -->
<!-- # sum(EcSharp < EPT02007) / length(EcSharp) -->
<!-- # sum(EyStar < EyStarUp) / length(EyStar) -->
<!-- #---------------------------------------------------------------------- -->
<!-- mEcSharpTrunc <- mean(log(EcSharp)) -->
<!-- sEcSharpTrunc <- sd(log(EcSharp)) -->
<!-- muEcSharpTrunc <- exp(mEcSharpTrunc + sEcSharpTrunc^2 / 2) -->
<!-- xIn <- c(sEcSharpTrunc, mEcSharpTrunc) -->
<!-- sol <- nleqslv::nleqslv(xIn, rootFnUp, jac = NULL, -->
<!--                         xUp = EPT02007, -->
<!--                         sXtrunc = sEcSharpTrunc, -->
<!--                         mXtrunc = mEcSharpTrunc) -->
<!-- #sol -->
<!-- sEcSharp <- sol$x[1] -->
<!-- mEcSharp <- sol$x[2] -->
<!-- muEcSharpT0 <- exp(mEcSharp + sEcSharp^2 / 2) -->
<!-- #---------------------------------------------------------------------- -->
<!-- mLamTrunc <- mean(log(lam)) -->
<!-- sLamTrunc <- sd(log(lam)) -->
<!-- muLamTrunc <- exp(mLamTrunc + sLamTrunc^2 / 2) -->
<!-- xIn <- c(sLamTrunc, sLamTrunc) -->
<!-- sol <- nleqslv::nleqslv(xIn, rootFnLo, jac = NULL, -->
<!--                         xLo = hCoef, -->
<!--                         sXtrunc = sLamTrunc, -->
<!--                         mXtrunc = mLamTrunc) -->
<!-- #sol -->
<!-- sLam <- sol$x[1] -->
<!-- mLam <- sol$x[2] -->
<!-- muLam <- exp(mLam + sLam^2 / 2) -->
<!-- muLamEtaInv <- exp(-etaCoef * mLam + etaCoef^2 * sLam^2 / 2) -->
<!-- # #muLamTrunc -->
<!-- # exp(mLamTrunc - sLamTrunc^2) -->
<!-- # exp(mLam - sLam^2) -->
<!-- #--- -->
<!-- # x <- seq(0, 3, length = 200) -->
<!-- # y <- dlnorm(x, meanlog = mLam, sdlog = sLam) -->
<!-- # gg <- ggplot(data.frame(x = x, y = y), aes(x = x, y = y)) -->
<!-- # gg <- gg + geom_line() -->
<!-- # gg <- gg + geom_vline(xintercept = hCoef) -->
<!-- #--------------------------------------------------------------------- -->
<!-- # mean(const)^(etaCoef / hCoef) * mean(kRn^kappaRn)^(etaCoef / hCoef) -->
<!-- # mean(kRn^kappaRn)^(etaCoef / hCoef) - (mean(kRn)^kappaRn)^(etaCoef / hCoef) -->
<!-- # mean(kRn^kappaRn)^(etaCoef / hCoef) - mean(kRn^(kappaRn * etaCoef / hCoef)) -->
<!-- # #muConst <- mean((const * kRn^kappaRn)^(etaCoef / hCoef)) -->
<!-- muConst <- mean((const)^(etaCoef / hCoef)) # * mean(kRn)^(kappaRn * etaCoef / hCoef) -->
<!-- muEcSharpT0eta <- exp(etaCoef * mEcSharp + etaCoef^2 * sEcSharp^2 / 2) -->
<!-- muEyStarT0 <- muConst * muEcSharpT0eta * hCoef^-etaCoef -->
<!-- muEyStarT0trunc <- mean(EyStar0 * kRn^-kappaRn) -->

<!-- ``` -->

<!-- ```{r Fig5, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:Qs} uyiijl", echo = FALSE} -->

<!-- # Define supply curve/price elasticity of supply/price risk elasticity of supply function -->
<!-- QsFun <- function(muEyStarT0, EPT0ref, fracVec, h, kappaRn, muArea, -->
<!--                   muEcSharpT0, mP, sP, th, Nf, kRn = 1){ -->
<!--   eta <- h / (1 - h) -->
<!--   muKrnKapEtaH_up <- mean((kRn * 2)^(kappaRn * eta / h)) -->
<!--   muKrnKapEtaH_lo <- mean((kRn * 1 / 2)^(kappaRn * eta / h)) -->

<!--   EPT0vec <- fracVec * EPT0ref -->
<!--   muEyStarT0vec <- muEyStarT0 * fracVec^eta -->
<!--   muEyStarT0upVec <- muEyStarT0vec * muKrnKapEtaH_up -->
<!--   muEyStarT0loVec <- muEyStarT0vec * muKrnKapEtaH_lo -->
<!--   muEqStarT0vec <- muArea * muEyStarT0vec -->
<!--   muEqStarT0upVec <- muArea * muEyStarT0upVec -->
<!--   muEqStarT0loVec <- muArea * muEyStarT0loVec -->
<!--   P0vec <- EPT0vec * exp(-mP * th) -->
<!--   z <- (eta * log(muEcSharpT0 / P0vec) - (eta * mP - eta^2 * sP^2 / 2) * th) / (eta * sP * sqrt(th)) -->
<!--   EQs <- Nf * muEqStarT0vec * (1 - pnorm(z)) #in kg -->
<!--   EQsUp <- Nf * muEqStarT0upVec * (1 - pnorm(z)) #in kg -->
<!--   EQsLo <- Nf * muEqStarT0loVec * (1 - pnorm(z)) #in kg -->
<!--   EQs <- EQs * 10^-9 #in million MT -->
<!--   EQsUp <- EQsUp * 10^-9 #in million MT -->
<!--   EQsLo <- EQsLo * 10^-9 -->
<!--   #------------ -->
<!--   etaAg <- eta + dnorm(-z) / pnorm(-z) * 1 / (sP * sqrt(th)) -->
<!--   #------------ -->
<!--   etaRisk <- -dnorm(-z) / pnorm(-z) * (eta * sP * sqrt(th) - z) -->
<!--   #------------ -->
<!--   dfQs <- data.frame(EPT0 = EPT0vec, 100 * fracVec, -->
<!--                      EQs, EQsUp, EQsLo, -->
<!--                      etaAg, etaRisk, -->
<!--                      probPgtC = pnorm(-z)) -->
<!--   colnames(dfQs) <- c("Expected price (KES/kg)", "Pct. of E[P(T)]", -->
<!--                       "Expected supply, normal rainfall\n(million metric tons)", -->
<!--                       "Expected supply, high rainfall\n(million metric tons)", -->
<!--                       "Expected supply, low rainfall\n(million metric tons)", -->
<!--                       "Price elasticity\nof supply", -->
<!--                       "Price risk elasticity\nof supply", -->
<!--                       "Participation (%)") -->
<!--   return(dfQs) -->
<!-- } -->
<!-- #===================================================================== -->
<!-- # Get FAO Kenya maize data for validation of Qs -->
<!-- mainFolder -->
<!-- thisFile <- "FAO Kenya maize.csv" -->
<!-- thisFilepath <- paste0(mainFolder, thisFile) -->
<!-- dfFAO <- read.csv(thisFilepath, stringsAsFactors = F) -->
<!-- keepCols <- c("Area", "Element", "Item", "Year", "Unit", "Value") -->
<!-- dfFAO <- dfFAO[, keepCols] -->
<!-- areaFAO2007 <- dfFAO$Value[which(dfFAO$Year == 2007 & dfFAO$Element == "Area harvested")] -->
<!-- prodFAO2007 <- dfFAO$Value[which(dfFAO$Year == 2007 & dfFAO$Element == "Production")] -->
<!-- areaFAO2009 <- dfFAO$Value[which(dfFAO$Year == 2009 & dfFAO$Element == "Area harvested")] -->
<!-- prodFAO2009 <- dfFAO$Value[which(dfFAO$Year == 2009 & dfFAO$Element == "Production")] -->
<!-- # areaFAO2006 <- 1888195 -->
<!-- # areaFAO2007 <- 1615304 -->
<!-- # areaFAO2008 <- 1700000 -->
<!-- # prodFAO2006 <- 3247200 -->
<!-- # prodFAO2007 <- 2928793 -->
<!-- # prodFAO2008 <- 2367237 -->
<!-- #---------------------------------------------------------------------- -->
<!-- # lA <- quantile(df_mod2$acres, 0.01 * c(1:100)) -->
<!-- # prob <- 0.01 * as.numeric(gsub("%", "", names(lA))) -->
<!-- # dfArea <- data.frame(lA, prob) -->
<!-- # #ggplot(dfArea, aes(x = lA, prob)) + geom_line() -->
<!-- # modArea <- glm(prob ~ lA, dfArea, family = "binomial") -->
<!-- # #summary(modArea) -->
<!-- # b0 <- modArea$coefficients[1] -->
<!-- # bA <- modArea$coefficients[2] -->
<!-- # probHat <- 1 / (1 + exp(-b0 - bA * lA)) -->
<!-- # err <- probHat - prob -->
<!-- # #plot(probHat, err) -->
<!-- # dfArea$probHat <- probHat -->
<!-- # dfArea$probHat2 <- pnorm(lA, mean(lAcres), sd(lAcres)) -->
<!-- # dfArea <- dfArea %>% gather(var, val, prob:probHat2) -->
<!-- # ggplot(dfArea, aes(x = lA, y = val, group = var, color = var)) + geom_line() -->
<!-- #---------------------------------------------------------------------- -->
<!-- # mRnAnom <- mean(log(kRn)) -->
<!-- # sRnAnom <- sd(log(kRn)) -->
<!-- # muRnAnom <- exp(mRnAnom + sRnAnom^2 / 2) -->
<!-- # sigRnAnom <- muRnAnom * sqrt(exp(sRnAnom^2) - 1) -->
<!-- # mBetaRn <- 0 #mean(log(betaRn)) -->
<!-- # sBetaRn <- sd(log(betaRn)) -->
<!-- # muBetaRnEtaH <- exp(etaCoef / hCoef * mBetaRn + (etaCoef / hCoef)^2 * sBetaRn^2 / 2) -->
<!-- #---------------------------------------------------------------------- -->
<!-- # # Ex-post calibration number of farms Nf -->
<!-- # dfQs2007 <- QsFun(muEyStarT0, -->
<!-- #                   EPT0 = EPT02007, fracVec = 1, -->
<!-- #                   h = hCoef, kappaRn, muArea, -->
<!-- #                   muEcSharpT0 = muEcSharpT0, -->
<!-- #                   mP = mP2006, sP = sP2006, th, Nf = 1) -->
<!-- # Qs2007 <- dfQs2007$`Expected supply, normal rainfall\n(million metric tons)` -->
<!-- # Nf <- prodFAO2007 * mean(kRn^(-kappaRn * etaCoef / hCoef)) * 10^-6 / Qs2007 -->
<!-- # #Nf <- 1.7 * 10^6 -->
<!-- #---------------------------------------------------------------------- -->
<!-- # 2007 aggregate supply curve -->
<!-- fracVec <- seq(0.01, 2, length.out = 50) -->
<!-- #dfQs <- QsFun(muEyStarT0 = muEyStarT0 * (EPT02009 / EPT02007)^hCoef, -->
<!-- Nf = 1.7 * 10^6 -->
<!-- dfQs <- QsFun(muEyStarT0 = muEyStarT0, -->
<!--               EPT0ref = EPT02007, fracVec, -->
<!--               h = hCoef, kappaRn, muArea, -->
<!--               muEcSharpT0 = muEcSharpT0, -->
<!--               mP = mP2006, sP = sP2006, -->
<!--               th, Nf) -->
<!-- #--------------------------------------------------------------------- -->
<!-- ``` -->

<!-- ...pretty close to FAO (put in % divergence terms), divergence maybe rooted in variation of output price, also because we don't really know EyStarT0 and EPT0, also because this is expected supply at planting, not actual supply at harvest...also does not account for short rains growing season (October-December) (but short rains harvest is small % of total, in 2021 it was about 250,000MT) -->

<!-- [@abodi2021supply; @mckay1999aggregate; @muchapondwa2009supply] -->

<!-- ...price risk elasticity of supply... -->

<!-- ```{r Fig6, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:PriskElastQs} uyiijl", echo = FALSE} -->

<!-- gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Price risk elasticity\nof supply`)) -->
<!-- gg <- gg + geom_line() -->
<!-- gg <- gg + theme_bw() -->
<!-- ggElast <- gg -->
<!-- df_inset <- subset(dfQs, `Expected price (KES/kg)` > 9 & `Expected price (KES/kg)` < 25) -->
<!-- gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price risk elasticity\nof supply`)) -->
<!-- gg <- gg + geom_line() -->
<!-- gg <- gg + geom_hline(yintercept = 0, linetype = "dashed", color = "red") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title = element_blank()) -->
<!-- ggElastInset <- gg -->
<!-- ggPriskElastQs <- ggElast + annotation_custom(ggplotGrob(ggElastInset), -->
<!--                                               xmin = 6, xmax = 35,  -->
<!--                                               ymin = 9, ymax = 35) -->

<!-- ggPriskElastQs -->

<!-- ``` -->

<!-- ```{r Fig7, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:PriskElastQs} uyiijl", echo = FALSE} -->

<!-- #dfEPT0 <- subset(dfEPT0, Year > 2008) -->
<!-- dfQs <- QsFun(dfEPT0$EPT0, -->
<!--               muArea, g0, h = hCoef, muBetaKetaH, muEtaLamInv, -->
<!--               muEcSharpT0, -->
<!--               mP = dfEPT0$mP, -->
<!--               sP = dfEPT0$sP, -->
<!--               th, Nf) -->
<!-- #dfQs$`Supply\n(million metric tons)` -->
<!-- dfFAOlook <- subset(dfFAO, Year %in% c(2007:2022) & Element == "Production") -->
<!-- dif <- dfQs$`Supply\n(million metric tons)` - dfFAOlook$Value * 10^-6 -->
<!-- pctDif <- 100 * dif / (dfFAOlook$Value * 10^-6) -->
<!-- dfEPT0$`FAO Anomaly` <- pctDif -->
<!-- df_plot <-  dfEPT0[, c("Year", "Anomaly", "FAO Anomaly")] %>% gather(var, val, Anomaly:`FAO Anomaly`) -->
<!-- gg <- ggplot(df_plot, aes(x = Year, y = val, -->
<!--                           group = var, color = var)) -->
<!-- gg <- gg + geom_line() -->
<!-- gg -->


<!-- * Proponents of these models presume to dismiss such objections on the grounds that the functional form doesn't matter results aren't sensitive to them, and that theory has "very little to say" about the derivation of aggregate supply models. When reviewing the literature, the first of these arguments turns out to be baseless, while the second is patently false. [Maybe save for expansion:] Theory tells us that aggregate supply can be written down as follows.... Theory thus tells us that the aggregate supply we have to think carefully about farm production function $q$, the farm production density $...$, the bounds over which the integral i.e. farm entry/exit, And it tells us that $q(x, constraints)$ must satisfy certain microeconomic axioms regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves. It only remains to take the steps . Instead of starting here, however, the convention is to start here: ...linear or ...CES, with no regard for how this form results from the definite integral in Equation... or if it is consistent with microeconomic axioms etc.,. By starting here, preclude any discussion of microeconomic theoretical underpinnings role for theory. Theory is silent because the modeler has decided to proceed in a way that precludes any theoretical discussion, by construction.  -->





<!-- * By construction, then, these models ... petitio principii -->
<!-- As a result, the mapping between the parameters that appear in these conventional models and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.) is necessarily tenuous, such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters might be affected.... farm entry/exit.  -->

<!-- * Argue that functional form unimportant and that economic theory tells us "very little" on which to base a model derivation. -->

<!-- * For those interested in a model built up from microeconomic axioms, a model of aggregate supply is presented below derived from 5 axioms... farm entry/exit... address the conclusion that economic theory tells us little and that functional form doesn't matter.  -->

<!-- Conventional linear and constant elasticity of supply (CES) aggregate supply curves such as those featured in have long been used in ex-ante impact assessments of new agricultural technology [@alston1995science; @alston2009economics], are specified for the purpose of facilitating certain calculations (especially of economic surplus), with little or no consideration given to the plausibility of the theoretical underpinnings and empirical implications of the choice of functional form. In particular, it is unclear whether such models are consistent with standard microeconomic assumptions regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves. The documentation of such models might make passing reference to these axioms; but the models themselves are not formally derived from them. -->

<!-- Moreover, these conventional models do not explicitly account for the shape of the farm yield density (i.e., heterogeneity in farm endowments)---or, worse still, assume that all farms are homogeneously endowed and produce identically. This, in turn, precludes any explicit accounting for farm entry/exit effects on aggregate supply. In some sectors, one might reasonably justify this omission by invoking competitive long run equilibrium. The case for competitive long run equilibrium is strained in the primary sector, however, where one often sees an abundance of inframarginal farms in operation. Wohlgenant [-@wohlgenant1997nature] provides an analytical exploration of the distortions that can occur when neglecting to account for heterogeneity and inframarginal production. -->

<!-- As a direct consequence of the tenuous connection with reality and with standard theoretical premises described above, the mapping between the parameters that appear in these conventional models and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.) is likewise tenuous, such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters are affected. This, in turn, precludes any endogenous modeling of economic decision making on the part of farmers in response to technology, or any other exogenous, shocks. Instead, such models introduce farm level economic decision making (i.e., the economically rational supply/expenditure/input mix response to the exogenous shock) as a calibrated assumption based on agronomic data gathered from field trials, literature, and/or consultation with scientists involved in the research under evaluation. -->

<!-- This bears emphasis. Conventional supply models specifically designed for ex-ante impact assessment of new technology do not in fact model the supply response to new technology, but rather present a mathematical depiction of a presumed supply response that has been predetermined outside of the model, and then exogenously introduced into it.  -->

<!-- The subsequent step of translating the exogenously introduced farm level response into an aggregate supply response is, likewise, not an endogenous model of economic behavior, but rather exogenous guesswork translated into mathematical symbols. That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate supply response should be represented as a pivot or parallel shift of the curve, or of some combination thereof [@alston1995science; @norton1981evaluating; @lindner1978supply], the parallel shift has emerged as the  -->
<!--  Conventional models of aggregate supply do not in fact model the economic decision making, i.e., changes in expenditure, input mix   are not models of aggregate economic behavior, but rather a translation into mathematical symbols of   economic model That is to say, the model  -->


<!-- In ,  ; and it is unclear what shape of farm production density function is implied by the model. That is to say, if we consider aggregate supply $Q$ in its most basic definition as the definite integral of farm production function $q^*$ times the production density $\rho(q^*)$ over the domain of profitable production $(\underline{q}^*, \overline{q}^*)$, -->

<!-- \begin{equation} -->
<!-- Q(P) = \int_{\underline{q}^*}^{\overline{q}^*} q^* \rho(q^*) \: dq^* -->
<!-- \label{eq:aggSup0} -->
<!-- \end{equation} -->

<!-- then it is not readily apparent from conventional specifications of $Q$ what the functions $q^*$ and $\rho(q^*)$ are, nor whether they are consistent with microeconomic principles. Critically, expedient specifications of $Q$ also omit or gloss over farm entry and exit---i.e. the domain of profitable production $(\underline{q}^*, \overline{q}^*)$---such that it is not possible to decompose changes in aggregate supply into yield and farm entry/exit components. Some expedient forms also introduce awkward artifacts---such as the possibility of negative supply quantities and/or of farms producing for free, in the case of the linear aggregate supply curve---which further undermine the model's explanatory power. -->

<!-- The theoretical opacity of expedient aggregate models introduces considerable empirical opacity as well. That is to say, because expedient aggregate models are not explicitly built up from a farm level function of relevant, measurable, phenomena---i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.---the mapping between these phenomena and the parameters appearing in the aggregate model is tenuous. This leaves very little basis upon which to assess the plausibility of different parameterizations of a given exogenous shock, or to attribute modeled impacts to the exogenous shock with confidence. -->


<!-- To redress the incredulity of policy makers insofar as it is directed at theoretically and empirically opaque modeling of aggregate supply and of research/policy induced supply curve shifts, here I derive an aggregate supply model prioritizing theoretical transparency and consistency. More specifically, I 1) derive a farm level production function $q^*$ from three non-controversial microeconomic axioms, 2) introduce a lognormal farm density function $\rho(q^*)$ as the fourth axiom, which then leads to a simplification of the integral in Equation \ref{eq:aggSup0} to a tractable analytic expression, and 3) introduce a fifth axiom to explicitly account for the stochastic character of output price and yield, which then leads to an even more instructive and intuitive form of the integral in Equation \ref{eq:aggSup0}. including a term that explicitly captures farm entry/exit in response to price movements and risk. This term is surprisingly instructive and intuitive, as it is proportionate to the probability that output price will be greater than the mean farm's expected unit cost at harvest---i.e. the mean farm's probability of profit. Because the model is explicitly built up from a farm level function, all parameters appearing in the model have a straightforward mapping to the relevant, measurable, empirical phenomena, such that the supply and expenditure response to changes in these phenomena is modeled endogenously, as opposed to being exogenously asserted as in the expedient conventional way.   The supply response---aggregate or farm level---to changes in any of these phenomena, whether it be technology, input prices, agroclimatic variables, or something else, is easily inspected by differentiating the aggregate supply curve with respect to the variable of concern. This allows for high fidelity, explicit modeling of simultaneous, multi-faceted exogenous shocks (e.g., a technology shock in conjunction with an input subsidy, considered under different future demographic and agroclimatic scenarios). The expedient model by contrast would have to introduce these shocks as exogenous changes in yield/expenditure, each of which with its own empirical justification conflict of interest issues, greatly compounding the problem.  It also allows for close inspection of conventional wisdom. The price elasticity of supply agrees with conventional wisdom, consisting of a technology term plus a farm entry/exit term. The derivative of aggregate supply with respect to technology, on the other hand, turns out to be considerably more complex than is typically assumed. Any results that seem peculiar can be traced back to specific assumptions regarding economic behavior, and/or the estimation of specific parameter values. ....the other desirable properties following as corollaries -->

<!-- The aggregate supply curve presented below is derived from the following five axioms: -->

<!-- The exogenously introduced yield and/or expenditure shock is typically estimated based on field trial data and/or consultation with scientists closely involved in the research. Model guidelines might mention the need to adjust the elicited estimate for differences between agronomically optimal yields at an experimental station and economically optimal yields in a real farm population; and to compensate for bias resulting from the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation; but offer nothing in the way of practical, concrete steps that can be implemented within the timeframe of an impact assessment.     formal adjustment method since, in the name of expedience, no farm yield envelope is ever invoked or derived from microeconomic principles. -->

<!-- and b) recommend steps  But, as to (a),  The same guidelines might also  Alston et al. [], e.g., recommend creating an atmosphere (b) creating an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and (c) creating an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact (e.g., by comparing actual achievements within programs over time against scientists' forecasts of what would be achieved). -->

<!-- Lindner and Jarrett note that inframarginal farms convergent divergent... Rose... Wohlgenant inframarginal. Alston et al. subsequently acknowledge that proportional shift is more realistic, and parallel quite unrealistic. (and lets not forget they are assuming identical marginal firms) -->
<!-- Rose's comment about the "only realistic strategy" is in reference to the impossibility of determining where the inframarginal farms are on the aggregate supply curve, and thus the impossibility of specifying the convergent/divergent shift. -->

<!-- In the assessment of technology shocks, particularly, it is unclear how the shock might be accurately represented in terms of a change in the model's parameters, or even which parameters are affected. Instead of attempting to represent the technological shock directly, then, expedient models typically forgo any endogenous economic modeling of the relation between technology and management, and instead introduce the farm supply and/or expenditure response to technology exogenously, based on field trial data and consultation with scientists involved in the research under evaluation.  -->

<!-- The subsequent step of determining how the exogenously introduced farm level supply/expenditure shock then manifests at the aggregate level is likewise less a matter of endogenous economic modeling than it is of exogenous guesswork translated into mathematical symbols. The usual assumption since the 1990s is that the shock manifests as a parallel shift of the aggregate supply curve [@alston1995science]. But no theoretical or empirical grounds exist for this preference over, say, a supply curve pivot, or a combination of pivot and shift, which would result in a very different calculation of net benefits [@alston1995science; @alston2009economics]. [Again, because there is no clear mapping between model parameters and empirical phenomena, then, by construction, the model can offer no .] -->
<!-- Again, because the aggregate model is not explicitly built up from a farm level function of relevant measurable input and control variables, the aggregate model, by construction, precludes the possibility of endogenously modeling the change in aggregate supply curve response to technology. The change is thus     The calculation of net benefits hinges critically upon which kind of aggregate shock is introduced. -->

<!-- in particular its theoretical premises and derivation, its estimation, and the assumptions upon which it rests.  In the present article we dubious assumptions and theoretically opaque modeling---especially ---that generate implausibly high projections of net benefits in the first place. -->
<!-- In other words, there is a demand for theoretical transparency and consistency, and empirical plausibility in the ex-ante impact assessment itself, not in how the result of the assessment is discounted back to the present. -->
<!-- Insofar as this suspicion is correct, MIRR is but a cosmetic dressing up of implausibility that fails to address the real root of the problem. -->
<!-- Or, at the very least, it points to a growing, unmet demand for more . -->
<!-- conclude that donors have stopped believing them. This is a more telling indicator than popularity, suggesting that expedient specifications are insufficient for most purposes---i.e. for the purposes of producing accurate, unbiased, credible ex-ante impact assessments.  -->
<!-- Self-interest might also play a role, as the opacity of such models is known to invite misuse and abuse in the form of overstated net benefits [@alston2001attribution; @hurley2014re].-->
<!-- Alternative/complementary motive: The many methodological headaches accumulated in the pursuit of expedience, a few of which are enumerated above, raise the question of whether the expedient form is expedient at all, i.e. of whether we are in fact gaining the expedience we expected in return for our sacrifice of theoretical rigor and explanatory power; raising the question of whether perhaps the expedience of rigorous form ...at the very least it is worth exploring just what sort of price we pay in expedience for following a theoretical derivation rigorously. Here I present one such exploration of this alternative route. The results of the exploration suggest there is in fact no rigor-expedience tradeoff, that the most expedient form is also the most rigorous. -->


<!-- typically boils down a matter of methodological fiat. again because the ... precludes any clear mapping between model parameters and real economic phenomena...  That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate impact of the farm level yield/expenditure shock should be represented as a shift or a pivot of the aggregate supply curve [@alston1995science; @norton1981evaluating; @lindner1978supply], proponents of the parallel shift , even though, by the authors' own admission, there are no theoretical or empirical grounds to justify this preference [@alston1995science; @alston2009economics]. -->
<!-- efectively not modeled but asserted... the outward economic markings/trappings just pageantry; the key elements of the model prefiguring the results of the assessment have little or no basis in economic theory, and are not even modeled, but rather exogenously asserted. to this extent/in this measure assertion not assessment, petitio principii. -->
<!-- Again, because the aggregate model is not explicitly grounded in microeconomic principles, and thus has a tenuous connection to empirical phenomena, then, by construction, the aggregate model has nothing clear to say about the nature of the aggregate supply response to technology shocks. There was considerable debate in the 1970s over whether the research-induced supply curve shift should be modeled as a parallel shift or a pivot , which was ultimately inconclusive. -->
<!-- Without a theoretical framework to link parameter values and functional forms to real world conditions, the debate was ultimately inconclusive. -->
<!-- The debate was further complicated by differing views as to whether supply should be modeled as a linear or a curved function.   Modeling results depend critically upon these choices. A curved specification    The answers to the questions left unresolved by the debate have come down to us today as a matter of preference. -->
<!-- [and thence to endogenously deduce the farm supply and expenditure response based on economic theory,] -->
<!-- Model guidelines might advise care be taken to adjust the elicited estimate for differences between economically and agronomically optimal yields, and to adjust for the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation, but offer little in the way of a practical, formal method for achieving such adjustments. (Otherwise, why not just model the supply/expenditure response to technology endogenously in the first place?) -->
<!-- technological shock will affect the  [Because no farm level yield or production envelope ($q^*$) is ever cited or derived from microeconomic principles, expedient modelers preclude any chance of leveraging microeconomic theory to draw inference about the farm level supply and expenditure response to changes in technology.]  -->
<!-- Moreover, such models ignore changes on price elasticity.  -->
<!-- [Romer has macroeconomic modeling in mind, but the principle applies here too.] -->
<!-- The slippage ... to confuse results with assumptions (petitio principii), or, as in the case of the economic surplus model, to infuse a collection of contradictory and/or unfounded assertions with an air of rigor and coherence. -->
<!-- More recently, Romer has similarly criticized the rise of "mathiness" in economic modeling. -->
<!-- "There is no point in using exact methods where there is no clarity in the concepts and issues to which they are to be applied" [@morgenstern1953theory]. -->
<!-- "the economic problems were not formulated clearly and are often stated in such vague terms as to make mathematical treatment _a priori_ appear hopeless because it is quite uncertain what the problems really are" [@morgenstern1953theory]. -->
 <!-- (the attribution problem) -->
<!-- The widely implemented linear aggregate supply curve, for example, assumes homogeneous factor endowment and output across all farms, effectively implying that $\rho(q^*)$ is congruent to a Dirac delta density function, and that the domain of profitable production is a single value. Wohlgenant [-@wohlgenant1997nature] demonstrates analytically that impact assessment results can be highly sensitive such brazen oversimplifications. -->
<!-- [...holding multiple axioms without knowing if they perhaps contradict each other...] -->
<!-- [This, in turn, complicates the defense of any modeling results, especially when the modeler or their source of funding have a vested interest in said results.. as it boils down to modeler fiat not to any verifiable presmises] -->
<!-- adoption -->
<!-- [, while adding more layers of methodological wrangling/theoretical opacity.] -->
<!-- [which in turn invites misuse and abuse of the model, and otherwise complicates the defense of any modeling results.] -->
<!-- [the mathematical expression no different from the same statement in literary form] -->
<!-- [Meanwhile, the growing disparity between current research funding levels and the levels that would seem to be justified by expediently specified ex-ante impact assessments suggests that donors have stopped taking the results of such models seriously...] -->
<!-- , which was at a premium when these models were first popularized in the post-WWII literature. -->
<!-- ...donors have stopped believing the assessments...MIRR a cosmetic fix -->
<!-- To be fair, the whole point of an expedient model is to deliberately sacrifice a degree of theoretical rigor, and hence of explanatory power, in exchange for computational expedience. And the thousands of published ex-ante impact assessments of agricultural research that specify linear aggregate supply and demand functions would seem to some to suggest that the explanatory power retained by such specifications is sufficient for most modeling purposes []. -->
<!-- <!-- [Expedience no longer a pressing concern due to high cpu power.] -->
<!-- <!-- in ex-ante impact assessment, as in movies, music, or anything else, -->

<!-- However, popularity is often a misleading indicator of quality. A more telling indicator is the  -->



<!-- Note that the forgoing implies a map between farm employment rate and probability of profit which can be instructive in understanding farm entry/exit responsiveness to changes in price and technology. The example drawn in Figure \ref{fig:mapEmployProbProf} makes it clear that farm entry/exit becomes highly responsive to changes in the probability of profit as the degree of homogeneity (technology) increases past $0.5$. but mSharp changes with h so careful -->

<!-- # ```{r Fig2, fig.show = "hold", fig.width = 3, fig.height=3, fig.align="center", fig.cap="\\label{fig:mapEmployProbProf}Example map of the relation between farm employment rate and PEFS-adjusted mean probability of profit at different degrees of homogeneity. The parameters m_{\#} and s_{\#} are held constant at the values 0.92 and 1.13, respectively, which are taken from the Kenyan maize farm data examined farther below. Each line is plotted over a maize output price ranging from 0 to 100 Kenyan shillings (KES) per kg.", echo = FALSE} -->
<!-- theseColors <- randomcoloR::distinctColorPalette(3) -->
<!-- hVec <- c(0.25, 0.5, 0.75) -->
<!-- listDf <- list() -->
<!-- listEtaEQT0P0 <- list() -->
<!-- mSharp <- 0.92; sSharp <- 1.13 -->
<!-- EPT0 <- seq(0.01, 100, length.out = 500) -->
<!-- for(i in 1:length(hVec)){ -->
<!-- h <- hVec[i] -->
<!-- eta <- h / (1 - h) -->
<!-- zNeg <- (log(EPT0) - mSharp) / sSharp - eta * sSharp -->
<!-- probProfit = pnorm(zNeg) -->
<!-- employRate = pnorm(zNeg + eta * sSharp) -->
<!-- etaEQT0P0 <- dnorm(zNeg) / pnorm(zNeg) * 1 / sSharp -->
<!-- listDf[[i]] <- data.frame(etaEQT0P0, probProfit, employRate, EPT0, eta = as.character(eta), h = as.character(h)) -->
<!-- } -->
<!-- dfPlot <- do.call(rbind, listDf) %>% as.data.frame() -->
<!-- gg <- ggplot(dfPlot, aes(x = probProfit, y = employRate, group = h, color = h)) -->
<!-- gg <- gg + geom_line(lwd = 0.75) -->
<!-- gg <- gg + scale_color_manual(values = theseColors) -->
<!-- gg <- gg + labs(x = "PEFS-adj. mean probability of profit", y = "Farm employment rate", color = "Degree of homogeneity") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title = element_text(size = axisTitleSize), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  legend.text = element_text(size = legendTextSize), -->
<!--                  legend.title = element_text(size = axisTitleSize), -->
<!--                  legend.position = "top") -->
<!-- gg -->
<!-- ``` -->

<!-- # ```{r Fig3, fig.show = "hold", fig.width = 3, fig.height=3, fig.align="center", fig.cap="\\label{fig:elastConcept}Price elasticity of expected aggregate supply plotted over output price (KES/kg).", echo = FALSE} -->
<!-- gg <- ggplot(dfPlot, aes(x = EPT0, y = etaEQT0P0, group = h, color = h)) -->
<!-- gg <- gg + geom_line(lwd = 0.75) -->
<!-- gg <- gg + geom_hline(yintercept = 1, color = "red", linetype = "dashed") -->
<!-- gg <- gg + coord_cartesian(ylim = c(0, 2.5)) -->
<!-- gg <- gg + scale_color_manual(values = theseColors) -->
<!-- gg <- gg + labs(x = "Output price at planting (KES/kg)", y = "Price elasticity of aggregate supply", color = "Degree of homogeneity") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title = element_text(size = axisTitleSize), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  legend.text = element_text(size = legendTextSize), -->
<!--                  legend.title = element_text(size = axisTitleSize), -->
<!--                  legend.position = "top") -->
<!-- gg -->
<!-- ``` -->
<!-- One of the many novelties of the derived form is that it allows for explicit inspection of the aggregate supply sensitivity to price volatility. -->
<!-- \begin{equation} -->
<!-- \frac{\partial \ln(E[Q(T)]|_{t = 0})}{\partial (s_p \sqrt{T})} = - \frac{\phi(-z)}{\Phi(-z)} \left(\eta -  \frac{z}{\eta s_p \sqrt{T}}\right) -->
<!-- \label{eq:pRiskElasQagg} -->
<!-- \end{equation} -->
<!-- So long as $z$ is negative (and thus the mean farm's probability of profit greater than $50\%$), then this says that aggregate supply is decreasing in price volatility. -->
<!-- Finally, consider the derivative with respect to technology. -->
<!-- \begin{equation} -->
<!-- \end{equation} -->






Incidentally, note also that Equation \ref{eq:cStar} simplifies to

\begin{equation}
C^{\#} = P \frac{h}{\lambda}
\label{eq:useful}
\end{equation}

Which, when evaluated at the upper bound $C^{\#} = P$ reveals a lower bound on the budget shadow price $\lambda \geq h$.
<!-- Such that yield (Equation \ref{eq:YdEnvNeatSharp}) can be rewritten as a function of $P$, $\lambda$, and $h$ instead of $C^{\#}$. -->
<!-- \begin{equation} -->
<!-- y^* = E[y^*] \frac{k^{\eta + 1}}{E[k^{\eta + 1}]} \frac{C^{\# \eta}}{E[C^{\# \eta}]} -->
<!-- \label{eq:YdEnvNeatP} -->
<!-- \end{equation} -->
<!-- Moreover, applying axiom 3 to Equation \ref{eq:useful} reveals that the budget shadow price $\lambda$ has a lower bound at the population constant $h$, facilitating integration of  presenting an alternative route the derivation could take. -->

note that    to point out that the introduction of $C^{\#}$ in Equation \ref{eq:cStar} results in the following endogenous cost model.

But first, it is worthwhile to pause and take stock of some important implications of the derivation thus far that diverge from or even contradict the conventional wisdom permeating much of the agricultural economic surplus literature. To begin with, 

This is a particularly instructive expression because it indicates precisely under what circumstances optimal unit expenditure changes. Specifically, the expression indicates that optimal unit expenditure increases with improvements in technology (increases in $h$) and output price, and decreases with the budget shadow price. Note, moreover, that Equation \ref{eq:YdEnvNeatSharp} indicates that yield is positively correlated with optimal unit cost. The presumption at agricultural research institutions (and one that permeates much of the agricultural economic surplus analysis literature), on the other hand, is that an improvement in technology _exogenously_ lowers expenditure and/or increases yield. Insofar as axioms 1 and 2 are true, Equations \ref{eq:YdEnvNeatSharp} and \ref{eq:useful} demonstrate that this presumption is fallacious. It is a presumption that may be true under other axioms---e.g., by replacing axiom 2 (profit maximization) with a production quota axiom---but cannot be true under the axioms adopted here.

[[
very nearly a case in point of what Paul Romer calls "mathiness".

>"Like mathematical theory, mathiness uses a mixture of words and symbols, but instead of making tight links, it leaves ample room for slippage between statements in natural versus formal languages and between statements with theoretical as opposed to empirical content". [-@romer2015mathiness]

Or of what Von Neumann and Morgenstern had in mind when they observed that

>"part of the feeling of dissatisfaction with the mathematical treatment of economic theory derives largely from the fact that frequently one is offered not proofs but mere assertions which are really no better than the same assertions given in literary form" [-@morgenstern1953theory].

<!-- The authors go on to suggest there is a "scientifically unsound" inclination among economists to confuse these formalized literary assertions, including "very valuable surmises and inspiring anticipations of results", with actual proofs or otherwise rigorously derived theoretical results [@morgenstern1953theory]. -->


Specification of the aggregate supply curve may be considered a case in point. The model is not theoretically derived, but rather a collection of educated guesses or surmises translated into mathematical equations. Many of these surmises imply well documented contradictions of basic economic theory, and/or inconvenient ramifications vis-a-vis the supposed benefits of research and technology adoption []. The model has evolved into its present form not by force of logic, but as a matter of preference. For example, there was considerable debate in the 1970s over whether the research-induced supply curve shift should be modeled as a parallel shift or a pivot [@alston1995science; @norton1981evaluating; @lindner1978supply]. The debate was further complicated by differing views as to whether supply should be modeled as a linear or a curved function. Modeling results depend critically upon these choices. A curved specification   Without a theoretical framework to link parameter values and functional forms to real world conditions, the debate was ultimately inconclusive. The answers to the questions left unresolved by the debate have come down to us today as a matter of preference. In their highly influential book, _Science Under Scarcity_, Alston et al. indicated their preference for the linear parallel shift [-@alston1995science]. This is a conspicuous choice, to put it mildly, considering that 1) it prefigures research impacts in the best possible light, and 2) by the authors' own admission, there are no theoretical or empirical grounds to justify this preference [@alston1995science; @alston2009economics]. AR4D partial equilibrium impact studies since then have generally follow suit....the supply curve shift "k" + arbitrarily assumed adoption rate and "probability of success" (which are elicited from scientists with a conflict of interest) = results by modeler fiat, PETITIO PRINCIPII

<!-- ...The current sense is that this is somehow impossible. The verdict: -->



<!-- Expedient functional forms also tend to introduce awkward model artifacts---such as the possibility of negative supply quantities and/or of farms producing for free, in the case of linear supply functions---which effectively reduce the form to a local approximation of some inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point. The  -->
<!-- The representation of exogenous shocks in terms of such abstract parameters is thus largely a matter of modeler fiat. Insofar as the modeling results hinge upon this parameterization, they too are prefigured by modeler fiat. The impact "assessment" is thus more accurately an impact _assertion_ dressed up in mathematical language, i.e. in this measure, reduced to an exercise in petitio principii. -->
<!-- <!-- -contradict theory [have to be constant returns to scale but also upward sloping demand curves...] -->

<!-- ...haven't even gotten to adoption yet... -->
<!-- This, in turn, complicates the defense of modeling results. Without any theoretical framework by which to map the real world to model parameters, the parameterization of exogenous shocks effectively defaults to modeler fiat.  That is, the "assessment" is reduced to an _assertion_ dressed up in mathematical symbols. The     cannot be decomposed into specific components---a technology effect versus a price effect--- -->
<!-- ...distinguish between impact, model artifact, modeler fiat. -->
<!-- , and cannot be decomposed into technology and price components.  -->

<!-- When there is a [...Wd be nice to consider a range of scenarios covering a range of potential input price increases versus technology shocks, but this not possible ... not clear why adoption rate takes a certain value... or how the shock affects the entry and exit of farms... nor how the shock affects the aggregate...  nor which centiles adopt...] The representation of exogenous shocks to real world parameters in terms of model parameters thus largely boils down to a matter of modeler fiat. Insofar as modeling results hinge upon the parameterization of shocks, the conclusions of the impact assessment are, in this measure, also by fiat; and the whole process is thereby reduced to an exercise in petitio principii. This obviously complicates subsequent defense of the modeling results, especially if the modelers and/or their source of funding have a vested interest in the results. -->

<!-- [The response to the growing impatience is the cosmetic approach---MIRR] -->
<!-- <!-- The constant elasticity of supply curve, for example, -->
<!-- <!-- \begin{equation} -->
<!-- <!-- Q = a P^{\eta} -->
<!-- <!-- \end{equation} -->
<!-- <!-- conflates yield and employment response to price changes in one parameter, $\eta$. -->

<!-- Expedient specifications also tend to introduce awkward model artifacts. The parameter $\eta$, for example, implies that yield and employment responses offset each other such that $\eta$ is always constant. The linear aggregate supply curve, on the other hand, implies the possibility of negative supply quantities and/or of farms producing for free. This either requires redefinition of the curve as a piecewise function---which further complicates interpretation in terms of Equation \ref{eq:aggSup0}---or compels us to regard the function as a local approximation to an inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point. -->

<!-- Finally, the parameterization of such forms tends to be highly abstract, with no clear mapping to the relevant measurable, real world phenomena---i.e. technology, input prices, agroclimatic conditions, demographic variables, and so on. This leaves very little basis upon which to assess the plausibility of a given parameterization of exogenous shocks. How should a 10% increase in total factor productivity be represented in terms of a change in, say, $a$ and $\eta$? The answer effectively boils down to modeler fiat, which in turn invites misuse and abuse of the model, and otherwise complicates the defense of any modeling results. -->

<!-- [preclude constant returns to scale, directly contradicting the conventional wisdom handed down by Hicks [-@hicks1963theory] and Solow [-@solow1957technical]. ...also constant marginal cost...This agrees with empirical evidence [@lavoie2014post]. It also contradicts the theory of the firm presented in most microeconomic textbooks, which assumes (with no evidentiary basis) increasing marginal cost as output rises.] -->
<!-- Note, in passing, that the notion of an upper bound on economic yields agrees with empirical observation [@herdt1988increasing; @pingali2001cereal]. In Pingali and Heisey's words: -->
<!-- >\singlespacing "The best yields obtained on experiment stations are often used as the indicator of technology potential. Experiment stations are often located on the best lands within a region and have reliable irrigation water supplies. Agronomic yield potential determined on experiment stations, with no physical, biological, or economic constraints, is the maximum achievable yield.... When the objective of the experiment is changed from maximizing yields to maximizing profits, the yields obtained by experiment station researchers drop significantly..." [-@pingali2001cereal]. -->
<!-- \doublespacing -->

[In discussion: alternative form using lambda with lower bound h, working with remote sensing/spatial data vs survey data, key strength is versatility in the research questions that may be addressed either in concert or in isolation...may examine multi-lever, multi-faceted policy involving price stabilization, technology...The curve is empirically transparent, i.e. its parameters have a straightforward interpretation in terms of concrete, measurable phenomena, such that exogenous shocks may be modeled precisely and transparently. The research induced supply curve shift is complex. ...adoption...  derivative of aggregate supply with respect to price volatility, multiple levers at the policy maker's disposal.explicitly accounts for price risk and agroclimatic uncertainty, allowing explicit analysis of the role of futures markets and marketing board policy, in enhancing technological impact....the trade board debate... ...comparative analysis of multiple impact pathways to achieve the same result (ETH bean example)]

Address more nuanced questions like what is the right balance of policy and technology mix required to reach certain development goals...how can the impact of new technology release be enhanced through policy

More than validation this is to illustrate the potential usefulness of the model in examining new technologies, policies (subsidies, storage, transportation, microfinance, insurance), etc....comparison of different impact pathways. Current methods focus on yield enhancing varieties...maybe the same development goals can be reached at lower cost and in a shorter time frame through policy instruments...

In minimum data contexts... have to assume (inverse) relation between yield and area

short cropping season is omitted from aggregate supply, but this generally accounts for less than 5% of total production in any given year

The participation term, does it mean employment? ...

Of course, supply can also be defined in terms of an integral of farm yield over its density.

\begin{equation}
Q_S = \int_{0}^{\bar{y}^*} y^* \rho(y^*) \: dq^*
\end{equation}

Where the yield density is defined such that

\begin{equation}
\rho(y^*) = \int_{0}^{\infty} \rho(y^*) \: dy^* = N_a
\end{equation}

Where $N_a$ is the number of acres (or whatever the unit of area is) in the population.

The latter expression may be more suitable when dealing with remote sensing data. The former is more suitable when dealing with farm survey data, as here.

...it may be worthwhile to integrate using the cost form of yield...

...here focused on the motivating context, but the method is applicable in CGE models etc. anywhere a model of aggregate supply is required...



...this form allows one to look at questions of the value of storage...forward contracts...for e.g. as policy instruments implemented in tandem with new technology...questions of how to optimize the enabling environment to maximize impact of new technology...

...treatment of aggregate demand...
...upper bound on $x_j^*$,

\begin{equation}
x_j^* < \frac{\alpha_j}{w_j} \left(y_0 \frac{P}{h} \right)
\label{eq:inputUpBound}
\end{equation}


...negatively sloped cross price demand curves implies that all inputs are complements, not substitutes...makes sense, can't substitute CAN for dap or labor or pesticide

...Axioms can be formalized differently...intensive versus extensive diminishing marginal returns... or a risk constraint can be introduced in addition to the budget constraint in Axiom 2.  More than a specific functional form, an axiomatic approach... rules are made to be refined and ammended... the aim is to come up with a set of Axioms that generate a game that is worth the candle... Axioms should be formulated so as to minimize Axioms and maximize corollaries, i.e. maximize the number of Axioms that are explained by the original Axioms  and must not contradict each other.

In defense of CobbDoug
[Mention the good empirical fit and validation tests (input demand, optimal area, etc.) as arguments in favor of C-D]

Translog is so "flexible" that it ends up being restrictive from an economic standpoint---not homogeneous, monotonicity and concavity, global concavity requires negative semidefinite matrix of parameters, enforcement of which "destroys the flexibility of the form" and restricts the price elasticities in undesired way (from "Estimating a Derived Demand System from a Translog Cost Function"). Jorgenson etc. have to then devise ways to make it less flexible, in order to impose constant returns to scale, for eg.  Translog also violates axiom 1

However, it does not directly address---not in an obvious way---the most enduring objections to the form: its perceived conflict with evidence and intuitions regarding 1) input substitution, 2) production elasticities, and 3) factor demand elasticities. A complete response to these objections is beyond the scope of the work at hand. Nonetheless, a minimal response is sketched out below in the hopes of retaining the attention of the many vigorous critics of Cobb-Douglas who might otherwise read no further.

Enduring objection 1 is that the Cobb-Douglas function implies a unitary elasticity of input substitution, whereas intuition and evidence clearly suggest otherwise. Arrow et al. [-@arrow1961capital] set the tone in their seminal article:

>"Technological alternatives are numerous and flexible in some sectors, limited in others; and uniform substitutability is most unlikely. The difference in elasticities is confirmed by direct observation of capital-labor proportions, which show much more variation among countries in some sectors than in others".

However, the authors here are objecting not to unitary elasticity of substitution, but rather "uniform substitutability". The measure of substitutability of one input for another in a two factor model $y(x_1, x_2)$ given an output target is not the elasticity of substitution, but rather the marginal rate of substitution, $dx_1/dx_2$. And the phrase "uniform substitutability" followed closely by the word "elasticities" may reasonably be interpreted as $d\ln(x_1)/\ln(dx_2) = 1$. (Hundreds of subsequent authors espousing this objection appear to mean this, at any rate.) It is straightforward to show that the two factor Cobb-Douglas model does not imply this. On the contrary, it implies

\begin{equation}
\frac{d \ln(x_1)}{d\ln(x_2)} = -\frac{\alpha_2}{\alpha_1}
\end{equation}

And thus agrees with Arrow et al.'s observations regarding the unlikelihood of "uniform substitutability".

At the same time, it is true that the two factor Cobb-Douglas model implies a unitary elasticity of substitution. But the elasticity of substitution is not a measure of factor substitutability. It is a measure of how factor proportions change with substitutability. A unitary elasticity of substitution thus means that a $1\%$ change in substitutability ($dx_1/dx_2$) results in a $1\%$ change in the input usage ratio $x_1/x_2$. In plain English: a change in substitutability of $x_1$ for $x_2$ results in a proportionate change in the substitution of $x_1$ for $x_2$. One may conjecture without controversy that most farm managers would consider this an eminently reasonable characterization of management decision-making.

Enduring objection 2 is that the Cobb-Douglas production elasticities $\alpha_i$ are constant, whereas intuition suggests that production elasticities are functions of inputs, and should thus vary with input use. To lift this "restriction", the translog production function was introduced, with production elasticities defined as Cobb-Douglas functions of the inputs.

While the Cobb-Douglas production elasticities are indeed constant, it is fallacious to then conclude from this that they are not functions of the inputs. On the contrary, by Euler's theorem it is straightforward to show that

\begin{equation}
\alpha_i = \left(\frac{h - 1}{h} \right)  \frac{x_i}{y} \sum_{j}^{n} \frac{\partial^2 y}{\partial x_i \partial x_j} x_j
\end{equation}

And, moreover,

\begin{equation}
\frac{\partial^2 y}{\partial x_i \partial x_j} = \frac{1}{h - 2}  \sum_{k}^{n} \frac{\partial}{ \partial x_i} \frac{\partial y}{\partial x_j \partial x_k} x_k
\end{equation}

And, so on for any order $\mathcal{\ell}$ of differentiation, ad infinitum,

\begin{equation}
\frac{\partial^{\ell} y}{\partial x_i^{\ell}} = \frac{1}{h - \ell + 1}  \sum_{j}^{n} \frac{\partial^{\ell + 1} y}{\partial x_i^{\ell + 1} \partial x_j} x_j
\end{equation}

That is to say, for $h \neq 1$, the Cobb-Douglas production elasticities are not just functions of all inputs, but also of the $2^{nd}$, $3^{rd}$, $\dots$,$\infty^{th}$ order variation of production with respect to inputs, as well as the interactions of these implied in the successive orders of cross derivatives. That all this complex interaction should add up to a constant is a sign not of oversimplification, then, but of mathematical serendipity stemming from axiom 1. The translog function, meanwhile, is not derived from any first principle and is not even a homogeneous function. Which, then, is the more restrictive model? translog also violates axiom 1.

It may be added that the economic principle of net-benefit maximization (cost minimization) implies that optimal input quantities are functions of prices and control variables, and are thus constant. In this sense, the translog production elasticities are also constant.

The same riposte applies to enduring objection 3, namely, that the Cobb-Douglas input demand elasticities are constant, whereas intuition and evidence indicate that input demand elasticities vary with input use. Again, it is true that Cobb-Douglas demand elasticities are constant. But, again, this does not mean that they are not functions of inputs. On the assumption that producers maximize their net benefit (or minimize cost), the Cobb-Douglas input demand own and cross price elasticities follows as

\begin{equation}
\end{equation}

The input own and cross price demand elasticities are thus functions of price and technology. Because optimal input use is also a function of price, these elasticities may be written as functions of input use, if so desired. Conversely, the Hicks-Allen partial elasticities derived using the translog model may be written in terms of prices, if so desired.

how to implement in minimum data contexts...

Also agrees with Lipton...


the mapping defaults to the subjective preferences of the modeler, which in turn prefigures the results of the impact assessment.  ...arbitrarily set by modeler...in the name of expedience, then, petitio principii. an assumed result dressed up in mathematical symbols. [In lit review: The most famous example is whether an improved variety does a shift or pivot of the supply curve. Results depend critically on this choice...conflict of interest.] Counterveiling changes in prices...Lipton.

in Discussion: the starting Axioms are to be experimented with. Other sets of Axioms might yield the same or different results.

...the numerous methodological headaches incurred in the pursuit of expedience, outlined above (and reviewed in more detail below), outweigh any gain in computational expedience. [What good is computational expedience if it is not even clear what is being calculated, what its connection to reality is]

can also address questions of how the same result might be achieved through interventions of other variables (Ethiopia bean an example), so as to compare which impact pathway is cheapest


sketch out extension to aggregate demand and PE analysis...computing Econ Surplus, change in net benefit as alternative to ES


<!-- The $alpha_i$ can either be directly estimated by fitting Equation \ref{eq:cobbDoug2} or \ref{eq:cobbDoug3} to the farm data, or calculated based on cost share data and the value of $h$ estimated using Equation \ref{eq:lYdEnvReg2}. The latter approach takes advantage of an instructive corollary following immediately from input demand (Equation \ref{eq:inputdem2}), which states that input cost shares ($C^*_i / C^*$) are equal to their respective technology shares ($\alpha_i/h$). -->

<!-- \begin{equation} -->
<!-- \frac{C^*_i}{C^*} = \frac{\alpha_i}{h} \:\:;\:\:\: C^*_i = w_i x^*_i -->
<!-- \end{equation} -->

<!-- Given an estimate for $h$ and input cost share data, then, $\alpha_i = h C^*_i / C^*$ can be calculated for each $i$. -->

<!-- # ```{r, echo = FALSE} -->

<!-- alphaCAN <- h * exp(df_mod1$`Total CAN fert (kg/acre)`) * df_mod1$`Total CAN fert price (KES/kg)` / exp(df_mod1$`Cost/acre (KES/acre)`) -->
<!-- hist(alphaCAN[alphaCAN > 0 & alphaCAN < 1], 25) -->
<!-- mean(alphaCAN[alphaCAN > 0]) -->

<!-- alphaNPK <- h * exp(df_mod1$`Total NPK fert (kg/acre)`) * df_mod1$`Total NPK fert price (KES/kg)` / exp(df_mod1$`Cost/acre (KES/acre)`) -->
<!-- hist(alphaNPK[alphaNPK > 0 & alphaNPK < 1], 20) -->
<!-- mean(alphaNPK[alphaNPK > 0]) -->

<!-- alphaDAP <- h * exp(df_mod1$`DAP fert (kg/acre)`) * df_mod1$`DAP fert price (KES/kg)` / exp(df_mod1$`Cost/acre (KES/acre)`) -->
<!-- hist(alphaDAP[alphaDAP > 0 & alphaDAP < 1], 20) -->
<!-- mean(alphaDAP[alphaDAP > 0]) -->

<!-- alphaUREA <- h * df_mod1$`Total UREA fert (KES/acre)` / exp(df_mod1$`Cost/acre (KES/acre)`) -->
<!-- hist(alphaUREA[alphaUREA > 0 & alphaUREA < 1], 20) -->
<!-- mean(alphaUREA[alphaUREA > 0]) -->

<!-- ``` -->
<!-- **-- -->
<!-- The impact of yield scaling technologies and/or management practices on aggregate supply can be represented through perturbations of the TFP parameter ($g$). This is tantamount to adding a dummy endowment variable to the yield model in Equation \ref{eq:lYdEnvReg3}. The four endowment dummies included in the Kenya maize example may be considered yield scaling interventions that increase the value of $g$ on adopting farms. The percentage increase in TFP given the introduction of a new intervention $\beta_5 b_5$ on farms that implement the new technology (farms where $b_5 = 1$) may be calculated as -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \partial \ln(g) &\approx \frac{g' - g}{g} \:\:; \:\:\: g' = g e^{\beta_5 b_5} -->
<!-- &\approx e^{\beta_5} - 1 -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Note that the increase in TFP is the same regardless of the starting value of $g$, which varies across the population because the binary endowments $b_{i \in [1,4]}$ vary. -->

<!-- The resulting percentage changes in farm level expenditure TFP ($v$), expenditure per acre, and yield given a 1 percentage change in $g$ follow from Equations \ref{eq:v0forms}, \ref{eq:mCk}, and \ref{eq:yStarT}, respectively. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(v)}{\partial \ln(g)} = 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} -->
<!-- \label{eq:dlv0dlg0} -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(C^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \label{eq:dlCstardlg0} -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(g)} = \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} + h \frac{\partial \ln(P)}{\partial \ln(g)} \right) -->
<!-- \label{eq:dlyStardlg0} -->
<!-- \end{equation} -->
<!-- address unavailability of alpha -->
<!-- [at what rain level?] -->

<!-- We note that the change in expenditure, unconditional mean expenditure, yield, and expected unconditional mean yield follow from Equations ..., and are all the same. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial \ln(C^*)}{\partial \ln(g)} &= \frac{\partial \ln(E[C^*])}{\partial \ln(g)} = \frac{\partial \ln(y^*(T))}{\partial \ln(g)} = \frac{\partial \ln(E[\tilde{y}^*(T; k_m(T))]|_{t = 0})}{\partial \ln(g)} \\ -->
<!-- &= \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} \right) -->
<!-- \end{split} -->
<!-- \label{eq:ddlng0} -->
<!-- \end{equation} -->

<!-- Where the last equality follows noting that $u = v E[k] E[C^*]^h$. -->
<!-- -- -->

<!-- \begin{equation} -->
<!-- E[\ell|\ell < \gamma] = \frac{\int_{0}^{\gamma} f(\ell) d \ell}{F(\gamma)} -->
<!-- \end{equation} -->
<!-- If $\ell$ is lognormally distributed, then this reduces to -->
<!-- \begin{equation} -->
<!-- E[\ell|\ell < \gamma] = E[\ell] \frac{\Phi \left(\frac{\ln(\gamma) - m_{\ell}}{s_{\ell}} - s_{\ell}\right)}{F(\frac{\ln(\gamma) - m_{\ell}}{s_{\ell}} \right))} \:\:;\:\:\: m_{\ell} = E[\ln(\ell)] \:\: s^2_{\ell} = Var[\ln(\ell)] -->
<!-- \label{eq:condMean} -->
<!-- \end{equation} -->
<!-- The unconditional mean yield can then be deduced from the known information $E[y^*|C^{\#} < P]$, $m_{\#}$, and $s_{\#}$ by considering that for any random variable $\ell$ with probability density $f(\ell)$ and cumulative distribution function $F(\ell)$, the conditional mean of $\ell$ with upper tail truncated at $\gamma$ is -->
<!-- Moreover, given conditional parameters $\hat{m}_{\ell}$ and $\hat{s}_{\ell}$ estimated from the observed truncated distribution,  -->
<!-- Substituting $C^{\# \eta}$ for $\ell$ and $P$ for $\gamma$ in Equation \ref{eq:condMean}, -->
<!-- \:\:;\:\:\: m_{\#} = E[\ln(C^{\#})] \:\: s^2_{\#} = Var[\ln(C^{\#})] -->
<!-- The unconditional mean does not change with price but with technology or lambda. The conidtional mean changes with price, in addition to technology and lambda. So, given the relation between conditional and unconditional mean of a lognormally distributed variable,  -->
<!-- Finally, necessary to account for the stochastic character of price... -->
<!-- choose the approach based on higher resolution data -->
<!-- mean log(lambda) = 0 might be a reasonable assumption -->
<!-- Main thing is result that price is a dual space where solution can be found in the absence of farm data. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- Q &= N \int_{\underline{q}^*}^{\bar{q}^*} \rho(q^*) dq^* \\ -->
<!-- &= N \int_{0}^{\infty} k_a \int_{0}^{\bar{y}^*} \rho(y^*) dy^* \rho(k_a) dk_a \\ -->
<!-- &= N E[k_a] \frac{E[y^*]}{E[k] E[C^{* h}]} \int_{0}^{\infty} k \int_{0}^{\bar{C}^{*}(k)} C^{*h}(k) \rho(C*) dC^* \rho(k) dk \\ -->
<!-- &= N E[k_a] \frac{E[y^*]}{E[C^{* h}]} \int_{0}^{\bar{C}^*(k)} C^{* h}(k) \rho(C^*) d C^* -->
<!-- \end{split} -->
<!-- \label{eq:aggSupStep} -->
<!-- \end{equation} -->

<!-- By axiom 3 and the expression for $C^*$ in Equations \ref{eq:fnCsharp}, the upper bound on farm expenditure for given $k$ is -->

<!-- \begin{equation} -->
<!-- \bar{C}^*(k) = (P v k)^{\frac{\eta}{h}} -->
<!-- \end{equation} -->

<!-- Axiom 3 states that farms enter production only if they expect to make non-negative profit. Mathematically, this means $C^* \leq R^*$, which implies the following upper bound on optimal expenditure. -->

<!-- \begin{equation} -->
<!-- \bar{C}^* = R^* = P y^*|_{C^* = \bar{C}^*} = P v k R^{*h} -->
<!-- \end{equation} -->

<!-- Taking logs of this expression and repeatedly substituting $P y^*|_{C^* = \bar{C}^*}$ for $R^*$ and expanding the righthand side results in an infinite geometric series. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \ln(\bar{C}^*) = \ln(\bar{R}^*) &= \ln(P y^*|_{C^* = R^*}) = \ln(P v k) + h \ln(R^*) \\ -->
<!-- &= \ln(P v k) + h(\ln(P v k) + h\ln(R^*)) \\ -->
<!-- &= \ln(P v k) + h(\ln(P v k) + h(\ln(P v k) + h\ln(R^*))) \\ -->
<!-- &= \cdots \\ -->
<!-- &= \ln(P v k) \sum_{j = 0}^{\infty} h^{j} \\ -->
<!-- &= \frac{1}{1 - h} \ln(P v k) = (\frac{\eta}{h}) \ln(P v k) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Where the geometric series converges to the last equation only because axioms 1 and 2 constrain $h$ to $(0,1)$ (decreasing returns ot scale). Assuming constant or increasing returns to scale ($h \geq 1$) would result in a divergent infinite sum and thus unbounded $C^*$. -->

<!-- Given the domain of homogeneity $h \in (0,1)$, the upper bound on cost for given $k$ can thus be expressed -->

<!-- \begin{equation} -->
<!-- \bar{C}^*(k) = (P v k)^{\frac{\eta}{h}} -->
<!-- \end{equation} -->

<!-- Then, because $C^*$ is lognormally distributed, aggregate supply can be expressed -->
<!-- \begin{equation} -->
<!-- Q(k) = N E[k_a] \frac{E[y^*]}{E[C^*(k)^h]} \int_{0}^{(P v k)^{\frac{\eta}{h}}} C^*(k)^h \rho(C^*(k)) dC^*(k) -->
<!-- \label{eq:aggSupStep} -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- Q = N E[k_a] E[y^*] \Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) -->
<!-- \label{eq:aggSup1} -->
<!-- \end{equation} -->

<!-- If $y^*$ is lognormally distributed (axiom 4), then $C^*$ is also lognormally distributed.  -->

<!-- Where $\Phi()$ is the standard normal cumulative distribution function.  -->

<!-- But note that $C^*$ can be expressed $C^* = C^{\#} y^*$, where $C^{\#}$ is the optimal cost per unit output (also commonly referred to as the "average cost"). Then, for given $k$, -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- C^* = C^{\#} y^* &= C^{\#} v k C^{*h} \\ -->
<!-- &\rightarrow C^* = (C^{\#} v k)^{\frac{1}{1 - h}} \\ -->
<!-- &\Rightarrow E[\ln(C^*(k))] = \frac{1}{1 - h} (E[\ln(C^{\#})] + \ln(v k)) \\ -->
<!-- & m_c = (\frac{\eta}{h}) (m_{\#} + \ln(v k))  \:\:;\:\:\: m_{\#} = E[\ln(C^{\#})] -->
<!-- \end{split} -->
<!-- \label{eq:mCk} -->
<!-- \end{equation} -->

<!-- And -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- Var[\ln(C^*)] &= \frac{1}{(1 - h)^2} Var[\ln(C^{\#})] \\ -->
<!-- s^2_c &= \frac{1}{(1 - h)^2} s^2_{\#} \:\:;\:\:\: s^2_{\#} = Var[\ln(C^{\#})] \\ -->
<!-- &\rightarrow s_c = \frac{\eta}{h} s_{\#} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Substituting these new expressions in for $m_c$ and $s_c$ in Equation \ref{eq:integralStep} gives -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_{0}^{(P v k)^{\eta / h}} C^{* h} \rho(C^*) d C^* &= E[C^{* h}] \Phi \left( \frac{\eta \ln(P v k) - \eta m_{\#}}{\eta s_{\#}} - \eta s_{\#} \right) \\ -->
<!-- &= E[C^{* h}] \Phi \left( \frac{\ln(P v k) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Substituting the right hand side of this equation for the integral in Equation \ref{eq:aggSupStep} results in the following expression for aggregate supply. -->

<!-- \begin{equation} -->
<!-- Q = N E[k_a] E[y^*] \Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right) -->
<!-- \label{eq:aggSup1} -->
<!-- \end{equation} -->

<!-- **-- -->
<!-- In the evaluation of $Q$, it is important to keep in mind that $E[y^*]$, $m_{\#}$, and $s_{\#}$ are unconditional population parameters. That is to say, $E[y^*]$ refers to the mean yield given the participation of all farms in the population; and $m_{\#}$ and $s_{\#}$ refer to the mean and standard deviation of $\ln(C^{\#})$ given full participation, i.e. as $C^{\#}$ goes to infinity. But axiom 3 truncates the upper tail of the distribution of $C^{\#}$ at $P$ (this follows directly from $C^* \leq R^*$). The observed parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ are thus conditional. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \bar{m}_{\#} &= E[\ln(C^{\#}) | C^{\#} \leq P] \\ -->
<!-- \bar{s}^2_{\#} &= Var[\ln(C^{\#}) | C^{\#} \leq P] -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Because $y^*$ is a function of $C^{\#}$, then (for given $k$) $y^*$ is also truncated; and so the observed mean yield is the conditional mean $E[y^*|C^{\#} \leq P]$. -->
<!-- <!-- The unconditional  $E[y]$ is thus never observed except in the limit as $P$ becomes very large.-->

<!-- The unconditional parameters $m_{\#}$ and $s_{\#}$ can be deduced from the conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ by numerically solving the following system of equations. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \bar{m}_{\#} &= m_{\#} - s_{\#} \frac{\phi(z)}{\Phi(z)} \\ -->
<!-- \bar{s}_{\#}^2 &= s_{\#}^2 \left( 1 - z \frac{\phi(z)}{\Phi(z)} - \left( \frac{\phi(z)}{\Phi(z)} \right)^2   \right) \:\:;\:\:\: z = \frac{\ln(P) - m_{\#}}{s_{\#}} -->
<!-- \end{split} -->
<!-- \label{eq:cSharpUncondParams} -->
<!-- \end{equation} -->

<!-- Where $\phi()$ is the standard normal probability density function. Now, for any lognormally distributed variable $\chi$ and upper bound $\xi$, it can be shown that -->

<!-- \begin{equation} -->
<!-- E[\chi | \chi \leq \xi] = E[\chi] \frac{\Phi \left(\frac{\ln(\xi) - m_{\chi}}{s_{\chi}} - s_{\chi}\right)}{\Phi \left( \frac{\ln(\xi) - m_{\chi}}{s_{\chi}} \right))} -->
<!-- \label{eq:keyResult2} -->
<!-- \end{equation} -->

<!-- The unconditional mean yield $E[y^*]$ can be deduced by evaluating this relation at $\chi =C^{\# \eta}$ and $\xi = P$. -->

<!-- \begin{equation} -->
<!-- E[C^{\# \eta} | C^{\#} \leq P] = E[C^{\# \eta}] \frac{\Phi \left(\frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#}\right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right))} -->
<!-- \end{equation} -->

<!-- Such that the conditional mean of $y^*$ truncated at $C^{\#} \leq P$ can be parsed as follows. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[y^*|C^{\#} \leq P] &= E \left[ E[y^*] \frac{k^{\eta + 1}}{E[k^{\eta + 1}]}\right] \frac{E[C^{\# \eta} | C^{\#} \leq P]}{E[C^{\# \eta}]} \\ -->
<!-- &= E[y^*] \frac{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)} -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- <!-- &\rightarrow E[y^*] = E[y^*|C^{\#} < P] = E[y^*] \frac{\Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)} --> 
<!-- Whence the unknown $E[y^*]$ follows as a function of the observed or derived parameters $E[y^*|C^{\#} \leq P]$, $m_{\#}$, $s_{\#}$, and $\eta$. -->

<!-- \begin{equation} -->
<!-- E[y^*] = E[y^*|C^{\#} \leq P] \frac{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)} -->
<!-- \label{eq:condMeanYd1} -->
<!-- \end{equation} -->

<!-- Note that it also follows from this expression that aggregate supply can be written -->
<!-- The disaggregated $\bar{m}_{c \ell}$ are also computed...and then the conditional mean cost and yield are also evaluated both in the aggregate and disaggregated by strata, as explained in section \ref{sec:TFPstrata}. -->
<!-- The mean harvest yield for each stratum then follows from the first of Equations \ref{eq:v0forms} as $E[y^*(T)]_i = v_{0i} E[k] E[C^{*h}]_i$ (where $E[C^{*h}]_i = e^{h m_{ci} + h^2\frac{s^2_c}{2}}$). -->
<!-- The TFP parameter for each stratum ($g_{0i}$) can likewise be calculated from the last of Equations \ref{eq:v0forms} given the input elasticities $\alpha_i$. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[C^*]_i &= e^{m_{ci} + \frac{s^2_c}{2}} \\ -->
<!-- &= v_{0i}^{\frac{1}{1 - h}} e^{\frac{1}{1 - h}(m_k + m_{\#}) + \frac{1}{(1 - h)^2} \frac{s^2_k + s_{\#}^2}{2}} -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- the mean fitted values for yield ($\hat{y}^*$) are interpreted as the observed conditional mean yield. -->
<!-- the fitted values for yield ($\hat{y}^*$) are interpreted as the observed conditional mean yield. -->
<!-- \begin{equation} -->
<!-- y^*(T; k_r(T)) = \hat{y}^* \:\:;\:\:\: \hat{y}^* = y_{obs}^* e^{-\epsilon} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- E[y^*(T; k_r(T))]|_{t = 0} = \frac{E[k_r(T)^{\kappa_r}]|_{t = 0}}{k_r(T)^{\kappa_r}} y^*(T; k_r(T)) -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- E[y^*(T; k_r(T))|\theta] = E[\hat{y}^*] \:\:;\:\:\: \hat{y}^* = y_{obs}^* e^{-\epsilon} -->
<!-- \end{equation} -->

<!-- (Where $y_{obs}^*$ are the observed farm yields reported in the data.) -->

<!-- Recall from Equation \ref{eq:EmuYstarCondEst} that the stochastic expectation of the conditional mean yield can then be calculated from this for expected mean rainfall $E[E[k_r(T)^{\kappa_r}]]|_{t = 0}$ as follows. -->

<!-- \begin{equation} -->
<!-- E[\tilde{y}^*(T; k_r(T))|\theta]|_{t = 0} = \frac{E[E[k_r(T)^{\kappa_r}]]|_{t = 0}}{E[k_r(T)^{\kappa_r}]} E[y^*(T; k_r(T))|\theta] -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- E[y^*(T; k_r(T))|\theta] = E[\hat{y}^*] \:\:;\:\:\: \hat{y}^* = y_{obs}^* e^{-\epsilon} -->
<!-- \end{equation} -->

<!-- Estimation of the unconditional parameters $m_{\#}$ and $s_{\#}$, requires the conditional parameters $\bar{m}_{\#}$, $\bar{s}_{\#}$ computed from the observed farm data and expected harvest price at planting time for the year of the data. The conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ can be computed from the farm expenditure ($C^*$) and exogenous factor ($k$) data based on Equations \ref{eq:mCsC}. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- m_c &= \frac{1}{1 - h}(\ln(v) + m_k + m_{\#}) \:\:;\:\:\: m_k = E[\ln(k)] \\ -->
<!-- s_c^2 &= \frac{1}{(1 - h)^2} (s_k^2 + s_{\#}^2) \:\:;\:\:\: s_k^2 = Var[\ln(k)] -->
<!-- \end{split} -->
<!-- \label{eq:mCsC} -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \bar{m}_{\#} &= (1 - h) \bar{m}_c - m_k - \ln(v) \\ -->
<!-- \bar{s}_{\#}^2 &= (1 - h)^2 (\bar{s}_c^2 - s_k^2) \\ -->
<!-- & \bar{m}_c = E[\ln(C^*)| \theta] \:\:\:\: \bar{s}_c^2 = Var[\ln(C^*)| \theta] -->
<!-- \end{split} -->
<!-- \label{eq:paramsCondCsharp} -->
<!-- \end{equation} -->

<!-- note that the second line of Equations \ref{eq:mCk} (rewritten in stochastic terms) can be rearranged as an expression for $E[C^{\#}(T)]|_{t = 0}$. -->
<!-- \begin{equation} -->
<!-- E[C^{\#}(T)]|_{t = 0} = \frac{C^{* 1 - h}}{v k} -->
<!-- \end{equation} -->
<!-- Such that the conditional parameters $\bar{m}_{\#}$ and $\bar{s}_{\#}$ can be estimated from the data as follows. -->
<!-- To parse $m_c$ and $s_c$, recall from Equation \ref{eq:mCk} that $C^* = (v k C^{\#})^{1 / (1 - h)}$, such that -->
<!-- as explained in section \ref{sec:TFPstrata} -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \Delta \psi &= N \int_0^{\infty} k_a \int_0^{\infty} k \int_0^{\bar{\bar{C}^{*}}} \partial \mathcal{L}^*(C^*, k) \rho(C^*) d C^* \rho(k) dk \rho(k_a) dk_a \\ -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- From the expression for research induced farm level change in net benefit in Equation \ref{eq:dLdlng} it follows that -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \partial \mathcal{L}^*(C^*, k) &= r ( C^* \left(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \mathbf{w} \right) + h \partial B ) \\ -->
<!-- &= r \gamma (C^* - \bar{\bar{C}^*}) \:\:;\:\:\: \gamma = \left(\partial \ln(g) - \boldsymbol{\alpha} ' \partial \mathbf{w} \right) \\ -->
<!-- &= \gamma P (y^* - \bar{\bar{y^*}}) \\ -->
<!-- &= \gamma P v k  (C^{*h} - \bar{\bar{C^{*h}}}) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Such that -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \Delta \psi &= N E[k_a] E[k] v P \gamma \int_0^{\bar{\bar{C}^{*}}} (C^{*h} - \bar{\bar{C^{*h}}}) \rho (C^*) d C^* \\ -->
<!-- &= N E[k_a] E[k] v P \gamma (E[C^{*h}] \mathcal{P}(\bar{\bar{C^*}}) - \bar{\bar{C^{*h}}} \mathcal{A}) \:\:;\:\:\: \mathcal{P}(\bar{\bar{C^{\#}}}) = \Phi \left( \frac{\ln(\bar{\bar{C^{\#}}}) - m_{\#}}{s_{\#}} - \eta s_{\#}  \right) \\ -->
<!-- &= N E[k_a] P \gamma (E[y^*] \mathcal{P}(\bar{\bar{C^{\#}}}) - E[k] v \bar{\bar{C^{*h}}} \mathcal{A}) \\ -->
<!-- &= N E[k_a] P \gamma \left( E[y^*] \mathcal{P}(\bar{\bar{C^{\#}}}) - E[\bar{\bar{y}^*}] \mathcal{A} \right) \:\:;\:\:\: E[\bar{\bar{y}^*}] = E[v k \bar{\bar{C^{*}}}] = \frac{\bar{\bar{C^{*}}}}{E[C^{* h}]} E[y^*] -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- $$ -->
<!-- N E[k_a] E[k] v P \gamma (E[C^{*h}] \mathcal{P}(\bar{\bar{C^*}}) - \bar{\bar{C^{*h}}} \mathcal{A}) \:\:;\:\:\: \mathcal{P}(\bar{\bar{C^*}}) = \Phi \left( \frac{\ln(\bar{\bar{C^{\#}}}) - m_{\#}}{s_{\#}} - \eta s_{\#}  \right) -->
<!-- $$ -->
<!-- &= N E[k_a] E[k] v P \gamma (E[C^{*h}] (1 - \Phi(\zeta)) - \bar{\bar{C^{*h}}} \mathcal{A}) \\ -->
<!-- &= N E[k_a] P \gamma (E[y^*] (1 - \Phi(\zeta)) - E[k] v \bar{\bar{C^{*h}}} \mathcal{A}) \\ -->
<!-- &= N E[k_a] P \gamma \left( E[y^*] (1 - \Phi(\zeta)) - E[\bar{\bar{y}^*}] \mathcal{A} \right) -->

<!-- By Equation \ref{eq:keyResult2} this can also be written -->

<!-- \begin{equation} -->
<!-- \Delta \psi = N E[k_a] P \gamma \mathcal{A} \left( E[y^*| C^* \leq \bar{\bar{C^{*h}}}] -  E[\bar{\bar{y}^*}] \right) -->
<!-- \end{equation} -->
<!-- The total change in aggregate net benefit summed across all strata then follows as -->
<!-- \begin{equation} -->
<!-- \Delta \psi = \sum \Delta \psi -->
<!-- \label{eq:dPsi} -->
<!-- \end{equation} -->

<!-- Following the steps in Equations \ref{eq:PhiMap}, the $\Phi()$ term can then be expressed in stochastic price parameter space. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \Phi \left( \frac{\ln(\bar{\bar{C^{\#}}}) - m_{\#}}{s_{\#}} - \eta s_{\#}  \right) &= 1 - \Phi ( \zeta ) \:\:;\:\:\: \zeta = \frac{\ln \left( \frac{E[\tilde{C}^{\#}(T)]|_{t = 0}}{\bar{\bar{C^{\#}(0)}}} \right) - \left( m_p - \eta \frac{s_p^2}{2} \right) T}{s_p \sqrt{T}} \\ -->
<!-- &= \text{Prob}(\tilde{C}^{\#}(T)} \leq \bar{\bar{C^{\#}}}) -->
<!-- \end{equation} -->

<!-- Such that the term $1 - \Phi(\zeta)$ may be interpreted as the PEFS-adjusted probability that, on the mean farm, adoption will prove to be more profitable than not adopting. [The PEFS adjusted mean probability of profitable adoption] -->

<!-- Recalling, moreover, the relation between conditional and unconditional mean of a lognormally distributed variable (Equation \ref{eq:keyResult2}), -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[y^*] \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_{c}}{s_c} - h s_c  \right) &= E[y^*| C^* \leq \bar{\bar{C^*}}] \Phi \left( \frac{\ln(\bar{\bar{C^*}}) - m_{c}}{s_c} \right) \\ -->
<!-- E[y^*] (1 - \Phi(\zeta)) &= E[y^*| C^* \leq \bar{\bar{C^*}}] \mathcal{A} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Such that the expression for $\Delta Q$ may be rewritten as follows. -->
<!-- The percentage change in aggregate supply given a 1% change in TFP follows from Equations \ref{eq:aggSup2} and \ref{eq:ddlng0}, -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \frac{\partial \ln(E[Q(T)]|_{t = 0})}{\partial \ln(g)} = \frac{\partial \ln E[\tilde{y}^*(T; k_m(T))]|_{t = 0}}{\partial \ln(g)} \\ -->
<!-- &= \frac{1}{1 - h} \left( 1 - \boldsymbol{\alpha} ' \frac{\partial \ln(\mathbf{w})}{\partial \ln(g)} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Recalling that $\partial \ln(y^*(T; k_m(T))) = \partial \ln(C^*)$, this can be parsed as follows. -->
<!-- E[y^*(T; k_m(T))]|_{t = 0} -->
<!-- \partial y^*(T, k_m(T)) = \Delta y^*(T, k_m(T)) -->
<!-- $\partial q^*(T) = k_a \partial y^*(T; k_m(T))$ -->
<!-- To reduce clutter, the following shorthand is used -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- y^* &= E[y(T; k_m(T))] \bigr|_{t = 0} \\ -->
<!-- C^{\#} &= E[C^{\#}(T)] \bigr|_{t = 0} \\ -->
<!-- P &= E[P(T)]|_{t = 0} \\ -->
<!-- Q &= E[Q(T)]|_{t = 0} -->
<!-- \end{split} -->
<!-- \end{equation} -->