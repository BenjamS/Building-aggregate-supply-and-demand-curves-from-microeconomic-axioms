---
title: A theoretical derivation of the aggregate supply curve accounting for farm entry and exit
# author: "Benjamin Schiek"
# date: "`r Sys.Date()`"
abstract: |
  Conventional models of the aggregate supply of agricultural commodities---specifically those often used in ex-ante impact assessments of policy and research shocks---do not endogenously model the supply response to technology (or any other exogenous) shocks, but rather 1) assume the farm level supply response as exogenously given based on agronomic information, and then 2) assume, as a matter of fiat, the mechanism by which the farm level response manifests at the aggregate level (whether it is a shift or pivot of the aggregate supply curve). Such models also do not account for farm heterogeneity---or, worse still, assume identical marginal farms---and do not account for farm entry/exit. For applications where these things matter, here a tractable aggregate supply model is formally derived from 6 weak axioms. The derived form allows for endogenous modeling of the supply response to exogenous shocks, including entry/exit. The model also accounts for price volatility, opening up a novel set of policy modeling possibilities.. also distributional issues can be addressed... As an illustrative use case, the model is estimated on Kenya farm survey data. Calculations of supply and price elasticity of supply agree with empirical estimates. Potential applications in policy impact assessment are briefly discussed.
  [The term accounting for farm/entry exit turns out to be highly instructive and intuitive, as it is proportionate to the probability that the mean farm will make a profit at harvest.]
header-includes:
  - \usepackage{geometry}
  - \geometry{top=1in,left=1in,bottom=1in,right=1in}
  - \usepackage{framed}
  - \usepackage{setspace}\doublespacing
  - \usepackage{float}
  - \floatplacement{figure}{H}
  - \usepackage{amsmath}
  - \numberwithin{equation}{section}
output:
  pdf_document:
   fig_caption: true
   number_sections: true
   #latex_engine: xelatex
# mainfont: Times Roman
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      dev = c("png", "tiff"),
                      dpi = 300)

library(tidyverse)
library(patchwork)
library(scales)

labelSize <- 2.5
smallLabelSize <- 2
titleSize <- 7
subtitleSize <- 7
legendTextSize <- 6
axisTextSize <- 6
axisTitleSize <- 7
facetTitleSize <- 7

```
   <!-- Allows for analysis of price and technology impacts at specific centiles. -->
  <!--  The results of ex-ante impact assessments often hinge critically upon these two assumptions Strange results cannot then be traced back to    That is to say, there is no actual modeling of economic decision making; rather, the decision making is exogenously introduced. are not explicitly or formally derived from standard microeconomic axioms. Nor does the specification of such models  Such models are then, by construction, theoretically opaque, with unclear mappings between model parameters and relevant empirical phenomena, and no accounting of farm entry/exit in response to price changes. -->
  <!-- [And this, in turn, precludes any possibility of rigorous, endogenous modeling of the supply response to technology (or any other exogenous) shocks. Instead, such models effectively assume the farm level supply response as exogenously given based on agronomic information; and then assume a mechanism by which this translates up to the aggregate level.] -->
<!-- [The two choices presented to us in the literature linear or curved... neither of which...] -->
<!-- unclear mapping between model parameters and relevant empirical phenomena. ...in turn precludes endogenous modeling of decision making... instead exogenously assumed there is no actual modeling of economic behavior or decision making. The economic decision making is assumed. it is questionable, then, in what sense such a model can even be called an economic model. literary statements surmises translated into mathematical symbols not better than the original literary form -->

# Introduction

The conventional linear and constant elasticity of supply (CES) aggregate supply curves commonly used in ex-ante impact assessments of new agricultural technology [@alston1995science; @alston2009economics] are not explicitly derived from microeconomic axioms, but rather specified primarily to facilitate calculations of consumer and producer surplus, with little consideration given to the plausibility of the theoretical underpinnings and empirical implications of this choice of functional form. In particular, it is unclear whether these forms are consistent with standard microeconomic axioms regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves.
<!-- (The model documentation might make passing reference to such axioms; but the models themselves are not formally derived from them.) -->

That is to say, if we consider aggregate supply $Q$ in its most basic definition as the definite integral of farm production function $q^*$ times the production density $\rho(q^*)$ over the domain of profitable production $(\underline{q}^*, \overline{q}^*)$,

\begin{equation}
Q(P) = \int_{\underline{q}^*}^{\overline{q}^*} q^* \rho(q^*) \: dq^*
\label{eq:sup1}
\end{equation}

then it is not readily apparent from conventional linear and CES specifications of $Q$ what the function $q^*$ is, nor whether it is consistent with microeconomic theory. Critically, the conventional models also do not explicitly account for heterogeneously endowed farm populations (captured in the farm production density $\rho$)---or, worse still, assume a population of homogeneously endowed identical marginal farms; and they neglect to account for the domain of profitable production $(\underline{q}^*, \overline{q}^*)$, thus precluding any detailed analysis of supply response in terms of yield and entry/exit components.

Because these models are not formally derived from axioms, there is no clear mapping between their parameters and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.), such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters might be affected by the change. This, in turn, precludes any endogenous modeling of economic decision making on the part of farmers in response to technology, or any other exogenous, shocks. Instead, the conventional models introduce farm level economic decision making (i.e., the economically rational supply/expenditure/input mix response to the exogenous shock) as a calibrated assumption based on agronomic data gathered from field trials, literature, and/or consultation with scientists involved in the research under evaluation.

This bears emphasis. The conventional aggregate supply models specifically designed for ex-ante impact assessment of new technology do not in fact model the supply response to new technology, but rather present a mathematical description of a presumed supply response that has been predetermined outside of the model, and then exogenously introduced into it. Model guidelines might offer some words of warning about the difference between economically and agronomically optimal yields/expenditures/input mixes, and about the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation; but very little in the way of actionable advice is actually given. To redress conflicts of interest, e.g., Alston et al. [@alston1995science] prescribe the creation of
<!-- The absurdly high rates of return to agricultural R&D reported in the literature based on such models [@hurley2016] suggests that few practitioners follow this advice in any substantive way. -->

>"an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and...an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact".

Admirable aspirations, to be sure, but not actionable. If research institute directors are hard pressed to effect such deep cultural changes over the course of a multi-year tenure, how can the lowly economist tasked with the impact assessment---often hired by the scientists as a short term consultant---be expected to do so?

The subsequent step of translating the exogenously introduced farm level response into an aggregate supply response likewise involves no endogenous modeling of economic behavior, but is rather a set of exogenous guesswork translated into mathematical symbols. That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate supply response should be represented as a pivot or parallel shift of the curve [@alston1995science; @norton1981evaluating; @voon1991calculation], or some combination thereof, the current default choice of parallel shift in most impact assessments emerges not on any theoretical or empirical basis, but purely as a matter of fiat [@alston2009economics].
<!-- The consensus since the 1990s is that the shock manifests as a parallel shift of the aggregate supply curve [@alston1995science]. But no theoretical or empirical grounds exist for this preference over, say, a supply curve pivot, or a combination of pivot and shift, which would result in a very different calculation of net benefits [@alston1995science; @alston2009economics]. -->

The final step of calculating net benefits in terms of discounted economic surplus, adjusted for probability of success, expected adoption rate, time lags in research and adoption, capital depreciation, and other exogenously collected parameters, bears many of the markings of a rigorous economic assessment. But insofar as the result of this calculation is prefigured by the initial, exogenously determined farm supply/expenditure response to technology change, and to its expression-by-fiat at the aggregate level, it is not so much an impact assessment as it is an impact _assertion_, i.e., an exercise in _petitio principii_.
<!-- To put it more plainly, impact assessments based on conventional supply curves are offer a depiction of what net benefits could look like _if_ the assumed supply and demand curves, type of supply curve shift, and magnitude of the shift are accurate (with no theoretical or empirical basis to suspect that they are). The  -->

Critics have long noted as much, if perhaps in a more understated way. Rose [-@rose1980supply], for example, notes that

>"[T]reatments have been concentrated on increasing the geometric sophistication of explanatory models and even that has been subject to fundamental errors. What is more important is to have an understanding of supply curves and the derivation of cost changes. Geometric manipulations are of little help at that level" [@rose1980supply].

In other words, policy formation does not require mathematical descriptions of an exogenously assumed supply response to exogenous shocks, but rather endogenous modeling of the supply response to exogenous shocks. For those interested in such modeling, here an aggregate supply curve function is derived from the following five non-controversial economic axioms.

1) Diminishing marginal returns to input use

2) Farms maximize their expected net benefit subject to a budget constraint

3) Farm yield is lognormally distributed

4) Farms enter production only if they expect to make positive profit

5) Output price follows a geometric Brownian motion over time

All of the parameters appearing in the derived model have a straightforward interpretation in terms of relevant, measurable, empirical phenomena. This includes, in addition to the usual variables (technology, agroclimatic variables, price), output price volatility and length of cropping season, widening the range of policy/technology questions that can be explored. The resulting aggregate supply curve also includes a term that explicitly captures farm entry/exit in response to price movements and risk, effectively accounting for heterogeneous endowments across inframarginal farms. The entry/exit term itself is surprisingly instructive and intuitive, as it is proportionate to the mean farm's probability of profit.
<!-- Wohlgenant [-@wohlgenant1997nature] suggests the lognormal distribution as a suitable density fn... -->
<!-- the probability that output price will be greater than the mean farm's expected cost per unit output at harvest---i.e. the mean farm's probability of profit -->

Five other desirable properties immediately follow from axioms 1 and 2 as corollaries, and need not be imposed as additional axioms: 1) The farm yield function is homogeneous (and thus homothetic) and 2) concave in inputs; 3) farm supply curves are upward sloping; and 4) input demand curves are downward sloping. We also take a moment to demonstrate that 5) the derived yield function agrees with Lipton's theory of technology adoption [].

On the other hand, two somewhat controversial corollaries also follow: strictly decreasing returns to scale and constant marginal cost. The former contradicts the conventional wisdom handed down by Hicks [-@hicks1963theory] and Solow [-@solow1957technical]. The latter is well supported empirically [@lavoie2014post], but is eschewed in textbooks. Regardless of one's view on returns to scale and marginal cost curves, the very fact that it is possible to disagree with specific corollaries, and to trace the disagreement back to specific axioms, underscores a key strength of the derived model: its theoretic transparency. Under the theoretic opacity of the expedient approach, by contrast, it is not even possible to know if one agrees or disagrees with the premises, or whether the premises contradict each other mathematically, since those premises are stated in literary form (if they are stated at all), and the model is not explicitly derived from such premises.
<!-- Working under such opacity, many economists would not hesitate to add Solow's axiom (constant returns to scale) to the list above, and would never discover the mathematical contradiction between this and axioms 1 and 2. -->
<!-- Moreover, such  a corollary of eminently reasonable axioms seems distasteful, then one may not simply discard the offending corollary without also discarding the reasonable axioms whence it derives. Another strength of the theoretically rigorous approach followed here is that it invites careful reflection upon . -->

In the first part of the derivation, the farm yield function is derived from axioms 1-3. Most of these steps are elementary and thus presented below in a highly summarized form---only pausing to note any novel details or implications, such as the agreement with Lipton's theory of adoption---with details provided in the Appendix. The main novelty and focus of the article is in the subsequent derivation of the aggregate supply model from the farm yield function and from axioms 4 and 5. This is followed by an illustrative use case using Kenya maize farm data. Calculations of aggregate production and price elasticity of aggregate supply agree with empirical estimates. Food policy relevance, application in partial equilibrium analysis, and application in minimum data contexts are briefly considered in the Discussion.

Because the conventional linear and CES aggregate supply functions are in such wide use, it is first worthwhile to engage with that literature in more detail than is offered in the cursory treatment above, and to thereby place the motivation for the present work on a more solid footing.

# Literature review

## Is impact assessment insensitive to misspecification of the supply curve?

When pressed on the matter, proponents of the conventional aggregate supply functions make little attempt to defend their specifications on empirical or theoretical grounds. On the contrary, proponents of linear models generally admit that real world commodity supply and demand curves are almost certainly never linear [@brester2023equilibrium]. Proponents of the CES model generally argue that CES models are probably at least slightly more accurate than linear specifications [@voon1991calculation], but likewise offer no formal derivation of their model from theory. Rather, the defense of conventional models centers on the argument that the functional form is irrelevant for purposes of impact assessment.
<!-- On the contrary, everyone involved in this literature acknowledges that the functional forms are specified primarily to facilitate calculations of consumer and producer surplus [@lindner1978supply; @alston1995science; @rose1980supplys]. -->

>\single spacing "The pertinent question is whether the functional form used is an adequate approximation for the purpose. It turns out, empirically, that measures of total research benefits and their distribution between producers and consumers are quite insensitive to choices of functional form. They are much more sensitive to the related but separate choices concerning the nature of the research-induced supply curve shift and elasticities" [@alston1995science].

\doublespacing

Alston et al. [-@alston1995science] cite three peer reviewed articles in support of this claim. One of the cited articles actually runs contrary to the claim, explicitly concluding that impact assessment results are highly sensitive to choices of functional form [@voon1991calculation]---a conclusion subsequently reaffirmed in a comment [@elbasha1997calculation] and reply [@edwards1997calculation]. Another cited article, by Lindner and Jarrett [-@lindner1978supply], concludes that impact assessment results are sensitive to the nature of the supply curve shift (pivot versus parallel shift); but also acknowledges that these shifts are determined by the choice of functional form. In their words,

>\single spacing"[P]ast studies have made no attempt to justify or explain the particular assumptions made about the type of supply shift. In fact, in some studies the impression is given that the type of supply shift was determined by the specification of the mathematical form of the supply curve, which in turn appears to have been chosen simply for computational convenience" [@lindner1978supply].

\doublespacing

By the transitive property, then, their conclusion regarding impact assessment sensitivity to the type of supply curve shift extends to functional form, again contrary to the claim that functional form is irrelevant. Similarly, the third cited article, by Norton and Davis [-@norton1981evaluating], asserts that functional form is "less important than the type and magnitude of the supply shift". But then, contrary to this assertion, the authors proceed to survey four examples where the mathematical form of the shift is clearly prefigured by that of the supply curve; and explicitly state that differences between the four examples in the assessment of net benefits are due to differences in both type/magnitude of shift and functional form. Alston et al. [-@alston1995science] themselves point out that the practitioner is at liberty to choose between different types of shift only in the case of the linear specification---where the choice is between a pivot and a parallel shift, or some combination thereof. In the case of the CES specification, the practitioner is constricted to assume a pivot (a point later emphasized by Voon and Edwards [-@voon1991calculation]). And elsewhere Alston writes that "the choice [of type of supply shift is] dictated by analytic convenience, given _a prior_ choice of functional form for supply" [@martin1997producer].

A fourth document is also cited [@alston1990measuring], but is not peer reviewed and not, at the time of writing, readily available from the publisher. A subsequent peer reviewed article by Zhao et al. [-@zhao1997functional] cites the unavailable document as an annex to a technical report on R&D in the Australian wool industry. The main text of this report appears to have been published in a peer reviewed journal, but without the annex in question [@scobie1991returns]. In their own analysis, Zhao et al. [-@zhao1997functional] find that assessment of net benefits (economic surplus) is highly sensitive to misspecification of the functional form in the case of the CES specification, again contrary to the claim that impact assessments are insensitive to misspecification of the supply curve.

They also find that impact assessment is insensitive to misspecification error when 1) the linear specification is assumed together with 2) a parallel shift, and assuming 3) the shift is small [@zhao1997functional]. Proponents and critics alike acknowledge that the empirical and theoretical grounds for assumptions 1 and 2 are narrow, at best [@lindner1978supply; @alston2009economic; @voon1991calculation; @rose1980supplys]. If the real shift is a pivot or mixture of pivot and shift, then Zhao et al.'s finding of insensitivity does not apply. Moreover, it is questionable whether the parallel supply curve shifts assumed in most economic surplus assessments of returns to agricultural R&D qualify as "small" [@hurley2014re; @alston2000research]. To know for sure, Zhao et al. [-@zhao1997functional] develop a method to calculate the upper bound on misspecification bias; but the present literature review finds no instance where this method has actually been implemented. Finally, Zhao et al. [-@zhao1997functional] acknowledge that their findings regarding linear misspecification are valid only insofar as farm populations consist entirely of identical marginal farms, a condition never actually observed in any real farm population.

In synthesis, then, it is misleading to characterize the cited literature as supportive of Alston et al.'s [-@alston1995science] broad claim that impact assessments are insensitive to misspecification of the functional form of the supply curve. More accurately, the literature supports the much narrower claim that impact assessments are insensitive to misspecification when the linear specification is assumed together with a parallel shift, and when the real shift is also parallel; and when the shift is small, and when the farm population consists of identical marginal farms. Apart from this exceptionally implausible case identified by Zhao et al. [-@zhao1997functional], the literature indicates that impact assessments are highly sensitive to functional form, whether directly, as in the case of the CES function, or by the transitive property, i.e., through a supply curve shift which is mathematically prefigured by the functional form of the supply curve.

## Is it impossible to do any better?

As a final line of defense, proponents of conventional aggregate supply curves argue that there is no alternative to their cavalier approach of arbitrarily assuming a functional form for supply curves and supply curve shifts, however implausible or grossly inaccurate they might be. Alston et al. [-@alston1995science] write:

>"What does economic theory tell us about the nature of ...[research induced aggregate supply curve] shifts? Unfortunately, not very much. To be confident about this aspect of the problem would require either (a) precise econometric evidence or (b) detailed information on the effects on individual agents, details of industry structure including details on exit and entry of firms, and a complete theory of aggregation. This information is not available; assumptions are unavoidable".

<!-- The aggregate supply model derived in the subsequent sections -->
The present work is effectively one long disagreement with this passage. The sweeping claim that economic theory does not tell us "very much" about the nature of aggregate supply curve shifts is especially perplexing. On the contrary, economic theory provides a set of microeconomic principles whence a firm level yield envelope is derived, whence "effects on individual agents", i.e., farm level response to exogenous shock, can be can modeled. Insofar as the phrase "complete theory of aggregation" refers to the specification of aggregate supply and demand curves, this too can be derived from theory by integrating individual effects over a suitable density function (i.e., Equation \ref{eq:sup1}). The firm yield model implies bounds on the domain of optimal output, such that the "exit and entry of firms" is accounted for by integrating over the domain of optimal behavior.
<!-- (Similar bounds can be determined for optimal input use, whence an aggregate demand curve could be derived; but the focus here is limited to aggregate supply.) -->

To be clear, the "precise econometric evidence or...detailed information" that the authors refer to is, indeed, generally not available; but the suggestion that economic theory offers nothing in its stead is mistaken. One of the key purposes of having a theory is to draw inference when detailed information is unavailable or otherwise provides no clear answer to our questions. And, yes, "assumptions are unavoidable"---but in the sense that axioms 1-5 in the Introduction are unavoidable, not in the sense of superimposing an exogenously assumed supply response on top of said axioms. Not economic theory, then, but rather a descriptive mathematical formulation which, by construction, precludes endogenous modeling of the aggregate supply response to exogenous shocks, is what tells us "not very much" about the the aggregate supply response to exogenous shocks.
<!-- The authors themselves may have made little use of theory when they specified their linear aggregate supply and demand curves; but this does not mean that others are prohibited from doing so. -->

## The limited policy relevance of conventional forms

Effective policy formation requires careful assessment not only of the magnitude of net benefits of a given intervention, but also of their distribution across producers and consumers (the "food price dilemma"), and across income levels. Proponents and critics alike acknowledge that conventional functional forms are ill suited to the assessment of such distributional issues [@alston2009economic; @alston1995science; @lindner1978supply; @rose1980supply; @wohlgenant1997nature].

More specifically, impact assessments based on a pivot of the linear or CES supply curve can result in consumer-producer tradeoffs, whereas assessments based on a linear parallel shift of the linear supply curve guarantee increases in both consumer and producer welfare [@alston2009economic]. With no clear theoretical or empirical premise upon which to recommend one set of results over another, little confidence can be attached to any of them. This is remarkable considering that the primary motive for conventional supply curve specifications is to facilitate the assessment of changes in consumer and producer surplus. It is also noteworthy that, of all the possible arbitrary configurations of supply curve and type of shift, most agricultural R&D impact assessments assume the one that, by construction, results in the highest net benefits and avoids any food-price dilemma [@hurley2014re; @alston2000research; @alston2009economic].
<!-- mainly because they are not explicitly derived from a theoretical framework that maps model parameters to specific empirical economic phenomena. -->
<!-- Effective food policy formation requires careful assessment not only of the magnitude of net benefits of a given intervention, but also of resulting consumer-producer tradeoffs (the "food price dilemma"), as well as the distributional effects of the intervention across income levels. In recent decades, rural-urban migration, and hence rural employment (farm entry/exit), is also a major concern []; as well as the overarching issue of smallholder price risk and risk-mitigating mechanisms []. -->
<!-- Due to the fundamental disconnect between theory and functional form outlined above,  Impact assessment results regarding consumer-producer tradeoffs vary considerably with the assumed functional form and type of supply curve shift [@alston2009economic].  -->
<!-- conspicuous -->

As for the assessment of impacts on income inequality, conventional models are ill suited because, as noted earlier, they either do not explicitly account for heterogeneous farm endowments (in the case of the CES curve), or assume a population of identically endowed marginal farms (in the case of the linear specification). In some sectors, one might reasonably justify the assumption of homogeneously endowed firms by invoking competitive long run equilibrium. Such arguments are strained in the primary sector, however, where one typically sees an abundance of heterogeneously endowed, inframarginal farms in operation. (See Wohlgenant [-@wohlgenant1997nature] for a deeper treatment of this point.)

Proponents of the conventional approach even go so far as to expressly discourage the assessment of distributional equity vis-a-vis agricultural research, arguing that such issues lie beyond its scope.
<!-- Wohlgenant [-@wohlgenant1997nature] demonstrates that the long run equilibrium supply curve cannot be linear under such circumstances, even if the supply curves of individual farms are all linear. -->

>"For many economists...the only defensible justification for government intervention in agricultural research, and the only legitimate and achievable objective of research, is the pursuit of economic efficiency. This is not to say that other objectives (such as...income distribution and food security) are illegitimate, irrelevant, or unimportant but that there are likely to be alternative, less costly ways to achieve these other objectives than by biasing the agricultural research portfolio away from programs that will maximize total national net income" [@alston1995science].

An underlying assumption here is that distributional equity and economic growth ("efficiency") are mutually exlusive objectives, such that the one cannot be pursued except at the cost of the other. Norton [-@norton1992economic] makes this explicit by actually drawing an equity-efficiency tradeoff frontier to illustrate the concept. Again citing "many economists", he affirms that "agricultural research is a relatively poor instrument for achieving non-efficiency objectives".

The authors provide no references to indicate who they mean by "many economists"; and it is not readily obvious who they might have in mind. On the contrary, many economists think and/or have demonstrated econometrically that the exact opposite is true: agricultural research generally results in agricultural productivity growth, which goes hand in hand with poverty reduction [@rosegrant2001transforming; @ravallion1996important; @thorbecke1996multiplier; @fan2005rural; @bourguignon1998inequality; @timmer1997well; @gallup1998economic; @ravallion1999gowth; @ravallion2002has; @byerlee2009agriculture; @valdes2010reflections; @kydd2004agricultural; @world2007world; @de2020using; @de2022agriculture; @gollin2021two]. Publicly funded agricultural research since the 1960s has generally endeavored to align with pro-poor growth objectives, with mixed success [@thirtle2003impact; @adato2007agricultural; @hazell2001agricultural; @lipton2005family; @redclift1983production; @feleke2016assessing; @pingali1998impact; @mathur2003agricultural]. Moreover, it is now well documented that a nation's economic growth is generally more robust and sustainable in the measure that it is equitable [@partridge1997inequality; @easterly2007inequality; @berg2012makes; @ostry2015inequality; @berg2017inequality; @berg2018redistribution; @ostry2021growth]. Equity and sustainable growth are not mutually exclusive, but rather "two sides of the same coin" [@berg2017inequality].

The lack of any accounting for farm entry/exit 

Effective policy formation also requires careful  rural-urban migration, and hence rural employment (farm entry/exit), is also a major concern [@lall2006rural; @nori2020migration; @crush2013linking].  The conventional approach also takes no account of commodity price risk and risk mitigating mechanisms, which have also received increasing attention in agriculture research and policy discussions [@bellemare2020producer; @byerlee2006managing].

By neglecting farm heterogeneity, the conventional approach also of course precludes decomposition of supply shifts into yield and entry/exit components. The 

entry/exit and yield components [].
price risk

Conventional models also introduce awkward artifacts that further undermine their explanatory power. The CES function, by definition, implies that yield and entry/exit responses to price changes always offset each other precisely such that the elasticity of supply is constant. The linear aggregate supply curve implies the possibility of negative supply quantities and/or of farms producing for free. This either requires redefinition of the curve as a piecewise function---which further complicates interpretation in terms of Equation \ref{eq:sup1}---or compels us to regard the function as a local approximation to some inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point.


## Real consequences


Results vary substantially depending upon The choice of functional form and type/magnitude of exogenous supply curve shift together result in different distribution of net benefits across ...with no theoretical or empirical basis to choose one over the other, this leaves us with an empty feeling

[case in point of Von Neumann? mathematical representations of literary descriptions which are no better than their literary form]

/We are thus presented with a model that in some sense minimizes misspecification error but has numerous implications which may or may not have anything to do with theory and reality  [The consequences of misspecification are hefty...] 

-all bets are off, inc. Zhao et al., when inframarginal firms considered
-equality vs efficiency
-risk
-Impossible to do any better

Regardless of functional form, there remains the issue of type and magnitude of supply curve shift. As noted above, proponents of conventional aggregate supply functions readily acknowledge the sensitivity of impact assessments to this methodological choice. A choice of parallel shift generally results in overestimation of net benefits by a factor of 2 as compared to a pivot or proportional shift, and also producer-consumer surplus tradeoffs. [@alston2009economics].   

Assuming for a moment that it were possible for functional form to somehow be both irrelevant and yet also to prefigure the highly relevant type of supply curve shift,

-uncomfortable or inconvenient tradeoffs between producer and consumer surplus [@voon1991calculation; @rose1980supply].
-sensitivity to type of shift [@alston2009economics].
-all bets are off, inc. Zhao et al., when inframarginal firms considered
-equality vs efficiency
-risk

Then fall back on "it's impossible".

Real consequences

cite the now unavailable annex as providing empirical evidence that the error in impact assessment due to misspecification of the functional form is "small as long as the size of the exogenous supply curve shift is small". In their own analysis, Zhao et al. [-@zhao1997functional] go on to analytically demonstrate that assessment error due to misspecification of the functional form is negligible when a parallel shift is assumed, but quite considerable when a proportional shift is assumed. Since proportional shifts are more likely (b/c of the observations of Rose, Lindner and Jarrett, Wohlgenant mentioned above), this means that functional form matters, contrary to the claim. One does not escape by assuming a parallel shift, but merely adds another source of error on top.


Even if it were true that the functional form of the supply curve were trivial, there remains the issue of type of supply curve shift, which the proponents of conventional aggregate supply curves readily admit is highly non-trivial... Introduces tradeoffs between consumer and producer surplus. Not a matter of consensus...Voon and Edwards argue to the contrary. A matter of convenience to avoid complex questions of tradeoffs between producers and consumers.

Finally, regardless of the foregoing, pales in comparison to the more important issue of assuming identical marginal firms...

[It is unclear how being right on this point is of any benefit to them, as it then leads to the issue of shift which they readily concede ...   Besides, the argument from shift does not absolve them since they recognize that choice of shift too is an arbitrary decision, and readily concede that this choice may bias the impact assessment... No consensus on the issue, Voon and Edwards 1991 compare linear shift and CES pivot and choose CES pivot as more realistic for agricultural commodity supply curves, noting that empirical estimates of short and long run supply "have often been reported in the ineleastic range", and noting that the linear alternative introduces the awkward artifact of negative prices. Conspicuous as alternative choices of shift result in tradeoffs between consumer and producer surplus.  They then discourage any progress towards an empirically and theoretically sound model specification by characterizing the ]



...also the economic equality vs. efficiency dichotomy, ag a poor choice for distributional justice --- out of line with the CG pro-poor mandate and with the new agricultural paradigm literature, pro-poor growth [IMF evidence].
...donors have stopped believing the assessments...MIRR a cosmetic fix




The type of shift is largely prefigured by the choice of functional form. As noted by Lindner and Jarrett . Alston et al. themselves acknowledge that they are related ("but separate");... and to this extent the type of shift is functional form. If the two are to be separated it must be in a highly qualified sense, which is not offered by the authors.




readily admit that there is no empirical or theoretical justification for one type of shift over another [@alston2009economics]. The only argument they offer in their defense is that the error  impact assessment results are not sensitive to the choice of shift.

Proponents of the conventional models concede that there is no empirical or theoretical justification for them, and, as a last line of defense claim that accurate representation of the aggregate supply curve is unimportant for the purposes of impact assessment.

 
Lindner and Jarrett note that inframarginal farms convergent divergent... Rose... Wohlgenant inframarginal. Alston et al. subsequently acknowledge that proportional shift is more realistic, and parallel quite unrealistic. (and lets not forget they are assuming identical marginal firms)
Rose's comment about the "only realistic strategy" is in reference to the impossibility of determining where the inframarginal farms are on the aggregate supply curve, and thus the impossibility of specifying the convergent/divergent shift.
 
Finally, the model introduces awkward artifacts...does not account for risk...(Alston et al. quote about risk)...no treatment of distributional issues, quite out of step with the pro-poor mandate and strategic objectives of CG...



Because of the way they formulate the problem, they cannot solve it.



The mechanism by which the farm level response is then translated into a 
<!-- providing very little basis upon which to objectively assess the plausibility of a representation of a given exogenous shock in terms of changes in model paremeters, or to attribute modeled impacts to the exogenous shock with confidence. -->

In the assessment of technology shocks, particularly, it is unclear how the shock might be accurately represented in terms of a change in the model's parameters, or even which parameters are affected. Instead of attempting to represent the technological shock directly, then, expedient models typically forgo any endogenous economic modeling of the relation between technology and management, and instead introduce the farm supply and/or expenditure response to technology exogenously, based on field trial data and consultation with scientists involved in the research under evaluation. 

The subsequent step of determining how the exogenously introduced farm level supply/expenditure shock then manifests at the aggregate level is likewise less a matter of endogenous economic modeling than it is of exogenous guesswork translated into mathematical symbols. The usual assumption since the 1990s is that the shock manifests as a parallel shift of the aggregate supply curve [@alston1995science]. But no theoretical or empirical grounds exist for this preference over, say, a supply curve pivot, or a combination of pivot and shift, which would result in a very different calculation of net benefits [@alston1995science; @alston2009economics]. [Again, because there is no clear mapping between model parameters and empirical phenomena, then, by construction, the model can offer no .]
<!-- Again, because the aggregate model is not explicitly built up from a farm level function of relevant measurable input and control variables, the aggregate model, by construction, precludes the possibility of endogenously modeling the change in aggregate supply curve response to technology. The change is thus     The calculation of net benefits hinges critically upon which kind of aggregate shock is introduced. -->

<!-- in particular its theoretical premises and derivation, its estimation, and the assumptions upon which it rests.  In the present article we dubious assumptions and theoretically opaque modeling---especially ---that generate implausibly high projections of net benefits in the first place. -->
<!-- In other words, there is a demand for theoretical transparency and consistency, and empirical plausibility in the ex-ante impact assessment itself, not in how the result of the assessment is discounted back to the present. -->
<!-- Insofar as this suspicion is correct, MIRR is but a cosmetic dressing up of implausibility that fails to address the real root of the problem. -->
<!-- Or, at the very least, it points to a growing, unmet demand for more . -->
<!-- conclude that donors have stopped believing them. This is a more telling indicator than popularity, suggesting that expedient specifications are insufficient for most purposes---i.e. for the purposes of producing accurate, unbiased, credible ex-ante impact assessments.  -->
<!-- Self-interest might also play a role, as the opacity of such models is known to invite misuse and abuse in the form of overstated net benefits [@alston2001attribution; @hurley2014re].-->
Alternative/complementary motive: The many methodological headaches accumulated in the pursuit of expedience, a few of which are enumerated above, raise the question of whether the expedient form is expedient at all, i.e. of whether we are in fact gaining the expedience we expected in return for our sacrifice of theoretical rigor and explanatory power; raising the question of whether perhaps the expedience of rigorous form ...at the very least it is worth exploring just what sort of price we pay in expedience for following a theoretical derivation rigorously. Here I present one such exploration of this alternative route. The results of the exploration suggest there is in fact no rigor-expedience tradeoff, that the most expedient form is also the most rigorous.


<!-- typically boils down a matter of methodological fiat. again because the ... precludes any clear mapping between model parameters and real economic phenomena...  That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate impact of the farm level yield/expenditure shock should be represented as a shift or a pivot of the aggregate supply curve [@alston1995science; @norton1981evaluating; @lindner1978supply], proponents of the parallel shift , even though, by the authors' own admission, there are no theoretical or empirical grounds to justify this preference [@alston1995science; @alston2009economics]. -->
<!-- efectively not modeled but asserted... the outward economic markings/trappings just pageantry; the key elements of the model prefiguring the results of the assessment have little or no basis in economic theory, and are not even modeled, but rather exogenously asserted. to this extent/in this measure assertion not assessment, petitio principii. -->
<!-- Again, because the aggregate model is not explicitly grounded in microeconomic principles, and thus has a tenuous connection to empirical phenomena, then, by construction, the aggregate model has nothing clear to say about the nature of the aggregate supply response to technology shocks. There was considerable debate in the 1970s over whether the research-induced supply curve shift should be modeled as a parallel shift or a pivot , which was ultimately inconclusive. -->
<!-- Without a theoretical framework to link parameter values and functional forms to real world conditions, the debate was ultimately inconclusive. -->
<!-- The debate was further complicated by differing views as to whether supply should be modeled as a linear or a curved function.   Modeling results depend critically upon these choices. A curved specification    The answers to the questions left unresolved by the debate have come down to us today as a matter of preference. -->
<!-- [and thence to endogenously deduce the farm supply and expenditure response based on economic theory,] -->
<!-- Model guidelines might advise care be taken to adjust the elicited estimate for differences between economically and agronomically optimal yields, and to adjust for the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation, but offer little in the way of a practical, formal method for achieving such adjustments. (Otherwise, why not just model the supply/expenditure response to technology endogenously in the first place?) -->
<!-- technological shock will affect the  [Because no farm level yield or production envelope ($q^*$) is ever cited or derived from microeconomic principles, expedient modelers preclude any chance of leveraging microeconomic theory to draw inference about the farm level supply and expenditure response to changes in technology.]  -->
<!-- Moreover, such models ignore changes on price elasticity.  -->
<!-- [Romer has macroeconomic modeling in mind, but the principle applies here too.] -->
<!-- The slippage ... to confuse results with assumptions (petitio principii), or, as in the case of the economic surplus model, to infuse a collection of contradictory and/or unfounded assertions with an air of rigor and coherence. -->
<!-- More recently, Romer has similarly criticized the rise of "mathiness" in economic modeling. -->
<!-- "There is no point in using exact methods where there is no clarity in the concepts and issues to which they are to be applied" [@morgenstern1953theory]. -->
<!-- "the economic problems were not formulated clearly and are often stated in such vague terms as to make mathematical treatment _a priori_ appear hopeless because it is quite uncertain what the problems really are" [@morgenstern1953theory]. -->
 <!-- (the attribution problem) -->
<!-- The widely implemented linear aggregate supply curve, for example, assumes homogeneous factor endowment and output across all farms, effectively implying that $\rho(q^*)$ is congruent to a Dirac delta density function, and that the domain of profitable production is a single value. Wohlgenant [-@wohlgenant1997nature] demonstrates analytically that impact assessment results can be highly sensitive such brazen oversimplifications. -->
<!-- [...holding multiple axioms without knowing if they perhaps contradict each other...] -->
<!-- [This, in turn, complicates the defense of any modeling results, especially when the modeler or their source of funding have a vested interest in said results.. as it boils down to modeler fiat not to any verifiable presmises] -->
<!-- adoption -->
<!-- [, while adding more layers of methodological wrangling/theoretical opacity.] -->
<!-- [which in turn invites misuse and abuse of the model, and otherwise complicates the defense of any modeling results.] -->
<!-- [the mathematical expression no different from the same statement in literary form] -->
<!-- [Meanwhile, the growing disparity between current research funding levels and the levels that would seem to be justified by expediently specified ex-ante impact assessments suggests that donors have stopped taking the results of such models seriously...] -->
<!-- , which was at a premium when these models were first popularized in the post-WWII literature. -->
To be fair, the whole point of an expedient model is to deliberately sacrifice a degree of theoretical rigor, and hence of explanatory power, in exchange for computational expedience. And the thousands of published ex-ante impact assessments of agricultural research that specify linear aggregate supply and demand functions would seem to some to suggest that the explanatory power retained by such specifications is sufficient for most modeling purposes [].
<!-- [Expedience no longer a pressing concern due to high cpu power.] -->
<!-- in ex-ante impact assessment, as in movies, music, or anything else, -->

However, popularity is often a misleading indicator of quality. A more telling indicator is the growing "disconnect" between the actual level of funding for agricultural research and the level of funding that would be justified by impact assessments conducted on the basis of expedient aggregate supply models [@hurley2016returns]. There is good reason to suspect that this disconnect is due to the implausibly high---and sometimes absurdly high---internal rates of return reported in conventional impact assessments of agricultural R&D [@hurley2014re; @alston2001attribution; @hurley2016returns]. (The high reported returns are, of course, made more conspicuous by the aforementioned conflict of interest inherent in the expert opinion on which these studies are typically based.) In a meta-analysis of 492 such impact assessments, for example, Hurley et al. [@hurley2016] note that the average reported internal rate of return (IRR) implies that the USDA's 2000 R&D investment of \$4.1 billion should be worth \$56.3 quintillion in 2050, or 2.3 million times projected world GDP at that time.^[The meta-analysis covered a variety of impact assessment methods in addition to expedient specifications of aggregate supply (economic surplus analyses). It is safe to assume that most of these studies were economic surplus analyses.] "[I]t is not difficult to see," the authors conclude, "how policy makers may question the credibility of such evidence" [@hurley2016].
<!-- It could merely reflect the low cost of implementing the model, for example, and/or the lack of comparably low cost alternatives.  -->
<!-- [In discussion: The implausibility is made more conspicuous considering that these assessments are typically written by or in close consultation with the scientists whose research is under evaluation, and who thus have a vested interest in its success.] -->

Hurley et al. [@hurley2014re] respond to the incredulity of policy makers by replacing IRR with their "modified" IRR or "MIRR", whereby implausibly high projected returns are deflated to plausible levels. This is a suitable response insofar as the implausibility in question is rooted in the discounting method (although see the debate between Ohemke [-@oehmke2017re] and Hurley et al. [-@hurley2017re]). However, the discussion above is good reason to suspect that much of the incredulity is in fact aimed at the impact modeling itself, particularly the modeling of aggregate supply and the supply response to exogenous shocks. Insofar as this is true, MIRR is an insufficient response, and may even exacerbate the problem by masking its real source.



















* Proponents of these models presume to dismiss such objections on the grounds that the functional form doesn't matter results aren't sensitive to them, and that theory has "very little to say" about the derivation of aggregate supply models. When reviewing the literature, the first of these arguments turns out to be baseless, while the second is patently false. [Maybe save for expansion:] Theory tells us that aggregate supply can be written down as follows.... Theory thus tells us that the aggregate supply we have to think carefully about farm production function $q$, the farm production density $...$, the bounds over which the integral i.e. farm entry/exit, And it tells us that $q(x, constraints)$ must satisfy certain microeconomic axioms regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves. It only remains to take the steps . Instead of starting here, however, the convention is to start here: ...linear or ...CES, with no regard for how this form results from the definite integral in Equation... or if it is consistent with microeconomic axioms etc.,. By starting here, preclude any discussion of microeconomic theoretical underpinnings role for theory. Theory is silent because the modeler has decided to proceed in a way that precludes any theoretical discussion, by construction. 





* By construction, then, these models ... petitio principii
As a result, the mapping between the parameters that appear in these conventional models and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.) is necessarily tenuous, such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters might be affected.... farm entry/exit. 

* Argue that functional form unimportant and that economic theory tells us "very little" on which to base a model derivation.

* For those interested in a model built up from microeconomic axioms, a model of aggregate supply is presented below derived from 5 axioms... farm entry/exit... address the conclusion that economic theory tells us little and that functional form doesn't matter. 

Conventional linear and constant elasticity of supply (CES) aggregate supply curves such as those featured in have long been used in ex-ante impact assessments of new agricultural technology [@alston1995science; @alston2009economics], are specified for the purpose of facilitating certain calculations (especially of economic surplus), with little or no consideration given to the plausibility of the theoretical underpinnings and empirical implications of the choice of functional form. In particular, it is unclear whether such models are consistent with standard microeconomic assumptions regarding homogeneity, convexity/concavity, profit maximization, and the slope of farm level supply and input demand curves. The documentation of such models might make passing reference to these axioms; but the models themselves are not formally derived from them.

Moreover, these conventional models do not explicitly account for the shape of the farm yield density (i.e., heterogeneity in farm endowments)---or, worse still, assume that all farms are homogeneously endowed and produce identically. This, in turn, precludes any explicit accounting for farm entry/exit effects on aggregate supply. In some sectors, one might reasonably justify this omission by invoking competitive long run equilibrium. The case for competitive long run equilibrium is strained in the primary sector, however, where one often sees an abundance of inframarginal farms in operation. Wohlgenant [-@wohlgenant1997nature] provides an analytical exploration of the distortions that can occur when neglecting to account for heterogeneity and inframarginal production.

As a direct consequence of the tenuous connection with reality and with standard theoretical premises described above, the mapping between the parameters that appear in these conventional models and the relevant, measurable empirical phenomena (i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.) is likewise tenuous, such that it is not clear how a change in any of these phenomena might be accurately represented in terms of a change in parameter values, nor even which parameters are affected. This, in turn, precludes any endogenous modeling of economic decision making on the part of farmers in response to technology, or any other exogenous, shocks. Instead, such models introduce farm level economic decision making (i.e., the economically rational supply/expenditure/input mix response to the exogenous shock) as a calibrated assumption based on agronomic data gathered from field trials, literature, and/or consultation with scientists involved in the research under evaluation.

This bears emphasis. Conventional supply models specifically designed for ex-ante impact assessment of new technology do not in fact model the supply response to new technology, but rather present a mathematical depiction of a presumed supply response that has been predetermined outside of the model, and then exogenously introduced into it. 

The subsequent step of translating the exogenously introduced farm level response into an aggregate supply response is, likewise, not an endogenous model of economic behavior, but rather exogenous guesswork translated into mathematical symbols. That is to say, after a long and inconclusive debate in the 1970s over whether the aggregate supply response should be represented as a pivot or parallel shift of the curve, or of some combination thereof [@alston1995science; @norton1981evaluating; @lindner1978supply], the parallel shift has emerged as the 
 Conventional models of aggregate supply do not in fact model the economic decision making, i.e., changes in expenditure, input mix   are not models of aggregate economic behavior, but rather a translation into mathematical symbols of   economic model That is to say, the model 
 

In ,  ; and it is unclear what shape of farm production density function is implied by the model. That is to say, if we consider aggregate supply $Q$ in its most basic definition as the definite integral of farm production function $q^*$ times the production density $\rho(q^*)$ over the domain of profitable production $(\underline{q}^*, \overline{q}^*)$,

\begin{equation}
Q(P) = \int_{\underline{q}^*}^{\overline{q}^*} q^* \rho(q^*) \: dq^*
\label{eq:sup1}
\end{equation}

then it is not readily apparent from conventional specifications of $Q$ what the functions $q^*$ and $\rho(q^*)$ are, nor whether they are consistent with microeconomic principles. Critically, expedient specifications of $Q$ also omit or gloss over farm entry and exit---i.e. the domain of profitable production $(\underline{q}^*, \overline{q}^*)$---such that it is not possible to decompose changes in aggregate supply into yield and farm entry/exit components. Some expedient forms also introduce awkward artifacts---such as the possibility of negative supply quantities and/or of farms producing for free, in the case of the linear aggregate supply curve---which further undermine the model's explanatory power.

The theoretical opacity of expedient aggregate models introduces considerable empirical opacity as well. That is to say, because expedient aggregate models are not explicitly built up from a farm level function of relevant, measurable, phenomena---i.e., technology, input prices, agroclimatic conditions, demographic variables, etc.---the mapping between these phenomena and the parameters appearing in the aggregate model is tenuous. This leaves very little basis upon which to assess the plausibility of different parameterizations of a given exogenous shock, or to attribute modeled impacts to the exogenous shock with confidence.


To redress the incredulity of policy makers insofar as it is directed at theoretically and empirically opaque modeling of aggregate supply and of research/policy induced supply curve shifts, here I derive an aggregate supply model prioritizing theoretical transparency and consistency. More specifically, I 1) derive a farm level production function $q^*$ from three non-controversial microeconomic axioms, 2) introduce a lognormal farm density function $\rho(q^*)$ as the fourth axiom, which then leads to a simplification of the integral in Equation \ref{eq:sup1} to a tractable analytic expression, and 3) introduce a fifth axiom to explicitly account for the stochastic character of output price and yield, which then leads to an even more instructive and intuitive form of the integral in Equation \ref{eq:sup1}. including a term that explicitly captures farm entry/exit in response to price movements and risk. This term is surprisingly instructive and intuitive, as it is proportionate to the probability that output price will be greater than the mean farm's expected cost per unit output at harvest---i.e. the mean farm's probability of profit. Because the model is explicitly built up from a farm level function, all parameters appearing in the model have a straightforward mapping to the relevant, measurable, empirical phenomena, such that the supply and expenditure response to changes in these phenomena is modeled endogenously, as opposed to being exogenously asserted as in the expedient conventional way.   The supply response---aggregate or farm level---to changes in any of these phenomena, whether it be technology, input prices, agroclimatic variables, or something else, is easily inspected by differentiating the aggregate supply curve with respect to the variable of concern. This allows for high fidelity, explicit modeling of simultaneous, multi-faceted exogenous shocks (e.g., a technology shock in conjunction with an input subsidy, considered under different future demographic and agroclimatic scenarios). The expedient model by contrast would have to introduce these shocks as exogenous changes in yield/expenditure, each of which with its own empirical justification conflict of interest issues, greatly compounding the problem.  It also allows for close inspection of conventional wisdom. The price elasticity of supply agrees with conventional wisdom, consisting of a technology term plus a farm entry/exit term. The derivative of aggregate supply with respect to technology, on the other hand, turns out to be considerably more complex than is typically assumed. Any results that seem peculiar can be traced back to specific assumptions regarding economic behavior, and/or the estimation of specific parameter values. ....the other desirable properties following as corollaries

The aggregate supply curve presented below is derived from the following five axioms:

<!-- The exogenously introduced yield and/or expenditure shock is typically estimated based on field trial data and/or consultation with scientists closely involved in the research. Model guidelines might mention the need to adjust the elicited estimate for differences between agronomically optimal yields at an experimental station and economically optimal yields in a real farm population; and to compensate for bias resulting from the glaring conflict of interest inherent in the expert opinion of scientists closely involved in the research under evaluation; but offer nothing in the way of practical, concrete steps that can be implemented within the timeframe of an impact assessment.     formal adjustment method since, in the name of expedience, no farm yield envelope is ever invoked or derived from microeconomic principles. -->

<!-- and b) recommend steps  But, as to (a),  The same guidelines might also  Alston et al. [], e.g., recommend creating an atmosphere (b) creating an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and (c) creating an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact (e.g., by comparing actual achievements within programs over time against scientists' forecasts of what would be achieved). -->

# Methodology

Below the agg sup curve is derived from axioms 1-5. First the farm production function is derived from axioms 1 and 2. Then a provisional aggregate supply function is derived from the farm production function and axioms 3 and 4. This is provisional in the sense that it does not take into account the stochasticity of output price and certain agroclimatic variables. The final aggregate supply function is final step of introducing axiom 5 gBm... resulting in the final form.

## Derivation of the farm production function from axioms 1 and 2

Throughout much of written history, astute observers have noticed that the usefulness of increments in the quantity of a good is inversely proportional to amount of the input or good or service already acquired [@kauder1953genesis]. In 1738, Daniel Bernoulli put it this way:
<!-- an input (in the case of producer yield functions) or good or service (in the case of consumer utility functions) -->

>\singlespacing "In the absence of the unusual, the utility resulting from any small increase in wealth will be inversely proportionate to the quantity of goods previously possessed" [@bernoulli1954exposition].

\doublespacing
<!-- Today, this is known as the "law of diminishing marginal returns". -->
<!-- \begin{framed} -->
<!--    \textbf{Axiom 1} \\ The law of diminishing marginal returns. -->
<!-- \end{framed} -->
<!-- Formalization of Bernoulli's verbal statement of the law of diminishing marginal returns depends upon how one defines "small increase". If "small increase" means a marginal increase, then Bernoulli's statement can be written down as follows.^[Bernoulli himself could not have had "marginal increase" in mind per se, as calculus had not yet been invented.] -->

Today, this is known as the "law of diminishing marginal returns". Bernoulli's statement is a consumer side formulation of the law. It can also has a producer side formulation: "In the absence of the unusual, the yield increase resulting from any small increase in a given input will be inversely proportionate to the quantity of the input already applied." With the aid of calculus (which was not available to Bernoulli), this may be formalized as follows.

\begin{equation}
\frac{\partial \ln(y)}{\partial x} \sim \frac{1}{x}
\label{eq:dimUtilDefine}
\end{equation}

Where, to be clear, the term $\partial \ln(y) / \partial x$ is the [percentage change in yield?] change in total yield given a marginal increase in the quantity of good $x$, and "$\sim 1 / x$", means "inversely proportionate to the quantity of good $x$ already acquired". An expression $y(x)$ for the yield of good $x$ can then be obtained by integrating Bernoulli's statement.

\begin{equation}
\begin{split}
\int \frac{\partial \ln(y)}{\partial x} \: dx &= \int \alpha \frac{d \ln(x)}{dx} \: dx \\
\ln(y(x))  &= \alpha \ln(x) + k \\
y(x) &= e^k x^{\alpha}
\end{split}
\label{eq:integrate_lny}
\end{equation}

Where the proportionality constant $\alpha = \partial \ln(y)/ \partial \ln(x)$ is the input elasticity of yield, i.e., the percentage change in yield given a $1$ percent increase in input $x$.

In the multivariate case, an expression $y(\mathbf{x})$ for yield as a function of a vector of $n$ goods $\mathbf{x} = [x_1,x_2,...,x_n]$ can be obtained as follows.

\begin{equation}
\int \nabla_{\mathbf{x}} \ln(y) \cdot d \mathbf{x} = \int D(\boldsymbol{\alpha}) \nabla_{\mathbf{x}} \ln(\mathbf{x}) \cdot d \mathbf{x}
\end{equation}

\begin{equation}
\begin{split}
\ln(y(\mathbf{x})) &= \boldsymbol{\alpha} \cdot \ln(\mathbf{x}) + \alpha_0 \\
y &= e^{\alpha_0} \prod_{i = 1}^{n} x_i^{\alpha_i}
\end{split}
\label{eq:cobbDoug}
\end{equation}

where $\boldsymbol{\alpha}$ is the vector of input elasticities corresponding to each $x_i$, the notation $D(\boldsymbol{\alpha})$ indicates a diagonal matrix with the elements of $\boldsymbol{\alpha}$ along its diagonal, and

\begin{equation}
\nabla_{\mathbf{x}} \ln(y) = \left[ \begin{matrix} \frac{\partial \ln(y)}{\partial x_1} \\
\frac{\partial \ln(y)}{\partial x_2} \\
\vdots \\
\frac{\partial \ln(y)}{\partial x_n}
\end{matrix} \right]
\end{equation}

It is straightforward to see that equation \ref{eq:cobbDoug2} is a homogeneous (and thus also homothetic) function with degree of homogeneity $h$ equal to $\sum_i \alpha_i$. There is no need, then, to impose homogeneity as an additional axiom. It follows from the axiom of diminishing marginal returns.

Empirical analysis involves exogenously given control variables ($k_i$), typically including demographic variables such as age, education, gender, household size, as well as agroclimatic variables such as temperature, rainfall, soil conditions, and so forth. Equation \ref{eq:cobbDoug} is thus henceforth rewritten as follows.
<!-- (Analysis is said to be "ceteris paribus" when these variables are held constant at a particular value across the population.) -->

\begin{equation}
y = g_0 \prod_{i = 1}^{n_k} k_i^{\kappa_i} \prod_{i = 1}^{n_x} x_i^{\alpha_i} \:\:;\:\:\: g_0 = e^{\alpha_0}
\label{eq:cobbDoug2}
\end{equation}

Where the $\kappa_i$ are the control variable elasticities of yield. Because the control variables $k_i$ are non-discretionary, the corresponding elasticities $\kappa_i$ may take positive or negative values. The input elasticities $\alpha_i$, on the other hand, which correspond to discretionary management variables, are generally positive. For purposes of economic analysis, the degree of homogeneity is calculated only over the production elasticities corresponding to management variables ($h = \sum_i \alpha_i$, omitting the $\kappa_i$).
<!-- However, there may arise cases where a variable does not fall neatly into either the management or control category. In the empirical analysis presented farther below, for example, the coefficient on child family labor takes a negative value. Labor is generally considered a discretionary management variable; but family labor, and especially child family labor, might, in some cases, better be considered a control variable, indicative of hard constraints beyond the farmers' discretion. -->
<!-- Axiom 1 gives us the farm yield function as a multivariate power law (see Appendix for details of the derivation.) -->
<!-- Where the $x_i$ are management inputs (fertilizer, etc.), the $k_i$ are control variables (demographic and agroclimatic variables, etc.), and the $\alpha_i$ and $\kappa_i$ are input and control variable elasticities of yield, respectively. The input elasticities of yield are also referred to collectively as the "technology". The product bounds $n_x$ and $n_k$ indicate the number of inputs and control variables, respectively. -->
<!-- The variables $x_i$ and $k_i$ are assumed to be linearly independent and are divided by their population means ($\tilde{x}_i$, $\tilde{k}_i)$, such that $y_0$ may be interpreted as the mean yield.  -->

This is, of course, the Cobb-Douglas form. Outside of Economics, it would simply be referred to as a (multivariate) power law. Such forms are often good models of observed processes across a wide range of research contexts and disciplines. In Economics, the Cobb-Douglas form was widely used from the 1920s to 1950s on the basis of its good empirical fit, but fell into disrepute thereafter for its perceived lack a theoretical basis. Capalbo and Antle [-@capalbo2015agricultural] offer a succinct introduction to this vast discussion. The forgoing derivation of the Cobb-Douglas form from axiom 1 in some measure redresses the lack of a theoretical basis. A full defense against all of the criticisms levied against this form over the past seventy five years is a book-length project that will not be attempted here.
<!-- [Other perceived shortcomings of the form are briefly addressed in the Discussion. if there is enough space!] [Or: In the course of the derivation below, a number of theoretical strengths are brought to light---underrepresented or overlooked by textbook treatments---that cast doubt on the bad reputation as a "restrictive" model] -->

Interpretation of the constant $g_0$ is as difficult as one wants to make it. It is, of course, usually called the "total factor productivity", and understood to represent the yield per unit "all inputs"---although a more accurate description would be yield per unit "all input and control variables, raised to various powers". For those not yet comfortable working in units of, say,

$$
\text{kg.} \times \: \text{acres}^{-1} \times \: \text{liters}^{-\alpha_{pest}} \times \: \text{kg.}^{-\alpha_{fert}} \times \: \text{manhours}^{-\alpha_{labor}} \times\: \\ \text{mm.}^{-\alpha_{rain}} \times\: \: \text{years}^{-\alpha_{age}} \times\: \text{num. persons}^{-\alpha_{HHsize}} \:;\:\: \alpha_{(var)} \in \mathbb{R}
$$
an alternative approach is to define $g_0$ in terms of a new parameter combined with judiciously chosen reference terms such that the new parameter has a meaningful interpretation and/or results in a more useful expression for yield. For present purposes, $g_0$ is defined as follows
<!-- in terms of another constant $u_0$, the means $E[x_i]$, and the mean of    fixed reference values $\tilde{k}_i$, $\tilde{x}_i$ that have the same units as the corresponding management and control variables $x_i$ and $k_i$. -->
<!-- Because the ratios in parentheses are dimensionless, $y_0$ must have the same units as $y$; and $y_0$ may be interpreted as the value of $y$ when all management and control variables equal their reference values. In the empirical study included here, for example, the reference values are set equal to the sample means, such that $y_0$ is the value of $y$ evaluated at the sample means of the input and control variables. -->

\begin{equation}
g_0 = \frac{u_0}{E[\prod_{i = 1}^{n_k} k_i^{\kappa_i}] \prod_{i = 1}^{n_x} E[x_i]^{\alpha_i}}
\label{eq:u0_for_g0}
\end{equation}

Such that $y$ may be rewritten

\begin{equation}
y = u_0 \frac{k}{E[k]} \prod_{i = 1}^{n_x} \left( \frac{x_i}{E[x_i]} \right)^{\alpha_i} \:\:;\:\:\: k = \prod_{i = 1}^{n_k} k_i^{\kappa_i}
\label{eq:cobbDoug3}
\end{equation}

This substitution will soon be seen to facilitate interpretation and manipulation of the optimal yield function. But first the optimal yield must be derived from axiom 2. The introduction of axiom 2---profit maximization---gives the optimal inputs (see Appendix A1 for details).

...in passing...diminishing returns to scale. Constant returns to scale ($h = 1$) imply the break-even point, while increasing returns to scale ($h > 1$) imply a loss. The farm yield function is thus globally concave in inputs. Constant and increasing returns, on the other hand, would imply global linearity and convexity, respectively.

\begin{equation}
x^*_i = \frac{y^* P \alpha_i}{\lambda w_i}
\label{eq:inputDem1}
\end{equation}

Where $P$ is the output price, $w_i$ is the $i^{th}$ input price, $\lambda$ is the farm budget shadow price, and $y*$ is the optimal yield, i.e., the yield function in Equation \ref{eq:cobbDoug2} evaluated at the optimal inputs $x^*_i$. Multiplying this expression for $x^*_i$ by $w_i$ and summing both sides over $i$ gives an expression for optimal cost or expenditure ($C^*$).

\begin{equation}
C^* = R^* \frac{h}{\lambda} \:;\:\:\: R^* = y^* P
\label{eq:cStar}
\end{equation}

Such that optimal input may be rewritten

\begin{equation}
x^*_i = \frac{C^* \alpha_i}{h w_i}
\label{eq:inputDem2}
\end{equation}

By which it also follows

\begin{equation}
\frac{x^*_i}{E[x^*_i]} = \frac{C^*}{E[C^*]}
\end{equation}

Such that the optimal farm yield $y^*$ (Equation \ref{eq:cobbDoug3} evaluated at $x^*_i$) may be expressed

\begin{equation}
y^* = u_0 \frac{k}{E[k]} \left( \frac{C^*}{E[C^*]} \right)^h
\end{equation}

The expression can be simplified still further by taking the expectation and solving for $u_0$.

\begin{equation}
u_0 =  E[y^*] \frac{E[C^*]^h}{E[C^{*h}]}
\end{equation}

And then substituting this for $u_0$ in the yield expression.

\begin{equation}
y^* = E[y^*] \frac{k}{E[k]} \frac{C^{*h}}{E[C^{*h}]}
\label{eq:YdEnvNeat}
\end{equation}

This expression is particularly useful for estimation, as it only requires information on the control variables $k_i$ and total cost $C^*$, and no information on individual input quantities, as would be required when estimating Equation \ref{eq:cobbDoug3}. Given farm data, one specifies the model

\begin{equation}
\hat{y}^* = v_0 k C^{*h} \:\:;\:\:\: v_0 = \frac{E[y^*]}{E[k] E[C^{*h}]}
\label{eq:YdEnvReg}
\end{equation}

Such that the estimated coefficient on logged farm cost may be directly interpreted as the degree of homogeneity for the population. When estimating the model in Equation \ref{eq:cobbDoug3}, by contrast, $h$ must be tallied by summing the estimated coefficients $\alpha_i$, and will likely vary across the population since not all farms necessarily apply all the inputs specified in the model.
<!-- Moreover, once $v_0$ is estimated,  -->
<!-- A further advantage of this form is that the fitted coefficient on $\ln(C^*)$ may be directly interpreted as $h$, valid for all farms in the sample. Estimation of the model in Equation \ref{eq:cobbDoug3}, on the other hand, requires the extra step of summation of the input elasticities $\alpha_i$ in order to arrive at $h$. This may result in varying $h$ across the sample, as not all farms necessarily apply all the inputs specified in the model. -->

[Note somewhere that cost does not change exogenously but as a result of change in P, lambda, or tech (h)]

To develop an expression for aggregate supply, it is useful to express $y^*$ in terms of cost per unit output---also commonly referred to as "average cost". Denoting this $C^{\#}$, then by definition,

\begin{equation}
C^{\#} = \frac{C^*}{y^*}
\end{equation}

Substituting $C^{\#} y^*$ for $C^*$ in Equation \ref{eq:YdEnvNeat} and solving for $y^*$ gives

\begin{equation}
y^* = E[y^*] \left( \frac{k}{E[k]} \right)^{\frac{\eta}{h}} \frac{C^{\# \eta}}{E[C^{\# h}]^{\frac{\eta}{h}}} \:\:\:;\:\:\:\: \eta = \frac{h}{1 - h}
\end{equation}

Taking the expectation and rearranging gives 

\begin{equation}
E[k]^{\frac{\eta}{h}} E[C^{\# h}]^{\frac{\eta}{h}} = E[k^{\frac{\eta}{h}}] E[C^{\# \eta}]
\end{equation}

Such that the previous expression simplifies to

\begin{equation}
y^* = E[y^*] \frac{k^{\frac{\eta}{h}}}{E[k^{\frac{\eta}{h}}]} \frac{C^{\# \eta}}{E[C^{\# \eta}]}
\label{eq:YdEnvNeatSharp}
\end{equation}

While this is a poor choice of econometric yield model (because cost per unit output is calculated as a function of yield, and would thus introduce an endogeneity problem if used in an OLS regression), it is an expedient way of deriving the aggregate supply function. Farm production $q^*$ is defined as $y^*$ times area $k_a$.

\begin{equation}
q^* = k_a y^*
\end{equation}

Substituting this into Equation \ref{eq:sup1} gives

\begin{equation}
\begin{split}
Q = N \int_{\underline{q}^*}^{\bar{q}^*} \rho(q^*) dq^* \\
&= N \int_{0}^{\infty} k_a \int_{0}^{\bar{y}^*} \rho(y^*) dy^* \rho(k_a) dk_a \\
&= N E[k_a] \frac{E[y^*]}{E[k^{\eta / h}] E[C^{\# \eta}]} \int_{0}^{\infty} k^{\frac{\eta}{h}} \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#}) dC^{\#} \rho(k) dk \\
&= N E[k_a] \frac{E[y^*]}{E[C^{\# \eta}]} \int_{0}^{\bar{C}^{\#}} C^{\# \eta} \rho(C^{\#})
\end{split}
\end{equation}

Axiom 4 states that farms enter production only if they expect to make positive profit. This condition may be formalized $R^* > C^*$, which in turn implies $P > C^{\#}$. By axiom 4, then, the upper bound of integration $\bar{C}^{\#}$ must be $P$.

\begin{equation}
Q = N E[k_a] \frac{E[y^*]}{E[C^{\# \eta}]} \int_{0}^{P} C^{\# \eta} \rho(C^{\#}) dC^{\#}
\end{equation}

If $y^*$ is lognormally distributed (axiom 3), then $C^{\#}$ is also lognormally distributed, and the integral in this expression resolves to

\begin{equation}
\int_{0}^{P} C^{\# \eta} \rho(C^{\#}) dC^{\#} = E[C^{\#}] \Phi\left( \frac{\ln(C^{\#}) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)
\end{equation}

Where $\Phi()$ is the standard normal cumulative distribution function, $m_{\#} = E[\ln(C^{\#})]$, and $s^2_{\#} = Var[\ln(C^{\#})]$. (See Appendix A2 for a proof of this step.)

Substituing the right hand side of this equation for the integral in the previous equation results in the following expression for aggregate supply.

\begin{equation}
Q = N E[k_a] E[y^*] \Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)
\label{eq:aggSupply1}
\end{equation}

In the evaluation of $Q$, it is important to keep in mind that $E[y^*]$, $m_{\#}$, and $s_{\#}$ are unconditional population parameters. That is to say, $E[y^*]$ refers to the mean yield given the participation of all farms in the population; and $m_{\#}$ and $s_{\#}$ refer to the mean and standard deviation of $\ln(C^{\#})$ given full participation, i.e. as $C^{\#}$ goes to infinity. But axiom 4 truncates the upper tail of the distribution of $C^{\#}$ at $P$. The observed parameters $\tilde{m}_{\#}$ and $\tilde{s}_{\#}$ are thus conditional.

\begin{equation}
\begin{split}
\tilde{m}_{\#} = E[\ln(C^{\#}) | C^{\#} \leq P]
\tilde{s}^2_{\#} = Var[\ln(C^{\#}) | C^{\#} \leq P]
\end{split}
\end{equation}

Because $y^*$ is a function of $C^{\#}$, then (for given $k$) $y^*$ is also truncated; and so the observed mean yield is the conditional mean $E[y^*|C^{\#} < P]$.
<!-- The unconditional  $E[y]$ is thus never observed except in the limit as $P$ becomes very large.-->

The unconditional parameters $m_{\#}$ and $s_{\#}$ can be deduced from the conditional parameters $\tilde{m}_{\#}$ and $\tilde{s}_{\#}$ by numerically solving the following system of equations.

\begin{equation}
\begin{split}
m_{\#} &= \tilde{m}_{\#} - \tilde{s}_{\#} \frac{\phi(z)}{\Phi(z)} \\
s_{\#}^2 &= \tilde{s}_{\#}^2 \left( 1 - z \frac{\phi(z)}{\Phi(z)} - \left( \frac{\phi(z)}{\Phi(z)} \right)^2   \right) \:\:;\:\:\: \frac{\ln(\gamma) - m_{\#}}{s_{\#}} \:\:\:;\:\: z = \frac{\ln(\gamma) - m_{\#}}{s_{\#}}
\end{split}
\label{eq:cSharpUncondParams}
\end{equation}

The unconditional mean yield $E[y^*]$ can then be deduced considering that

\begin{equation}
E[C^{\# \eta} | C^{\#} < P] = E[C^{\# \eta}] \frac{\Phi \left(\frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#}\right)}{F(\frac{\ln(P) - m_{\#}}{s_{\#}} \right))}
\end{equation}

Such that the conditional mean of $y^*$ truncated at $C^{\#} < P$ can be parsed as follows.

\begin{equation}
\begin{split}
E[y^*|C^{\#} < P] = E[y^*] = E \left[ E[y^*] \frac{k^{\eta + 1}}{E[k^{\eta + 1}]}\right] \frac{E[C^{\# \eta} | C^{\#} < P]}{E[C^{\# \eta}]} \\
&= \frac{E[y^*]} \frac{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)}{\Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)}
\end{split}
\end{equation}
<!-- &\rightarrow E[y^*] = E[y^*|C^{\#} < P] = E[y^*] \frac{\Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)}{\Phi \left( \frac{\ln(P) - m_{\#}}{s_{\#}} - \eta s_{\#} \right)} -->

Whence $E[y^*]$ follows as a function of the observed or derived parameters $E[y^*|C^{\#} < P]$, $m_{\#}$, and $s_{\#}$. Note that it also follows from this expression that aggregate supply can be written

\begin{equation}
Q = N E[k_a] E[y^*|C^{\#} < P] \Phi\left( \frac{\ln(P) - m_{\#}}{s_{\#}} \right)
\end{equation}

Which may be useful for point estimates of aggregate supply along the curve since $E[y^*|C^{\#} < P]$ can be estimated from the observed yield distribution. This form is also instructive because the $\Phi()$ term has a straightforward interpretation as the fraction of the population participating in production, i.e. the farm employment rate. However, it is inconvenient for purposes of drawing the entire aggregate supply curve, as the observed $E[y^*|C^{\#} < P]$ is valid only for the $P$ at which it is measured. The unconditional mean yield $E[y^*]$, on the other hand, is constant for all $P$. For this reason, Equation \ref{eq:aggSupply1} is preferred. Moreover, the $\Phi()$ term in Equation \ref{eq:aggSupply1} turns out to have a meaningful economic interpretation once the stochastic character of price is taken into account, as shown below.

<!-- \begin{equation} -->
<!-- E[\ell|\ell < \gamma] = \frac{\int_{0}^{\gamma} f(\ell) d \ell}{F(\gamma)} -->
<!-- \end{equation} -->
<!-- If $\ell$ is lognormally distributed, then this reduces to -->
<!-- \begin{equation} -->
<!-- E[\ell|\ell < \gamma] = E[\ell] \frac{\Phi \left(\frac{\ln(\gamma) - m_{\ell}}{s_{\ell}} - s_{\ell}\right)}{F(\frac{\ln(\gamma) - m_{\ell}}{s_{\ell}} \right))} \:\:;\:\:\: m_{\ell} = E[\ln(\ell)] \:\: s^2_{\ell} = Var[\ln(\ell)] -->
<!-- \label{eq:condMean} -->
<!-- \end{equation} -->
<!-- The unconditional mean yield can then be deduced from the known information $E[y^*|C^{\#} < P]$, $m_{\#}$, and $s_{\#}$ by considering that for any random variable $\ell$ with probability density $f(\ell)$ and cumulative distribution function $F(\ell)$, the conditional mean of $\ell$ with upper tail truncated at $\gamma$ is -->
<!-- Moreover, given conditional parameters $\tilde{m}_{\ell}$ and $\tilde{s}_{\ell}$ estimated from the observed truncated distribution,  -->
<!-- Substituting $C^{\# \eta}$ for $\ell$ and $P$ for $\gamma$ in Equation \ref{eq:condMean}, -->
<!-- \:\:;\:\:\: m_{\#} = E[\ln(C^{\#})] \:\: s^2_{\#} = Var[\ln(C^{\#})] -->
The unconditional mean does not change with price but with technology or lambda. The conidtional mean changes with price, in addition to technology and lambda. So, given the relation between conditional and unconditional mean of a lognormally distributed variable, 

...

The previous expression can be rewritten

...

Note term is employment rate. This ok for spot estimate of supply. To make an aggregate curve.
Different ways to estimate the unkowns depending upon data available. 

Finally, necessary to account for the stochastic character of price...

choose the approach based on higher resolution data

mean log(lambda) = 0 might be a reasonable assumption

Note truncation, E[y*] not sample mean

Main thing is result that price is a dual space where solution can be found in the absence of farm data.
<!-- ## Derivation of a provisional aggregate supply function from the forgoing + axioms 3 and 4 -->

<!-- The contours of an aggregate supply function begin to emerge into view when one considers what might happen if one of the farm production expressions above is substituted for $q^*$ in Equation \ref{eq:sup1}. In particular, it becomes clear that: -->

<!-- 1) Insofar as prices are constant across the population, and insofar as $y_0$ and the technology $\alpha_i$ are estimated on farm survey data (and are thus constant across the farm population), then $y_0$, $P$, $h$, $\theta_x$, and $\theta_w$ are constants that factor out of the integral. -->

<!-- 2) Control variables, and thus $\hat{\theta}_k$, inevitably vary across the population. But if production is lognormally distributed (axiom 3), then it follows that $\hat{\theta}_k$ is independent of either $\lambda$ or $C^{\#}$, such that the population mean of $\hat{\theta}_k$ factors out of the integral. -->

<!-- 3) It follows from (1) and (2), and from the law of the unconscious statistician, that the integral with respect to $q^*$ reduces to an integral with respect to $\lambda$, $C^{\#}$, or $C^*$, depending upon which of the expressions for farm production is used. In the case of Equation \ref{eq:prodFn2}, e.g., Equation \ref{eq:sup1} can now be rewritten as follows. -->

<!-- \begin{equation} -->
<!-- Q = N \left(y_0 \frac{\theta_x}{\theta_w} \right)^{\frac{\eta}{h}} E \left[\theta_k^{\frac{\eta}{h}} \right] h^{-\eta} \int_{\underline{C}^{\#}}^{\overline{C}^{\#}} C^{\# \eta} f \left(C^{\#} \right) \: dC^{\#} -->
<!-- \end{equation} -->

<!-- Where the farm density $\rho()$ that appears in Equation \ref{eq:sup1} has been rewritten in terms of the probability density $f()$ and the number of farms in the population $N$ (i.e., $\rho(C^{\#}) = N f(C^{\#})$). -->

<!-- 4) Assuming that farms enter production only if they expect to make a profit (axiom 4), then cost per unit output cannot exceed output price, thus resolving the upper bound of this integral. Since cost cannot be negative, the lower bound is $0$. The domain of integration must then be $0 < C^{\#} < P$. -->

<!-- \begin{equation} -->
<!-- Q &= N E[k_a] E[y^*] \frac{1}{E[C^{\# \eta}]} \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} -->
<!-- \end{equation} -->
<!-- <!-- &= N E[k_a] E[y^*] \frac{E[C^{\# \eta} | C^{\#} \leq P]}{E[C^{\# \eta}]} -->

<!-- Because $y^*$ is lognormally distributed, then $C^{\# \eta}$ must also be lognormally distribtued, such that the integral in this expression resolves as follows (proof given in Appendix A2). -->
<!-- <!--and $k$ and $C^{\# \eta}$ are independent, then $k$ and [$k$ and $C^{\# \eta}$ are independent by equation useful (i.e. b/c Csharp is not a function of k)] k is formerly theta_k --> 

<!-- \begin{equation} -->
<!-- \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} = E[C^{\# \eta}] \Phi \left(\frac{\ln \left( \frac{E[C^{\# \eta}]}{P} \right) + \frac{s_{\#}^2}{2}}{s_{\#}} \right) -->
<!-- \end{equation} -->

<!-- Such that the aggregate supply equation reduces to -->

<!-- \begin{equation} -->
<!-- Q &= N E[k_a] E[y^*] \Phi \left(\frac{\ln \left( \frac{E[C^{\# \eta}]}{P} \right) + \frac{s_{\#}^2}{2}}{\eta s_{\#}} \right) \:;\:\:\: s_{\#}^2 = Var[\ln(C^{\#})] -->
<!-- \end{equation} -->

<!-- This might be a suitable aggregate supply function in sectors characterized by highly deterministic production processes, negligible delays between input decisions and output, and negligible output price volatility. However, it is not suited to the primary sector, where production is partly deterministic, partly a function of stochastic meteorological variables; where there is a significant delay between input decisions and output (i.e., the cropping season); and where output price volatility looms large in any management decision. In order to accommodate these features, a suitable assumption regarding the stochastic character of output price (axiom 5) is introduced in the next section; and the aggregate supply model derived above is modified accordingly. In addition to accommodating the stochastic character of farm production, the modified model resolves the term $\Phi(\gamma)$ into a surprisingly instructive and intuitive form. -->





<!-- Where $\omega^2 = Var[\ln(v)]$ and $\Phi()$ is the standard cumulative normal distribution function. (See Appendix A2 for proof.) -->

<!-- Because production is assumed to be lognormally distributed, $C^{\#}$ (and $\lambda$) must also be lognormally distributed. Substituting $v = C^{\# \eta}$ and $M = P^{\eta}$, into \ref{eq:keyResult} then, -->

<!-- \begin{equation} -->
<!-- E[C^{\# \eta} | C^{\# \eta} < P^{\eta}] = E[C^{\# \eta}] \Phi \left(\frac{\ln P - m_{\#}}{s_{\#} - \eta s_{\#}} \right) -->


<!-- \right) + \frac{s_{\#}^2}{2}}{s_{\#}} \right) -->

<!-- \int_{0}^{P} C^{\# \eta} f(C^{\#}) \: dC^{\#} = E \left[C^{\# \eta} \right] \Phi \left(\frac{\ln\left(\frac{P}{E \left[C^{\#} \right]} \right)^{\eta} - \frac{\eta^2}{2} Var \left[\ln \left(C^{\#} \right) \right]}{\eta \sqrt{Var \left[ \ln \left(C^{\#} \right) \right]}} \right) -->
<!-- \end{equation} -->

<!-- Where $\Phi()$ is the standard normal cumulative distribution function. (See Appendix A.2 for details.) The aggregate supply function thus reduces to the following tractable form. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- Q &= N \left(y_0 \frac{\theta_x}{\theta_w} \right)^{\frac{\eta}{h}} E \left[\hat{\theta}_k^{\frac{\eta}{h}} \right] \frac{E \left[C^{\# \eta}\right]}{h^{\eta}} \Phi(\gamma) \:\:; \\ -->
<!-- \gamma &= \frac{\ln\left(\frac{P}{E \left[C^{\#} \right]} \right)^{\eta} - \frac{\eta^2}{2} Var \left[\ln \left(C^{\#} \right) \right]}{\eta \sqrt{Var \left[\ln \left( C^{\#} \right) \right]}} -->
<!-- \end{split} -->
<!-- \label{eq:sup2a} -->
<!-- \end{equation} -->
<!-- <!-- This is an aggregate supply curve that explicitly accounts for input prices, farm size, technology, and control variables ($\hat{\theta}$), as well as for output price and farm entry/exit in response to changes in output price. Farm entry/exit is captured by the term $\Phi(\gamma)$. The supply response to changes in technology is thus endogenously modeled. --> 

## Derivation of the aggregate supply curve from the forgoing + axiom 5 

This might be a suitable aggregate supply function in sectors characterized by highly deterministic production processes, negligible delays between input decisions and output, and negligible output price volatility. However, it is not suited to the primary sector, where production is partly a function of stochastic meteorological variables; where there is a significant delay between input decisions and output (i.e., the cropping season); and where output price volatility looms large in any management decision. In order to accommodate these hallmarks of agricultural supply, a suitable assumption regarding the stochastic character of output price (axiom 5) is introduced in the next section; and the aggregate supply model derived above is modified accordingly.
<!-- In addition to accommodating the stochastic character of farm production, the modified model resolves the term $\Phi(\gamma)$ into a surprisingly instructive and intuitive form. -->


Henceforth it is necessary to be more explicit in the treatment of output price $P$ as a stochastic variable. Absent a forward contract, the output price at the time of harvest and sale $(t = T)$ is unknown to the farmer at the time of planting $(t = 0)$. Wherever $P$ appears in the equations above, then, what is really meant is $E[P(T)]|_{t = 0}$. That is to say, what is meant is the value that the farmer expects $P$ to take at harvest/sale, as evaluated at planting time.
<!-- Likewise, yield is partly dependent upon stochastic processes occurring between planting and harvest, especially meteorological processes, which are unknown to the farmer at the time of planting. Wherever $P$ and $y^*$ appear in the equations above, then, what is really meant is $E[P(T)]|_{t = 0}$ and $E[y^*(T)]\bigr|_{t = 0}$---that is to say, what is meant are the values that the farmer expects $P$ and $y^*$ to take at harvest/sale, as evaluated at planting time. -->

To parse $E[P(T)]|_{t = 0}$, a suitable stochastic model must be assumed for $P(t)$. Within a given season, prices often follow a geometric Brownian motion (gBm). That is to say, changes in $P$ over a small time interval $\Delta t$ ($\Delta P = P(t + \Delta t) - P(t)$) are often accurately modeled by

\begin{equation}
\Delta P = \Delta P(t) m_p \Delta t - P(t) s_p \epsilon \sqrt{\Delta t}
\end{equation}

Where $\epsilon$ is a normally distributed random variable with mean $0$ and variance $1$, such that the arithmetic change $\Delta P / P$ is normally distributed with mean and variance

\begin{equation}
\begin{split}
E \left[\frac{\Delta P(T)}{P(T)} \right] &= m_{p} \Delta t  \\
Var \left[\frac{\Delta P(T)}{P(T)} \right] &= s_{p}^2 \Delta t
\end{split}
\end{equation}

Such that the expected value of $P(T)$ resolves as

\begin{equation}
E[P(T)]\bigr|_{t = 0} = P(0) e^{m_p T}
\label{eq:EPT0}
\end{equation}

(For details, see Hull [-@hull9thEdition].)

The choice of gBm as the stochastic model for $P(t)$ is axiom 5. For what follows, it is important to note that the log change of the gBm $\ln(P(T) / P(\hat{t}))$ is defined over any finite time interval for some starting time $\hat{t}<T$, and is also normally distributed, with mean and variance

\begin{equation}
\begin{split}
E \left[\ln \left( \frac{P(T)}{P(\hat{t})} \right) \right] &= \left(m_{p} - \frac{s_p^2}{2} \right) T \\
Var \left[\ln \left( \frac{P(T)}{P(\hat{t})} \right) \right] &= Var \left[\ln (P(T)) \right] = s_{p}^2 T
\label{eq:lnChngP}
\end{split}
\end{equation}

For those unfamiliar with stochastic modeling but familiar with statistics, the choice of stochastic model may be roughly thought of as the choice of size distribution of changes in $P(t)$ per small time increment $\Delta t$. Selecting gBm as the stochastic model of $P(t)$ is tantamount to assuming that such changes are lognormally distributed. Some examples of maize prices following a gBm are given in Figure \ref{fig:gBmPrice}, accompanied by histograms of their log changes per time step. The histograms offer visual confirmation that price changes per time step are lognormally distributed, and that gBm is therefore a reasonable assumption.

It is important to keep in mind that the price trajectory considered here is over a cropping season---from planting to harvest. When considered over multiple cropping seasons, prices typically exhibit cyclic or mean reverting behavior, which requires a more sophisticated stochastic model.
<!-- Finally, note that $\Delta t$ is technically an instantaneous time interval, such that $m_p$ is the expected instantaneous growth rate. In practice, it is often acceptable to treat $\Delta t$ as a finitely small, but judicious, time step. As a rule of thumb, $\Delta t$ should be as small as the resolution of the data will allow, while also ensuring a finite sample path with no jumps. -->

```{r Fig1, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:gBmPrice}(Left) Maize price series from (top to bottom) Chicago, USA (CME, 2023), Johannesburg, RSA (JSE, 2023), and Eldoret market, Kenya (FPMA, 2023). (Right) The corresponding daily (monthly, in the case of Kenya) log changes exhibit the normal distribution typical of geometric Brownian motion.", echo = FALSE}

thisFolder <- "D:/OneDrive - CGIAR/Documents 1/CIAT 2/A theory of aggregate supply and demand/"
thisFile <- "South Africa corn future price.csv"
thisFilePath <- paste0(thisFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c("DATE", "WHITE")
df_raw <- df_raw[, keepCols]
colnames(df_raw) <- c("Date", "Price")
df_raw$Date <- as.Date(df_raw$Date, "%m/%d/%Y")
df <- subset(df_raw, Date > "2017-11-01" &
               Date < "2018-04-15")
df$`Log change` <- c(NA, diff(log(df$Price)))
#colnames(df)[2] <- "ZAR / kg."
# gg <- ggplot(df, aes(x = Date, y = `ZAR / kg.`))
# gg <- gg + geom_line()
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title.x = element_blank(),
#                  axis.title.y = element_text(size = axisTitleSize),
#                  axis.text = element_text(size = axisTextSize))
# gg_sa <- gg
df_sa <- df
#df_sa$`ZAR / kg.` <- NULL
df_sa$Place <- "South Africa"
# gg <- ggplot(df, aes(x = `Log change`))
# gg <- gg + geom_histogram(color = 4, fill = "white", bins = 15)
# gg
# mm <- mean(df$`Log daily return`, na.rm = T)
# s <- sd(df$`Log daily return`, na.rm = T)
# print(mm)
# print(s)
#-----------------------------------------------------------------
thisFile <- "US corn future price.csv"
thisFilePath <- paste0(thisFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c("date", "adjusted")
df_raw <- df_raw[, keepCols]
colnames(df_raw) <- c("Date", "Price")
df_raw$Date <- as.Date(df_raw$Date, "%Y-%m-%d")
df <- subset(df_raw, Date > "2018-03-31" &
               Date < "2018-12-01")
df$Price <- df$Price / 100
df$`Log change` <- c(NA, diff(log(df$Price)))
#colnames(df)[2] <- "USD / bushel"
# gg <- ggplot(df, aes(x = Date, y = `USD / bushel`))
# gg <- gg + geom_line()
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_text(size = axisTitleSize),
#                  axis.text = element_text(size = axisTextSize))
# gg_us <- gg
df_us <- df
#df_us$`USD / bushel` <- NULL
df_us$Place <- "USA"
# mm <- mean(df$`Log daily return`, na.rm = T)
# s <- sd(df$`Log daily return`, na.rm = T)
# print(mm)
# print(s)
#---------------------------------------------------------------
thisFile <- "Nakuru Eldoret monthly maize price.csv"
thisFilePath <- paste0(thisFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c(1, 2)
df_raw <- df_raw[, keepCols]
df_raw <- as.data.frame(apply(df_raw, 2, rev))
colnames(df_raw) <- c("Date", "Price")
df_raw$Price <- as.numeric(df_raw$Price)
df_raw$Date <- as.Date(df_raw$Date, "%m/%d/%Y")
df <- subset(df_raw, Date >= "2008-03-01" &
               Date <= "2019-08-01")
df$`Log change` <- c(NA, diff(log(df$Price)))
#colnames(df)[2] <- "KES / kg."
# gg <- ggplot(df, aes(x = Date, y = `KES / kg.`))
# gg <- gg + geom_line()
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title.x = element_blank(),
#                  axis.title.y = element_text(size = axisTitleSize),
#                  axis.text = element_text(size = axisTextSize))
# gg_ky <- gg
df_ky <- df
#df_ky$`KES / kg.` <- NULL
df_ky$Place <- "Kenya"
# gg <- ggplot(df, aes(x = `Log change`))
# gg <- gg + geom_histogram(color = 4, fill = "white", bins = 20)
# gg
# mm <- mean(df$`Log daily return`, na.rm = T)
# s <- sd(df$`Log daily return`, na.rm = T)
# print(mm)
# print(s)
df_ts <- as.data.frame(do.call(rbind, list(df_us, df_sa, df_ky)))
df_ts$Place <- gsub("Kenya", "Eldoret, Kenya\n2008-2019 (monthly)\nKES / kg.", df_ts$Place)
df_ts$Place <- gsub("USA", "Chicago, USA\n2018 growing season (daily)\nUSD / bushel", df_ts$Place)
df_ts$Place <- gsub("South Africa", "Johannesburg, RSA\n2018 growing season (daily)\nZAR / kg.", df_ts$Place)
gg <- ggplot(df_ts, aes(x = Date, y = Price))
gg <- gg + geom_line()
gg <- gg + scale_x_date(breaks = scales::breaks_pretty(n = 8), labels = date_format("%b\n%Y"))
# gg <- gg + scale_x_date(breaks = "4 months", labels = date_format("%m-%Y"))
#gg <- gg + scale_x_date(date_breaks = "4 month", date_labels =  "%b %Y")
gg <- gg + facet_wrap(~factor(Place,
                              levels = c("Chicago, USA\n2018 growing season (daily)\nUSD / bushel",
                                         "Johannesburg, RSA\n2018 growing season (daily)\nZAR / kg.",
                                         "Eldoret, Kenya\n2008-2019 (monthly)\nKES / kg.")),
                      ncol = 1, scales = "free", strip.position = "left")
gg <- gg + labs(title = "Maize price series exhibiting geometric Brownian motion")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title.x = element_text(size = axisTitleSize),
                 axis.title.y = element_blank(),
                 axis.text = element_text(size = axisTextSize),
                 strip.background = element_rect(fill = "white"),
                 strip.text = element_text(size = facetTitleSize),
                 plot.title = element_text(size = titleSize))
gg_ts <- gg
#---------------------------------------------------------------
# df_hist <- as.data.frame(do.call(rbind, list(df_sa, df_us, df_ky)))
df_hist <- df_ts
gg <- ggplot(df_hist, aes(x = `Log change`))
gg <- gg + geom_histogram(color = 4, fill = "white", bins = 20)
gg <- gg + facet_wrap(~factor(Place,
                              levels = c("Chicago, USA\n2018 growing season (daily)\nUSD / bushel",
                                         "Johannesburg, RSA\n2018 growing season (daily)\nZAR / kg.",
                                         "Eldoret, Kenya\n2008-2019 (monthly)\nKES / kg.")), ncol = 1, scales = "free")
gg <- gg + labs(title = "Log change")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank(),
                 axis.text = element_text(size = axisTextSize),
                 strip.background = element_rect(fill = "white"),
                 strip.text = element_blank(),
                 plot.title = element_text(size = titleSize))
gg_hist <- gg
#---------------------------------------------------------------
# library(patchwork)

gg_ts + gg_hist + plot_layout(ncol = 2, widths = c(1, 1/3))

# design <- c("AAD
#             BBD
#             CCD")
# wrap_plots(A = gg_ky, B = gg_sa, C = gg_us, D = gg_hist, design = design)

```

Given the stochastic definition of price, the relation between optimal expenditure and price (Equation \ref{eq:useful}) must be rewritten more carefully as follows.

\begin{equation}
\frac{E[C^{\#}(T)]\bigr|_{t = 0}}{h} = \frac{E[P(T)]\bigr|_{t = 0}}{\lambda}
\label{eq:useful2}
\end{equation}

Optimal unit cost necessarily becomes a function of time here because it changes with expected price, which is a function of time. The critical time of interest is planting time $t = 0$, the time at or by which land preparation, seed, fertilizer, and any other necessary planting expenditure decisions are or have been made. The expectation $E[C^{\#}(T)]\bigr|_{t = 0}$ appears in the expression, as opposed to just $C^{\#}(0)$, because optimal unit cost also includes post planting expenditures such as pest and disease control, harvest, and post-harvest activities, which are generally unknown at planting time. Also, $C^{\#}(0)$ by definition depends upon yield, which is of course unknown until harvest.

A further implication of Equation \ref{eq:useful2} that is critically important for the derivation of the aggregate supply curve below, is that $C^{\#}(t)$ must itself be a gBm with same parameters as $P(t)$. This follows from Ito's Lemma. A proof is given in Appendix 2.










Optimal cost is an abstract stochastic variable referring to optimal course of action based on price, regardless of what the farmer has actually done. Unfortunately, the farmer is not at liberty to wait until harvest to see what the harvest price is and to then calculate their optimal expenditure based on this. At certain points in the cropping season, the farmer must optimize expenditures based on what they think the price will be.


Assuming that output price follows a gBm (axiom 5), the stochastic model for $C^{\#}(t)$ follows directly from the gBm model for $P(t)$. That is to say, since ${C}^{\#}(t)$ and $P(t)$ are related by Equation \ref{eq:useful}, then, by Ito's lemma, $C^{\#}(t)$ must also follow a gBm with trend and volatility parameters ($m_c$, $s_c$) equal to those of the output price ($m_p$, $s_p$). (See Appendix for details.) It then follows trivially that the mean and variance of the log change $\ln(C^{\#}(T)/C^{\#}(\hat{t}))$ are equal to those of the log change in output price displayed in Equations \ref{eq:lnChngP}. This means that

\begin{equation}
Var \left[\ln \left( \tilde{C}^{\#}(T) \right) \right] = s_p^2 T 
\label{eq:lnChngC}
\end{equation}


<!-- Cost per unit output is likewise partly dependent upon possible unforeseen adversity after planting (e.g., pests & disease), and then it too must be considered a stochastic variable whose value is not known at the time of planting. -->
<!-- , yield $y^*$, and cost per unit output $C^{\#}$ -->
<!-- and cost per unit output are -->
<!-- , and $C^{\#}$ -->
<!-- , and $E[C^{\#}(T)]\bigr|_{t = 0}$ -->
<!-- and $C^{\#}$ -->

In the aggregate supply function (Equation \ref{eq:sup2b}), the term $E \left[C^{\#} \right]$ is thus replaced with $E \left[E\left[C^{\#}(T) \right]\bigr|_{t = 0} \right]$, which is the population mean of expected cost per unit production at planting time. This is a double integral. By Fubini's theorem, the order of integration may be swapped, such that this may also be interpreted as the mean farm's expected cost as evaluated at planting time.

\begin{equation}
E\left[E\left[C^{\#}(T)\right]\biggr|_{t = 0}\right] = E\left[E\left[C^{\#}(T)\right]]\biggr|_{t = 0}\right]
\end{equation}

To avoid ugly and potentially ambiguous notation, the population mean of $C^{\#}(T)$ is henceforth denoted $\tilde{C}^{\#}(T)$. That is to say, $E\left[C^{\#}(T)\right] = \tilde{C}^{\#}(T)$, such that the mean farm's expected cost at planting time is henceforth rewritten $E\left[\tilde{C}^{\#}(T)\right]\biggr|_{t = 0}$.
<!-- Cost per unit output $C^{\#}$ must likewise be replaced with $E\left[C^{\#}(T)\right]\biggr|_{t = 0}$, such that the population mean $E\left[C^{\#}\right]$ appearing in the aggregate supply function in Equation \ref{eq:sup2} must be replaced with -->
<!-- \begin{equation} -->
<!-- E\left[E\left[C^{\#}(T)\right]\biggr|_{t = 0}\right] -->
<!-- \end{equation} -->
<!-- This is the population mean of the expected  -->

Making these substitutions for $P$ and $C^{\#}$ in Equation \ref{eq:sup2b}, then, the provisional aggregate supply function becomes an _expected_ aggregate supply function.

\begin{equation}
\begin{split}
E[Q(T)]|_{t = 0} &= N E[\theta] E[\lambda^{-\eta}] P(0)^{\eta} e^{\eta m_p T} \Phi(\gamma) \:\:; \\
\gamma &= \frac{\ln\left(\frac{E[P(T)]|_{t = 0}}{E \left[ \tilde{C}^{\#}(T) \right]\bigr|_{t = 0}} \right)^{\eta} - \frac{\eta^2}{2} Var \left[\ln \left( \tilde{C}^{\#}(T) \right) \right]}{\eta \sqrt{Var \left[\ln \left( \tilde{C}^{\#}(T) \right) \right]}} \\
\theta &= \left( y_0 \frac{\theta_x}{\theta_w} \hat{\theta}_k \right)^{\frac{\eta}{h}}
\end{split}
\label{eq:sup3}
\end{equation}
<!-- reference justifying application of Fubini's thm here: -->
<!-- https://stats.stackexchange.com/questions/412936/when-can-integration-and-expectation-be-exchanged -->
<!-- \begin{equation} -->
<!-- E\left[C^{\#}(T)\right]\biggr|_{t = 0} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- E[E[q^*(T)]\bigr|_{t = 0}] = E[E[q^*(T)]]\bigr|_{t = 0} -->
<!-- \label{eq:fubThm} -->
<!-- \end{equation} -->
<!-- And the other ugly term $Var[\ln(E[q^*(T)]\bigr|_{t = 0})]$ may likewise be rewritten -->
<!-- \begin{equation} -->
<!-- Var[\ln(E[q^*(T)]\bigr|_{t = 0})] = Var[\ln(E[q^*(T)])]\bigr|_{t = 0} -->
<!-- \end{equation} -->
<!-- To reduce the notational ugliness, the shorthand $\tilde{q}^*(T) = E[q^*(T)]$ is henceforth introduced, such that -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[E[q^*(T)]]\bigr|_{t = 0} &= E[\tilde{q}^*(T)]\bigr|_{t = 0} = \tilde{q}^*(0) e^{m_q T} \\ -->
<!-- Var[\ln(E[q^*(T)])]\bigr|_{t = 0} &= Var[\ln(\tilde{q}^*(T))]\bigr|_{t = 0} = s_q^2 T -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Where, recall from the previous section, $m_q = E[\Delta \tilde{q} / (\tilde{q} \Delta t)]$ and $s_q^2 = Var[\Delta \tilde{q} / (\tilde{q} \Delta t)]$. -->
<!-- That is to say, expressions \ref{eq:YdEnvCompact0}-\ref{eq:upBnd} should be rewritten, respectively, -->
<!-- \begin{equation} -->
<!-- E[y^*]\bigr|_{t = 0} = (y_0 \theta)^{\frac{1}{1 - h}} \left( \frac{E[P(T)]\bigr|_{t = 0}}{\lambda} \right)^{\frac{h}{1 - h}} -->
<!-- \label{eq:YdEnvCompact0b} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- E[y^*]\bigr|_{t = 0} = y_0 \theta \left( \frac{C^*}{h} \right)^h -->
<!-- \label{eq:yStarC0b} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \frac{E[P(T)]\bigr|_{t = 0}}{\lambda} = \frac{E[C^{\#}]\bigr|_{t = 0}}{h} -->
<!-- \label{eq:lambda30b} -->
<!-- \end{equation} -->
<!-- and -->
<!-- \begin{equation} -->
<!-- E[C^{\#}(T)]\bigr_{t = 0} < E[P(T)]\bigr|_{t = 0} -->
<!-- \label{eq:upBnd2} -->
<!-- \end{equation} -->

To evaluate this expression,




Substituting the right hand sides of this and Equation \ref{eq:EPT0} into Equation \ref{eq:sup3} then results in the following form for expected aggregate supply.

\begin{equation}
\begin{split}
E[Q(T)]|_{t = 0} &= N E[\theta] E[\lambda^{-\eta}] P(0)^{\eta} e^{\eta m_p T} \Phi(-z) \:\:; \\
z &= -\gamma = \frac{\ln\left(\frac{E \left[ \tilde{C}^{\#}(T) \right]\bigr|_{t = 0}}{P(0)} \right)^{\eta} - \left(\eta m_p - \eta^2 \frac{s_p^2}{2} \right) T }{\eta s_p \sqrt{T}}
\end{split}
\label{eq:sup4}
\end{equation}

Recalling from Equations \ref{eq:lnChngP} that $\left(\eta m_p - \eta^2 \frac{s_p^2}{2} \right) T$ and $s_p^2 T$ are the mean and variance of the log change in price $\ln(P(T) / P(0))$, then the term $z$ is the standard score of the hypothetical log change in output price $\ln \left(E\left[\tilde{C}^{\#}(T)\bigr|_{t = 0} \right] / P(0) \right)$, scaled by the farm level price elasticity $\eta$. The term $\Phi(z)$, which captures farm entry/exit, is thus the probability that output price will fall from its value at planting time to or below the mean farm's expected cost per unit output (scaled by $\eta$). And the term $\Phi(-z)$, it follows, is the probability that output price will remain above the mean farm's expected cost per unit output (scaled by $\eta$). In simple terms, $\Phi(-z)$ is roughly the probability that the mean farm will be profitable.

Here it is tempting to introduce a sixth axiom saying that farmers will only pursue a risky bet if the probability of profit is greater than that of a coin toss (i.e., greater than $50\%$), and to thereby limit the domain of $z$ to $(-\infty, 0)$. But this is left to the discretion of the practitioner. [There are cases when rational economic agents pursue "out of the money" bets.]
<!-- i.e., the log change in output price from its value at planting time ($P(0)$) to a value equal to the mean farm's expected cost per unit output, scaled by $\eta$. -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E \left[\ln \left( \frac{C^{\#}(T)}{C^{\#}(\hat{t})} \right) \right] &= E \left[\ln \left( \frac{P(T)}{P(\hat{t})} \right) \right] \\ -->
<!-- Var \left[\ln \left( \frac{C^{\#}(T)}{C^{\#}(\hat{t})} \right) \right] &= Var \left[\ln \left( C^{\#}(T) \right) \right] = Var \left[\ln(P(T)) \right] -->
<!-- \end{split} -->
<!-- \label{eq:lnChngC} -->
<!-- \end{equation} -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- m_c \Delta t = E \left[\frac{\Delta C^{\#}(T)}{C^{\#}(T)} \right] &= m_{p} \Delta t  \\ -->
<!-- s_c^2 \Delta t = Var \left[\frac{\Delta C^{\#}(T)}{C^{\#}(T)} \right] &= s_{p}^2 \Delta t -->
<!-- \end{split} -->
<!-- \end{equation} -->
<!-- Because of the functional relation in Equation \ref{eq:lambda3}---which says that farms regulate their expenditure based on output price expectations---it can be shown by Ito's lemma that cost per unit output $C^{\#}$ is also a geometric Brownian motion with volatility $s_c$ equal to $s_p$. -->
<!-- For present purposes, it is not necessary to specify a stochastic model for $y^*(t)$. However, in passing it is worth noting that, insofar as the meteorological variables on which $y^*(t)$ depends follow a gBm over the course of a given cropping season (as they appear to do, e.g., in Figure \ref{fig:gBmWeather}), then, again by Ito's lemma, $y^*(t)$ must also follow a gBm. -->
<!-- The stochastic movement of $y^*(t)$ is slightly less straightforward. Unlike prices, yield is never directly observable except at $t = T$. While it is increasingly possible to make indirect observations of $y^*(t)$ for $t$ well before $T$ via remote sensing data [@wahab2018remote; @vallentin2022suitability; @ali2022crop], it is unlikely that it will ever be possible to check the value of $y^*(t)$ for $t$ close to $0$ (planting time) in the same way that one may check the spot price of a commodity $P(t)$. -->
<!-- However, the specific question of whether or not $y^*(t)$ follows a geometric Brownian motion can be assessed in another way. Insofar as the stochastic movement of the meteorological variables on which yield depends biophysically follows a geometric Brownian motion, then, once again by Ito's lemma, it follows that $y^*(t)$ must also follow a geometric Brownian motion. The question then becomes whether or not the relevant meteorological variables (typically rainfall, temperature, and solar radiation) follow a gBm within a given cropping season. This is a much weaker assumption than the assumption that yield itself follows a gBm (see, e.g., Figure \ref{fig:gBmWeather}). -->
<!-- Yield is a function of both deterministic and stochastic (mostly meteorological) variables. -->
<!-- The assessment of the yield trend and volatility parameters $m_y$, $s_y$ in terms of trend and volatility parameters that can be estimated from observable meteorological variables is problematic, moreover, since this requires knowledge about the precise functional relation between these variables and yield. -->
<!-- (Although see Wahab et al. [-@wahab2018remote], Vallentin et al. [-@vallentin2022suitability], and Ali et al. [-@ali2022crop].) -->
<!-- For the present purpose, the relevance of $y^*(t)$ following a gBm lies in the relation between $y^*(t)$ and cost per unit output $C^{\#}$. Because $C^{\#}$ is a function of $y^*(t)$, and because this function is known (Equation \ref{eq:cSharp1}), then, by Ito's lemma, $C^{\#}$ must also follow a geometric Brownian motion with volatility $s_c$ equal to the yield volatility $s_y$. Moreover, Equation \ref{eq:lambda3} implies $s_c = s_p$; and thus, by transitivity, $s_y = s_p$. -->
<!-- Denoting the mean and variance of the normally distributed changes $\Delta y^* / y^*$ as $m_y \Delta t$ and $s_y^2 \Delta t$, respectively, then Ito's lemma also reveals that the   -->
<!-- ... -->
<!-- Moreover, combining Equations \ref{eq:lambda3} and \ref{eq:YdEnvCompact} gives yet another instructive expression for $y^*$. -->
<!-- \begin{equation} -->
<!-- y^* = (y_0 \theta)^{\frac{\eta}{h}} \left( \frac{C^{\#}}{\eta} \right)^{\eta} \:\:;\:\:\: \eta = \frac{h}{1 - h} -->
<!-- \label{eq:yStarCsharp} -->
<!-- \end{equation} -->
<!-- This expression proves useful during parameterization of the aggregate supply curve farther below, but has limited predictive power since, by definition, $C^{\#}$ is not known until harvest. -->
<!-- # ```{r Fig2, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:gBmWeather}(Left) Daily average weather variable time series covering the 2018 maize long rains growing season in Eldoret, Kenya (NREL 2023). (Right) The corresponding daily log changes exhibit the normal distribution typical of geometric Brownian motion.", echo = FALSE} -->
<!-- #Weather data from National Solar Radiation Database -->
<!-- #https://nsrdb.nrel.gov/data-viewer -->
<!-- thisFolder <- "D:/OneDrive - CGIAR/Documents 1/CIAT 2/A theory of aggregate supply and demand/Eldoret weather data/" -->
<!-- thisFile <- "NSRDB weather data Eldoret 2018 maize season.csv" -->
<!-- thisFilePath <- paste0(thisFolder, thisFile) -->
<!-- df <- read.csv(thisFilePath, stringsAsFactors = F) -->
<!-- colnames(df)[ncol(df)] <- "Log change" -->
<!-- df$Date <- as.Date(df$Date) -->
<!-- gg <- ggplot(df, aes(x = Date, y = val)) -->
<!-- gg <- gg + geom_line() -->
<!-- gg <- gg + scale_x_date(breaks = scales::breaks_pretty(n = 8)) -->
<!-- gg <- gg + facet_wrap(~var, ncol = 1, scales = "free_y", strip.position = "left") -->
<!-- gg <- gg + labs(title = "Daily averages of key weather variables influencing crop yields\nEldoret, Kenya, 2018 maize growing season") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title.x = element_text(size = axisTitleSize), -->
<!--                  axis.title.y = element_blank(), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  strip.background = element_rect(fill = "white"), -->
<!--                  strip.text = element_text(size = facetTitleSize), -->
<!--                  plot.title = element_text(size = titleSize)) -->
<!-- gg_line <- gg -->
<!-- gg <- ggplot(df, aes(x = `Log change`)) -->
<!-- gg <- gg + geom_histogram(color = 4, fill = "white", bins = 20) -->
<!-- gg <- gg + facet_wrap(~var, ncol = 1, scales = "free") -->
<!-- gg <- gg + labs(title = "Daily log change") -->
<!-- gg <- gg + theme_bw() -->
<!-- gg <- gg + theme(axis.title = element_blank(), -->
<!--                  #axis.title.y = element_blank(), -->
<!--                  #axis.title.x = element_text(size = axisTitleSize), -->
<!--                  axis.text = element_text(size = axisTextSize), -->
<!--                  strip.background = element_rect(fill = "white"), -->
<!--                  strip.text = element_blank(), -->
<!--                  plot.title = element_text(size = titleSize)) -->
<!-- gg_hist <- gg -->
<!-- gg_line + gg_hist + plot_layout(ncol = 2, widths = c(1, 1/3)) -->
<!-- ``` -->
<!-- [@jseData; @fpmaData; @cmeData; @nsrdbData] -->
<!-- ---especially temperature, solar radiation, and humidity--- -->
<!-- That is, farmers make their expenditure decision $C^*$ at planting time ($t = 0$) based on what they expect the values of $y^*$ and $P$ to be at harvest ($t = T$). -->

## Some derivatives of interest to policy makers

A few derivatives of the aggregate supply curve with respect to variables that are of general interest to policy makers are briefly explored below. First and foremost, the price elasticity of aggregate supply:

\begin{equation}
\begin{split}
\frac{\partial \ln(E[Q(T)]|_{t = 0})}{\partial \ln(P(0))} &= \eta + \frac{\partial \ln (\Phi(-z))}{\partial(-z)} \frac{\partial (-z)}{\partial \ln(P(0))} \\
&= \eta + \frac{\phi(-z)}{\Phi(-z)} \frac{1}{s_p \sqrt{T}}
\end{split}
\label{eq:pElasQagg}
\end{equation}

The output price elasticity of aggregate supply is thus the farm level elasticity $\eta$ plus a term capturing the effect of farm entry/exit in response to the price movement. Note that the entry/exit term is the slope of the log of the standard normal cumulative distribution function. As the mean farm's probability of profit approaches $100\%$, this term approaches zero, such that price elasticity of aggregate supply approaches the price elasticity of supply on an individual farm. Aggregate supply is inelastic/elastic if

\begin{equation}
\eta </> 1 - \frac{\phi(-z)}{\Phi(-z)} \frac{1}{s_p \sqrt{T}}
\end{equation}

Such that the possibility of an elastic aggregate supply response to price movements becomes increasingly limited as farm participation approaches $100\%$.

One of the many novelties of the derived form is that it allows for explicit inspection of the aggregate supply sensitivity to price volatility.

\begin{equation}
\frac{\partial \ln(E[Q(T)]|_{t = 0})}{\partial (s_p \sqrt{T})} = - \frac{\phi(-z)}{\Phi(-z)} \left(\eta -  \frac{z}{\eta s_p \sqrt{T}}\right)
\label{eq:pRiskElasQagg}
\end{equation}

So long as $z$ is negative (and thus the mean farm's probability of profit greater than $50\%$), then this says that aggregate supply is decreasing in price volatility.

Finally, consider the derivative with respect to technology.

\begin{equation}
\end{equation}

## Parameter estimation guidelines

Parameterization of the aggregate supply curve derived above thus requires knowledge of the output price at time of planting $P(0)$, the price growth rate $m_p$ and volatility $s_p$, the length of the cropping season $T$, the number of farms in the population $N$, the output degree of homogeneity $h$, the mean farm's expected cost per unit output as evaluated at planting time $E[\tilde{C}^{\#}(T)]|_{t = 0}$, and the expected mean harvested output as evaluated at planting time $E[\tilde{q}^*(T)]\bigr|_{t = 0}$. The last of these may of course be further decomposed as $E[A] E[\tilde{y}(T)]\bigr|_{t = 0}$, where $E[A]$ is the mean farm size and $\tilde{y}(T)$ is just the $\tilde{y}$ from Equation \ref{eq:yConst}, with the time of evaluation (harvest) made explicit.

When estimating $E[C_0^{\#}(T)]|_{t = 0}$ and $E[y^*(T)]\bigr|_{t = 0}$ based on farm survey data, it may be tempting to use the respective sample means. This would be erroneous on two counts: 1) The sample mean gives the actual values known post-harvest, whereas the model deduced above requires the farmers' expectation at planting time. And 2) axiom 3 ($E[C^{\#}(T)]\bigr|_{t = 0} < E[P(T)]\bigr|_{t = 0}$) implies that the sample means are taken over a truncated distribution.

To redress count 1, the log-log model in either Equation \ref{eq:cobbDoug3Ln} or \ref{eq:cobbDoug4} can be estimated by OLS on farm survey data (taking the usual precautions to ensure homoscedasticity and linear independence of the regressors). If the fit is good, then each farm's expected yield at planting may then be reasonably approximated by evaluating the fitted model $\hat{y}^*$ at the farm's regressor values, with the exception of weather variables (and any other control variables whose values are known only post harvest), denoted $\mathbf{k}_{post}$, which should be set to their expected values ($\mathbf{\tilde{k}}_{post}$). That is, for each farm,
<!-- the expected yield at planting time for a given farm $E[y^*(T)]\bigr|_{t = 0}$ can be assessed by estimating -->
<!-- The fitted model then describes the behavior of all farms -->
<!-- As discussed in section ... Equation \ref{eq:cobbDoug4} has the advantage of requiring less data, and giving a  -->

\begin{equation}
E[y^*(T)]\bigr|_{t = 0} \approx \hat{y}^*|_{\mathbf{k}_{post} = \mathbf{\tilde{k}}_{post}})
\end{equation}

Now, as discussed in the previous section, the population mean of $E[y^*(T)]\bigr|_{t = 0}$ may be considered equal to the expected value at planting time of the population mean harvested yield $\tilde{y}^*(T)$ (recall Equation \ref{eq:rubThm}). However, because of axiom 3, the sample mean of $E[y^*(T)]\bigr|_{t = 0}$ does not represent the population mean, but rather the mean over a truncated population, i.e. $E[\tilde{y}^*(T) | C^# < E[P(T)]\bigr|_{t = 0}]\bigr|_{t = 0}$.

In order to arrive at the population mean and redress count 2, the sample mean of $C^{\#}$ is first calculated as follows.

\begin{equation}
E[C^{\#}(T) | E[C^{\#}(T)]\bigr|_{t = 0} < E[P(T)]\bigr|_{t = 0}]\bigr|_{t = T} = E\left[ frac{C^*}{y^*(T)} \right]
\end{equation}

Given the assumption of lognormally distributed yield (axiom 4), then, by linear independence of the OLS regressors, $C^{\#}(T)$ is also lognormally distributed, such that the unobserved mean and variance of the untruncated distribution of $\ln(C^{\#}(T))$ ($m_c$, $s_c^2$) can be implicitly calculated from the observed (i.e. sample) mean and variance ($\overline{m}_c$, $\overline{s}_c^2$) by the following standard formulae.

\begin{equation}
\begin{split}
\overline{s}_c^2 &= s_c^2 \left( 1 - \overline(z) \frac{\phi(\overline{z})}{\Phi(\overline{z})} - \left( \frac{\phi(\overline{z})}{\Phi(\overline{z})} \right)^2   \right) \:\:;\:\:\: \frac{\ln(E[P(T)]\bigr|_{t = 0}) - m_c}{s_c} \\
\overline{m}_c &= m_c - s_c \frac{\phi(\overline{z})}{\Phi(\overline{z})}
\end{split}
\end{equation}
<!-- rootFnUp <- function(xIn, xUp, sXtrunc, mXtrunc){ -->
<!--   sX <- xIn[1] -->
<!--   mX <- xIn[2] -->
<!--   zUp <- (log(xUp) - mX) / sX -->
<!--   probTerm <- dnorm(zUp) / pnorm(zUp) -->
<!--   slack_s <- sXtrunc^2 - sX^2 * (1 - zUp * probTerm - probTerm^2) -->
<!--   slack_m <- mXtrunc - mX + sX * probTerm -->
<!--   outVec <- c(slack_s, slack_m) -->
<!--   return(outVec) -->
<!-- } -->

With $m_c$ and $s_c$ in hand, the mean cost per unit output over the untruncated population then follows as $E[C^{\#}(T)] = e^{m_c + s_c^2/2}$. Because Equation \ref{eq:yStarCsharp} is also a model for $y^*$, the mean expected yield taken over the untruncated distribution then follows as the mean over the truncated distribution (the sample mean) multiplied by a correction term.

\begin{equation}
\begin{split}
E[\tilde{y}^*(T)]\bigr|_{t = 0} &= E[\tilde{y}^*(T) | C^# < E[P(T)]\bigr|_{t = 0}]\bigr|_{t = 0} \left( \frac{E[C^{\#}]}{E[C^{\#} | C^{\#} < E[P(T)]\bigr|_{t = 0}]} \right)^{\eta} \\
&= E[\hat{y}^*(\mathbf{k}_{ante}, C^*)|_{\mathbf{k}_{post} = \tilde{\mathbf{k}}_{post}})] e^{\frac{s_{\epsilon}^2}{2}} \left( \frac{E[C^{\#}]}{E[C^{\#} | C^{\#} < E[P(T)]\bigr|_{t = 0}]} \right)^{\eta}
\end{split}
\end{equation}

Where $s_{\epsilon}^2$ is the variance of the OLS estimation error and $h$ (implied in $\eta$) is the coefficient on $\ln(C^*)$.

The output price $P(T)$ received by farmers after harvest might be reported in the same farm survey data used to estimate $E[\tilde{y}^*(T)]\bigr|_{t = 0}$. However, the model requires the price at planting time $P(0)$, as well as $m_p$ and $s_p$, which are generally not reported in farm surveys. In countries with well developed forward contracts markets, such information is often available from commodity exchanges. And even in regions with poorly developed farm-to-market linkages, price information is increasingly available from services like the FAO Food Price Monitoring and Analysis Tool, which is the source of the price series in the lower left panel of Figure \ref{fig:gBmPrice}.
<!-- , often due to a large, entrenched intermediary market which thrives precisely on buyer-seller information asymmetry -->

Given sufficient price data, the values of $m_p$ and $s_p$ should be estimated over a suitable timeframe. Assuming that farmers expect the output price to behave roughly as it did during the previous year, then $m_p$ and $s_p$ should be estimated over the previous year or growing season. However, this may not always be an appropriate assumption, particularly in volatile markets. It may be more suitable to average over multiple years, or to take the average of the parameters estimated over multiple growing seasons.
<!-- , required to calculate the farmers' expected price (recall Equation \ref{eq:EPT0}) -->

An accurate value for $N$ will be difficult to estimate in populations where no recent farm census data is available. Note that $N$ is not necessary for evaluation of the price elasticity of aggregate supply and price risk elasticity of aggregate supply (Equations \ref{eq:pElasQagg} and \ref{eq:pRiskElasQagg}).


# An illustrative use case: a parameterization of the maize aggregate supply curve in Kenya 

<!-- As an illustrative use case, the supply curve derived above is fitted on 2007 Kenya farm data; and the expected aggregate supply curve is calculated. The (expected) price elasticity of aggregate supply curve and producer participation are also calculated. -->

<!-- The comparison, in some limited sense, validates the model; but the main point here is to briefly explore some of the challenges faced when applying the method in a real world use case. -->

<!-- divergence maybe rooted in variation of output price, also because we don't really know EyStarT0 and EPT0, also because this is expected supply at planting, not actual supply at harvest...also does not account for short rains growing season (October-December) (but short rains harvest is small % of total, in 2021 it was about 250,000MT) -->


<!-- Evaluation of Equation \ref{eq:sup4}, requires estimation of the parameters $\theta_x$, $\theta_w$, $\hat{\theta}_k$, the farm level output price elasticity of supply $\eta$, the farm production degree of homogeneity $h$, the mean farm's expected cost per unit output $E\left[\tilde{C}^{\#}(T)\right]\biggr|_{t = 0}$,  -->


<!-- knowledge of control variables $k_i$ and ; estimation of the technology $\alpha_i$ and of the control variable elasticities $\kappa_i$, and $y_0$. -->

<!-- Knowledge of the output price at time of planting $P(0)$, as well as the price seasonal growth rate $m_p$ and volatility $s_p$, and the length of the cropping season $T$ is also required. the number of farms in the population $N$ The mean farm's shadow price of budget $E[\lambda^{-\eta}]$. -->

<!-- Below, an illusrative use case is presented ...for the ideal case where high quality farm survey data is available. The minimum data case is considered in the Discussion. the exogenous parameters of the aggregate supply curve are estimated based on Kenya maize farm data. Calculations of aggregate supply and the output price elasticity of supply using the estimated model are compared against empirical estimates. The comparison, in some limited sense, validates the model; but the main point here is to briefly explore some of the challenges faced when applying the method in a real world use case. -->

<!-- The term $y_0 \theta_{\alpha} / \theta_{w}$ can  technology $\alpha_i$  the control variable elasticities $k_i$,  are estimated by straightforward OLS regression of either Equation \ref{eq:cobbDoug3} (in logs) or Equation \ref{eq:prodFn3}. -->


<!-- $$ -->
<!-- E[Q(T)]|_{t = 0} = N E[\theta] E[\lambda^{-\eta}] P(0)^{\eta} e^{\eta m_p T} \Phi(-z) \:\:; \\ -->
<!-- z = -\gamma = \frac{\ln\left(\frac{E \left[ \tilde{C}^{\#}(T) \right]\bigr|_{t = 0}}{P(0)} \right)^{\eta} - \left(\eta m_p - \eta^2 \frac{s_p^2}{2} \right) T }{\eta s_p \sqrt{T}} \\ -->
<!-- \theta = \left( y_0 \frac{\theta_x}{\theta_w} \hat{\theta}_k \right)^{\frac{\eta}{h}} -->
<!-- $$ -->


<!-- Parameterization of the aggregate supply curve derived above thus requires knowledge of the output price at time of planting $P(0)$, the price growth rate $m_p$ and volatility $s_p$, the length of the cropping season $T$, the number of farms in the population $N$, the output degree of homogeneity $h$, the mean farm's expected cost per unit output as evaluated at planting time $E[\tilde{C}^{\#}(T)]|_{t = 0}$, and the expected mean harvested output as evaluated at planting time $E[\tilde{q}^*(T)]\bigr|_{t = 0}$. -->

<!-- ## Data -->


<!-- For the present exercise,  -->
<!-- summary statistics are provided in the appendix...variables on which focus...bin vars -->
<!-- [as well as 2007 rainfall data... as well as the historical average rainfall. ...binary endowment variables...] -->
<!-- This sort of a validation but not so much a validation... -->
<!-- <!-- (graphics here or in Appendix) Summary statistics can be found in the Appendix. --> 
<!-- graphics: main input use, main labor types + who labors -->
<!-- labor qty calculated over significant activities  -->
<!-- cost calculated over significant expenditures - labor, fert, p&d  -->

## Model Specification

For parameter estimation, Equation \ref{eq:yStarC} is natural logged, giving


\begin{equation}
\ln(y) = \ln(\tilde{y}) + h \ln \left(\frac{C^*}{\tilde{C}^*} \right) + \sum_{i = 1}^{n_k} \kappa_i \ln \left( \frac{k_i}{\tilde{k}_i} \right) + \sum_{i = 1}^{n_w} \alpha_i \ln(w_i)
\label{eq:cobbDoug4}
\end{equation}

Where the shorthand $\tilde{y}$ has been introduced, defined

\begin{equation}
\tilde{y} = y_0 \theta_{\alpha} \left( \frac{\tilde{C}^*}{h} \right)^h
\label{eq:yConst}
\end{equation}



\begin{equation}
\ln(\hat{y}) = \ln(\tilde{y}) + \sum_{i = 1}^{n_k} \kappa \ln \left(\frac{k_i}{\tilde{k}_i}\right) + h \ln \left( \frac{C^*}{\tilde{C}^*} \right) + \epsilon \:\:;\;\;\; \ln(\tilde{y}) = \beta_0 + \sum_i \beta_i \ln(b_i)
\label{eq:regMod}
\end{equation}

Where the estimation error $\epsilon$ has been introduced, and where binary endowments $b_i$ are made explicit and separated out from the base constant $\beta_0$. For the present exercise, the binary variables included in the model are land tenure (whether or not the head of household holds a title deed to the land they are farming), adoption of hybrid maize, use of oxen during land preparation, and use of a tractor during land preparation. Recall from section ... that binary endowments take a value of $e$ if the endowment is present, such that the corresponding effect $\beta_{i\neq0}$ is added to the base effect $\beta_0$; and $1$ otherwise, such that no effect is added. The base constant $\beta_0$ figures on all farms in the sample, whereas the $\beta_{i\neq0}$ figure only on farms with the respective endowment. The constant $\tilde{y}$ thus varies from farm to farm based on which endowments, if any, are present.

The continuously valued control variables ($k_i$) included in the model are farm size (acres), adult equivalent household size, rainfall anomaly, planting density (seed kg/acre), and child family labor (person-hours/acre). "Rainfall anomaly" captures rainfall divergence from expectation. It is calculated as the actual rainfall during the 2007 main rains season divided by an historical average over the same period (see the next section for details). A rainfall anomaly value of 1, for example, would suggest that rainfall matched expectation. Planting density is treated as a control variable because it is typically determined by agroclimatic endowments/constraints such as soil conditions and cultivar. Child family labor is likewise treated as a control variable on the premise that it effectively measures a hard constraint (poverty), as opposed to a discretionary input.

The farm maize production cost per acre ($C^*$) is 

<!-- To control for exogenous constraints/endowments, a range of binary and continuously valued control variables is included. The continuously valued control variables are farm size (acres), adult equivalent household size, rainfall anomaly, planting density (seed kg/acre), and child family labor (person-hours/acre). "Rainfall anomaly" captures rainfall divergence from expectation. It is calculated as the actual rainfall during the 2007 main rains season divided by an historical average over the same period (see Appendix 2 for details). A rainfall anomaly value of 1, for example, would suggest that rainfall matched expectation. Planting density is treated as a control variable because it is typically determined by agroclimatic endowments/constraints such as soil conditions and cultivar. Child family labor is likewise treated as a control variable on the premise that it effectively measures a hard constraint (poverty), as opposed to a discretionary input. -->








<!-- [recall from Equation \ref{eq:yConst} that the input variable elasticities $\alpha_i$ and input prices $w_i$ are implicit in the constant $\tilde{y}$, without requiring detailed information about either.] -->

Note that the constant $\tilde{y}$ is not the same for all farms, but varies depending upon how many binary endowments the farm has. The "base case" of $\tilde{y} = e^{\beta_0}$, represents the sample average yield on farms with neither land tenure nor hybrid maize nor use of oxen or tractors for land preparation. In the sample examined here, there are 14 unique values for $\tilde{y}$, summarized in Figure \ref{fig:ySampAvg}.

Model is essentially a function of cost/acre, binary endowments (including the adoption of hybrid maize), management/agroclimatic/demographic control variables, and the prices of the main chemical inputs.

For the purpose of parameterizing an aggregate supply curve, the data is required in order to have a mean yield ($E[y^*]$), average cost ($C^#$), and degree of homogeneity ($h$)....   The yield model in Equation \ref{eq:cobbDoug4} is specified as a function of cost per acre ($C^*$) and control variables ($k_i$).

The continuous control variables $k_i$ are farm size (acres), seed quantity per acre (planting density), child family labor during planting (person-hours/acre), adult-equivalent household size (aehh07), and the 2007 main season rainfall. The cost per acre $C^*$ is the sum of all land prep and input (seed, fertilizer, hired labor, and pesticide) costs.

B and binary endowment variables ($b_i$), plus an error term $\epsilon$ assumed to be normally distributed with mean 0.

```{r Fig3, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:lognormalYd}", echo = FALSE}

thisFolder <- "D:/OneDrive - CGIAR/Documents 1/CIAT 2/A theory of aggregate supply and demand/"
thisFile <- "df_mod2007.csv"
thisFilepath <- paste0(thisFolder, thisFile)
df_mod <- read.csv(thisFilepath, stringsAsFactors = F)
colnames(df_mod) <- df_mod[nrow(df_mod), ]
df_mod <- df_mod[-nrow(df_mod), ]
df_mod[, -1] <- as.data.frame(apply(df_mod[, -1], 2, as.numeric))
colnames(df_mod)[which(colnames(df_mod) == "Cstar")] <- "Cost/acre (KES/acre)"
df_mod <- df_mod %>% rename(`Child family labor, planting (person-hrs/acre)` = `planting fam lab child (pers-hrs/acre)`,
                            `Maize (KES/kg)` = P,
                            `DAP fert (kg/acre)` = `dap (kg/acre)`,
                            `DAP fert (KES/kg)` = `dap (KES/kg)`,
                            `DAP fert (KES/acre)` = `dap (KES/acre)`,
                            `Adult equivalent household size` = aehh07,
                            `Farm size (acres)` = acres)
colnames(df_mod) <- str_replace(colnames(df_mod), "^\\w{1}", toupper)
colnames(df_mod) <- gsub("\\(KES/kg\\)", "price (KES/kg)", colnames(df_mod))
#=======================================================================
input_vars <- c(#"Total fam lab child (pers-hrs/acre)",
  #"Total fam lab (pers-hrs/acre)",
  #"Total fam lab adult (pers-hrs/acre)",
  #"Total wage labor (pers-hrs/acre)",
  #"1st weeding fam lab child (pers-hrs/acre)",
  #"2nd weeding fam lab fem (pers-hrs/acre)",
  #"2nd weeding fam lab adult (pers-hrs/acre)",
  #"1st weeding fam lab fem (pers-hrs/acre)",
  #"1st weeding fam lab adult (pers-hrs/acre)",
  #"1st weeding fam lab male (pers-hrs/acre)", *
  #"1st weeding wage labor (pers-hrs/acre)",
  #"2nd weeding wage labor (pers-hrs/acre)",
  # "1st ploughing fam lab child (pers-hrs/acre)",
  #"1st ploughing fam lab adult (pers-hrs/acre)",
  # "1st ploughing fam lab fem (pers-hrs/acre)",
  #"1st ploughing fam lab male (pers-hrs/acre)",
  #"1st ploughing wage labor (pers-hrs/acre)",
  #"shelling fam lab adult (pers-hrs/acre)",
  #"shelling fam lab fem (pers-hrs/acre)",
  #"shelling fam lab male (pers-hrs/acre)",
  #"shelling fam lab child (pers-hrs/acre)",
  # "shelling wage labor (pers-hrs/acre)",
  #"harvesting fam lab male (pers-hrs/acre)", #**
  #"harvesting fam lab adult (pers-hrs/acre)", *
  #"harvesting fam lab fem (pers-hrs/acre)",
  #"harvesting fam lab child (pers-hrs/acre)",
  #"harvesting wage labor (pers-hrs/acre)",
  #  "planting fam lab adult (pers-hrs/acre)",
  # "planting fam lab fem (pers-hrs/acre)",
  #"planting fam lab male (pers-hrs/acre)",
  "Child family labor, planting (person-hrs/acre)",
  #"planting wage labor (pers-hrs/acre)",
  #"Total synth. fert. (kg/acre)",
  "Seed (kg/acre)",
  "Total CAN fert (kg/acre)",      
  "Total NPK fert (kg/acre)",  
  "Total UREA fert (kg/acre)",
  "DAP fert (kg/acre)",
  #"UREA (46:0:0) (kg/acre)",
  #"CAN (26:0:0) (kg/acre)",
  # "NPK (23:23:23) (kg/acre)",
  # "NPK (23:23:0) (kg/acre)",
  #"NPK (17:17:0) (kg/acre)",
  #"manure (kg/acre)",
  #"compost (kg/acre)",
  #"mavuno-basal (kg/acre)",
  #"foliar feed (kg/acre)",
  # "Fungicide qty (kg/acre)",
  # "Herbicide qty (kg/acre)",
  # "Insecticide qty (kg/acre)",
  # "Pesticide qty (kg/acre)"
  "Total P&D chem (kg/acre)"
)
demog_vars <- c(#"age",
  "Adult equivalent household size"#,
  #"hhsize07"
  # "km to organic fert mkt",
  #"km to synth fert mkt",
  #"km to pest/plague chem mkt"
)
clim_vars <- c("Rain anomaly"#,
               #"qwetpre",
               #"main07",
               # "qwetxt",
               # "qwetit"
)
bin_vars <- c("Adopter", #"gend",
              #"irrigated",
              # "tenure: govt/communal/cooperative",
              # "tenure: owned by parent/relative", 
              "Tenure: owned with title deed",
              # "tenure: owned without title deed",
              # "tenure: rented",
              # "landprep: manual",
              # "landprep: none",
              "Landprep: oxen",
              "Landprep: tractor")
#-----------------------------------------------------------------------
costVars <- c("Cost/acre (KES/acre)", #"seed (KES/acre)",
              "DAP fert (KES/acre)",
              #"UREA (46:0:0) (KES/acre)",
              "Total CAN fert (KES/acre)",
              #"CAN (26:0:0) (KES/acre)",
              "Total NPK fert (KES/acre)",
              #"NPK (23:23:23) (KES/acre)",
              #"NPK (23:23:0) (KES/acre)",
              "Total UREA fert (KES/acre)",
              #"manure (KES/acre)",
              "Total P&D chem (KES/acre)"
)
priceVars <- gsub("\\(KES/acre\\)", "price (KES/kg)", costVars[-1])
#priceVars <- c(priceVars, "harvesting (KES/hour)")
priceVars <- priceVars[-which(priceVars == "Total UREA fert price (KES/kg)")]
#-----------------------------------------------------------------------
# # Remove farms not using any inputs (as these farms then have h=0)
# indh0 <- which(rowSums(df_mod[, setdiff(input_vars, c("planting fam lab child (pers-hrs/acre)", "seed (kg/acre)"))]) == 0)
# #length(indh0)
# df_mod <- df_mod[-indh0, ]
#-----------------------------------------------------------------------
mod1Vars <- c("Dist", "Yield (kg/acre)", "Farm size (acres)",
              input_vars, bin_vars, demog_vars, clim_vars,
              costVars, priceVars, "Maize price (KES/kg)")
df_mod1 <- df_mod[, mod1Vars]
not_these <- which(colnames(df_mod1) %in% c("Dist", costVars, priceVars, "Maize price (KES/kg)"))
# df_mod1 <- df_mod1 %>% rename(`Adult equivalent household size` = aehh07,
#                               `DAP (kg/acre)` = `dap (kg/acre)`)
mod1 <- lm(`Yield (kg/acre)`~., df_mod1[, -not_these])
#summ(mod1)
#summary(mod1)
#sum(mod1$residuals^2)
#plot(mod1$fitted.values, mod1$residuals)
#car::vif(mod1)
#View(df_mod1[which(mod1$residuals < -2), ])
library(jtools)
#summ(mod1)
coefsNeg <- mod1$coefficients[which(mod1$coefficients < 0)]
coefsNegNames <- gsub("`", "", names(coefsNeg))
inputsNegCoef <- coefsNegNames[which(coefsNegNames %in% input_vars)]
inputsPosCoef <- setdiff(input_vars, inputsNegCoef)
#-----------------------------------------------------------------------
mod2Vars <- c("Dist", "Yield (kg/acre)", "Cost/acre (KES/acre)", "Farm size (acres)", "Seed (kg/acre)", inputsNegCoef, bin_vars, demog_vars, clim_vars, priceVars)
df_mod2 <- df_mod[, c(mod2Vars, "Maize price (KES/kg)")]
#-----------------------------------------------------------------------
# Get cStar and area before transforming
cStar <- exp(df_mod2$`Cost/acre (KES/acre)`)
muCstarSamp <- mean(cStar)
lAcres <- df_mod2$`Farm size (acres)`
mArea <- mean(lAcres)
sArea <- sd(lAcres)
muArea <- exp(mArea + sArea^2 / 2)
#---------------------------------------------------------------------
theseCols <- c("Cost/acre (KES/acre)", "Farm size (acres)", "Seed (kg/acre)", demog_vars)
thisFun <- function(x){out <- x - log(mean(exp(x))); return(out)}
df_mod2[, theseCols] <- as.data.frame(apply(df_mod2[, theseCols], 2, thisFun))
df_mod2[, priceVars] <- log(df_mod2[, priceVars])
for(i in 1:length(priceVars)){
  u <- df_mod2[, priceVars[i]]
  df_mod2[which(is.infinite(u)), priceVars[i]] <- 0
  if(length(which(is.na(u)) > 0)){
      df_mod2[which(is.na(u)), priceVars[i]] <- 0
  }
}
not_these <- which(colnames(df_mod2) %in% c("Maize price (KES/kg)", "Dist", costVars[-1]))
# naFn <- function(x){return(sum(is.na(x)))}
# NaNfn <- function(x){return(sum(is.nan(x)))}
# nNA <- apply(df_mod2, 2, naFn)
# nNaN <- apply(df_mod2, 2, NaNfn)
mod2 <- lm(`Yield (kg/acre)`~., df_mod2[, -not_these])
#summ(mod2)
#summary(mod2)
# sum(mod2$residuals^2)
# plot(mod2$fitted.values, mod2$residuals)
#car::vif(mod2)
# View(df_mod2[which(mod2$residuals < -1.5), ])
# indOutlier <- which(mod2$residuals < -2)
# df_mod2[indOutlier, c("Dist", "Yield (kg/acre)", "Farm size (acres)")]
# df_mod2 <- df_mod2[-indOutlier, ]
#---------------------------------------------------------------------
# mod 3
mod3Vars <- setdiff(mod2Vars, c(priceVars, "Child family labor, planting (person-hrs/acre)"))
#mod3Vars <- setdiff(mod2Vars, c(priceVars))
# # Let's drop some extreme values
# # Extremely high cost/acre often due to extremely small farm size
# hist(exp(df_mod$`Cost/acre (KES/acre)`), 40)
# indHiCost <- which(exp(df_mod$`Cost/acre (KES/acre)`) > 20000)
# indUnprofitable <- which(exp(df_mod$Rstar) / exp(df_mod$`Cost/acre (KES/acre)`)<0.75)
# cSharpTrunc <- df_mod$`Cost/acre (KES/acre)`/df_mod$`Yield (kg/acre)`
# hist(cSharpTrunc,25)
# cSharpTrunc
# # exp(df_mod$`Yield (kg/acre)`[indHiCost])
# # exp(df_mod$`Farm size (acres)`[indHiCost])
# # exp(df_mod$Rstar[indHiCost]) / exp(df_mod$`Cost/acre (KES/acre)`[indHiCost])
# # df_mod[which(!duplicated(df_mod$`Seed (kg/acre)`)),]%>%View
# # df_mod[indUnprofitable,]%>%View
# indRm <- indHiCost
#indRm <- unique(c(indHiCost, indUnprofitable))
#dfMod3 <- df_mod[, c(mod3Vars)]
hist(df_mod$`Yield (kg/acre)`)
# Focus on provinces that have same or similar maize price
dfLook <- df_mod %>% group_by(Dist) %>% summarize(`Maize price (KES/kg)` = mean(`Maize price (KES/kg)`))
ggplot(dfLook,aes(x=`Maize price (KES/kg)`,y=Dist))+geom_bar(stat="identity")
maizeProvs <- c("Uasin Gishu", "Nyeri", "Trans Nzoia", "Bungoma", "Kakamega", "Narok", "Laikipia", "Kitui", "Machakos")
dfLook <- df_mod %>% subset(Dist %in% maizeProvs) %>% select(all_of(mod3Vars))
hist(dfLook$`Yield (kg/acre)`)
dfLook$cSharp <- dfLook$`Cost/acre (KES/acre)` - dfLook$`Yield (kg/acre)`
hist(dfLook$cSharp)
#dfMod3 <- df_mod[-indRm, c(mod3Vars)]
dfMod3 <- df_mod[, mod3Vars]
#dfMod3 <- dfMod3 %>% subset(Dist %in% maizeProvs)
mod3 <- lm(`Yield (kg/acre)`~., dfMod3[, -1])
summ(mod3)
# indSameP <- which(dfMod3$Dist %in% maizeProvs)
# hist(mod3$fitted.values[indSameP])
# lcSharpSameP <- (subset(dfMod3, Dist %in% maizeProvs)$`Cost/acre (KES/acre)` - mod3$fitted.values[indSameP])
# hist(lcSharpSameP)
# dfMod3$cSharp <- dfMod3$`Cost/acre (KES/acre)` - dfMod3$`Yield (kg/acre)`
# dfMod3$`Yield (kg/acre)` <- NULL#; dfMod3$`Cost/acre (KES/acre)`
# mod3 <- truncreg::truncreg(cSharp~., dfMod3[, -1], point = 2.5, direction = "right")
# mod3 <- lm(cSharp~., dfMod3[, -1])
# summary(mod3)
# plot(mod3$fitted.values, mod3$residuals)
# 1-mod3$coefficients[2]



#car::vif(mod3)
# # Clean: drop outliers with error outside of x stand devs
# indRm <- which(abs(mod3$residuals) > 1)
# View(dfMod3[indRm,]); length(indRm)
# dfMod3 <- dfMod3[-indRm, ]
#======================================================================
#======================================================================
#======================================================================
# Descriptive graphics
dfLook <- dfMod3
gatherCols <- colnames(dfLook)[-1]
dfLook <- dfLook %>% gather_("var", "val", gatherCols)
# Control vars
controlVarsVec <- c("Seed (kg/acre)", "Adult equivalent household size", "Rain anomaly", "Cost/acre", "Farm size (acres)") #"Child family labor, planting (person-hrs/acre)"
dfPlot <- dfLook %>% subset(var == "Yield (kg/acre)")
dfPlot$val <- exp(dfPlot$val)
ggYd <- ggplot(dfPlot, aes(x = val)) +
  geom_histogram(color = "black", fill = "white", bins = 25) +
  facet_wrap(~var, scales = "free") + theme_bw() +
  theme(axis.title = element_blank(),
        #axis.title.y = element_text(size = axisTitleSize),
        axis.text = element_text(size = axisTextSize),
        strip.background = element_blank(),
        strip.text = element_text(size = facetTitleSize))
dfPlot <- dfLook %>% subset(var %in% controlVarsVec & val > 0)
dfPlot$val <- exp(dfPlot$val)
u <- dfPlot$var; dfPlot$var[grep("Adult equivalent", u)] <- "Adult equivalent\nhousehold size"
#u <- dfPlot$var; dfPlot$var[grep("Child family", u)] <- "Child fam lab, planting\n (pers-hrs/acre)"
ggIndepVars <- ggplot(dfPlot, aes(x = val)) +
  geom_histogram(color = "black", fill = "white", bins = 26) +
  facet_wrap(~var, scales = "free") + theme_bw() +
  theme(axis.title.x = element_blank(),
        #axis.title.y = element_text(size = axisTitleSize),
        axis.text = element_text(size = axisTextSize),
        strip.background = element_blank(),
        strip.text = element_text(size = facetTitleSize - 1))
ggIndepVars + ggYd + plot_layout(widths = c(2, 2))
# # Input/output prices
# dfPlot <- dfLook %>% subset(var %in% priceVars & val > 0) %>% rename(`KES/kg` = val)
# dfPlot$var <- gsub(" \\(KES/kg\\)", "", dfPlot$var)
# ggInputPrices <- ggplot(dfPlot, aes(y = `KES/kg`)) +
#   geom_histogram(color = "black", fill = "white") +
#   facet_wrap(~var, scales = "free_y") + theme_bw() +
#   theme(axis.text = element_text(size = axisTextSize),
#         strip.background = element_blank(),
#         strip.text = element_text(size = facetTitleSize))
# dfPlot <- dfLook %>% subset(var == "Maize price (KES/kg)") %>%
#   group_by(Dist) %>% summarise(val = mean(val)) %>%
#   rename(`KES/kg` = val) %>% mutate(var = "Maize price")
# dfPlot$var <- gsub(" \\(KES/kg\\)", "", dfPlot$var)
ggMaizePrice <- ggplot(dfPlot, aes(x = `KES/kg`, y = Dist)) +
  geom_bar(stat = "identity", color = "black", fill = "white") +
    facet_wrap(~var, scales = "free_y") + theme_bw() +
  theme(axis.title.y = element_blank(),
        axis.text = element_text(size = axisTextSize),
        strip.background = element_blank(),
        strip.text = element_text(size = facetTitleSize))
#ggInputPrices + ggMaizePrice + plot_layout(widths = c(2, 1))
#======================================================================
#======================================================================
#======================================================================
# Estimation
# mod3 <- lm(`Yield (kg/acre)`~., dfMod3b[, -1])
# summ(mod3)
# plot(mod3$fitted.values, mod3$residuals)
#----------------------------------------------------------------------
# Post-estimation transformation of regression constant into expected value of yStar (y0)
# HAVE TO FACTOR OUT KRAIN BECAUSE IT IS AN EX POST VARIABLE!!!!
# IMPORTANT TO NOTE IN TEXT THAT EXOG CONTROL VARS ARE FROM POV OF PLANTING TIME
# --> A crude way of calculating expected yield is by evaluating ex-post yield
# at kRain = 1, i.e. expecting rainfall to follow past pattern.
coefVec <- mod3$coefficients; coefNames <- gsub("`", "", names(coefVec))
kappaRn <- coefVec[which(coefNames == "Rain anomaly")]
kRn <- exp(dfMod3$`Rain anomaly`)
# EyStarT0 <- exp(dfMod3$`Yield (kg/acre)`) * kRn^(-kappaRn)
EyStarT0trunc <- exp(mod3$fitted.values) * kRn^(-kappaRn)
notThese <- c("Dist", "Yield (kg/acre)", "Cost/acre (KES/acre)", "Rain anomaly", bin_vars)
kVars <- setdiff(mod3Vars, notThese)
kappaVec <- coefVec[which(coefNames %in% kVars)]
matK <- dfMod3[, kVars] %>% as.matrix()
kLook <- matK %*% rep(1, ncol(matK))
mVec <- colMeans(matK)
sVec <- apply(matK, 2, sd)
muThetaK <- exp(sum(c(mVec * kappaVec, kappaVec^2 * sVec^2 / 2)))
thetaKvec <- matK %*% kappaVec
muThetaKsamp <- thetaKvec %>% exp() %>% mean()
muThetaK/muThetaKsamp
#EthetaKsamp2 <- matK %*% diag(kappaVec) %>% colMeans() %>% sum() %>% exp()
h <- coefVec[which(coefNames == "Cost/acre (KES/acre)")]; eta <- h / (1 - h)
muThetaKnh <- exp(sum(c(eta / h * mVec * kappaVec, (eta / h)^2 * kappaVec^2 * sVec^2 / 2)))
#======================================================================
# Get mean price jump from county level monthly price data (downloaded from FAO GIEWS-FPMA Tool) and calculate lambda
thisFile <- "Nakuru Eldoret monthly maize price.csv"
thisFilePath <- paste0(thisFolder, thisFile)
df_raw <- read.csv(thisFilePath, stringsAsFactors = F)
keepCols <- c(1, 2)
df_raw <- df_raw[, keepCols]
df_raw <- as.data.frame(apply(df_raw, 2, rev))
colnames(df_raw) <- c("Date", "Price")
df_raw$Price <- as.numeric(df_raw$Price)
df_raw$Date <- as.Date(df_raw$Date, "%m/%d/%Y")
df <- df_raw
# df <- subset(df_raw, Date >= "2008-03-01" &
#                Date <= "2019-08-01")
df$`Log change` <- c(NA, diff(log(df$Price)))
library(lubridate)
yrVec <- unique(year(df$Date))
nYr <- length(yrVec)
th <- 7
mVec <- c()
sVec <- c()
P0vec <- c()
EPT0hist <- c()
anomVec <- c()
for(i in 1:(nYr - 1)){
  thisDate <- as.Date(paste0(as.character(yrVec[i]), "-03-01"))
  indMY <- grep(thisDate, df$Date)
  indMY <- indMY:(indMY + th)
  this_m <- mean(df$`Log change`[indMY], na.rm = T)
  this_s <- sd(df$`Log change`[indMY], na.rm = T)
  mVec[i] <- this_m
  sVec[i] <- this_s
  #---
  thisDate <- as.Date(paste0(as.character(yrVec[i]), "-03-01"))
  indGrow <- grep(thisDate, df$Date)
  indGrow <- indGrow:(indGrow + th)
  P0 <- df$Price[indGrow[1]]
  PT <- df$Price[indGrow[1 + th]]
  P0vec[i] <- P0 
  #---
  # print(year(df$Date[indGrow[1]]))
  # print(paste("m = ", this_m))
  # print(paste("s = ", this_s))
  if(i > 1){
    EPT0 <- P0 * exp(mVec[i - 1] * th)
    thisAnomaly <- 100 * (EPT0 / PT - 1)
    # print(paste("P0 = ", P0))
    # print(paste("PT = ", PT))
    # print(paste("EPT0 = ", EPT0))
    # print(thisAnomaly)
    EPT0hist[i] <- EPT0
    anomVec[i] <- thisAnomaly
  }
  
}

# hist(anomVec, 15)
# hist(mVec)
#---
P02007 <- P0vec[2]
mP2006 <- mVec[1]
sP2006 <- sVec[1]
#EPT02007 <- floor(P02007 * exp(mP2006 * th))
EPT02007ElDoret <- P02007 * exp(mP2006 * th)
#---
P02009 <- P0vec[4]
mP2008 <- mVec[3]
sP2008 <- sVec[3]
EPT02009 <- P02009 * exp(mP2008 * th)
#=============================================================================
# Define root function to solve for population EcSharpT0
rootFnUp <- function(xIn, xUp, sXtrunc, mXtrunc){
  sX <- xIn[1]
  mX <- xIn[2]
  zUp <- (log(xUp) - mX) / sX
  invMillsRatio <- dnorm(zUp) / pnorm(zUp)
  slack_s <- sXtrunc^2 - sX^2 * (1 - zUp * invMillsRatio - invMillsRatio^2)
  slack_m <- mXtrunc - mX + sX * invMillsRatio
  outVec <- c(slack_s, slack_m)
  return(outVec)
}
EyStarT0trunc <- exp(mod3$fitted.values)#kRn^-kappaRn * exp(mod3$fitted.values)
EcStarT0trunc <- exp(dfMod3$`Cost/acre (KES/acre)`)
EcSharpT0trunc <- EcStarT0trunc / EyStarT0trunc
lEcSharpT0trunc <- log(EcSharpT0trunc)
EPT02007 <- mean(df_mod$`Maize price (KES/kg)`) * exp(-mP2006 * th)
lamTrunc <- EPT02007 / EcSharpT0trunc * h
sum(lamTrunc > h) / length(lamTrunc)
#mEcSharpT0trunc <- mean(lcSharpSameP); sEcSharpT0trunc <- sd(lcSharpSameP)
mEcSharpT0trunc <- mean(lEcSharpT0trunc); sEcSharpT0trunc <- sd(lEcSharpT0trunc)
muEcSharpT0trunc <- exp(mEcSharpT0trunc + sEcSharpT0trunc^2 / 2)
xIn <- c(sEcSharpT0trunc, mEcSharpT0trunc)
sol <- nleqslv::nleqslv(xIn, rootFnUp, jac = NULL,
                        xUp = EPT02007,
                        sXtrunc = sEcSharpT0trunc,
                        mXtrunc = mEcSharpT0trunc)
#sol
sEcSharpT0 <- sol$x[1]
mEcSharpT0 <- sol$x[2]
muEcSharpT0 <- exp(mEcSharpT0 + sEcSharpT0^2 / 2)
muEcSharpT0n <- exp(eta * mEcSharpT0 + eta^2 * sEcSharpT0^2 / 2)

mLamba <- log(P02007) + (mP2006 - sP2006^2 / 2) * th + log(h) - mEcSharpT0
mean(log(lamTrunc))

ProbProfit <- pnorm((log(EPT02007) - mEcSharpT0) / (sEcSharpT0) - eta * sEcSharpT0)
EmploymentRate <- pnorm((log(EPT02007) - mEcSharpT0) / sEcSharpT0)
muEyStarT0trunc <- mean(EyStarT0trunc)
muEyStarT0 <- muEyStarT0trunc * EmploymentRate / ProbProfit
EcSharpT0nTrunc <- (exp(dfMod3$`Cost/acre (KES/acre)`) / EyStarT0trunc)^eta
muEcSharpT0nTrunc <- mean(EcSharpT0nTrunc)
muEcSharpT0n <- muEcSharpT0nTrunc * EmploymentRate / ProbProfit
EyStarT0max <- muEyStarT0 * EPT02007^eta / muEcSharpT0n
#======================================================================
# Graph truncated yield, cost per unit output distributions
# shapiro.test(lEcSharpT0trunc)
# car::qqPlot(lEcSharpT0trunc)
xVec <- seq(0.001, 40, length.out = length(EcSharpT0trunc))
fVec <- dlnorm(xVec, mEcSharpT0, sEcSharpT0)
dfPlot <- data.frame(xVec, fVec)
EPT02007min <-min(df_mod$`Maize price (KES/kg)`) 
EPT02007max <-max(df_mod$`Maize price (KES/kg)`)
gg <- ggplot() + geom_histogram(data = data.frame(EcSharpT0trunc), aes(x = EcSharpT0trunc, y = after_stat(count / sum(count))), bins = 35, color = "black", fill = "white") + scale_y_continuous(labels = scales::percent)
gg <- gg + geom_line(data = dfPlot, aes(x = xVec, y = fVec))
gg <- gg + scale_x_continuous(limits = c(0, 40))
gg <- gg + geom_vline(xintercept = EPT02007, color = "red", linetype = "dashed")
gg <- gg + annotate("rect", fill = "red", alpha = 0.25, 
        xmin = EPT02007min, xmax = EPT02007max,
        ymin = -Inf, ymax = Inf)
gg <- gg + theme_bw()
# Now EyStarT0
xVec <- seq(0.001, 2500, length.out = length(EyStarT0trunc))
fVec <- dlnorm(xVec, mEyStarT0, sEyStarT0)
dfPlot <- data.frame(xVec, fVec)
EyStarT0maxUp <- muEyStarT0 * max(exp(thetaKvec))^(eta / h) / muThetaKnh * EPT02007max^eta / muEcSharpT0n
EyStarT0maxLo <- muEyStarT0 * min(exp(thetaKvec))^(eta / h) / muThetaKnh * EPT02007min^eta / muEcSharpT0n
gg <- ggplot() + geom_histogram(data = data.frame(EyStarT0trunc), aes(x = EyStarT0trunc, y = after_stat(count / sum(count))), bins = 15, color = "black", fill = "white") #+ scale_y_continuous(labels = scales::percent)
gg <- gg + geom_line(data = dfPlot, aes(x = xVec, y = fVec))
gg <- gg + geom_vline(xintercept = EyStarT0max, color = "red", linetype = "dashed")
gg <- gg + annotate("rect", fill = "red", alpha = 0.25, 
        xmin = EyStarT0maxLo, xmax = EyStarT0maxUp,
        ymin = -Inf, ymax = Inf)
gg <- gg + theme_bw()




# ggplot() + geom_line(data = dfPlot, aes(x = lEcSharpVec, y = f)) + geom_vline(xintercept = log(EPT02007), color = "red", lwd = 1) + theme_bw()
xVec <- seq(0.0001, 40, length.out = length(EcSharp))
f <- dlnorm(xVec, mEcSharp, sEcSharp)
dfPlot <- data.frame(xVec, f)
gg <- ggplot() + geom_histogram(data = data.frame(EcSharpT0), aes(x = EcSharp, y = 0.7*after_stat(count / sum(count))), bins = 45, color = "black", fill = "white") #+ scale_y_continuous(labels = scales::percent)
gg <- gg + geom_line(data = dfPlot, aes(x = EcSharpVec, y = f)) + geom_vline(xintercept = EPT02007, color = "red", lwd = 1) + theme_bw()

annotate("rect", fill = "red", alpha = 0.5, 
        xmin = 1924, xmax = 1928 + 11/12,
        ymin = -Inf, ymax = Inf) 

#----------------------------------------------------------------------------------------
# Agg supply
EQsFun <- function(EPT0, muEyStarT0, mEcSharpT0, sEcSharpT0, h, muArea, Nf){
  # eta <- h / (1 - h)
  # PT0 <- EPT0 * exp(-mP * th)
  # z <- (eta * log(muEcSharpT0 / PT0) - (eta * mP - eta^2 * sP^2 / 2) * th) / (eta * sP * sqrt(th))
  # ProbProfitMeanFarm <- (1 - pnorm(z)) #Probability of mean farm making a profit (adjusted by eta)
  z <- (log(EPT0) - mEcSharpT0) / sEcSharpT0 - eta * sEcSharpT0
  ProbProfitMeanFarm <- pnorm(z)
  EQsT0 <- muArea * Nf * muEyStarT0 * ProbProfitMeanFarm #Expected agg supply in kg
  #------------Expected agg supply in million MT
  EQsT0 <- EQsT0 * 10^-9
  #------------Spot price elasticity of expected agg supply
  etaP0EQsT0 <- dnorm(z) / pnorm(z) * 1 / (sP * sqrt(th))
  #etaP0EQsT0 <- dnorm(-z) / pnorm(-z) * 1 / (sP * sqrt(th))
  #------------sP (price risk) elasticity of expected agg supply
  # (But of limited significance since really want to know it at equilibrium
  # PT0 and EcSharpT0, which change with sP)
  #etaSpEQsT0 <- -dnorm(-z) / pnorm(-z) * (eta * sqrt(th) - z / sP)
  #eta <- -dnorm(-z) / pnorm(-z) * (eta * sP * sqrt(th) - z)
  #------------
  EmploymentRate <- pnorm((log(EPT0) - mEcSharpT0) / sEcSharpT0)
  #------------
  dfOut <- data.frame(EPT0, EQsT0, ProbProfitMeanFarm, etaP0EQsT0, EmploymentRate)# etaP0EQsT0, etaSpEQsT0)
  colnames(dfOut) <- c("Expected price (KES/kg)", "Expected supply\n(million MT)",
                       "Mean probability\nof profit", "Price elasticity\nof supply",
                       "Employment rate")
  return(dfOut)
}

EPT0vec <- seq(0.1, 23, length.out = 50)
muArea <- mean(exp(dfMod3$`Farm size (acres)`))
Nf <- 2*10^6
dfEQsT0 <- EQsFun(EPT0vec, muEyStarT0, mEcSharpT0, sEcSharpT0, h, muArea, Nf)

gg <- ggplot(dfEQsT0, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million MT)`))
gg <- gg + geom_line() + theme_bw()
ggEQsT0 <- gg
gg <- ggplot(dfEQsT0, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
gg <- gg + geom_line() + theme_bw()
ggEtaEPT0EQsT0a <- gg
gg <- ggplot(dfEQsT0, aes(x = `Expected price (KES/kg)`, y = `Mean probability\nof profit`))
ggProbProfit <- gg + geom_line() + theme_bw()
gg <- ggplot(dfEQsT0, aes(x = `Expected price (KES/kg)`, y = `Employment rate`))
ggEmployment <- gg + geom_line() + theme_bw()
df_inset <- subset(dfEQsT0, `Expected price (KES/kg)` > (EPT02007 - 3) & `Expected price (KES/kg)` < EPT02007 + 3)
gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
gg <- gg + geom_line()
#gg <- gg + geom_hline(yintercept = 1, linetype = "dashed", color = "red")
gg <- gg + geom_vline(xintercept = EPT02007)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank())
ggEtaEPT0EQsT0b <- gg
ggEtaEPT0EQsT0 <- ggEtaEPT0EQsT0a + annotation_custom(ggplotGrob(ggEtaEPT0EQsT0b),
                                          xmin = 6, xmax = 20, 
                                          ymin = 5, ymax = 11)


#----------------------------------------------------------------------------------------
# # Define constant in terms of convenient known reference value y0, in this case sample mean yield.
# # Sample mean yield varies with binary controls. Here is the mean with just the base constant
# # (i.e. all binaries = 0)
# alpha0 <- coefVec[1]
# v0base <- exp(alpha0)
# #y0base <- v0base * muThetaKnh * muEcSharpT0n
# muEcStarT0hBase <- muEyStarT0 / (muThetaK * v0base)
# #---
# # Now calculate mean yield for all binary combinations
# # Adjust for exogenous endowments/constraints
# kappaBins <- coefVec[which(coefNames %in% bin_vars)]
# dfBins <- dfMod3[, bin_vars]
# #dfBins <- dfMod3b[, bin_vars]
# alpha0adj <- alpha0 + as.matrix(dfBins) %*% kappaBins
# v0 <- exp(alpha0adj)
# muEcStarT0h <- muEyStarT0 / (muThetaK * v0)
# y0 %>% unique() %>% length # 14 endowment combos present
# dfPlot <- data.frame(County = dfMod3$Dist, y0)
# #dfPlot <- data.frame(County = dfMod3b$Dist, y0)
# #ggplot(dfPlot, aes(x = y0)) + geom_histogram() + facet_wrap(~County)
# #exp(mean(dfMod3$`Yield (kg/acre)`) + sd(dfMod3$`Yield (kg/acre)`)^2/2)
# # mean(y0)
# #-----------------------------------------------------------------------
# # Create label vec for each of the 14 endowment combos
# dfBins$Adopter <- ifelse(dfBins$Adopter == 1, "Hybrid", "0")
# dfBins$`Tenure: owned with title deed` <- ifelse(dfBins$`Tenure: owned with title deed` == 1, "Tenure", "0")
# dfBins$`Landprep: oxen` <- ifelse(dfBins$`Landprep: oxen` == 1, "Oxen", "0")
# dfBins$`Landprep: tractor` <- ifelse(dfBins$`Landprep: tractor` == 1, "Tractor", "0")
# endowVec <- apply(dfBins, 1, paste, collapse = " + ")
# endowVec <- gsub("0 \\+|\\+ 0", "", endowVec)
# endowVec <- gsub("   0", "Base", endowVec)
# endowVec[which(endowVec != "Base")] <- paste("Base +", endowVec[which(endowVec != "Base")])
# endowVec <- gsub("  ", " ", endowVec)
# endowVec <- trimws(endowVec)
# endowVec <- gsub("  ", " ", endowVec)
# #unique(endowVec)
# #---------------------------------------------------------------------
# # Graphic of prevalence of each endowment combo and its value
# cellText_size <- 2.5
# df_plot <- data.frame(Type = endowVec, y0 = round(y0, 1)) %>%
#   mutate(xx = 1) %>% group_by(Type) %>%
#   summarise(`Number of farms` = sum(xx, na.rm = T), y0 = unique(y0)) %>%
#   as.data.frame() %>%
#   mutate(`Pct of farms in sample` = `Number of farms` / sum(`Number of farms`) * 100) %>%
#   mutate(Element = 1) %>% arrange(y0) %>%
#   mutate(Type = factor(Type, Type))
# typeVec <- df_plot$Type
# # df_plot$Type <- factor(df_plot$Type, levels = df_plot$y0[order(df_plot$y0)], ordered = T)
# #gg <- ggplot(df_plot, aes(x = Element, y = Type, fill = y0, label = y0))
# gg <- ggplot(df_plot, aes(x = Element, y = Type, fill = y0, label = y0))
# #gg <- gg + scale_y_discrete(limits = typeVec)
# gg <- gg + geom_tile(alpha = 0)
# gg <- gg + labs(title = expression(y[0]))
# #gg <- gg + labs(title = expression(tilde(y)))
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank(),
#                  axis.text.x = element_blank(),
#                  axis.ticks.x = element_blank(),
#                  axis.text.y = element_text(size = axisTextSize),
#                  panel.grid = element_blank(),
#                  plot.title = element_text(size = axisTitleSize, hjust = 0.5),
#                  legend.position = "none")
# gg <- gg + geom_text(size = cellText_size)
# ggEndow1 <- gg
# #---
# gg <- ggplot(df_plot, aes(x = `Pct of farms in sample`, y = Type))
# #gg <- gg + scale_y_discrete(limits = typeVec)
# gg <- gg + geom_col()
# gg <- gg + labs(title = "Pct of farms in sample")
# gg <- gg + theme_bw()
# gg <- gg + theme(axis.title = element_blank(),
#                  #axis.title.x = element_text(size = axisTitleSize),
#                  axis.text.y = element_blank(),
#                  axis.text.x = element_text(size = axisTextSize),
#                  #panel.grid = element_blank(),
#                  plot.title = element_text(size = axisTitleSize, hjust = 0.5))
# ggEndow2 <- gg
# ggEndow1 + ggEndow2
#======================================================================
mean(y0) * 2.5*10^6 /1000 * 0.8 # Agg Supply with 80% chance of mean farm making profit
#Ok if it's a little low because omits short rains season
#Note mean of y0 automatically weights the 14 configurations according to their prevalence in the sample--it's a weighted sum of the sample mean yields of each system
# dfPlot <- data.frame(County = dfMod3$Dist, endowVec, xx = 1) %>% group_by(County) %>%
#   mutate(n = sum(xx)) %>% subset(n >=30)
# ggplot(dfPlot, aes(y = endowVec)) + geom_bar(stat = "count") + facet_wrap(~County)
# Define agg supply curve/price elasticity of supply/price risk elasticity of supply function
#----------------------------------------------------------------------
# rootFnLo <- function(xIn, xLo, sXtrunc, mXtrunc){
#   sX <- xIn[1]
#   mX <- xIn[2]
#   zLo <- (log(xLo) - mX) / sX
#   probTerm <- dnorm(zLo) / pnorm(-zLo)
#   slack_s <- sXtrunc^2 - sX^2 * (1 + zLo * probTerm - probTerm^2)
#   slack_m <- mXtrunc - mX - sX * probTerm
#   outVec <- c(slack_s, slack_m)
#   return(outVec)
# }

# Quick calculation of aggregate supply
EmploymentRate <- pnorm((log(EPT02007) - mEcSharpT0) / sEcSharpT0)
muEyStarT0trunc <- mean(EyStarT0trunc) / 1000
N <- 2 * 10^6
mufarmSize <- mean(exp(dfMod3$`Farm size (acres)`))
N * mufarmSize * muEyStarT0trunc * EmploymentRate
Qlo <- 0.5^kappaRn * N * mufarmSize * muEyStarT0trunc * EmploymentRate
#----------------------------------------------------------------------
muY0 <- mean(y0)
muArea <- mean(exp(dfMod3$`Farm size (acres)`))
EPT0vec <- seq(0.01, 20, length.out = 40)
mP <- mP2006; sP <- sP2006; Nf <- 2.5*10^6
dfEQsT0 <- EQsFun(EPT0vec, muEcSharpT0, h, muY0, muArea, mP, sP, th, Nf)

gg <- ggplot(dfEQsT0, aes(x = EPT0, y = EQsT0))
gg <- gg + geom_line()

gg <- ggplot(dfEQsT0, aes(x = EPT0, y = etaP0EQsT0))
gg <- gg + geom_line()


  
  
    dfEQs <- data.frame(EPT0 = EPT0vec,
                     EQs, EQsUp, EQsLo,
                     etaAg, etaRisk,
                     probPgtC = pnorm(-z))
  colnames(dfQs) <- c("Expected price (KES/kg)", "Pct. of E[P(T)]",
                      "Expected supply, normal rainfall\n(million metric tons)",
                      "Expected supply, high rainfall\n(million metric tons)",
                      "Expected supply, low rainfall\n(million metric tons)",
                      "Price elasticity\nof supply",
                      "Price risk elasticity\nof supply",
                      "Participation (%)")
  return(dfQs)
}





# mod3$coefficients
# muA <- exp(0.78*mean(dfMod3$`Farm size (acres)`) + 0.78^2 * sd(dfMod3$`Farm size (acres)`)^2 / 2)

# Compare mod3 with cost per unit output model
# dfMod4 <- df_mod[, c(mod3Vars)]
# dfMod4$`Cost/output` <- dfMod4$`Cost/acre` - dfMod4$`Yield (kg/acre)`
# dfMod4$`Cost/acre` <- NULL; dfMod4$`Rain anomaly` <- NULL
# mod4 <- lm(`Yield (kg/acre)`~., dfMod4[, -1])
# summ(mod4)
# #car::vif(mod3)
# # Clean: drop outliers with error outside of x stand devs
# plot(mod4$fitted.values, mod4$residuals)
# indRm <- which(abs(mod4$residuals) > 1.5)
# #View(dfMod3[indRm,]); length(indRm)
# dfMod4b <- dfMod4[-indRm, ]
# mod4b <- lm(`Yield (kg/acre)`~., dfMod4b[, -1])
# summ(mod4b)
#======================================================================

```

## Data and transformation

The farm data used in this pedagogical exercise come from a panel covering the main and short rains seasons for multiple crops across Kenya for the years 2000, 2004, 2007, and 2010, originally gathered by the Egerton University Tegemeo Institute of Agricultural Policy and Development in partnership with Michigan State University, under the auspices of a USAID project [@maizeData]. For the present exercise, only the 2007 main rains season maize farm data is used. Farms not reporting maize as their main crop or reporting zero maize production cost are excluded, resulting in a sample size of 942 maize farms across 20 counties. The sample represents all major maize growing regions in the country. Full details regarding the data and its processing for the present exercise, including summary statistics, are provided in Appendix 2.

Estimation of the yield model specified above requires data detailing maize yield, cost/acre, input prices, and continuous and binary control variables.

The retained data details farm level input types, quantities, and costs, such that input prices can be calculated at farm level by dividing costs by quantities. The inputs included in this exercise are synthetic fertilizers and pest and disease (P&D) control chemicals. The fertilizers are diammonium phosphate (DAP), calcium ammonium nitrate (CAN), and nitrogen-phosphorous-potassium (NPK). Different mixture ratios under NPK and CAN are aggregated. For example, "NPK (23:23:0)", "NPK (18:14:12)", and all other NPK mixtures are aggregated to "Total NPK". Similarly, fungicide, herbicide, insecticide, and pesticide use is aggregated under a single "P&D control chemicals" variable. The price of each aggregate input is then calculated as the aggregate cost divided by the aggregate quantity. Input and output prices vary considerably across the population (Figure ...).

Cost/acre is calculated as the sum of the costs of land preparation, synthetic fertilizers (CAN, NPK, and DAP), P&D control chemicals, non-land preparation wage labor (mostly harvesting and shelling), and seed, divided by farm size. [do i say something about some costs not being represented by a price in the model?]



exogenous constraints/endowments, a range of binary and continuously valued control variables is included. The continuously valued control variables are farm size (acres), adult equivalent household size, rainfall anomaly, planting density (seed kg/acre), and child family labor (person-hours/acre). Descriptive histograms of these variables are presented in Figure ..., together with total cost/acre and maize yield. Note that the maize yield density exhibits a lognormal shape, in accordance with axiom 3.

As explained in section..., all continuously valued independent variables are divided by their sample mean, such that the mean yield is equal to the constant ytilde in Equation.... A number of binary control variables are included such that ytilde varies across the population, not just the intercept. 

The binary control variables included in this exercise are land tenure (whether or not the head of household holds a title deed to the land they are farming), adoption of hybrid maize, and land preparation endowments (oxen, tractor, or none). There are 14 distinct combinations of these four endowments occurring in the sample, including the "base" case of zero binary endowments. The prevalence of these 14 endowment configurations is summarized in the right panel of Figure ....




Appendix 2:
DAP (NPK, CAN, UREA?) application in line with recommended level of 50kg/acre
farm size refers to maize fields only, excludes fields that are fallow or where other crops are grown
121 crops grown in the survey area, by far maize and beans, often intercropped together. Only farms reporting maize as their main crop are included for the present exercise. Only farms yd > 1kg/acre and cost > 0. [inappendix: yield from croplev07.dta, field07.dta, fert07.dta, labour07.dta, input07.dta (P&D control inputs) files, tampa_rain_96_07.dta (main07), climate.dta (qwetpre), main season only, Green maize production converted to dry maize equivalent by subtracting 15% of the production weight. Adopter if purchased or retained hybrid maize seed.]
The survey reports 28 different types of organic and synthetic fertilizer types in use, only a small subset of which is applied in significant quantities: CAN, NPK, DAP, UREA, and manure. For the present exercise, different mixture ratios within any one of these main fertilizer categories (e.g., NPK (23:23:0) and NPK (18:14:12)) are aggregated. Pest and disease control chemical use (pesticide, insecticide, herbicide, fungicide) is similarly aggregated up to a single "P&D control chemical" variable. Reported in different units, harmonized to kg. Input prices are then calculated as the aggregate cost divided by the aggregate quantities. Rain anomaly is actual rainfall divided by the qwetpre
the data are open access and available from Tegemeo Institute upon request, must be used in accordance with the provisions of the Tegemeo data policy.
adult equivalent household size 
tribal affiliation, gender of head of household, cell phone use, distance to market or nearest road, etc., but 
qwetpre is a climate model projection of rainfall during the rainiest three consecutive months of the year, i.e., the main rains season. It provides a benchmark based on which to measure how far actual rainfall diverges from expectation.


cost divided by area, natural logs taken.
The "prices" of aggregated input categories are calculated by dividing the value of the aggregate (calculated as qty x price) by the aggregate quantity.

Cost/acre Cstar is defined df$`Total synth fert (KES/acre)` + 
  df$`seed (KES/acre)` +
  df$lpcost +
  #df$`Non-land prep wage labor (KES/acre)` +
  df$`Total P&D chem (KES/acre)`

df$`Rain anomaly` <- df$main07 / df$qwetpre

Graphics:
main ferttypes used, fert kg/acre in line with recommendations, urea, manure
likewise pesticide/herbicide/fungicide
Farm size
Input and output prices vary considerably across districts.
Wage differs considerably by activity and district
Labor type breakdown who labors where
binary endowment barchart

Characterization of the data -- predominant ferttypes, price variation across districts, binary endowments
Descriptive graphics [yield/qty histogram, dist level chem input prices and wage, family labor, rain anomaly, cost per acre] are presented in figure .... More detailed summary statistics breakdown in appendix.
seed kg/acre not an input but a control variable representing planting density, which is a management decision/constraint
field level aggregated up to farm level
after estimation -- lambda rational farms
constant $\tilde{y}$ is not the same for all farms, but varies depending upon how many binary endowments the farm has
alternative model estimation included in appendix + some validation exercises -- tech share = cost share, implicit family wage
Maize growing farms in 20 sub-counties (known as "districts" at the time of the survey) covering the main agricultural zones. [hired labor wage is given in KES/day, this is converted to a nominal hourly wage by dividing by 8.]
Covers 18 labor activities, 16 excluding security and irrigation. wage varies considerably by activity and district. Main activities are 1st weeding, harvesting, planting, 1st ploughing, 2nd weeding, shelling, stooking


```{r Figx1, fig.show = "hold", fig.width=5, fig.height=3, fig.align="center", fig.cap="\\label{fig:descriptHist1}Histograms of the dependent and continuous independent variables in the model, except for prices. Note that most farms do not employ child family labor. Zero values are excluded in the child family labor histogram to clarify the distribution of non-zero values.", echo = FALSE}

ggIndepVars + ggYd + plot_layout(widths = c(2, 1))

# ggsave(, "....tiff", width = 5, height = 3, dpi = 300)

```


<!-- # ```{r Figx3, fig.show = "hold", fig.width=5, fig.height=3, fig.align="center", fig.cap="\\label{fig:descriptHist2}Input prices (farm level) and maize price (county level).", echo = FALSE} -->
<!-- ggInputPrices + ggMaizePrice + plot_layout(widths = c(2, 1)) -->
<!-- # ggsave(, "pricesBarChart.tiff", width = 5, height = 3, dpi = 300) -->

<!-- ``` -->


\ref{fig:descriptHist1}

\ref{fig:descriptHist2}

## Parameter estimation

Tried including farmer age, education, gender, maximum and minimum temperature, other types of family labor, and distance to market variables were also explored. But the coefficients on these variables were either statistically insignificant or introduced multicollinearity and/or missing data issues.

The binary endowments in the model are land tenure (whether or not the head of household holds a title deed to their land), hybrid maize seed, oxen, and tractor. These variables take a value of $e$ if the endowment is present and $1$ otherwise, such that the coefficients $\beta_i$ are added to the intercept term $\beta_0$ on farms that have the endowment, and vanish otherwise.

The OLS estimation results are presented in Table 1. Excellent fit, low standard errors, reasonable R2, homoskedastic. A multicollinearity test revealed low vif score and hence linearly independent logged regressors.

Because the model is estimated in logs, the coefficients on the continuous variables may be interpreted as the control variable elasticities ($\kappa_i$). Note that the coefficient on acres is negative, affirming the inverse relation between farm size and yield found in numerous other studies [@muyanga2019revisiting; @larson2014should; @wassie2019revisiting; @gautam2019too; @kimhi2006plot]. The coefficient on child family labor during planting is also negative, confirming that this variable is better thought of as a hard constraint rather than a discretionary management variable.


This is where we talk about the continuous and binary variables used in the model and how other specifications are certainly feasible... lots of management variables available, but not required because of Equation \ref{eq:yStarC}. Models including farmer age, education, gender, maximum and minimum temperature, other types of family labor, and distance to market variables were also explored. But the coefficients on these variables were either statistically insignificant or introduced multicollinearity and/or missing data issues. A model based on Equation \ref{eq:cobbDoug3} was also estimated (provided in the Appendix) to compare h via mod2 against h as sum of estimated output elasticities of inputs. As discussed in sec..., the mod1 h varies across farms...the mod 2 h is very close to the mean h of mod1.

As discussed in section \ref{sec:ax12}, the independent continuous variables $k_i$ and $C^*$ are divided by their respective sample means $\tilde{k}_i$ and $\tilde{C}^*$ in order to facilitate interpretation of the constant $\tilde{y}$. (In the case of rainfall, $\tilde{k}_i$ is the historical average, not the sample average). The constant $\tilde{y}$ may then be interpreted as the farm yield evaluated at the sample mean of the continuous independent variables (at the historical mean in the case of rainfall). Insofar as the continuous independent variables are uncorrelated, moreover, then $E[\hat{y}^*] = \tilde{y} e^{s_{\epsilon}^2 / 2}$, where $s_{\epsilon}^2$ is the variance of the error $\epsilon$.

But $E[\hat{y}^*]$ is the sample mean. 


There are x distinct output prices reported in the data, ranging from x to x with a mean of x... mp and sp from FPMA.


In the Appendix it is shown that the model in Equation \ref{eq:cobbDoug3} is also estimated...see Appendix. The value of $x_i / \tilde{x}_i$ is set to $1$ on farms where the input is not applied, such that the term vanishes from the equation... The output elasticities of input $\alpha_i$ are summed... add up to $h$.
<!-- appendix graphics: input use, family labor, sumstats table -->

By Equation \ref{eq:yStarC}, the coefficient of `r round(hCoef, 3)` on logged cost/acre can be interpreted as the yield degree of homogeneity $h$. By Equation \ref{eq:PelastYstar}, the farm level price elasticity of supply then follows as `r round(etaCoef, 3)`.

Since the $k_i$ are linearly independent, then the sample average yield equals $E[\hat{y}^*]$
The mean yield 

Equation \ref{eq:regMod} represents the real yield $y^*(T)$, known post harvest. Assuming that farmers expect rainfall to adhere to the historical average, then the expected yield at planting time ($E[y^*(T)]\bigr|_{t = 0}$) may reckoned from the available post hoc information as follows.


\begin{equation}
E[y^*(T)]\bigr|_{t = 0} = y^*(T) \frac{\tilde{k}_r}{k_r}^{\kappa_r} e^{\frac{s_{\epsilon}^2}{2}}
\end{equation}

Where $s_{\epsilon}^2$ is the variance of the error term $\epsilon$.

...lambda > h for most as expected, with truncated mean slightly less than 1...

[additional tacit axioms---linear independence ]

```{r Fig4, fig.show = "hold", fig.width=5, fig.height=3, fig.align="center", fig.cap="\\label{fig:ySampAvg}Yield evaluated at the sample means of the control variables, and with rainfall anomaly set to 1 (no divergence from historical rainfall), for farms with different binary endowments.", echo = FALSE}

ggEndow1 + ggEndow2 + plot_layout(ncol = 2, widths = c(1/2, 1))

# ggsave(, "endowmentsBarChart.tiff", width = 5, height = 3, dpi = 300)

```

Figure \ref{fig:ySampAvg}

## Results

...have to get the population mean/sd from the truncated mean/sd...

Assuming that the fitted coefficients do not vary much within a few years of when they are estimated...

Expected yield is actual yield divided by the rainfall anomaly...[assume farms expect rainfall consistent with the historical trend. The same would go for other weather variables like temperature and solar radiation, if they were included in the model and were statistically significant.] AND using EXPECTED PRICE at planting time, not the post harvest sale price.

...mP and sP -- time period over which it is taken.


This is an ex-ante curve in the sense that each point on the curve is an ex-ante projection based on the expected price information available at or before planting time.

The projection overestimates the eventual  is far off because of the 2008-2009 drought.

<!-- https://www.fao.org/giews/reports/sub-saharan-africa-cereal-report/en/ -->

```{r Fig5, fig.show = "hold", fig.width = 5, fig.height=3, fig.align="center", fig.cap="\\label{fig:Qs2009}The ex-ante Kenya 2009 aggregate maize supply curve, parameterized based on the 2007 Kenya farm data. The shaded area around the curve...", echo = FALSE}



thetaK <- 
EyStar0UpBnd <- e


kNames <- c("Farm size (acres)", "seed (kg/acre)",
            "Adult equivalent household size", "Rain anomaly")
kVec <- mod3Coefs[which(coefsNames %in% kNames)]
lkMat <- as.matrix(df_mod2[, kNames])
betaK <- exp(lkMat %*% kVec)
kappaRn <- mod2Coefs[which(coefsNames == "Rain anomaly")]
lkRn <- as.matrix(df_mod2[, "Rain anomaly"])
betaRn <- exp(lkRn * kappaRn)

#---





kNames <- c("acres", "seed (kg/acre)",
            "planting fam lab child (pers-hrs/acre)",
            demog_vars)
kVec <- mod2Coefs[which(coefsNames %in% kNames)]
lkMat <- as.matrix(df_mod2[, kNames])
betaK <- exp(lkMat %*% kVec)
kappaRn <- mod2Coefs[which(coefsNames == "Rain anomaly")]
lkRn <- as.matrix(df_mod2[, "Rain anomaly"])
betaRn <- exp(lkRn * kappaRn)
kRn <- exp(lkRn)
eps <- mod2$residuals
sErr <- sd(eps)
#----------------------------------------------------------------------
const <- y0 * betaK / muCstarSamp^hCoef * hCoef^hCoef * exp(sErr^2 / 2)
#----------------------------------------------------------------------
EyStar1 <- const * kRn^kappaRn * (cStar / hCoef)^hCoef
EyStar0 <- exp(mod2$fitted.values - kappaRn * lkRn + sErr^2 / 2)
#EyStar1 - EyStar0
EcSharp <- cStar / EyStar0
#---
lam <- EPT02007 / EcSharp * hCoef
#lam <- exp(-mP2006) * df_mod2$P / EcSharp * hCoef
# EyStarUp2 <- y0 * betaKnormdAdj * kRn^kappaRn * ERstar^hCoef * exp(sErr^2 / 2)
# EyStarUp - EyStarUp2
#----------------------------------------------------------------------
# How many rational farms?
nRational <- sum(lam > hCoef) / length(lam)
# sum(EcSharp < df_mod2$P) / length(EcSharp)
# sum(EcSharp < EPT02007) / length(EcSharp)
# sum(EyStar < EyStarUp) / length(EyStar)
#----------------------------------------------------------------------
mEcSharpTrunc <- mean(log(EcSharp))
sEcSharpTrunc <- sd(log(EcSharp))
muEcSharpTrunc <- exp(mEcSharpTrunc + sEcSharpTrunc^2 / 2)
xIn <- c(sEcSharpTrunc, mEcSharpTrunc)
sol <- nleqslv::nleqslv(xIn, rootFnUp, jac = NULL,
                        xUp = EPT02007,
                        sXtrunc = sEcSharpTrunc,
                        mXtrunc = mEcSharpTrunc)
#sol
sEcSharp <- sol$x[1]
mEcSharp <- sol$x[2]
muEcSharpT0 <- exp(mEcSharp + sEcSharp^2 / 2)
#----------------------------------------------------------------------
mLamTrunc <- mean(log(lam))
sLamTrunc <- sd(log(lam))
muLamTrunc <- exp(mLamTrunc + sLamTrunc^2 / 2)
xIn <- c(sLamTrunc, sLamTrunc)
sol <- nleqslv::nleqslv(xIn, rootFnLo, jac = NULL,
                        xLo = hCoef,
                        sXtrunc = sLamTrunc,
                        mXtrunc = mLamTrunc)
#sol
sLam <- sol$x[1]
mLam <- sol$x[2]
muLam <- exp(mLam + sLam^2 / 2)
muLamEtaInv <- exp(-etaCoef * mLam + etaCoef^2 * sLam^2 / 2)
# #muLamTrunc
# exp(mLamTrunc - sLamTrunc^2)
# exp(mLam - sLam^2)
#---
# x <- seq(0, 3, length = 200)
# y <- dlnorm(x, meanlog = mLam, sdlog = sLam)
# gg <- ggplot(data.frame(x = x, y = y), aes(x = x, y = y))
# gg <- gg + geom_line()
# gg <- gg + geom_vline(xintercept = hCoef)
#---------------------------------------------------------------------
# mean(const)^(etaCoef / hCoef) * mean(kRn^kappaRn)^(etaCoef / hCoef)
# mean(kRn^kappaRn)^(etaCoef / hCoef) - (mean(kRn)^kappaRn)^(etaCoef / hCoef)
# mean(kRn^kappaRn)^(etaCoef / hCoef) - mean(kRn^(kappaRn * etaCoef / hCoef))
# #muConst <- mean((const * kRn^kappaRn)^(etaCoef / hCoef))
muConst <- mean((const)^(etaCoef / hCoef)) # * mean(kRn)^(kappaRn * etaCoef / hCoef)
muEcSharpT0eta <- exp(etaCoef * mEcSharp + etaCoef^2 * sEcSharp^2 / 2)
muEyStarT0 <- muConst * muEcSharpT0eta * hCoef^-etaCoef
muEyStarT0trunc <- mean(EyStar0 * kRn^-kappaRn)

```

`r nRational`


```{r Fig5, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:Qs} uyiijl", echo = FALSE}

# Define supply curve/price elasticity of supply/price risk elasticity of supply function
QsFun <- function(muEyStarT0, EPT0ref, fracVec, h, kappaRn, muArea,
                  muEcSharpT0, mP, sP, th, Nf, kRn = 1){
  eta <- h / (1 - h)
  muKrnKapEtaH_up <- mean((kRn * 2)^(kappaRn * eta / h))
  muKrnKapEtaH_lo <- mean((kRn * 1 / 2)^(kappaRn * eta / h))
  
  EPT0vec <- fracVec * EPT0ref
  muEyStarT0vec <- muEyStarT0 * fracVec^eta
  muEyStarT0upVec <- muEyStarT0vec * muKrnKapEtaH_up
  muEyStarT0loVec <- muEyStarT0vec * muKrnKapEtaH_lo
  muEqStarT0vec <- muArea * muEyStarT0vec
  muEqStarT0upVec <- muArea * muEyStarT0upVec
  muEqStarT0loVec <- muArea * muEyStarT0loVec
  P0vec <- EPT0vec * exp(-mP * th)
  z <- (eta * log(muEcSharpT0 / P0vec) - (eta * mP - eta^2 * sP^2 / 2) * th) / (eta * sP * sqrt(th))
  EQs <- Nf * muEqStarT0vec * (1 - pnorm(z)) #in kg
  EQsUp <- Nf * muEqStarT0upVec * (1 - pnorm(z)) #in kg
  EQsLo <- Nf * muEqStarT0loVec * (1 - pnorm(z)) #in kg
  EQs <- EQs * 10^-9 #in million MT
  EQsUp <- EQsUp * 10^-9 #in million MT
  EQsLo <- EQsLo * 10^-9
  #------------
  etaAg <- eta + dnorm(-z) / pnorm(-z) * 1 / (sP * sqrt(th))
  #------------
  etaRisk <- -dnorm(-z) / pnorm(-z) * (eta * sP * sqrt(th) - z)
  #------------
  dfQs <- data.frame(EPT0 = EPT0vec, 100 * fracVec,
                     EQs, EQsUp, EQsLo,
                     etaAg, etaRisk,
                     probPgtC = pnorm(-z))
  colnames(dfQs) <- c("Expected price (KES/kg)", "Pct. of E[P(T)]",
                      "Expected supply, normal rainfall\n(million metric tons)",
                      "Expected supply, high rainfall\n(million metric tons)",
                      "Expected supply, low rainfall\n(million metric tons)",
                      "Price elasticity\nof supply",
                      "Price risk elasticity\nof supply",
                      "Participation (%)")
  return(dfQs)
}
#=====================================================================
# Get FAO Kenya maize data for validation of Qs
thisFolder
thisFile <- "FAO Kenya maize.csv"
thisFilepath <- paste0(thisFolder, thisFile)
dfFAO <- read.csv(thisFilepath, stringsAsFactors = F)
keepCols <- c("Area", "Element", "Item", "Year", "Unit", "Value")
dfFAO <- dfFAO[, keepCols]
areaFAO2007 <- dfFAO$Value[which(dfFAO$Year == 2007 & dfFAO$Element == "Area harvested")]
prodFAO2007 <- dfFAO$Value[which(dfFAO$Year == 2007 & dfFAO$Element == "Production")]
areaFAO2009 <- dfFAO$Value[which(dfFAO$Year == 2009 & dfFAO$Element == "Area harvested")]
prodFAO2009 <- dfFAO$Value[which(dfFAO$Year == 2009 & dfFAO$Element == "Production")]
# areaFAO2006 <- 1888195
# areaFAO2007 <- 1615304
# areaFAO2008 <- 1700000
# prodFAO2006 <- 3247200
# prodFAO2007 <- 2928793
# prodFAO2008 <- 2367237
#----------------------------------------------------------------------
# lA <- quantile(df_mod2$acres, 0.01 * c(1:100))
# prob <- 0.01 * as.numeric(gsub("%", "", names(lA)))
# dfArea <- data.frame(lA, prob)
# #ggplot(dfArea, aes(x = lA, prob)) + geom_line()
# modArea <- glm(prob ~ lA, dfArea, family = "binomial")
# #summary(modArea)
# b0 <- modArea$coefficients[1]
# bA <- modArea$coefficients[2]
# probHat <- 1 / (1 + exp(-b0 - bA * lA))
# err <- probHat - prob
# #plot(probHat, err)
# dfArea$probHat <- probHat
# dfArea$probHat2 <- pnorm(lA, mean(lAcres), sd(lAcres))
# dfArea <- dfArea %>% gather(var, val, prob:probHat2)
# ggplot(dfArea, aes(x = lA, y = val, group = var, color = var)) + geom_line()
#----------------------------------------------------------------------
# mRnAnom <- mean(log(kRn))
# sRnAnom <- sd(log(kRn))
# muRnAnom <- exp(mRnAnom + sRnAnom^2 / 2)
# sigRnAnom <- muRnAnom * sqrt(exp(sRnAnom^2) - 1)
# mBetaRn <- 0 #mean(log(betaRn))
# sBetaRn <- sd(log(betaRn))
# muBetaRnEtaH <- exp(etaCoef / hCoef * mBetaRn + (etaCoef / hCoef)^2 * sBetaRn^2 / 2)
#----------------------------------------------------------------------
# # Ex-post calibration number of farms Nf
# dfQs2007 <- QsFun(muEyStarT0,
#                   EPT0 = EPT02007, fracVec = 1,
#                   h = hCoef, kappaRn, muArea,
#                   muEcSharpT0 = muEcSharpT0,
#                   mP = mP2006, sP = sP2006, th, Nf = 1)
# Qs2007 <- dfQs2007$`Expected supply, normal rainfall\n(million metric tons)`
# Nf <- prodFAO2007 * mean(kRn^(-kappaRn * etaCoef / hCoef)) * 10^-6 / Qs2007
# #Nf <- 1.7 * 10^6
#----------------------------------------------------------------------
# 2007 aggregate supply curve
fracVec <- seq(0.01, 2, length.out = 50)
#dfQs <- QsFun(muEyStarT0 = muEyStarT0 * (EPT02009 / EPT02007)^hCoef,
Nf = 1.7 * 10^6
dfQs <- QsFun(muEyStarT0 = muEyStarT0,
              EPT0ref = EPT02007, fracVec,
              h = hCoef, kappaRn, muArea,
              muEcSharpT0 = muEcSharpT0,
              mP = mP2006, sP = sP2006,
              th, Nf)
#---------------------------------------------------------------------
gg <- ggplot(dfQs)
gg <- gg + geom_ribbon(aes(x = `Expected price (KES/kg)`,
                           ymin = `Expected supply, low rainfall\n(million metric tons)`,
                           ymax = `Expected supply, high rainfall\n(million metric tons)`),
                       fill='blue',alpha=0.2)
df_line <- dfQs[, c("Expected price (KES/kg)", "Expected supply, low rainfall\n(million metric tons)", "Expected supply, high rainfall\n(million metric tons)",
                    "Expected supply, normal rainfall\n(million metric tons)")]
colnames(df_line)[2:4] <- c("Low rainfall", "High rainfall", "Normal rainfall")
df_line <- df_line %>% gather(var, `Expected supply\n(million metric tons)`, `Low rainfall`:`Normal rainfall`)
gg <- gg + geom_line(data = df_line, aes(x = `Expected price (KES/kg)`, y = `Expected supply\n(million metric tons)`, group = var, color = var))
gg <- gg + scale_color_manual(values = c("green", "red", "black"))
gg <- gg + geom_vline(xintercept = EPT02007)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title.x = element_text(size = axisTextSize),
                 legend.title = element_blank(),
                 legend.text = element_text(size = legendTextSize),
                 legend.position = "top")
ggQs <- gg
#---
gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
gg <- gg + geom_line()
gg <- gg + theme_bw()
ggElast <- gg
df_inset <- subset(dfQs, `Expected price (KES/kg)` > 7 & `Expected price (KES/kg)` < 11)
gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price elasticity\nof supply`))
gg <- gg + geom_line()
gg <- gg + geom_hline(yintercept = 1, linetype = "dashed", color = "red")
gg <- gg + geom_vline(xintercept = EPT02007)
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank())
ggElastInset <- gg
ggPelastQs <- ggElast + annotation_custom(ggplotGrob(ggElastInset),
                                          xmin = 6, xmax = 20, 
                                          ymin = 20, ymax = 70)
#----------
gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Participation (%)`))
gg <- gg + geom_line()
# gg <- gg + labs(y = expression(paste("Prob(", P(T)^eta, "> E[", C^[0](T), "]", ")")))
gg <- gg + theme_bw()
gg <- gg + theme(axis.title.x = element_blank())
ggProb <- gg
#----------
ggQs + ggProb + ggPelastQs + plot_layout(ncol = 1, heights = c(1, 1/4, 1))
#----------------------------------------------------------------------
# Expected aggregate supply maps
fracVec <- seq(0.75, 1.2, length.out = 50)
n <- length(fracVec)
kRnVec <- seq(1 / 5, 3, length.out = n)
list_df <- list()
for(i in 1:n){
  thisKrn <- kRnVec[i]
  dfQs <- QsFun(muEyStarT0, EPT0ref = EPT02007,
                fracVec, h = hCoef, kappaRn, muArea,
                muEcSharpT0, mP = mP2006, sP = sP2006,
                th, Nf, kRn = thisKrn)
  dfQs$`Rainfall anomaly` <- thisKrn
  list_df[[i]] <- dfQs
}

dfMap <- as.data.frame(do.call(rbind, list_df))
colnames(dfMap)[3] <- "Expected supply\n(million metric tons)"
gg <- ggplot(dfMap, aes(x = `Expected price (KES/kg)`,
                        y = `Rainfall anomaly`, fill = `Participation (%)`))
gg <- gg + geom_tile()
gg


```

`r round(Qs2007, 2)`

`r round(pctDif2007, 1)` percent divergence from FAO

`r round(eta2007, 3)`


...pretty close to FAO (put in % divergence terms), divergence maybe rooted in variation of output price, also because we don't really know EyStarT0 and EPT0, also because this is expected supply at planting, not actual supply at harvest...also does not account for short rains growing season (October-December) (but short rains harvest is small % of total, in 2021 it was about 250,000MT)

[@abodi2021supply; @mckay1999aggregate; @muchapondwa2009supply]

...price risk elasticity of supply...

```{r Fig6, fig.show = "hold", fig.width = 4, fig.height=3, fig.align="center", fig.cap="\\label{fig:PriskElastQs} uyiijl", echo = FALSE}

gg <- ggplot(dfQs, aes(x = `Expected price (KES/kg)`, y = `Price risk elasticity\nof supply`))
gg <- gg + geom_line()
gg <- gg + theme_bw()
ggElast <- gg
df_inset <- subset(dfQs, `Expected price (KES/kg)` > 9 & `Expected price (KES/kg)` < 25)
gg <- ggplot(df_inset, aes(x = `Expected price (KES/kg)`, y = `Price risk elasticity\nof supply`))
gg <- gg + geom_line()
gg <- gg + geom_hline(yintercept = 0, linetype = "dashed", color = "red")
gg <- gg + theme_bw()
gg <- gg + theme(axis.title = element_blank())
ggElastInset <- gg
ggPriskElastQs <- ggElast + annotation_custom(ggplotGrob(ggElastInset),
                                              xmin = 6, xmax = 35, 
                                              ymin = 9, ymax = 35)

ggPriskElastQs

```

```{r Fig7, fig.show = "hold", fig.width = 5, fig.height=5, fig.align="center", fig.cap="\\label{fig:PriskElastQs} uyiijl", echo = FALSE}

#dfEPT0 <- subset(dfEPT0, Year > 2008)
dfQs <- QsFun(dfEPT0$EPT0,
              muArea, g0, h = hCoef, muBetaKetaH, muEtaLamInv,
              muEcSharpT0,
              mP = dfEPT0$mP,
              sP = dfEPT0$sP,
              th, Nf)
#dfQs$`Supply\n(million metric tons)`
dfFAOlook <- subset(dfFAO, Year %in% c(2007:2022) & Element == "Production")
dif <- dfQs$`Supply\n(million metric tons)` - dfFAOlook$Value * 10^-6
pctDif <- 100 * dif / (dfFAOlook$Value * 10^-6)
dfEPT0$`FAO Anomaly` <- pctDif
df_plot <-  dfEPT0[, c("Year", "Anomaly", "FAO Anomaly")] %>% gather(var, val, Anomaly:`FAO Anomaly`)
gg <- ggplot(df_plot, aes(x = Year, y = val,
                          group = var, color = var))
gg <- gg + geom_line()
gg
```


# Discussion

The exercise represents an ideal case where lots of data is available. Most use cases will not be like this.... 
It is worth noting moreover that even if the conventional method had all this data at its disposal, would not improve the accuracy of the supply curve. That method has no way of integrating the data as it is ultimately a mathematization of guesswork and agronomic assertions.
Model Equation \ref{eq:yStarC} can be tailored to data availability. Any variables $k_i$ or $w_i$ not explicitly specified are implicitly absorbed into $\tilde{y}$, such that the model may be tailored to available data.

PE analysis, derivation of an aggregate demand curve would be analogous.
 the proposed model can be adapted to the data constraints, taking full advantage of the data when it is available, and adapting to the minimum data when it is not... in the minimum data case can revert to parsimonious estimate...
  ...in the case of expedient models by contrast having the data above wouldn't even be of any help when using the expedient model... no clear way of integrating it into the analysis...

very nearly a case in point of what Paul Romer calls "mathiness".

>"Like mathematical theory, mathiness uses a mixture of words and symbols, but instead of making tight links, it leaves ample room for slippage between statements in natural versus formal languages and between statements with theoretical as opposed to empirical content". [-@romer2015mathiness]

Or of what Von Neumann and Morgenstern had in mind when they observed that

>"part of the feeling of dissatisfaction with the mathematical treatment of economic theory derives largely from the fact that frequently one is offered not proofs but mere assertions which are really no better than the same assertions given in literary form" [-@morgenstern1953theory].

<!-- The authors go on to suggest there is a "scientifically unsound" inclination among economists to confuse these formalized literary assertions, including "very valuable surmises and inspiring anticipations of results", with actual proofs or otherwise rigorously derived theoretical results [@morgenstern1953theory]. -->


Specification of the aggregate supply curve may be considered a case in point. The model is not theoretically derived, but rather a collection of educated guesses or surmises translated into mathematical equations. Many of these surmises imply well documented contradictions of basic economic theory, and/or inconvenient ramifications vis-a-vis the supposed benefits of research and technology adoption []. The model has evolved into its present form not by force of logic, but as a matter of preference. For example, there was considerable debate in the 1970s over whether the research-induced supply curve shift should be modeled as a parallel shift or a pivot [@alston1995science; @norton1981evaluating; @lindner1978supply]. The debate was further complicated by differing views as to whether supply should be modeled as a linear or a curved function. Modeling results depend critically upon these choices. A curved specification   Without a theoretical framework to link parameter values and functional forms to real world conditions, the debate was ultimately inconclusive. The answers to the questions left unresolved by the debate have come down to us today as a matter of preference. In their highly influential book, _Science Under Scarcity_, Alston et al. indicated their preference for the linear parallel shift [-@alston1995science]. This is a conspicuous choice, to put it mildly, considering that 1) it prefigures research impacts in the best possible light, and 2) by the authors' own admission, there are no theoretical or empirical grounds to justify this preference [@alston1995science; @alston2009economics]. AR4D partial equilibrium impact studies since then have generally follow suit....the supply curve shift "k" + arbitrarily assumed adoption rate and "probability of success" (which are elicited from scientists with a conflict of interest) = results by modeler fiat, PETITIO PRINCIPII

<!-- ...The current sense is that this is somehow impossible. The verdict: -->



<!-- Expedient functional forms also tend to introduce awkward model artifacts---such as the possibility of negative supply quantities and/or of farms producing for free, in the case of linear supply functions---which effectively reduce the form to a local approximation of some inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point. The  -->
<!-- The representation of exogenous shocks in terms of such abstract parameters is thus largely a matter of modeler fiat. Insofar as the modeling results hinge upon this parameterization, they too are prefigured by modeler fiat. The impact "assessment" is thus more accurately an impact _assertion_ dressed up in mathematical language, i.e. in this measure, reduced to an exercise in petitio principii. -->
<!-- <!-- -contradict theory [have to be constant returns to scale but also upward sloping demand curves...] -->

<!-- ...haven't even gotten to adoption yet... -->
<!-- This, in turn, complicates the defense of modeling results. Without any theoretical framework by which to map the real world to model parameters, the parameterization of exogenous shocks effectively defaults to modeler fiat.  That is, the "assessment" is reduced to an _assertion_ dressed up in mathematical symbols. The     cannot be decomposed into specific components---a technology effect versus a price effect--- -->
<!-- ...distinguish between impact, model artifact, modeler fiat. -->
<!-- , and cannot be decomposed into technology and price components.  -->

<!-- When there is a [...Wd be nice to consider a range of scenarios covering a range of potential input price increases versus technology shocks, but this not possible ... not clear why adoption rate takes a certain value... or how the shock affects the entry and exit of farms... nor how the shock affects the aggregate...  nor which centiles adopt...] The representation of exogenous shocks to real world parameters in terms of model parameters thus largely boils down to a matter of modeler fiat. Insofar as modeling results hinge upon the parameterization of shocks, the conclusions of the impact assessment are, in this measure, also by fiat; and the whole process is thereby reduced to an exercise in petitio principii. This obviously complicates subsequent defense of the modeling results, especially if the modelers and/or their source of funding have a vested interest in the results. -->

<!-- [The response to the growing impatience is the cosmetic approach---MIRR] -->
<!-- <!-- The constant elasticity of supply curve, for example, -->
<!-- <!-- \begin{equation} -->
<!-- <!-- Q = a P^{\eta} -->
<!-- <!-- \end{equation} -->
<!-- <!-- conflates yield and employment response to price changes in one parameter, $\eta$. -->

<!-- Expedient specifications also tend to introduce awkward model artifacts. The parameter $\eta$, for example, implies that yield and employment responses offset each other such that $\eta$ is always constant. The linear aggregate supply curve, on the other hand, implies the possibility of negative supply quantities and/or of farms producing for free. This either requires redefinition of the curve as a piecewise function---which further complicates interpretation in terms of Equation \ref{eq:sup1}---or compels us to regard the function as a local approximation to an inscrutable global function, with validity restricted to a small domain of convergence around the starting equilibrium point. -->

<!-- Finally, the parameterization of such forms tends to be highly abstract, with no clear mapping to the relevant measurable, real world phenomena---i.e. technology, input prices, agroclimatic conditions, demographic variables, and so on. This leaves very little basis upon which to assess the plausibility of a given parameterization of exogenous shocks. How should a 10% increase in total factor productivity be represented in terms of a change in, say, $a$ and $\eta$? The answer effectively boils down to modeler fiat, which in turn invites misuse and abuse of the model, and otherwise complicates the defense of any modeling results. -->

<!-- [preclude constant returns to scale, directly contradicting the conventional wisdom handed down by Hicks [-@hicks1963theory] and Solow [-@solow1957technical]. ...also constant marginal cost...This agrees with empirical evidence [@lavoie2014post]. It also contradicts the theory of the firm presented in most microeconomic textbooks, which assumes (with no evidentiary basis) increasing marginal cost as output rises.] -->
<!-- Note, in passing, that the notion of an upper bound on economic yields agrees with empirical observation [@herdt1988increasing; @pingali2001cereal]. In Pingali and Heisey's words: -->
<!-- >\singlespacing "The best yields obtained on experiment stations are often used as the indicator of technology potential. Experiment stations are often located on the best lands within a region and have reliable irrigation water supplies. Agronomic yield potential determined on experiment stations, with no physical, biological, or economic constraints, is the maximum achievable yield.... When the objective of the experiment is changed from maximizing yields to maximizing profits, the yields obtained by experiment station researchers drop significantly..." [-@pingali2001cereal]. -->
<!-- \doublespacing -->

[In discussion: alternative form using lambda with lower bound h, working with remote sensing/spatial data vs survey data, key strength is versatility in the research questions that may be addressed either in concert or in isolation...may examine multi-lever, multi-faceted policy involving price stabilization, technology...The curve is empirically transparent, i.e. its parameters have a straightforward interpretation in terms of concrete, measurable phenomena, such that exogenous shocks may be modeled precisely and transparently. The research induced supply curve shift is complex. ...adoption...  derivative of aggregate supply with respect to price volatility, multiple levers at the policy maker's disposal.explicitly accounts for price risk and agroclimatic uncertainty, allowing explicit analysis of the role of futures markets and marketing board policy, in enhancing technological impact....the trade board debate... ...comparative analysis of multiple impact pathways to achieve the same result (ETH bean example)]

This not really a validation of the model...markets at the time were in disarray dysfunctional...SAP liberalization... [@Jayne wicked problem].

Address more nuanced questions like what is the right balance of policy and technology mix required to reach certain development goals...how can the impact of new technology release be enhanced through policy

More than validation this is to illustrate the potential usefulness of the model in examining new technologies, policies (subsidies, storage, transportation, microfinance, insurance), etc....comparison of different impact pathways. Current methods focus on yield enhancing varieties...maybe the same development goals can be reached at lower cost and in a shorter time frame through policy instruments...

In minimum data contexts... have to assume (inverse) relation between yield and area

short cropping season is omitted from aggregate supply, but this generally accounts for less than 5% of total production in any given year

The participation term, does it mean employment? ...

Of course, supply can also be defined in terms of an integral of farm yield over its density.

\begin{equation}
Q_S = \int_{0}^{\bar{y}^*} y^* \rho(y^*) \: dq^*
\end{equation}

Where the yield density is defined such that

\begin{equation}
\rho(y^*) = \int_{0}^{\infty} \rho(y^*) \: dy^* = N_a
\end{equation}

Where $N_a$ is the number of acres (or whatever the unit of area is) in the population.

The latter expression may be more suitable when dealing with remote sensing data. The former is more suitable when dealing with farm survey data, as here.

...it may be worthwhile to integrate using the cost form of yield...

...here focused on the motivating context, but the method is applicable in CGE models etc. anywhere a model of aggregate supply is required...



...this form allows one to look at questions of the value of storage...forward contracts...for e.g. as policy instruments implemented in tandem with new technology...questions of how to optimize the enabling environment to maximize impact of new technology...

...treatment of aggregate demand...
...upper bound on $x_j^*$,

\begin{equation}
x_j^* < \frac{\alpha_j}{w_j} \left(y_0 \frac{P}{h} \right)
\label{eq:inputUpBound}
\end{equation}


...negatively sloped cross price demand curves implies that all inputs are complements, not substitutes...makes sense, can't substitute CAN for dap or labor or pesticide

...Axioms can be formalized differently...intensive versus extensive diminishing marginal returns... or a risk constraint can be introduced in addition to the budget constraint in Axiom 2.  More than a specific functional form, an axiomatic approach... rules are made to be refined and ammended... the aim is to come up with a set of Axioms that generate a game that is worth the candle... Axioms should be formulated so as to minimize Axioms and maximize corollaries, i.e. maximize the number of Axioms that are explained by the original Axioms  and must not contradict each other.

In defense of CobbDoug
[Mention the good empirical fit and validation tests (input demand, optimal area, etc.) as arguments in favor of C-D]

Translog is so "flexible" that it ends up being restrictive from an economic standpoint---not homogeneous, monotonicity and concavity, global concavity requires negative semidefinite matrix of parameters, enforcement of which "destroys the flexibility of the form" and restricts the price elasticities in undesired way (from "Estimating a Derived Demand System from a Translog Cost Function"). Jorgenson etc. have to then devise ways to make it less flexible, in order to impose constant returns to scale, for eg.  Translog also violates axiom 1

However, it does not directly address---not in an obvious way---the most enduring objections to the form: its perceived conflict with evidence and intuitions regarding 1) input substitution, 2) production elasticities, and 3) factor demand elasticities. A complete response to these objections is beyond the scope of the work at hand. Nonetheless, a minimal response is sketched out below in the hopes of retaining the attention of the many vigorous critics of Cobb-Douglas who might otherwise read no further.

Enduring objection 1 is that the Cobb-Douglas function implies a unitary elasticity of input substitution, whereas intuition and evidence clearly suggest otherwise. Arrow et al. [-@arrow1961capital] set the tone in their seminal article:

>"Technological alternatives are numerous and flexible in some sectors, limited in others; and uniform substitutability is most unlikely. The difference in elasticities is confirmed by direct observation of capital-labor proportions, which show much more variation among countries in some sectors than in others".

However, the authors here are objecting not to unitary elasticity of substitution, but rather "uniform substitutability". The measure of substitutability of one input for another in a two factor model $y(x_1, x_2)$ given an output target is not the elasticity of substitution, but rather the marginal rate of substitution, $dx_1/dx_2$. And the phrase "uniform substitutability" followed closely by the word "elasticities" may reasonably be interpreted as $d\ln(x_1)/\ln(dx_2) = 1$. (Hundreds of subsequent authors espousing this objection appear to mean this, at any rate.) It is straightforward to show that the two factor Cobb-Douglas model does not imply this. On the contrary, it implies

\begin{equation}
\frac{d \ln(x_1)}{d\ln(x_2)} = -\frac{\alpha_2}{\alpha_1}
\end{equation}

And thus agrees with Arrow et al.'s observations regarding the unlikelihood of "uniform substitutability".

At the same time, it is true that the two factor Cobb-Douglas model implies a unitary elasticity of substitution. But the elasticity of substitution is not a measure of factor substitutability. It is a measure of how factor proportions change with substitutability. A unitary elasticity of substitution thus means that a $1\%$ change in substitutability ($dx_1/dx_2$) results in a $1\%$ change in the input usage ratio $x_1/x_2$. In plain English: a change in substitutability of $x_1$ for $x_2$ results in a proportionate change in the substitution of $x_1$ for $x_2$. One may conjecture without controversy that most farm managers would consider this an eminently reasonable characterization of management decision-making.

Enduring objection 2 is that the Cobb-Douglas production elasticities $\alpha_i$ are constant, whereas intuition suggests that production elasticities are functions of inputs, and should thus vary with input use. To lift this "restriction", the translog production function was introduced, with production elasticities defined as Cobb-Douglas functions of the inputs.

While the Cobb-Douglas production elasticities are indeed constant, it is fallacious to then conclude from this that they are not functions of the inputs. On the contrary, by Euler's theorem it is straightforward to show that

\begin{equation}
\alpha_i = \left(\frac{h - 1}{h} \right)  \frac{x_i}{y} \sum_{j}^{n} \frac{\partial^2 y}{\partial x_i \partial x_j} x_j
\end{equation}

And, moreover,

\begin{equation}
\frac{\partial^2 y}{\partial x_i \partial x_j} = \frac{1}{h - 2}  \sum_{k}^{n} \frac{\partial}{ \partial x_i} \frac{\partial y}{\partial x_j \partial x_k} x_k
\end{equation}

And, so on for any order $\mathcal{\ell}$ of differentiation, ad infinitum,

\begin{equation}
\frac{\partial^{\ell} y}{\partial x_i^{\ell}} = \frac{1}{h - \ell + 1}  \sum_{j}^{n} \frac{\partial^{\ell + 1} y}{\partial x_i^{\ell + 1} \partial x_j} x_j
\end{equation}

That is to say, for $h \neq 1$, the Cobb-Douglas production elasticities are not just functions of all inputs, but also of the $2^{nd}$, $3^{rd}$, $\dots$,$\infty^{th}$ order variation of production with respect to inputs, as well as the interactions of these implied in the successive orders of cross derivatives. That all this complex interaction should add up to a constant is a sign not of oversimplification, then, but of mathematical serendipity stemming from axiom 1. The translog function, meanwhile, is not derived from any first principle and is not even a homogeneous function. Which, then, is the more restrictive model? translog also violates axiom 1.

It may be added that the economic principle of net-benefit maximization (cost minimization) implies that optimal input quantities are functions of prices and control variables, and are thus constant. In this sense, the translog production elasticities are also constant.

The same riposte applies to enduring objection 3, namely, that the Cobb-Douglas input demand elasticities are constant, whereas intuition and evidence indicate that input demand elasticities vary with input use. Again, it is true that Cobb-Douglas demand elasticities are constant. But, again, this does not mean that they are not functions of inputs. On the assumption that producers maximize their net benefit (or minimize cost), the Cobb-Douglas input demand own and cross price elasticities follows as

\begin{equation}
\end{equation}

The input own and cross price demand elasticities are thus functions of price and technology. Because optimal input use is also a function of price, these elasticities may be written as functions of input use, if so desired. Conversely, the Hicks-Allen partial elasticities derived using the translog model may be written in terms of prices, if so desired.

how to implement in minimum data contexts...

Also agrees with Lipton...

Lipton says... .

>\singlespacing "New science usually raises farm supply of outputs and demand for inputs. That makes outputs cheaper and inputs more expensive; hence the ratio of farm output prices to input prices falls. Do small and poor farmers gain? If, and only if, this science-induced fall in their relative farm prices is slower than the science-induced rise in their conversion ratio of physical inputs into physical outputs (that is, TFP)" [-@lipton2005family].

the mapping defaults to the subjective preferences of the modeler, which in turn prefigures the results of the impact assessment.  ...arbitrarily set by modeler...in the name of expedience, then, petitio principii. an assumed result dressed up in mathematical symbols. [In lit review: The most famous example is whether an improved variety does a shift or pivot of the supply curve. Results depend critically on this choice...conflict of interest.] Counterveiling changes in prices...Lipton.

in Discussion: the starting Axioms are to be experimented with. Other sets of Axioms might yield the same or different results.

...the numerous methodological headaches incurred in the pursuit of expedience, outlined above (and reviewed in more detail below), outweigh any gain in computational expedience. [What good is computational expedience if it is not even clear what is being calculated, what its connection to reality is]

can also address questions of how the same result might be achieved through interventions of other variables (Ethiopia bean an example), so as to compare which impact pathway is cheapest


sketch out extension to aggregate demand and PE analysis...computing Econ Surplus, change in net benefit as alternative to ES


# References {-}

<div id="refs"></div>

\pagebreak

# Appendix A

A.1
## Derivation of the optimal yield function from axiom 2 \label{sec:ax12}

The mathematical derivation of the optimized farm yield function is so rudimentary that it is questionable whether it should be given any space at all. It is included in the Appendix because the textbook derivation of the optimized yield function from the axiom of profit maximization usually focuses on the two input case (capital and labor) for purposes of isoquant analysis, whereas here the emphasis is on the modeling of multivariate yield; and because the widespread insistence on constant or increasing returns to scale together with profit maximization, upward sloping firm supply curves, and other commonly desired production function properties, without acknowledging the mathematical contradiction between the latter and the former, suggests a lack of familiarity with the mathematical implications of these axioms beyond a literary form, such that a review is relevant to the aims of this article.
<!-- \begin{framed} -->
<!--    \textbf{Axiom 2} \\ Farms apply inputs so as to maximize their net benefit subject to a budget constraint. -->
<!-- \end{framed} -->

Formally, axiom 2 may be written

\begin{equation}
y^* = y(\mathbf{x}^*; y_0, \tilde{\mathbf{x}}, \mathbf{k}, \tilde{\mathbf{k}}, \boldsymbol{\alpha}, \boldsymbol{\kappa}) \:;\:\: x^* = \text{argmax}_{\mathbf{x}}(P y - \lambda(C - B))
\end{equation}

Where $P$ is the output price, $B$ is the farm budget, $C$ is the cost function, defined

\begin{equation}
C = \mathbf{w} ' \mathbf{x}
\end{equation}

and $\mathbf{w}$ is the vector of input prices corresponding to each element in the input vector $\mathbf{x}$.

The Lagrangian is then

\begin{equation}
\mathcal{L} = Py - \lambda (C - B)
\end{equation}

Where $\lambda$ is the farm budget shadow price, that is, the marginal benefit to the farm of a marginal increase in budget.

\begin{equation}
\frac{\partial \mathcal{L}}{\partial B} = \lambda
\end{equation}
<!-- The budget shadow price is an implicit measure of how each farm values cash for expenditures on farm inputs, and plays a central role in the aggregation step farther below. -->

Standard textbook treatments of the first and second order conditions for Cobb-Douglas profit maximization are generally limited to the two input case (capital and labor) for the purpose of isoquant analysis, and omit the budget constraint. It is therefore necessary to take a moment to examine these conditions for the more general case, and specific aims, at hand. The first order conditions for a maximum of $\mathcal{L}$ are

\begin{equation}
\begin{split}
\nabla_{\mathbf{x}} \mathcal{L} &= P \nabla_{\mathbf{x}} y - \lambda \mathbf{w} = \mathbf{0} \\
&= Py D(\mathbf{x})^{-1} \boldsymbol{\alpha} - \lambda \mathbf{w} = \mathbf{0}
\end{split}
\label{eq:eqFOC}
\end{equation}

Where the $\mathbf{0}$ indicates a vector of zeroes equal to the length of $\mathbf{x}$.

And the second order condition for a maximum is

\begin{equation}
\begin{split}
\mathbf{x} ' \nabla_{\mathbf{x}}^2 \mathcal{L} \mathbf{x} &= P \mathbf{x} ' \nabla_{\mathbf{x}}^2 y \mathbf{x} ' < 0 \\
&= P h (h - 1) < 0
\end{split}
\label{eq:eqSOC}
\end{equation}

Where Euler's Theorem has been invoked in the second line of the condition. It follows that axiom 2 requires $0 < h < 1$, i.e. diminishing returns to scale. Constant returns to scale ($h = 1$) imply the break-even point, while increasing returns to scale ($h > 1$) imply a loss. The farm yield function is thus globally concave in inputs. Constant and increasing returns, on the other hand, would imply global linearity and convexity, respectively.

The first order conditions may be solved for input demand $x_j^*$ as follows.

\begin{equation}
x_j^* = \frac{P y^* \alpha_j}{\lambda w_j}
\label{eq:inputDem1}
\end{equation}

Optimal yield $y^*$ then follows as the unoptimized yield evaluated at the optimal input levels $x_j^*$. This works out to

\begin{equation}
y^* =  \left(y_0 \prod_i \left(\frac{\alpha_i}{w_i}\right)^{\alpha_i} \prod_i k_i^{\kappa_i} \right)^{\frac{1}{1 - h}} \left(\frac{P}{\lambda}\right)^{\frac{h}{1 - h}}
\label{eq:YdEnv1}
\end{equation}
<!-- Heathfield and Wibe [-@heathfield1987introduction] -->

This is the optimized yield function, or yield envelope, henceforth simply referred to as the farm yield. To reduce notational clutter, $y^*$ is rewritten as follows.

\begin{equation}
y^* = (y_0 \theta)^{\frac{1}{1 - h}} \left( \frac{P}{\lambda} \right)^{\frac{h}{1 - h}}
\label{eq:YdEnvCompact}
\end{equation}

Where

\begin{equation}
\theta = \frac{\theta_x \theta_k}{\theta_w} \:\:;\:\:\: \theta_w = \prod_i{w_i}^{\alpha_i} \:\:\: \theta_x = \prod_i {\alpha_i}^{\alpha_i} \:\:\: \theta_k = \prod_i \left( \frac{k_i}{\tilde{k}_i} \right)^{\kappa_i}
\end{equation}

Dotting the first order conditions in Equation \ref{eq:eqFOC} through by $\mathbf{x}$ results in a handy expression for the budget shadow price.

\begin{equation}
\lambda = \frac{R^*}{C^*} h \:\:;\:\:\: C^* = \mathbf{w} ' \mathbf{x}^* \:\:\: R^* = P y^*
\label{eq:lambda}
\end{equation}
<!-- when combined with Equation \ref{eq:inputDem1}, then gives -->
<!-- \begin{equation} -->
<!-- \frac{x_j^* w_j}{C^*} = \frac{\alpha_j}{h} -->
<!-- \end{equation} -->
<!-- which tells us that rational cost shares equal their respective "technology shares". -->

which, when combined with Equation \ref{eq:YdEnvCompact}, gives an instructive, alternative expression for $y^*$,

\begin{equation}
y^* = y_0 \theta \left( \frac{C^*}{h} \right)^h
\label{eq:yStarC}
\end{equation}

[
Shdn't it be

\begin{equation}
y^* = y_0 \theta \left( \frac{C^*/\tilde{C}^*}{h} \right)^h
\end{equation}

?
]

The degree of homogeneity $h$ is thus also the scale elasticity of yield ($d \ln(y^*) / d \ln(C^*) = h$), as noted in the textbooks. This form is particularly useful for estimation, as it requires only the control variables $k_i$ and input cost $C^*$, as opposed to detailed information on all of the input quantities. That is, instead of estimating the model in Equation \ref{eq:cobbDoug3ln}, one estimates

\begin{equation}
\ln(y) = \ln(\tilde{y}) + h \ln \left(\frac{C^*}{\tilde{C}^*} \right) + \sum_{i = 1}^{n_k} \kappa_i \ln \left( \frac{k_i}{\tilde{k}_i} \right) + \sum_{i = 1}^{n_w} \alpha_i \ln(w_i)
\label{eq:cobbDoug4}
\end{equation}

Where the shorthand $\tilde{y}$ has been introduced, defined

\begin{equation}
\tilde{y} = y_0 \theta_{\alpha} \left( \frac{\tilde{C}^*}{h} \right)^h
\label{eq:yConst}
\end{equation}

[Shdn't $\tilde{C}^*$ be in the denominator?]

Such that the input elasticities $\alpha_i$ are implicit in the fitted constant $\tilde{y}$ without requiring detailed information about input types and quantities. Any control variables $k_i$ or input prices $w_i$ not explicitly specified are implicitly absorbed into $\tilde{y}$, such that the model may be tailored to available data. Moreover, letting the reference values $\tilde{C}^*$ and $\tilde{k}_i$ equal the mean of the cost per acre and control variables, respectively, then $\tilde{y}$ is equal to the mean yield. A further advantage of this form is that the fitted coefficient on $\ln(C^*)$ may be directly interpreted as $h$, valid for all farms in the sample. Estimation of the model in Equation \ref{eq:cobbDoug3}, on the other hand, requires the extra step of summation of the input elasticities $\alpha_i$ in order to arrive at $h$. This may result in varying $h$ across the sample, as not all farms necessarily apply all the inputs specified in the model.

Finally, note also the similarity between Equations \ref{eq:yStarC} and \ref{eq:integrate_lny}. And note that

\begin{equation}
\frac{\partial \ln(y^*)}{\partial C^*} \sim \frac{1}{C^*}
\end{equation}

Which is congruent to axiom 1. The question arises, then, whether axiom 2 requires axiom status, or whether it is implied by axiom 1. But this is a question for logicians. Pending clarification, it remains an axiom for now.

### Marginal cost and cost per unit output
<!-- Some important/underrepresented corollaries -->
<!-- Because the C-D fn has fallen into such disrepute, it is worthwhile to take a moment to highlight some attractive corollaries that are underrepresented in the textbook treatments. [and one new one -lipton] -->

The farm marginal cost readily follows from the scale elasticity of yield by combining it with the budget shadow price expression in Equation \ref{eq:lambda}.

\begin{equation}
\frac{dC^*}{dy^*} = \frac{P}{\lambda}
\label{eq:margCost1}
\end{equation}

Note the difference between this and the standard assertion that marginal cost must equal marginal revenue.

This expression is the theoretical basis for considering that marginal cost 

Axioms 1 and 2 thus imply that marginal cost is proportionate, but not equal, to output price. If they were equal, then this would constitute theoretical grounds upon which to presume that every farm has the same marginal cost; and then from there it would be a short jump to presume, as is often done, that a given exogenous shock affects every farm's marginal cost identically. But no, marginal cost varies with $\lambda$. In highly developed economic sectors, it may be that $\lambda$ is effectively determined by the lending rate, and is thus homogeneous across firms; but not in the primary sector. In the primary sector, heterogeneous endowments result in heterogeneous valuation of marginal increments in production expenditure (i.e. $\lambda$). This may be considered one of the hallmarks of the primary sector setting it apart from other sectors.

Since $P = d R^* / d y^*$, this can be rearranged into another instructive expression for $\lambda$.
<!-- constant marginal cost. (As mentioned in the introduction, this is well supported empirically [].) -->

\begin{equation}
\lambda = \frac{dR^* / dy^*}{dC^* / dy^*} = \frac{dR^*}{dC^*}
\label{eq:lambda2}
\end{equation}

Letting $C^{\#}$ denote the cost per unit output (often called the "average cost of production"),

\begin{equation}
C^{\#} = \frac{C^*}{y^*}
\label{eq:cSharp1}
\end{equation}

Then

\begin{equation}
\lambda = \frac{P}{C^{\#}} h
\label{eq:lambda3}
\end{equation}

And the marginal cost and cost per unit yield are thus related as follows.

\begin{equation}
\frac{dC^*}{dy^*} h = C^{\#}
\label{eq:lambda3}
\end{equation}

That is to say, the farm's average cost is equal to its marginal cost scaled by $h$. The standard assertion that profit-maximizing farms produce such that marginal cost equals average cost thus implies that $h = 1$ (constant returns to scale). (Which in turn implies perfectly inelastic farm supply curve.)

### Farm level supply and input demand

Turning to supply and demand curves, From Equation \ref{eq:YdEnvCompact} and the domain of $h$, it follows that farm supply curves are positively sloped.

\begin{equation}
\frac{\partial \ln(y^*)}{\partial \ln(P)} = \frac{h}{1 - h} > 0
\label{eq:PelastYstar}
\end{equation}

Note, in passing, that farm supply is elastic for $h \in (1 / 2 , 1)$, inelastic for $h \in (0, 1 / 2)$, and linear when $h = 1 / 2$. And note that increasing returns to scale would imply negatively sloped supply curves.

The domain of $h$ required by Axiom 2 also implies strictly downward sloping input demand curves. To see this, combine Equations \ref{eq:inputDem1} and \ref{eq:YdEnvCompact} to obtain an alternate expression for input demand.

\begin{equation}
x_j^* = \frac{\alpha_j}{w_j} \left( y_0 \theta \frac{P}{\lambda} \right)^{\frac{1}{1 - h}}
\label{eq:inputDem2}
\end{equation}

The own and cross input price elasticities of input demand are, then, respectively,

\begin{equation}
\begin{split}
\frac{\partial \ln(x_j^*)}{\partial \ln(w_j)} &= - 1 - \frac{1}{1 - h} \frac{\partial \ln(\theta_w)}{\partial \ln(w_j)} \\
&= \frac{-\alpha_j}{1 - h} - 1
\end{split}
\label{eq:ownPriceElas}
\end{equation}

And

\begin{equation}
\frac{\partial \ln(x_j^*)}{\partial \ln(w_{\ell \neq j})} = \frac{-\alpha_{\ell}}{1 - h}
\label{eq:CrossPriceElas}
\end{equation}

whereby it is clear that the domain of $h$ implies negatively sloped own and cross price demand curves. It follows, moreover, that input demand is strictly elastic in own price. For cross price input demand curves, demand is elastic if $h \in (1 - \alpha_{\ell}, 1)$, inelastic if $h \in (0, 1 - \alpha_{\ell})$, and linear if $h = 1 - \alpha_{\ell}$. Note that increasing returns to scale would imply strictly upward sloping cross price demand curves, and the possibility of upward sloping own price demand curves.
<!-- In the case of cross price demand curves, this implies that all inputs are complements, not substitutes. -->
<!-- Positively sloped supply curves and negatively sloped demand curves thus follow from Axioms 1 and 2, and do not need to be imposed as additional Axioms. -->
[...recovers Lipton's theory of adoption...]
[...optimal farm size...?]

<!-- ### Domain of profitable production (Axiom 3) and restatement of aggregate supply -->
<!-- It is now possible to define in detail the domain of profitable production $(\underline{q}^*, \bar{q}^*)$ appearing in the aggregate supply integral (Equation \ref{eq:sup1}). -->

<!-- Assuming that farms do not enter production unless they expect to make a profit (Axiom 3) is tantamount to assuming that $C^{\#} < P$. By Equation \ref{eq:lambda3}, then, Axiom 3 introduces the bound $\lambda > h$. This, in turn, imposes the following upper bound on expected yield. -->

<!-- \begin{equation} -->
<!-- y^* < (g_0 \theta)^{\eta / h}  \left(\frac{P}{h} \right)^{\eta} \:\:;\:\:\: \eta = \frac{h}{1 - h} -->
<!-- \label{eq:ydUpBound} -->
<!-- \end{equation} -->

<!-- (No lower bound is imposed by Axiom 3, and so the lower bound of $y^*$ just defaults to the physical lower bound $y^* > 0$.) -->


<!-- This, in turn, means that, for a given $k$, yield has upper bound $\bar{y}^*(k)$. -->

<!-- \begin{equation} -->
<!-- \bar{y}^*(k) = E[y^*] \frac{k^{\frac{\eta}{h}}}{E[k^{\frac{\eta}{h}}]} \frac{P^{\# \eta}}{E[C^{\# \eta}]} -->
<!-- \end{equation} -->


<!-- By axiom 3, yield is assumed to be lognormally distributed. If $k_a$ and $y^*$ are independent, then production must also be lognormally distributed. However, there is good reason to suspect that area and yield are not independent. Empirically, an inverse relation is observed to exist between yield and area []. To handle this dependence between $k_a$ and $y^*$, let one of the control variables $k_i$ equal $k_a$ when estimating the yield model. Once the corresponding coefficient $\kappa_a$ is estimated, factor out $k_a^{\kappa_a}$ from $k$, such that the production function may be rewritten -->

<!-- \begin{equation} -->
<!-- q^* = k_a^{1 + \kappa_a \frac{\eta}{h}} E[y^*] \frac{\tilde{k}^{\frac{\eta}{h}}}{E[k^{\frac{\eta}{h}}]} \frac{C^{\# \eta}}{E[C^{\# \eta}]} \:\:;\:\:\: \tilde{k} = \prod_{i \neq a}^{n_k} -->
<!-- \end{equation} -->
<!-- Now the terms are independent. -->
The conciseness of this expression being due to the judicious substitution in Equation \ref{eq:u0_for_g0}. If this substitution is not made, then evaluation of $y$ (Equation \ref{eq:cobbDoug2}) at $x^*_i$ works out to

\begin{equation}
y^* = \left(g_0 \prod_{i = 1}^{n_x} \left( \frac{\alpha_i}{w_i} \right)^{\alpha_i} k \right)^{\frac{1}{1 - h}} \left( \frac{P}{\lambda} \right)^{\frac{h}{1 - h}}
\label{eq:YdEnvMessy}
\end{equation}

<!-- The degree of homogeneity $h$ is thus also the scale elasticity of yield ($d \ln(y^*) / d \ln(C^*) = h$), as noted in the textbooks. -->

Equation \ref{eq:YdEnvMessy} is useful for inspecting the output price elasticity of farm supply, making sure they agree with expectation based on intuition and/or empirical observation. Letting $\eta$ denote the output price elasticity of farm supply, from Equation \ref{eq:YdEnvMessy}, it is clear that

\begin{equation}
\eta = \frac{\partial \ln(y^*)}{\partial \ln(P)} = \frac{h}{1 - h}
\end{equation}

To know if this expression agrees with intuition, it is necessary to determine the domain of $h$. By axiom 2 (Equation \ref{eq:cStar}), clearly $h$ must lie between $0$ and $1$. At $h = 1$ (constant returns to scale), profit is $0$, and $h$ greater than $1$ implies loss. Given the domain $0 < h < 1$, it follows that $\eta$ is strictly non-negative, in agreement with expectation. It follows, moreover, that farm supply is inelastic over $0 < h < 1/2$ and elastic over $1/2 < h < 1$. The price elasticity of supply at the farm level thus increases with improvements in technology, which many might consider an intuitive result. Finally, note that the standard assumption of unit homogeneity or constant returns to scale ($h = 1$) implies not only zero profit but also perfect elasticity, which is never observed empirically.

The own and cross price elasticities of input demand may be inspected by examining Equations 
\ref{eq:inputDem1} or \ref{eq:inputDem2}. 

Note, moreover, assuming yield is lognormally distributed (axiom x) and that $C^*$ and $k$ are linearly independent,


\begin{equation}
E[y^*] = u_0 \frac{E[C^{*h}}{E[C^*]^h} = u_0 e^{\frac{s_c^2}{2}(h^2-h)}
\end{equation}

[[Cost *increases* with tech (h)]]

[[pause and review MC = h/lambda AC basis of the conventional concept and insistence on marginal firms]]

[[area and yd not independent. so when moving from yield to production fn can't just integrate over density of area. have to factor out the area component of yield and integrate it into area]]

[[By axioms 1 and 2, then we get corrollaries: upward sloping farm supply, downward sloping input demand, concavity in inputs, marginal cost equals P/lambda, MC and Avg cost]]

Where $h = \sum_i \alpha_i$ is the farm yield degree of homogeneity, $P$ is the output price, $\lambda$ is the farm budget shadow price, and

\begin{equation}
\theta_x = \prod_i {\alpha_i}^{\alpha_i} \:\:\: \theta_w = \prod_i{w_i}^{\alpha_i} \:\:\:  \theta_k = \prod_i \left( \frac{k_i}{\tilde{k}_i} \right)^{\kappa_i}
\end{equation}

Where the $w_i$ are input prices. Note that $\eta$, the farm level output price elasticity of supply, is a function of the technology. The yield envelope---i.e., the budget constrained, profit maximizing farm yield in Equation \ref{eq:YdEnvCompact0}---is henceforth referred to simply as the farm yield.

Such that the yield function may be rewritten

\begin{equation}
y = u_0 \frac{\prod_{i = 1}^{n_k} k_i^{\kappa_i}}{E[\prod_{i = 1}^{n_k} k_i^{\kappa_i}]} \prod_{i = 1}^{n_x} \left( \frac{x_i}{E[x_i]} \right)^{\alpha_i}
\label{eq:cobbDoug3b}
\end{equation}
<!-- \begin{equation} -->
<!-- y = y_0 \prod_{i = 1}^{n_k} \left( \frac{k_i}{\tilde{k}_i} \right)^{\kappa_i} \prod_{i = 1}^{n_x} \left( \frac{x_i}{\tilde{x}_i} \right)^{\alpha_i} -->
<!-- \label{eq:cobbDoug3} -->
<!-- \end{equation} -->

Or, taking logs,

\begin{equation}
\ln(y) = \ln(y_0) + \sum_{i = 1}^{n_k} \kappa_i \ln \left( \frac{k_i}{\tilde{k}_i} \right) + \sum_{i = 1}^{n_x} \alpha_i \ln \left( \frac{x_i}{\tilde{x}_i} \right)
\label{eq:cobbDoug3bln}
\end{equation}


A.2
## Proof of equation \ref{eq:sup2}
<!-- (The proof below closely follows that of Hull in the appendix to chapter 13 of his book [-@hull9thEdition].) -->

For lognormally distributed $C^{\#}$, the probability density function $\rho(C^{\#})$ is defined

\begin{equation}
\rho(C^{\#}) = \frac{1}{\sqrt{2\pi} s_{\#}} e^{-\frac{(\ln(C^{\#}) - m_{\#})^2}{2 s^2_{\#}}} \:\:;\:\:\: m_{\#} = E[\ln(C^{\#})] \:\:\: s^2_{\#} = Var[\ln(C^{\#})]
\end{equation}

So

\begin{equation}
\int_{0}^{P} C^{\# \eta} \rho(C^{\#}) \: dC^{\#} = \frac{1}{\sqrt{2\pi} s_{\#}} \int_{0}^{P} C^{\# \eta} e^{-\frac{(\ln(C^{\#}) - m_{\#})^2}{2 s^2_{\#}}} d \ln(C^{\#})
\label{eq:integral1}
\end{equation}

Introducing a change of variables,

\begin{equation}
\gamma = \frac{\ln(C^{\#}) - m_{\#}}{s_{\#}} \: \rightarrow \: d \ln(C^{\#}) = s_{\#} d \gamma
\end{equation}

Equation \ref{eq:integral1} resolves as follows.

\begin{equation}
\begin{split}
\int_{0}^{P} C^{\# \eta} \rho(C^{\#}) \: dC^{\#} &= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{(\gamma s_{\#} + m_{\#})\eta } e^{-\frac{\gamma^2}{2}} d \gamma \\
&= \frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-1/2[\gamma^2 - 2 \gamma s_{\#} \eta - 2 m_{\#} \eta]} d \gamma
\end{split}
\end{equation}

Where the argument of the exponential function resolves as follows,

\begin{equation}
\begin{split}
-1/2[\gamma^2 - 2 m_{\#} \eta - 2 \gamma s_{\#} \eta]\end{split} \\
&= -1/2 [(\gamma - s_{\#} \eta)^2 - 2 m_{\#} \eta - s^2_{\#} \eta^2 ] \\
&= -\frac{(\gamma - s_{\#} \eta)^2}{2} + m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2
\end{equation}

So the integral can be rewritten

\begin{equation}
\begin{split}
\frac{1}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2} + m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2} d \gamma \\
&= \frac{1}{\sqrt{2\pi}} e^{m_{\#} \eta + \frac{s^2_{\#}}{2} \eta^2} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2}} d \gamma \\
&= \frac{E[C^{\# \eta}]}{\sqrt{2\pi}} \int_{0}^{\frac{\ln(P) - m_{\#}}{s_{\#}}} e^{-\frac{(\gamma - s_{\#} \eta)^2}{2}} d \gamma \\
&= \frac{E[C^{\# \eta}]}{\sqrt{2\pi}} \Phi \left(\frac{\ln(P) - m_{\#}}{s_{\#}} - s_{\#} \eta \right)
\end{split}
\end{equation}

Where $\Phi()$ is the standard normal cumulative distribtion function.

\begin{equation}
\Phi(\ell) = \frac{1}{\sqrt{2\pi}} \int_{0}^{\ell} e^{-\frac{\xi^2}{2}} d \xi
\end{equation}

$\blacksquare$

A.3
# Proof that optimal unit cost is a geometric brownian motion with the same parameters as price

Equation \ref{eq:useful2} implies

\begin{equation}
\frac{C^{\#}(t)}{h} = \frac{P(t)}{\lambda}
\label{eq:useful2b}
\end{equation}

By Ito's Lemma, then,

\begin{equation}
\Delta C^{\#} = \left(\frac{\partial C^{\#}}{\partial t} + m_p P(t) \frac{\partial C^{\#}}{\partial P} +  \frac{1}{2} s_p^2 P(t)^2 \frac{\partial^2 C^{\#}}{\partial P^2}  \right) \Delta t + s_p P(t) \partial C^{\#}}{\partial P} \epsilon \sqrt{\Delta t}
\label{eq:itoLem}
\end{equation}

Where $\epsilon$ is a normally distributed random variable with mean $0$ and standard deviation $1$. (For a reference see Hull [-@hull9thEdition].)

By Equation \ref{eq:useful2b},

\begin{equation}
\frac{\partial C^{\#}}{\partial t} = 0 \:\:\:\: \frac{\partial C^{\#}}{\partial P} = \frac{C^{\#}}{P} \:\:\:\: \frac{\partial^2 C^{\#}}{\partial P^2} = 0
\end{equation}

Such that Equation \ref{eq:itoLem} thus resolves to

\begin{equation}
\Delta C^{\#} = m_p C^{\#} \Delta t + s_p C^{\#} \epsilon \sqrt{\Delta t}
\end{equation}

By which it follows that $E[C^{\#}(T)]\bigr|_{t = 0} = m_pT$ and $Var[C^{\#}(T)]\bigr|_{t = 0} = s^2_p T$.

$\blacksquare$

# Appendix B

## Data details and preparation


<!-- <!-- this can be rewritten --> -->
<!-- <!-- \begin{equation} --> -->
<!-- <!-- \int_0^{h^{-\theta}} \lambda^{-\theta} f(\lambda^{-\theta}) \: d \lambda^{-\theta} = h^{-\theta} E[E[b(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln \left(\frac{1}{E[E[b(T)]\bigr|_{t = 0}^{-\theta}]} \right) - \theta^2 \frac{\omega^2}{2}}{\theta \omega} \right) --> -->
<!-- <!-- \label{eq:refEq} --> -->
<!-- <!-- \end{equation} --> -->
<!-- <!-- Where $\omega^2 = Var[\ln(E[b(T)]\bigr|_{t = 0})]$. --> -->


<!--  Equation \ref{eq:refEq} may now be rewritten -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{h^{-\theta}} \lambda^{-\theta} f(\lambda^{-\theta}) \: d \lambda^{-\theta} &= h^{-\theta} E[\mu_b(T)^{-\theta}]\bigr|_{t = 0} \Phi \left(\frac{\ln \left(\frac{1}{E[\mu_b(T)]\bigr|_{t = 0}^{-\theta}} \right) - \theta^2 \frac{s_{\mu}^2}{2} T}{\theta s_{\mu} T} \right) \\ -->
<!-- &= h^{-\theta} \mu_b(0)^{-\theta} e^{-\theta m_{\mu} T} \Phi \left(\frac{\ln \left(\frac{1}{\mu_b(0)^{-\theta}} \right) - \theta m_{\mu}T - \theta^2 \frac{s_{\mu}^2}{2} T}{\theta s_{\mu} T} \right) \\ -->
<!-- &= h^{-\theta} \mu_b(0)^{-\theta} e^{-\theta m_{\mu} T} \Phi \left( -\frac{\ln \left(\frac{1}{\mu_b(0)^{-\theta}} \right) - \left(\theta m_{\mu} - \theta^2 \frac{s_{\mu}^2}{2}\right) T}{\theta s_{\mu} T} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->




<!-- The mean and variance of the log fractional change (or "return") of $\mu_b(t)$ over period $T$, meanwhile, are -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E \left[ \ln \left( \frac{\mu_b(T)}{\mu_b(0)} \right) \right] &= \left(m_{\mu} - \frac{s_{Eb}^2}{2} \right) T \\ -->
<!-- Var \left[ \ln \left( \frac{\mu_b(T)}{\mu_b(0)} \right) \right] &= Var[\ln(\mu_b(T))]\bigr|_{t = 0} = s_{\mu}^2 T -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- By which it follows that the -->


<!-- Taking logs and factoring out $\ln (P y^*/\lambda)$, -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + \ln \left(\frac{P y^*}{\lambda} \right) \sum_i \alpha_i + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i) -->
<!-- \end{equation} -->

<!-- But note that, by Euler's homogenous function theorem, -->

<!-- \begin{equation} -->
<!-- \sum_i \alpha_i = h -->
<!-- \end{equation} -->

<!-- where $h$ is the degree of homogeneity of $y$. -->

<!-- \begin{equation} -->
<!-- y^* =  \left(y_0 \left(\frac{P}{\lambda}\right)^h \prod_i \left(\frac{\alpha_i}{w_i}\right)^{\alpha_i} \prod_i k_i^{\kappa_i} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:YdEnv1} -->
<!-- \end{equation} -->





<!-- The Lagrangian is then -->

<!-- \begin{equation} -->
<!-- \mathcal{L} = Py - \lambda (C - B) -->
<!-- \end{equation} -->

<!-- Where $\lambda$ is the farm budget shadow price, that is, the marginal benefit to the farm of a marginal increase in budget. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \mathcal{L}}{\partial B} = \lambda -->
<!-- \end{equation} -->

<!-- The first order conditions for a maximum work out to: -->

<!-- \begin{equation} -->
<!-- \nabla_{\mathbf{x}} \mathcal{L} = Py D(\mathbf{x})^{-1} \boldsymbol{\alpha} - \lambda \mathbf{x} = \mathbf{0} -->
<!-- \label{eq:eqFOC} -->
<!-- \end{equation} -->

<!-- Where the $\mathbf{0}$ indicates a vector of zeroes equal to the length of $\mathbf{x}$. This is then solved for the optimal input levels $\mathbf{x}^*$. -->

<!-- \begin{equation} -->
<!-- \mathbf{x}^* = P y^* / \lambda D(\mathbf{w})^{-1} \boldsymbol{\alpha} -->
<!-- \end{equation} -->

<!-- Or, alternatively, -->

<!-- \begin{equation} -->
<!-- x_v^* = \frac{P y^* \alpha_v}{\lambda w_v} -->
<!-- \label{eq:inputDem1} -->
<!-- \end{equation} -->

<!-- The optimal yield, or yield envelope, or economic yield, $y^*$ is then found by evaluating $y$ at $\mathbf{x}^*$. -->

<!-- \begin{equation} -->
<!-- y^* = y(\mathbf{x}^*; y_0, \boldsymbol{\alpha}, \mathbf{k}, \boldsymbol{\kappa}) = y_0 \prod_i \left(\frac{P y^* \alpha_i}{\lambda w_i} \right)^{\alpha_i} \prod_i k_i^{\kappa_i} -->
<!-- \end{equation} -->

<!-- Taking logs and factoring out $\ln (P y^*/\lambda)$, -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + \ln \left(\frac{P y^*}{\lambda} \right) \sum_i \alpha_i + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i)  -->
<!-- \end{equation} -->

<!-- But note that, by Euler's homogenous function theorem, -->

<!-- \begin{equation} -->
<!-- \sum_i \alpha_i = h -->
<!-- \end{equation} -->

<!-- where $h$ is the degree of homogeneity of $y$. Hence the previous equation can be rewritten -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \alpha_0 + h \ln \left(\frac{P y^*}{\lambda} \right) + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i)  -->
<!-- \label{eq:eulerInvokd} -->
<!-- \end{equation} -->

<!-- Solving for $\ln(y^*)$, -->

<!-- \begin{equation} -->
<!-- \ln(y^*) = \frac{1}{1 - h} \left(\alpha_0 + h \ln \left(\frac{P}{\lambda} \right) + \sum_i \alpha_i \ln \left(\frac{\alpha_i}{w_i} \right) + \sum_i \kappa_i \ln(k_i) \right) -->
<!-- \end{equation} -->

<!-- And taking the exponential function of this then gives the yield envelope. -->

<!-- \begin{equation} -->
<!-- y^* =  \left(y_0 \left(\frac{P}{\lambda}\right)^h \prod_i \left(\frac{\alpha_i}{w_i}\right)^{\alpha_i} \prod_i k_i^{\kappa_i} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:YdEnv1} -->
<!-- \end{equation} -->

<!-- Economic yield is thus a function of: -->

<!-- 1) Input prices $\mathbf{w}$ -->

<!-- 2) The output price $P$ -->

<!-- 3) The input elasticities of yield $\boldsymbol{\alpha}$ (i.e. the technology) -->

<!-- 4) The control variables $\mathbf{k}$ -->

<!-- 5) Their control variable elasticities of yield $\boldsymbol{\kappa}$ -->

<!-- 6) The farm budget shadow price $\lambda$ -->
<!-- The steps followed above more or less align with the standard derivation of the Cobb-Douglas yield envelope found in textbooks , with the important exception of the invocation of Euler's homogeneous function theorem in equation \ref{eq:eulerInvokd}. -->



<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(w_i)} = \frac{-\alpha_v}{1 - h} -->
<!-- \end{equation} -->

<!-- With domain -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(y^*)}{\partial \ln(w_v)} \in (-\infty, -\alpha_v) -->
<!-- \end{equation} -->

<!-- The yield envelope derived in equation \ref{eq:YdEnvCompact} implies that the farm supply curve^["Farm supply curve" is used as a shorthand for the "yield envelope as a function of price $P$, with all other variables held constant".] is a power law---or, in economics jargon, a constant elasticity of supply curve. This becomes more evident if the yield envelope is rewritten in the following compact form. -->

<!-- \begin{equation} -->
<!-- y^* = t_S P^{\eta(P, y^*)} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- t_S = \left(y_0 \frac{\theta_x \theta_k}{\lambda^h \theta_w} \right)^{\frac{1}{1 - h}} -->
<!-- \end{equation} -->

<!-- And $\eta(P, y^*)$ is the price elasticity of yield defined in equation \ref{eq:PelastYstar}. -->

<!-- <!-- Both the scale parameter $t$ and exponent $\eta(P, y^*)$ depend critically upon the degree of homogeneity. -->
<!-- The output price elasticity of yield implies that the farm supply curve is elastic for $h \in (1 / 2 , 1)$, and inelastic for $h \in (0, 1 / 2)$, and linear with slope $t_S \bigr|_{h = 1 / 2}$ when $h = 1 / 2$. -->

<!-- This is important information. This means that (insofar as Axioms 1-3 are true) for a given increase in output price, the supply response in a population of farms with inefficient input elasticities (such that $h < 1 / 2$) will be less than proportionate to the increase in price. In a population of relatively input-efficient farms (such that $h > 1 / 2$), on the other hand, the supply response will be more than proportionate to the increase in price. -->

<!-- The farm supply curve approaches perfect inelasticity as $h$ approaches $0$, and approaches (but never reaches) perfect elasticity as $h$ approaches $1$. The scale factor $t_S$ approaches $0$ as $h$ approaches $0$, and tends toward infinity as $h$ approaches $1$. -->



<!-- ## The degree of homogeneity and output price elasticity of yield \label{sec:degHomog} -->

<!-- [The costStar^h  formulation of yield envelope] -->

<!-- [Put "certain useful elasticities/expressions" here maybe] -->

<!-- By invoking Euler's theorem in the derivation of the yield envelope above, the yield degree of homogeneity $h$ is made explicit in the yield envelope; and this lays bare some interesting critical properties. Note, first of all, that the yield envelope is undefined at $h = 1$. The theory constructed so far from Axioms 1 and 2 thus contradicts the deeply entrenched surmise among economists, going back at least to Hicks [-@hicks1963theory], and later cemented into place by Solow [-@solow1957technical], that yield functions are homogeneous of degree 1. -->

<!-- In section \ref{sec:PDfunP}, circumstances are explored under which increasing returns to scale are possible. However, these circumstances generally apply to firms---mills and factories, for example---and not to farms. -->

<!-- The domain of $h$ derived above in turn implies the following bounds on the price elasticity of yield. -->
<!-- <!-- Note, in passing, that the input price elasticity of yield likewise bears the expected sign only under decreasing returns to scale. -->

<!-- ## Input demand \label{sec:inDem} -->

<!-- Using equation \ref{eq:YdEnvCompact} to substitute for $y^*$ in input demand (equation \ref{eq:inputDem1}) gives the following expression for input demand as a function of basal yield, prices, input elasticities, the budget shadow price, and control variables together with their respective elasticities. -->

<!-- \begin{equation} -->
<!-- x_v^* = \frac{\alpha_v}{w_v} \left( y_0 \frac{P \theta_x \theta_k}{\lambda \theta_w} \right)^{\frac{1}{1 - h}} -->
<!-- \label{eq:inputDem2} -->
<!-- \end{equation} -->

<!-- Note that input demand, like optimal yield, is undefined at $h = 1$. The own price elasticity of input demand is -->


<!-- Here another Axiom comes into play. -->

<!-- \begin{framed} -->
<!--    \textbf{Axiom 4} \\ Demand curves are negatively sloped. $\left( \frac{\partial \ln(x_v^*)}{\partial \ln(w_v)} < 0 \:\: \forall v \right)$ -->
<!-- \end{framed} -->

<!-- From equation \ref{eq:ownPriceElas}, it is clear that Axiom 4 imposes the following domain on $h$. -->

<!-- \begin{equation} -->
<!-- h \in (-\infty, 1 + \underline{\alpha}) \:\:; \:\:\: \underline{\alpha} = \min(\boldsymbol{\alpha}) -->
<!-- \end{equation} -->

<!-- Considering that $\underline{\alpha} > 0$, the effective domain of $h$ satisfying both Axioms 3 and 4 (upward sloping supply curves and downward sloping demand curves) is -->

<!-- \begin{equation} -->
<!-- h \in (0, 1) -->
<!-- \end{equation} -->

<!-- The effective domain of $h$ in turn implies the following bounds on the own price elasticity of input demand. -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x_v^*)}{\partial \ln(w_v)} \in (\infty, -1) -->
<!-- \end{equation} -->

<!-- The input demand curve is thus always elastic, such that the increase in farm level demand resulting from a decrease in the input price is always more than proportionate to the fall in price. -->

<!-- Note that the cross price elasticity of input demand also bears the expected sign under the effective domain of $h$, -->


<!-- As does the output price elasticity of input demand, -->

<!-- \begin{equation} -->
<!-- \frac{\partial \ln(x_v^*)}{\partial \ln(P)} = \frac{1}{1 - h} -->
<!-- \end{equation} -->

<!-- Equation \ref{eq:inputDem2} implies that the input demand curve^["Input demand curve" is used as a shorthand for the "optimal input level as a function of its price, with all other variables held constant".] is a power law. This is more evident when expressed in the following compact form. -->

<!-- \begin{equation} -->
<!-- x_v^* = z w_v^{\eta(w_v, x_v^*)} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- z = \left(y_0 \frac{\theta_x \theta_k}{\lambda^h \tilde{\theta}_w} \right)^{\frac{1}{1 - h}} \:\:;\:\:\: \tilde{\theta}_w = w_v^{-\alpha_v}\theta_w -->
<!-- \end{equation} -->

<!-- And $\eta(w_v, x_v^*)$ is the own price elasticity of input demand, derived in equation \ref{eq:ownPriceElas}. -->

<!-- In equation \ref{eq:cobbDoug2}, the shorthand $y_0 = e^{\alpha_0}$ has also been introduced. The scale factor $y_0$ is the yield when inputs $\mathbf{x}$ are set to 1 and the control variables $\mathbf{k}$ are also set to 1. It may thus be interpreted as the "unit input yield" or "unit input ceteris paribus yield", to be more precise. "Basal yield" is henceforth used as a shorthand. -->
<!-- Many economists prefer to call $y_0$ the "total factor productivity" (TFP). This is because $y_0$ equals, in some sense, the "yield per unit all inputs" when it is isolated on one side of the equation. However, the presence of control variables complicates this interpretation. Moreover, TFP implies bizarre and rather useless units of measurement. For example, if the inputs $x_i$ are labor and pesticide, while the control variables $k_i$ are rainfall, temperature, and farmer age, then the TFP $y_0$ has units of kg hectare$^{-1}$ manhour$^{-1}$ liter$^{-1}$ millimeter$^{-1}$ degree Celsius$^{-1}$ years$^{-1}$, each of which is raised to various exponents (the respective elasticities $\alpha_i$ and $\kappa_i$). Because of the exponents, a more accurate name for TFP would be the "technology adjusted total factor productivity". -->
<!-- Nonetheless, a very mature literature has developed around TFP, and the reader is encouraged to continue thinking of $y_0$ in terms of TFP if that is what they are most comfortable with. The "basal yield" interpretation is merely provided here as an alternative for those of us who wrestle with the idea of TFP or are not yet familiar with it. -->
<!-- exogenously given control variables like age, soil quality, or climate variables. -->
<!-- TFP vis-à-vis dimensional analysis -->
<!-- The (in)famous residual -->
<!-- “The rate of growth of total factor productivity is defined as the difference between the rate of growth of real product and the rate of growth of real factor input” (Jorgenson & Griliches, 1967). This definition violates dimensional analysis. -->
<!-- Given a yield function -->
<!-- y=Kx_1^(α_1 ) x_2^(α_2 )…x_n^(α_n )	(1) -->
<!-- "TFP"=K=y/(x_1^(α_1 ) x_2^(α_2 )…x_n^(α_n ) )	(2) -->
<!-- There are two problems with this expression from the point of view of dimensional analysis. First of all, the units in which “TFP” is expressed are impossible to make sense of. Say n=4, with x_1 standing for labor, x_2 for machinery, x_3 for fertilizer, and x_4 for pesticide. Then TFP has units of production per unit -->
<!-- area (man hour)^(α_1 ) (machine hour)^(α_2 )  (weight)^(α_3 )  (volume)^(α_4 )	(3) -->
<!-- The second, more serious, problem is that these units will always vary from one data set to another. Even if the variables x_1,x_2,…,x_n are the same across studies, and are expressed in the same units, the units in which the “residual” K is expressed will nonetheless vary because the estimated parameters α_i vary. It is therefore impossible to make meaningful comparisons of K across data sets. -->
<!-- On the other hand, it is possible to make meaningful comparisons of the residual in another sense. Define the parameter K as follows: -->
<!-- K=k/(x ̃_1^(α_1 ) x ̃_2^(α_2 )…x ̃_n^(α_n ) )	(3) -->
<!-- Where the x ̃_i are arbitrarily chosen reference values. Then the yield equation becomes: -->
<!-- y=ku_1^(α_1 ) u_2^(α_2 )… u_n^(α_n )  ;  u_i=x_i/x ̃_i 	(3) -->
<!-- It now becomes clear what the units of k are. Each x ̃_i has the same units as its respective x_i. This means that all of the u_i^(α_i ) terms on the right hand side of the equation are dimensionless. Therefore, the units of k must agree with the units of whatever is on the left hand side, which happens to be yield.  -->
<!-- k=y/(u_1^(α_1 ) u_2^(α_2 )… u_n^(α_n ) )	(5) -->
<!-- When interpreted in this way, it is now possible to make meaningful comparisons of the residual across data sets (if the reference values x ̃_i are harmonized across the data sets). However, the residual now has units of productivity with respect to land only, and not with respect to any other factor, much less the “total factor”. -->
<!-- Conclusion -->
<!-- Above I have shown that TFP (equation 2) is measured in units which 1) are virtually impossible to make sense of, and 2) cannot be compared across data sets. I have shown that it is possible to express the residual in straightforward units that are comparable across data sets, but that these are units of land productivity only. The residual may be interpreted as TFP only at the cost of nonsensical units and cross-study incompatibility. A residual with sensible units and comparability, on the other hand, comes at the cost of expressibility only in units of a single factor’s productivity—land in the case of farms, widget factories in the case of firms. -->
<!-- As mentioned above, this result depends on a definition of small increase as a marginal increase. Other forms result from other definitions of small increase. If small increase is defined as a percentage increase, for example, a functional form involving Lambert's W function results (left as an exercise for the reader). The Cobb-Douglas function is selected from among these two choices on empirical grounds. (The Cobb-Douglas function is famous for how well it fits economic data across many contexts and scales.) -->
<!-- [# Derivation of the yield envelope from Axiom 2 (net benefit maximization)] -->



<!-- ## The farm net benefit envelope -->

<!-- The optimized objective function or "net benefit envelope" $\mathcal{L}^*$ is just the objective function $\mathcal{L}$ evaluated at the optimal yield $y^*$. -->

<!-- \begin{equation} -->
<!-- \mathcal{L}^* = \mathcal{L} \bigr|_{y = y^*} = P y^* - \lambda (C^* - B) -->
<!-- \end{equation} -->

<!-- Note that, applying the handy relation in equation \ref{eq:lambdaHandy}, the net benefit envelope can be rewritten without the optimal expenditure term $C^*$. -->

<!-- \begin{equation} -->
<!-- \mathcal{L}^* = (1 - h) P y^* + \lambda B -->
<!-- \label{eq:NBenv} -->
<!-- \end{equation} -->

<!-- Farm production $q^*$ is, of course, just farm yield envelope times farm area. Often, area is one of the control variables in $\theta_k$. In this case, $q^*$ is given by adding $1$ to the fitted exponent (call this $\kappa_a$) on area. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- q^* &= A y^* \\ -->
<!-- &= y_0 \hat{\theta}^{\eta(D)} \left(\frac{E[P(T)]\bigr|_{t = 0}}{\lambda}\right)^{\eta(E[P(T)]\bigr|_{t = 0})} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \hat{\theta} &= \frac{\theta_x \hat{\theta_k}}{\theta_w} \\ -->
<!-- \hat{\theta_k} &= A \theta_k = A^{\kappa_a + 1} \prod_{i \neq a}^{n_k} k_i^{\kappa_i} -->
<!-- \end{split} -->
<!-- \end{equation} -->


<!-- \begin{equation} -->
<!-- \int_{0}^{h^{-\eta(P)}} \lambda^{-\eta(P)} f(\lambda^{-\eta(P)}) \: d \lambda^{-\eta(P)} = E[\lambda^{-\eta(P)}] (1 - \Phi(z)) -->
<!-- \end{equation} -->

<!-- Where -->

<!-- \begin{equation} -->
<!-- z = \frac{\ln\left( \left( \frac{\mu_{C^{\#}}(0)}{P(0)} \right)^{\eta(D)} \right) - \left(\eta(D) m_{\lambda} - \eta(D)^2 \frac{s_{\lambda}^2}{2} \right)T}{s_{\lambda} \sqrt{T}} -->
<!-- \end{equation} -->

<!-- The term $1 - \Phi(z)$ may thus be interpreted as the probability, at planting time, that the elasticity adjusted output price at time of harvest and sale $P(T)^{\eta(P)}$ will be greater than the corresponding elasticity adjusted mean marginal cost of production $\mu_{C^{\#}}(T)^{\eta(D)}$. -->

<!-- \begin{equation} -->
<!-- 1 - \Phi(z) = \text{Prob}(P(T)^{\eta(D)} > \mu_{C^{\#}}(T)^{\eta(D)}) -->
<!-- \end{equation} -->

<!-- The effect of $\eta(D)$ in this equation is to regulate the rate at which the condition $P(T)^{\eta(D)} > \mu_{C^{\#}}(T)^{\eta(D)}$ is met (or fails) with changes in either $P(T)$ or $\mu_{C^{\#}}(T)$. To see this, it may be helpful to rewrite the condition in terms of a "marginal benefit-cost" ratio $r$. -->
<!-- \begin{equation} -->
<!-- 1 - \Phi(z) = \text{Prob}(r^{\eta(D)} > 1) \:\:;\:\:\: r = P(T) / \mu_{C^{\#}}(T) -->
<!-- \end{equation} -->
<!-- As $\eta(D)$ is lower, $r^{\eta(D)}$ changes less when $r$ changes. As $\eta(D)$ is higher, movements of $r^{\eta(D)}$ become more pronounced in response to changes in $r$. -->






<!-- ----------------------------------- -->
<!-- ...expedient forms are considered unavoidable because...characterize the alternative, a theoretical derivation, as an impossible task [a fool's errand?]... -->
<!--  In the name of expedience, then, many methodological headaches are accumulated. At some point the headaches outweigh the expedience   Difficult to defend and impossible to account for farm entry and exit. disentangle impact from model artifact...difficult to tell whether the result is due to exogenous shock, or to artifacts of the model  ... -->



<!-- The expression for aggregate supply in Equation \ref{eq:sup1} can now be written more explicitly as follows. -->
<!-- \begin{equation} -->
<!-- E[Q(T)]\bigr|_{t = 0} = N \int_0^{\bar{q}^*(T)} E[q^*(T)]|_{t = 0} f(q^*(T))  \: d q^*(T) -->
<!-- \label{eq:sup2} -->
<!-- \end{equation} -->
<!-- Where the farm production density $\rho(q^*)$ has been expressed in terms of a probability density $N f(q^*)$, where $N$ is the number of farms in the population. -->
<!-- Substituting Equation \ref{eq:yStarC0b} for $q^*$, the aggregate supply curve becomes -->
<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- E[Q(T)]\bigr|_{t = 0} &= N \int_0^{E[P(T)]\bigr|_{t = 0}} \left(\frac{\theta_x}{\theta_w} \theta_k \right)^{\frac{\eta}{h}} h^{-\eta} E[C^{\#}(T)]|_{t = 0} f(C^{\#}(T)) \: d C^{\#}(T) \\ -->
<!-- &= N \left(\frac{\theta_x}{\theta_w} \right)^{\frac{\eta}{h}} \hat{\theta}_k h^{-\eta} \int_0^{E[P(T)]\bigr|_{t = 0}} E[C^{\#}(T)]|_{t = 0} f(C^{\#}(T))  \: d C^{\#}(T) -->
<!-- \end{split} -->
<!-- \label{eq:sup3} -->
<!-- \end{equation} -->
<!-- Assuming production is lognormally distributed (axiom 5), this expression further resolves as follows. -->
<!-- \begin{equation} -->
<!-- E[Q(T)]\bigr|_{t = 0} = N E[E[q^*(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln\left(\frac{E[\bar{q}^*(T)]|_{t = 0}}{E[E[q^*(T)]|_{t = 0}]}\right) - \frac{\nu^2}{2}}{\nu} \right) \:\:;\:\:\: \nu^2 = Var[\ln(E[q^*(T)]\bigr|_{t = 0})] -->
<!-- \label{eq:sup3} -->
<!-- \end{equation} -->
<!-- (See Appendix for details.) -->


<!-- Science under scarcity p360: -->
<!-- "(after allowing for the optimization of the input mix when switching from existing technology to new technology and allowing for differences between changes in commercial yields and changes in experimental yields)" -->

<!-- The exogenous shock is introduced as a change in farm yield and cost elicited from experimental trial results and from scientists with a clear conflict of interest. These results must then be adjusted to reflect economic yield as opposed to experimental yield, but no clear method of adjustment is available because, in the name of expedience, the aggregate curve is not built up from the farm level curve, and so no farm level yield function is ever specified in the process. The change in yield in cost must be calculated from the economic yield and cost envelopes evaluated at the new technology, not the other way around. The impact asessor must elicit the change in technical efficiency resulting from the new technology and then calculate the change in yield and cost by evaluating the optimized yield and cost functions at the    The change in technology      The mechanism by which  ...also the price elasticity of aggregate supply is assumed to be independent of changes in technology... The impact assessment thus effectively an impact assertion. _petitio principii_ ... a great many methodological headaches are quickly accumulated in the name of expedience, which ultimately defeat the purpose/invalidate the model/etc. -->
<!-- ...They also introduce exogenous shocks in terms of a cost reduction---typically based on results gathered at experimental stations under biophysically optimal management conditions---whereas the cost reduction must be modeled as an endogenous economic reaction to a change in technological parameters....Cost, more properly optimal expenditure, is an economic variable, a function of technology and prices. Since the 1950s it has been observed that "yields are very different when the goal is changed to maximizing profit" [Pingali etc.]... By assuming a cost reduction, the modeler effectively engages in petitio principii---i.e. assumes what must be proven.... below we show that the cost/supply response to changes in tech is far more complex than the conventional treatment would suggest.  -->


<!-- The authors warn against this conflict of interest, and provide a few recommendations for managing this bias, none of which are ever followed in practice.... the result is a sort of positive impact assessment mill -->
<!-- Science under scarcity p349: -->
<!-- >When information for calculating Ks for prospective research is elicited from scientists, it is necessary to guard against unrealistic responses that would invalidate the analysis and the use of the results for evaluating research or setting priorities. A particular risk of bias  -->
<!-- arises because scientists know the purpose of the analysis and often have (or perceive) a vested interest in a high measured rate of return to research. Three ways of dealing with this potential bias are (a) using objective data on past experimental results, historical yield trends, and perhaps, total factor productivity growth rates to calibrate the elicitations, (b) creating an environment of peer review and, perhaps, a competitive process (e.g., Delphi methods) that will reduce the potential for personal incentives to bias estimates of technical parameters, and (c) creating an institutional setting in which scientists will be held accountable for systematic biases in their estimates of research impact (e.g., by comparing actual achievements within programs over time against scientists' forecasts of what would be achieved). -->



<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- #====================================================================== -->
<!-- # # Model validation tests -->
<!-- # #---------------------------------------------------------------------- -->
<!-- # coefsNames <- gsub("`", "", names(mod1$coefficients)) -->
<!-- # aVec <- mod1$coefficients[which(coefsNames %in% inputsPosCoef)] -->
<!-- # # If seed coef removed, calculation of h based on model 1 input coefs -->
<!-- # # matches estimation of h in model 2  -->
<!-- # rmThese <- which(names(aVec) == "`seed (kg/acre)`")#%in% c("`seed (kg/acre)`", "`harvesting fam lab male (pers-hrs/acre)`")) -->
<!-- # aVec <- aVec[-rmThese] -->
<!-- # hFull <- sum(aVec) -->
<!-- # #aVec / h -->
<!-- # inputMat <- as.matrix(df_mod1[, inputsPosCoef[-c(1)]]) # (if removing seed coef) -->
<!-- # #inputMat <- as.matrix(df_mod1[, inputsPosCoef]) -->
<!-- # inputMat[inputMat != 0] <- 1 -->
<!-- # h <-  inputMat %*% aVec -->
<!-- # eta <- h / (1 - h) -->
<!-- # hist(h, breaks = 10) -->
<!-- # #ind_h0 <- which(h == 0) -->
<!-- # #hist(df_mod1$`yield (kg/acre)`[ind_h0]) -->
<!-- # #unique(df_mod1$dist[ind_h0]) -->
<!-- # #hist(df_mod1$`seed (kg/acre)`[ind_h0]) -->
<!-- # #hist(df_mod1$aehh07[ind_h0]) -->
<!-- # #plot(mod1$fitted.values[ind_h0], mod1$residuals[ind_h0]) -->
<!-- # #View(df_mod1[ind_h0, ]) -->
<!-- # #h[ind_h0] <- 0.02 -->
<!-- # #--- -->
<!-- # # Validation test 1 using cost shares vs. tech shares -->
<!-- # # (Theory predicts that input cost_i / total input cost = alpha_i / h) -->
<!-- # # (So the following ratios should = 1, or log(ratio) = 0) -->
<!-- # # Encouraging results, make sure `cost/acre` only includes inputs used in model, -->
<!-- # # and that seed might better not be considered an input -->
<!-- # #--- -->
<!-- # `cost/acre` <- exp(df_mod1$`cost/acre`) -->
<!-- # yStar <- exp(df_mod1$`yield (kg/acre)`) -->
<!-- # # `cost/acre`, yStar, and CtildeStar are lognormally distributed -->
<!-- # cSharpEff <- `cost/acre` / yStar -->
<!-- # # # hist(log(CtildeStarEff), breaks = 25) -->
<!-- # # # hist(log(`cost/acre`), breaks = 25) -->
<!-- # # # hist(log(yStar), breaks = 25) -->
<!-- # # # #`cost/acre`[which(`cost/acre` == 1)] <- 0 -->
<!-- # # # hist(log(`cost/acre` / yStar)) -->
<!-- # # #ratio <- aVec[which(names(aVec) == "`seed (kg/acre)`")] / h * `cost/acre` / df_mod1$`seed (KES/acre)` -->
<!-- # # #ratio <- aVec[which(names(aVec) == "`manure (kg/acre)`")] / h * `cost/acre` / df_mod1$`manure (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total NPK fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total CAN fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total UREA fert (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`dap (kg/acre)`")] / h * `cost/acre` / df_mod1$`dap (KES/acre)` -->
<!-- # # ratio <- aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / h * `cost/acre` / df_mod1$`Total P&D chem (KES/acre)` -->
<!-- # # #hist(log(ratio)) -->
<!-- # # #--- -->
<!-- # # # Validation test 2 based only on input costs and tech coeffs -->
<!-- # # # (Theory says input cost_i / alpha_i = input cost_j / alpha_j) -->
<!-- # # # (So the following ratios should = 1, or log(ratio) = 0) -->
<!-- # # # More encouraging results! -->
<!-- # # # Ratios involving seed continue to diverge from theory, -->
<!-- # # # maybe b/c the seed cost is incomplete, -->
<!-- # # # maybe farmers have ways of getting it for free -->
<!-- # # # maybe b/c seed cost is not really a management variable -->
<!-- # # # Note this way of validating opens the door to deducing family labor wage -->
<!-- # # #--- -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` *  -->
<!-- # #   aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")] / (df_mod1$`Total NPK fert (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")] / (df_mod1$`Total UREA fert (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total UREA fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")]) -->
<!-- # # #ratio <- df_mod1$`seed (KES/acre)` * aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`seed (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")] / (df_mod1$`Total CAN fert (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / (df_mod1$`Total P&D chem (KES/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")] / (df_mod1$`Total P&D chem (KES/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # ratio <- df_mod1$`Total P&D chem (kg/acre)` * -->
<!-- # #   aVec[which(names(aVec) == "`dap (kg/acre)`")] / (df_mod1$`dap (kg/acre)` * aVec[which(names(aVec) == "`Total P&D chem (kg/acre)`")]) -->
<!-- # # # # Fam labor is in qty terms, not cost terms, but exhibits stable ratio values -->
<!-- # # # ratio <- df_mod1$`Total CAN fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total CAN fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`Total NPK fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total NPK fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`Total UREA fert (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`Total UREA fert (kg/acre)`")]) -->
<!-- # # # ratio <- df_mod1$`dap (KES/acre)` * aVec[which(names(aVec) == "`harvesting fam lab male (pers-hrs/acre)`")] / (df_mod1$`harvesting fam lab male (pers-hrs/acre)` * aVec[which(names(aVec) == "`dap (kg/acre)`")]) -->
<!-- # # #hist(log(ratio)) -->


<!-- Given a lognormally distributed random variable $u$, such that $\ln(u)$ is normally distributed with mean $m_u$ and variance $s_u^2$, then the expected value of $u$ is -->
<!-- <!-- Where $p(q)$ is the probability density function of the random variable $q$. If $\ln(q)$ is normally distributed with mean $m_u$ and variance $s_u^2$, then --> -->

<!-- \begin{equation} -->
<!-- E[u] = e^{m_u + \frac{s_u^2}{2}} -->
<!-- \label{eq:muU} -->
<!-- \end{equation} -->

<!-- And the probability density function of $u$ is -->

<!-- \begin{equation} -->
<!-- f(u) = \frac{1}{u s_u} \phi \left(\frac{\ln(u) - m_u}{s_u} \right) -->
<!-- \end{equation} -->

<!-- Where $\phi()$ is the standard normal probability density function. -->

<!-- Now, introducing a change of variables, -->

<!-- \begin{equation} -->
<!-- p = \frac{\ln(u) - m_u}{s_u} -->
<!-- \label{eq:subThis1} -->
<!-- \end{equation} -->

<!-- Such that -->

<!-- \begin{equation} -->
<!-- \frac{dp}{du} = \frac{1}{u s_u}\: \rightarrow \: d u = u s_u dp -->
<!-- \label{eq:subThis2} -->
<!-- \end{equation} -->

<!-- Then -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{\bar{u}} u f(u) \: du &= \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{s_u p + m_u} \phi(p) \: dp  \\ -->
<!-- &= \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{s_u p + m_u} \frac{1}{\sqrt{2 \pi}} e^{\frac{p^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{p s_u + m_u -\frac{p^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-1 / 2 (p^2 - 2 p s_u - 2 m_u)} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2} + m_u + \frac{s_u^2}{2}} \: dp \\ -->
<!-- &= \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} e^{m_u + \frac{s_u^2}{2}} \: dp \\ -->
<!-- &= e^{m_u + \frac{s_u^2}{2}} \frac{1}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} \: dp \\ -->
<!-- &= \frac{E[u]}{\sqrt{2 \pi}} \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} e^{-\frac{(p - s_u)^2}{2}} \: dp \\ -->
<!-- &= E[u] \int_0^{\frac{\ln(\bar{u}) - m_u}{s_u}} \phi(p - s_u) \: dp \\ -->
<!-- &= E[u] \Phi \left(\frac{\ln(\bar{u}) - m_u}{s_u} - s_u \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Finally, rearranging equation \ref{eq:muU} into an expression for $m_u$ -->

<!-- \begin{equation} -->
<!-- m_u = \ln(E[u]) - \frac{s_u^2}{2} -->
<!-- \end{equation} -->

<!-- And substituting this in for $m_u$ in the previous expression gives -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \int_0^{\bar{u}} u f(u) \: du &= E[u] \Phi \left(\frac{\ln(\bar{u}) - \ln(E[u]) + \frac{s_u^2}{2} }{s_u} - s_u \right) \\ -->
<!-- &= \frac{E[u]} \Phi \left(\frac{\ln \left(\frac{\bar{u}}{E[u]} \right) - \frac{s_u^2}{2} }{s_u} \right) -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- In Equation \ref{eq:sup3}, $u = E[q^*(T)]\bigr|_{t = 0}$, giving -->

<!-- $$ -->
<!-- E[Q(T)]\bigr|_{t = 0} = N_f E[E[q^*(T)]\bigr|_{t = 0}] \Phi \left(\frac{\ln\left(\frac{E[\bar{q}^*(T)]|_{t = 0}}{E[E[q^*(T)]|_{t = 0}]}\right) - \frac{s_{EqT0}^2}{2}}{s_{EqT0}} \right) \:\:;\:\:\: s_{EqT0}^2 = Var[E[q^*(T)]\bigr|_{t = 0}] -->
<!-- $$ -->

<!-- $\blacksquare$ -->
